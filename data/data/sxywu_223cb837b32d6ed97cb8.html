<script>
			function randomData(length) {
				var data = _.map(_.range(length), function() {
					return _.random(1, 500);
				});
				$('.data').text(JSON.stringify(data));
				return data;
			}
			var data = randomData(_.random(1, 10));

			var g = d3.select('svg').append('g'),
				color = d3.scale.category20(),
				width = 20,
				height = 500;

      var rect = g.selectAll('rect')
      	.data(data).enter().append('rect')
      	.attr('x', function(d, i) {return i * width})
      	.attr('y', function(d) {return height - d})
      	.attr('width', width)
      	.attr('height', function(d) {return d})
      	.attr('fill', color);
    
			$('.update').click(function() {
				data = randomData(_.random(1, 10));
       
        rect = g.selectAll('rect')
        	.data(data);
        
				// enter new rect
        rect.enter().append('rect');
       
        // exit rect no longer needed
        rect.exit().remove();
        
        // update attributes on all the bars that still remain
        rect.transition().duration(500)
          .attr('x', function(d, i) {return i * width})
          .attr('y', function(d) {return height - d})
          .attr('width', width)
          .attr('height', function(d) {return d})
          .attr('fill', color);
			});
		</script>