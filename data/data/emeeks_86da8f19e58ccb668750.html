<script>
      function makeSomeMaps() {
    map = d3.carto.map();

    d3.select("#map").call(map);
    
    tileLayer = d3.carto.layer();
    tileLayer
    .type("tile")
    .path("elijahmeeks.map-azn21pbi")
    .label("Base")
    
    csvLayer = d3.carto.layer.csv();
    csvLayer
    .path("sample_points.csv")
    .label("CSV Points")
    .cssClass("pinkcircle")
    .renderMode("canvas")
    .markerColor("black")
    .markerSize(1)
    .x("x")
    .y("y")
    .on("load", makeVoronoi)
    
    map.addCartoLayer(tileLayer).addCartoLayer(csvLayer);
    map.setScale(3);
    
    function makeVoronoi() {
      voronoiLayer = map.createVoronoiLayer(csvLayer, .5);

      voronoiLayer
      .label("Voronoi")
      .cssClass("voronoi")
      .on("load", colorVoronoi);
      
      map.addCartoLayer(voronoiLayer);
      
      function colorVoronoi() {
      var colorScale = d3.scale.linear().domain([60,80,100]).range(["green","yellow","red"])
        voronoiLayer.g().selectAll("path")
        .style("fill", function(d) {return colorScale(d.properties.node.rank)});
      }
      
    }

  }
</script>
<body onload="makeSomeMaps()">
<div id="map"></div>
<footer>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8" type="text/javascript"></script>
<script src="http://d3js.org/topojson.v1.min.js" type="text/javascript">
</script>
<script src="http://d3js.org/d3.geo.projection.v0.min.js" type="text/javascript">
</script>
<script src="http://bl.ocks.org/emeeks/raw/f3105fda25ff785dc5ed/tile.js" type="text/javascript">
</script>
<script src="http://bl.ocks.org/emeeks/raw/f3105fda25ff785dc5ed/d3.quadtiles.js" type="text/javascript">
</script>
<script src="http://bl.ocks.org/emeeks/raw/f3105fda25ff785dc5ed/d3.geo.raster.js" type="text/javascript">
</script>
<script src="https://rawgit.com/emeeks/d3-carto-map/master/d3.carto.map.js" type="text/javascript">
</script>