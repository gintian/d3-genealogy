<script> d3.eesur = {}; //namespace  </script>
  <script src="d3_code_heatmap_cal.js"></script>
  <script>
  // *****************************************
  // render chart
  // *****************************************
  (function() {
      'use strict';
      
      var nestedData;
      var parseDate = d3.time.format('%Y-%m-%d').parse;

      // create chart
      var heatChart = d3.eesur.heatmap()
          .colourRangeStart('#FDBB30')
          .colourRangeEnd('#EE3124')
          .height(800)
          .startYear('2011')
          .endYear('2016')
          .on('_hover', function (d, i) {
              var f = d3.time.format('%B %d, %Y');
              d3.select('#info')
                  .text(function () {
                      return 'date: ' + f(d) + ' | value: ' + nestedData[d];
                  });
          });

      // apply after nesting data
      d3.json('heatmap_data.json', function(error, data) {

          if (error) return console.warn(error);
        
          nestedData = d3.nest()
              .key(function (d) { return parseDate(d.date.split(' ')[0]); })
              .rollup(function (n) { 
                  return d3.sum(n, function (d) { 
                      return d.amount; // key
                  }); 
              })
              .map(data);

          // console.log(nestedData);

          // render chart
          d3.select('#heatmap')
              .datum(nestedData)
              .call(heatChart);

      });

  }());

  d3.select(self.frameElement).style('height', '900px');

  </script>