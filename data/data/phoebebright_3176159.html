<script>
    d3.csv("./data.csv", function(csv_data){

        var nested_data = d3.nest()
                .key(function(d)  { return d.status; })
                .entries(csv_data);


        $("#ex1").html(JSON.stringify(nested_data, null, 3));

        var nested_data = d3.nest()
                .key(function(d) { return d.status; })
                .key(function(d) { return d.priority; })
                .entries(csv_data);


        $("#ex2").html(JSON.stringify(nested_data, null, 3));

        var nested_data = d3.nest()
                .key(function(d) { return d.status; })
                .key(function(d) { return d.priority; })
                .rollup(function(leaves) { return leaves.length; })
                .entries(csv_data);


        $("#ex3").html(JSON.stringify(nested_data, null, 3));

        var nested_data = d3.nest()
                .key(function(d) { return d.status; })
                .key(function(d) { return d.priority; })
                .rollup(function(leaves) {
                    return {"length": leaves.length,
                        "total_time": d3.sum(leaves, function(d) {return parseFloat(d.time);})} })
                .entries(csv_data);


        $("#ex4").html(JSON.stringify(nested_data, null, 3));


        var nested_data = d3.nest()
                .key(function(d) { return d.status; }).sortKeys(d3.ascending)
                .key(function(d) { return d.priority; }).sortKeys(d3.descending)
                .rollup(function(leaves) { return leaves.length; })
                .entries(csv_data);


        $("#ex5").html(JSON.stringify(nested_data, null, 3));

        var priority_order = ['MUST', "SHOULD", 'COULD', 'WISH'];
        var nested_data = d3.nest()
                .key(function(d) { return d.status; }).sortKeys(d3.ascending)
                .key(function(d) { return d.priority; }).sortKeys(function(a,b) { return priority_order.indexOf(a) - priority_order.indexOf(b); })
                .rollup(function(leaves) { return leaves.length; })
                .entries(csv_data);


        $("#ex6").html(JSON.stringify(nested_data, null, 3));

        var priority_order = ['MUST', "SHOULD", 'COULD', 'WISH'];
        var nested_data = d3.nest()
                .key(function(d) { return d.status; }).sortKeys(d3.ascending)
                .key(function(d) { return d.priority; }).sortKeys(function(a,b) { return priority_order.indexOf(a) - priority_order.indexOf(b); })
                .sortValues(function(a,b) { return parseFloat(a.time) - parseFloat(b.time); } )
                .entries(csv_data);


        $("#ex7").html(JSON.stringify(nested_data, null, 3));

        var priority_order = ['MUST', "SHOULD", 'COULD', 'WISH'];
        var nested_data = d3.nest()
                .key(function(d) { return d.status; }).sortKeys(d3.ascending)
                .key(function(d) { return d.priority; }).sortKeys(function(a,b) { return priority_order.indexOf(a) - priority_order.indexOf(b); })
                .sortValues(function(a,b) { return ((a.who < b.who)
                    ?  -1
                    :  1);
                    return 0;} )
                .entries(csv_data);


        $("#ex8").html(JSON.stringify(nested_data, null, 3));

        var nested_data = d3.nest()
                .rollup(function(leaves) { return leaves.length; })
                .entries(csv_data);


        $("#ex9").html(JSON.stringify(nested_data, null, 3));

        var nested_data = d3.nest()
                .key(function(d) { return d.who}).sortKeys(d3.ascending)
                .rollup(function(leaves) { return leaves.length; })
                .entries(csv_data);

        var list = d3.select("#ex10").append("select")

        list.selectAll("option")
                .data(nested_data)
                .enter()
                .append("option")
                .attr("value", function(d) {return d.key;})
                .text(function(d) {
                    return d.key; });
    });



</script>