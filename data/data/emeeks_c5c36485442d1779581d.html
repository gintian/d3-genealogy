<script>
  function makeSomeMaps() {
    map = d3.carto.map();

    d3.select("#map").call(map);

    map.setScale(9)
    map.centerOn([-0.1275,51.507],"latlong");

    tileLayer = d3.carto.layer();
    tileLayer
    .type("tile")
    .path("examples.map-zgrqqx0w")
    .label("Base")
    
    topojsonLayer = d3.carto.layer();
    topojsonLayer
    .type("topojson")
    .path("http://bl.ocks.org/emeeks/raw/80dc1e4c11586c47a266/glondon.topojson")
    .label("London Wards")
    .cssClass("wards")
    .renderMode("svg")
    .clickableFeatures(true)
    .on("load", colorBySize);

    map.addCartoLayer(tileLayer);
    map.addCartoLayer(topojsonLayer);
    
// Function is called on load because it won't have anything to apply to until the layer is loaded
    function colorBySize() {
    var featureData = topojsonLayer.features();
    var sizeExtent = d3.extent(featureData, function (d) {return d.properties.w_size})
    var sizeScale = d3.scale.quantile().domain(sizeExtent).range(colorbrewer.Greens[5]);

      d3.selectAll("path.wards")
      .style("fill", function (d) {return sizeScale(d.properties.w_size)})
    
        //Some simple hover behavior
    d3.selectAll("path.wards").style("pointer-events", "auto").on("mouseover", wardOver).on("mouseout", wardOut);
    
    function wardOver(d,i) {
      d3.selectAll("path.wards").style("opacity", function (p) {return p.properties.region == d.properties.region ? .3 : 1})
    }

    function wardOut(d,i) {
      d3.selectAll("path.wards").style("opacity", 1)
    }
    }
  }
</script>
<body onload="makeSomeMaps()">
<div id="map"></div>
<footer>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8" type="text/javascript"></script>
<script src="http://d3js.org/topojson.v1.min.js" type="text/javascript">
</script>
<script src="http://d3js.org/d3.geo.projection.v0.min.js" type="text/javascript">
</script>
<script src="http://d3js.org/colorbrewer.v1.min.js"></script>
<script src="http://bl.ocks.org/emeeks/raw/f3105fda25ff785dc5ed/tile.js" type="text/javascript">
</script>
<script src="http://bl.ocks.org/emeeks/raw/f3105fda25ff785dc5ed/d3.quadtiles.js" type="text/javascript">
</script>
<script src="http://bl.ocks.org/emeeks/raw/f3105fda25ff785dc5ed/d3.geo.raster.js" type="text/javascript">
</script>
<script src="https://rawgit.com/emeeks/d3-carto-map/master/d3.carto.map.js" type="text/javascript">
</script>