<script>
// Create the map object
var map = L.map('map').setView([57, -94], 4);

// Add a tile layer from MapBox
L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}',
    {
        accessToken: 'pk.eyJ1IjoiYnJpZGVhdSIsImEiOiJIazVVNG1FIn0.MTzqTSVYYBaTXC885WRF1Q',
        id: 'brideau.o74k1moh',
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery  <a href="http://mapbox.com">Mapbox</a>'
    }).addTo(map);

var svg = d3.select(map.getPanes().overlayPane).append("svg"),
    g = svg.append("g").attr("class", "leaflet-zoom-hide");

var transfoo;
var pathypath;
d3.json("fed3082011topoQ1e5S40.json", function(error, canada) {
    if (error) throw error;

    // http://jsfiddle.net/cvs5d7o9/2/
    function projectPointD3(x, y) {
        // new L.LatLng creates a new lat/lng object with "lat" and "lng" as
        // keys. Topojson uses the (lng,lat) ordering so the x and y need to be
        // reversed. Equivalent to [y,x], or {lon:x, lat:y}
        var pointLatLng = new L.LatLng(y, x);
        // latLngToLayerPoint takes the lat/lng point and returns the x and y
        // coordinate for the point on the screen.
        var point = map.latLngToLayerPoint(pointLatLng);
        this.stream.point(point.x, point.y);
    }

    // Does plain old projecting from lat/lng to
    // an x/y coordinate
    function projectPoint(lat, lng) {
        var pointLatLng = new L.LatLng(lat, lng);
        var point = map.latLngToLayerPoint(pointLatLng);
        return point
    }

    var transform = d3.geo.transform({point: projectPointD3}),
        path = d3.geo.path().projection(transform);
    transfoo = transform;
    pathypath = path;
    var feature = g.selectAll("path")
        .data(topojson.feature(canada, canada.objects.districts2011).features)
        .enter().append("path");``


    map.on("viewreset", reset);
    reset();

    function reset() {
        var bounds = canada.bbox,
            left = bounds[0],
            bottom = bounds[1],
            right = bounds[2],
            top = bounds[3];
        var topLeft = projectPoint(top, left);
        var bottomRight = projectPoint(bottom, right);
        top = topLeft.y
        left = topLeft.x
        bottom = bottomRight.y
        right = bottomRight.x

        svg.attr("width", right - left)
            .attr("height", bottom - top)
            .style("left", left + "px")
            .style("top", top + "px");
        g.attr("transform", "translate(" + -left + "," + -top + ")");

        feature.attr("d", path);
    }

});
</script>