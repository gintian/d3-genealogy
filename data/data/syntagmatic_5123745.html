<script>
var url = "nutrients.csv";
var numerics = ["protein (g)", "calcium (g)", "sodium (g)"];

var nutrients,
    protein, calcium, sodium;

// load the data from an external file
d3.csv(url, function(data) {

  // coerce numbers to floats, empty strings to null
  data.forEach(function(d) {
    numerics.forEach(function(dim) {
      d[dim] = isNumber(d[dim]) ? parseFloat(d[dim]) : null;
    });
  });

  // load data into crossfilter
  nutrients = crossfilter(data);

  // construct filtering dimensions
  protein = nutrients.dimension(function(d) { return d["protein (g)"]; });
  calcium = nutrients.dimension(function(d) { return d["calcium (g)"]; });
  sodium = nutrients.dimension(function(d) { return d["sodium (g)"]; });

  // done loading
  d3.select("#loading").text("Loaded " + url);

  // display dataset size
  d3.select("#size").text(nutrients.size());

  // display top K lists
  renderTopList(protein, 6, "#protein-list");
  renderTopList(calcium, 6, "#calcium-list");
  renderTopList(sodium, 6, "#sodium-list");
});

// http://stackoverflow.com/a/1830844
function isNumber(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}

function renderTopList(dimension, count, selector) {
  d3.select(selector).selectAll("li")
    .data(dimension.top(count))
    .enter().append("li")
    .text(function(d) { return d.name });
}
</script>