{"took":5,"timed_out":false,"_shards":{"total":5,"successful":5,"failed":0},"hits":{"total":944,"max_score":null,"hits":[{"_index":"blockbuilder","_type":"blocks","_id":"3cba6ac2fac09e5483bf6c1fade733be","_score":null,"_source":{"userId":"mbostock","description":"Example Authors","created_at":"2016-05-01T16:48:27Z","updated_at":"2016-05-03T18:43:10Z","api":["d3.select","d3.format","d3.pack","d3.json","d3.hierarchy","d3.selectAll"],"colors":["#aaaaaa","#dddddd","#000000","#ff0000","#d2b48c"],"readme":"Source: [Stewart Noyce](/StewartNoyce/8699346), [Christophe Viau](http://christopheviau.com/d3list/gallery.html).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ntext {\n  font: 10px sans-serif;\n  text-anchor: middle;\n}\n\n.node circle {\n  fill: none;\n  pointer-events: all;\n}\n\n.node:not(.node--leaf) circle {\n  stroke: #aaa;\n}\n\n.node--leaf circle {\n  fill: #ddd;\n}\n\n.node--hover circle {\n  stroke: #000 !important;\n  stroke-width: 1.5px;\n}\n\n</style>\n<svg width=\"960\" height=\"960\"><g transform=\"translate(1,1)\"></g></svg>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar svg = d3.select(\"svg\"),\n    width = +svg.attr(\"width\"),\n    height = +svg.attr(\"height\");\n\nvar format = d3.format(\",d\");\n\nvar pack = d3.pack()\n    .size([width - 2, height - 2])\n    .padding(3);\n\nd3.json(\"authors.json\", function(error, data) {\n  if (error) throw error;\n\n  var root = d3.hierarchy(data)\n      .each(function(d) { if (/^other[0-9]+$/.test(d.data.name)) d.data.name = null; })\n      .sum(function(d) { return d.size; })\n      .sort(function(a, b) { return b.value - a.value; });\n\n  pack(root);\n\n  var node = svg.select(\"g\")\n    .selectAll(\"g\")\n    .data(root.descendants())\n    .enter().append(\"g\")\n      .attr(\"transform\", function(d) { return \"translate(\" + d.x + \",\" + d.y + \")\"; })\n      .attr(\"class\", function(d) { return \"node\" + (!d.children ? \" node--leaf\" : d.depth ? \"\" : \" node--root\"); })\n      .each(function(d) { d.node = this; })\n      .on(\"mouseover\", hovered(true))\n      .on(\"mouseout\", hovered(false));\n\n  node.append(\"circle\")\n      .attr(\"id\", function(d, i) { return \"node-\" + i; })\n      .attr(\"r\", function(d) { return d.r; });\n\n  var leaf = node.filter(function(d) { return !d.children; })\n      .classed(\"node--leaf\", true)\n    .filter(function(d) { return d.data.name; });\n\n  leaf.append(\"clipPath\")\n      .attr(\"id\", function(d, i) { return \"clip-\" + i; })\n    .append(\"use\")\n      .attr(\"xlink:href\", function(d, i) { return \"#node-\" + i + \"\"; });\n\n  leaf.append(\"text\")\n      .style(\"font-size\", function(d) { return Math.sqrt(d.r) * 2 + \"px\"; })\n      .attr(\"clip-path\", function(d, i) { return \"url(#clip-\" + i + \")\"; })\n    .selectAll(\"tspan\")\n      .data(function(d) { return d.data.name.split(/\\s+/g); })\n    .enter().append(\"tspan\")\n      .attr(\"x\", 0)\n      .attr(\"y\", function(d, i, nodes) { return 1.3 + (i - nodes.length / 2 - 0.5) + \"em\"; })\n      .text(function(d) { return d; });\n\n  node.append(\"title\")\n      .text(function(d) { return (d.data.name || \"N/A\") + \"\\n\" + (d.children ? \"\" : d.parent.data.name + \"\\n\") + format(d.value); });\n});\n\nfunction hovered(hover) {\n  return function(d) {\n    d3.selectAll(d.ancestors()\n        .map(function(d) { return d.node; }))\n      .classed(\"node--hover\", hover);\n  };\n}\n\n</script>\n","filenames":[".block","README.md","authors.json","index.html","preview.png","thumbnail.png"],"thumb":"d3cee3fa2661b1ce8c830d12d4d815dc9265f086","preview":"7d1cc3e6b2d907026ddd72f353cc9c30503a95ad"},"sort":[1462121307000]},{"_index":"blockbuilder","_type":"blocks","_id":"6526445e2b44303eebf21da3b6627320","_score":null,"_source":{"userId":"mbostock","description":"Beeswarm","created_at":"2016-04-29T18:07:07Z","updated_at":"2016-05-03T18:42:48Z","api":["d3.select","d3.format","d3.scaleLog","d3.csv","d3.extent","d3.forceSimulation","d3.forceX","d3.forceY","d3.forceCollide","d3.axisBottom","d3.voronoi"],"colors":["#000000","#ff0000"],"readme":"A static beeswarm plot implemented using [d3-force](https://github.com/d3/d3-force)’s [collision constraint](https://github.com/d3/d3-force#collision). A Voronoi overlay improves hover interaction.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n.axis text {\n  font: 10px sans-serif;\n}\n\n.cells path {\n  fill: none;\n  pointer-events: all;\n}\n\n.cells :hover circle {\n  fill: red;\n}\n\n</style>\n<svg width=\"960\" height=\"200\"></svg>\n<script src=\"https://d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar svg = d3.select(\"svg\"),\n    margin = {top: 40, right: 40, bottom: 40, left: 40},\n    width = svg.attr(\"width\") - margin.left - margin.right,\n    height = svg.attr(\"height\") - margin.top - margin.bottom;\n\nvar formatValue = d3.format(\",d\");\n\nvar x = d3.scaleLog()\n    .rangeRound([0, width]);\n\nvar g = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nd3.csv(\"flare.csv\", type, function(error, data) {\n  if (error) throw error;\n\n  x.domain(d3.extent(data, function(d) { return d.value; }));\n\n  var simulation = d3.forceSimulation(data)\n      .force(\"x\", d3.forceX(function(d) { return x(d.value); }).strength(1))\n      .force(\"y\", d3.forceY(height / 2))\n      .force(\"collide\", d3.forceCollide(4))\n      .stop();\n\n  for (var i = 0; i < 120; ++i) simulation.tick();\n\n  g.append(\"g\")\n      .attr(\"class\", \"axis axis--x\")\n      .attr(\"transform\", \"translate(0,\" + height + \")\")\n      .call(d3.axisBottom(x).ticks(20, \".0s\"));\n\n  var cell = g.append(\"g\")\n      .attr(\"class\", \"cells\")\n    .selectAll(\"g\").data(d3.voronoi()\n        .extent([[-margin.left, -margin.top], [width + margin.right, height + margin.top]])\n        .x(function(d) { return d.x; })\n        .y(function(d) { return d.y; })\n      .polygons(data)).enter().append(\"g\");\n\n  cell.append(\"circle\")\n      .attr(\"r\", 3)\n      .attr(\"cx\", function(d) { return d.data.x; })\n      .attr(\"cy\", function(d) { return d.data.y; });\n\n  cell.append(\"path\")\n      .attr(\"d\", function(d) { return \"M\" + d.join(\"L\") + \"Z\"; });\n\n  cell.append(\"title\")\n      .text(function(d) { return d.data.id + \"\\n\" + formatValue(d.data.value); });\n});\n\nfunction type(d) {\n  if (!d.value) return;\n  d.value = +d.value;\n  return d;\n}\n\n</script>\n","filenames":[".block","README.md","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"fb32ef40c715ecd762429742f1c20ad84da8d5f0","preview":"fe082f809c5627fd4688e656c237e4478fd0279b"},"sort":[1461953227000]},{"_index":"blockbuilder","_type":"blocks","_id":"1b64ec067fcfc51e7471d944f51f1611","_score":null,"_source":{"userId":"mbostock","description":"Force-Directed Lattice","created_at":"2016-04-27T18:45:53Z","updated_at":"2016-05-03T18:42:31Z","api":["d3.range","d3.forceSimulation","d3.forceManyBody","d3.forceLink"],"colors":["#aaaaaa","#ffffff","#d2b48c"],"readme":"This demonstrates [*forceLink*.iterations](https://github.com/d3/d3-force#link_iterations), which strengthens [d3-force](https://github.com/d3/d3-force)’s link constraint by applying the constraint multiple times per simulation step.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"960\"></canvas>\n<script src=\"https://d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar n = 20;\n\nvar nodes = d3.range(n * n).map(function(i) {\n  return {\n    index: i\n  };\n});\n\nvar links = [];\n\nfor (var y = 0; y < n; ++y) {\n  for (var x = 0; x < n; ++x) {\n    if (y > 0) links.push({source: (y - 1) * n + x, target: y * n + x});\n    if (x > 0) links.push({source: y * n + (x - 1), target: y * n + x});\n  }\n}\n\nvar simulation = d3.forceSimulation(nodes)\n    .force(\"charge\", d3.forceManyBody().strength(-30))\n    .force(\"link\", d3.forceLink(links).distance(20).iterations(10))\n    .on(\"tick\", ticked);\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nfunction ticked() {\n  context.clearRect(0, 0, width, height);\n  context.save();\n  context.translate(width / 2, height / 2);\n\n  context.beginPath();\n  links.forEach(drawLink);\n  context.strokeStyle = \"#aaa\";\n  context.stroke();\n\n  context.beginPath();\n  nodes.forEach(drawNode);\n  context.fill();\n  context.strokeStyle = \"#fff\";\n  context.stroke();\n\n  context.restore();\n}\n\nfunction drawLink(d) {\n  context.moveTo(d.source.x, d.source.y);\n  context.lineTo(d.target.x, d.target.y);\n}\n\nfunction drawNode(d) {\n  context.moveTo(d.x + 3, d.y);\n  context.arc(d.x, d.y, 3, 0, 2 * Math.PI);\n}\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"52c196058672861739f3386b07b57176b18fd813","preview":"d85c6a9585276187e750d6a8eec635b913b361f6"},"sort":[1461782753000]},{"_index":"blockbuilder","_type":"blocks","_id":"01ab2e85e8727d6529d20391c0fd9a16","_score":null,"_source":{"userId":"mbostock","description":"Force-Directed Web Worker","created_at":"2016-04-26T22:17:48Z","updated_at":"2016-04-29T17:56:39Z","api":[],"colors":["#aaaaaa","#ffffff","#ff0000","#d2b48c"],"readme":"This example demonstrates how to compute a static force-directed graph layout using [web workers](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<div id=\"progress\"></div>\n<canvas width=\"960\" height=\"960\"></canvas>\n<script src=\"https://d3js.org/d3-array.v0.7.min.js\"></script>\n<script>\n\nvar nodes = d3_array.range(1000).map(function(i) {\n  return {\n    index: i\n  };\n});\n\nvar links = d3_array.range(nodes.length - 1).map(function(i) {\n  return {\n    source: Math.floor(Math.sqrt(i)),\n    target: i + 1\n  };\n});\n\nvar meter = document.querySelector(\"#progress\"),\n    canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nvar worker = new Worker(\"worker.js\");\n\nworker.postMessage({\n  nodes: nodes,\n  links: links\n});\n\nworker.onmessage = function(event) {\n  switch (event.data.type) {\n    case \"tick\": return ticked(event.data);\n    case \"end\": return ended(event.data);\n  }\n};\n\nfunction ticked(data) {\n  var progress = data.progress;\n\n  meter.style.width = 100 * progress + \"%\";\n}\n\nfunction ended(data) {\n  var nodes = data.nodes,\n      links = data.links;\n\n  meter.style.display = \"none\";\n\n  context.clearRect(0, 0, width, height);\n  context.save();\n  context.translate(width / 2, height / 2);\n\n  context.beginPath();\n  links.forEach(drawLink);\n  context.strokeStyle = \"#aaa\";\n  context.stroke();\n\n  context.beginPath();\n  nodes.forEach(drawNode);\n  context.fill();\n  context.strokeStyle = \"#fff\";\n  context.stroke();\n\n  context.restore();\n}\n\nfunction drawLink(d) {\n  context.moveTo(d.source.x, d.source.y);\n  context.lineTo(d.target.x, d.target.y);\n}\n\nfunction drawNode(d) {\n  context.moveTo(d.x + 3, d.y);\n  context.arc(d.x, d.y, 3, 0, 2 * Math.PI);\n}\n\n</script>\n<style>\n\n#progress {\n  position: fixed;\n  top: 0;\n  left: -6px;\n  width: 0%;\n  height: 2px;\n  background: red;\n}\n\n#progress:before,\n#progress:after {\n  content: \"\";\n  position: absolute;\n  height: 2px;\n  opacity: 0.6;\n  box-shadow: red 1px 0 6px 1px;\n  border-radius: 100%;\n}\n\n#progress:before {\n  width: 20px;\n  right: 0;\n  clip: rect(-6px, 22px, 14px, 10px);\n}\n\n#progress:after {\n  width: 180px;\n  right: -80px;\n  clip: rect(-6px, 90px, 14px, -6px);\n}\n\n</style>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png","worker.js"],"thumb":"3ebd7ac19c589aeda0e2ad0a7bbbabb4bdf1f16c","preview":"783b165fbb722eb4c5375721a05d2d6162b9af2b"},"sort":[1461709068000]},{"_index":"blockbuilder","_type":"blocks","_id":"31ce330646fa8bcb7289ff3b97aab3f5","_score":null,"_source":{"userId":"mbostock","description":"Collision Detection","created_at":"2016-04-25T18:45:54Z","updated_at":"2016-05-03T18:42:08Z","api":["d3.range","d3.forceSimulation","d3.forceX","d3.forceY","d3.forceCollide"],"colors":["#dddddd","#333333"],"readme":"This example uses d3.forceCollide to prevent circles from overlapping.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"960\"></canvas>\n<script src=\"https://d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height,\n    tau = 2 * Math.PI;\n\nvar nodes = d3.range(1000).map(function(i) {\n  return {\n    r: Math.random() * 14 + 4\n  };\n});\n\nvar simulation = d3.forceSimulation(nodes)\n    .drag(0.2)\n    .force(\"x\", d3.forceX().strength(0.002))\n    .force(\"y\", d3.forceY().strength(0.002))\n    .force(\"collide\", d3.forceCollide().radius(function(d) { return d.r + 0.5; }).iterations(2))\n    .on(\"tick\", ticked);\n\nfunction ticked() {\n  context.clearRect(0, 0, width, height);\n  context.save();\n  context.translate(width / 2, height / 2);\n\n  context.beginPath();\n  nodes.forEach(function(d) {\n    context.moveTo(d.x + d.r, d.y);\n    context.arc(d.x, d.y, d.r, 0, tau);\n  });\n  context.fillStyle = \"#ddd\";\n  context.fill();\n  context.strokeStyle = \"#333\";\n  context.stroke();\n\n  context.restore();\n}\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"855c7bb7aa3f4d3c6a12e3ff337f4244f1c336fe","preview":"c9003e85bc26d1d69bc243e4470608c8561fe564"},"sort":[1461609954000]},{"_index":"blockbuilder","_type":"blocks","_id":"95aa92e2f4e8345aaa55a4a94d41ce37","_score":null,"_source":{"userId":"mbostock","description":"Force-Directed Tree","created_at":"2016-04-25T17:58:32Z","updated_at":"2016-05-03T18:41:52Z","api":["d3.range","d3.forceSimulation","d3.forceManyBody","d3.forceLink","d3.forceX","d3.forceY"],"colors":["#aaaaaa","#ffffff","#d2b48c"],"readme":"This randomly-generated tree is positioned using a force simulation.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"960\"></canvas>\n<script src=\"https://d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar nodes = d3.range(1000).map(function(i) {\n  return {\n    index: i\n  };\n});\n\nvar links = d3.range(nodes.length - 1).map(function(i) {\n  return {\n    source: Math.floor(Math.sqrt(i)),\n    target: i + 1\n  };\n});\n\nvar simulation = d3.forceSimulation(nodes)\n    .force(\"charge\", d3.forceManyBody().strength(-25))\n    .force(\"link\", d3.forceLink(links).distance(0).strength(0.8))\n    .force(\"X\", d3.forceX())\n    .force(\"Y\", d3.forceY())\n    .on(\"tick\", ticked);\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nfunction ticked() {\n  context.clearRect(0, 0, width, height);\n  context.save();\n  context.translate(width / 2, height / 2);\n\n  context.beginPath();\n  links.forEach(drawLink);\n  context.strokeStyle = \"#aaa\";\n  context.stroke();\n\n  context.beginPath();\n  nodes.forEach(drawNode);\n  context.fill();\n  context.strokeStyle = \"#fff\";\n  context.stroke();\n\n  context.restore();\n}\n\nfunction drawLink(d) {\n  context.moveTo(d.source.x, d.source.y);\n  context.lineTo(d.target.x, d.target.y);\n}\n\nfunction drawNode(d) {\n  context.moveTo(d.x + 3, d.y);\n  context.arc(d.x, d.y, 3, 0, 2 * Math.PI);\n}\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"3ebd7ac19c589aeda0e2ad0a7bbbabb4bdf1f16c","preview":"783b165fbb722eb4c5375721a05d2d6162b9af2b"},"sort":[1461607112000]},{"_index":"blockbuilder","_type":"blocks","_id":"f584aa36df54c451c94a9d0798caed35","_score":null,"_source":{"userId":"mbostock","description":"Force-Directed Graph","created_at":"2016-04-22T23:16:37Z","updated_at":"2016-05-03T18:41:44Z","api":["d3.forceSimulation","d3.forceManyBody","d3.forceLink","d3.forceCenter","d3.json"],"colors":["#aaaaaa","#ffffff"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"https://d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nvar simulation = d3.forceSimulation()\n    .force(\"charge\", d3.forceManyBody())\n    .force(\"link\", d3.forceLink().id(function(d) { return d.id; }))\n    .force(\"center\", d3.forceCenter());\n\nd3.json(\"miserables.json\", function(error, graph) {\n  if (error) throw error;\n\n  simulation\n      .nodes(graph.nodes)\n      .on(\"tick\", ticked);\n\n  simulation.force(\"link\")\n      .links(graph.links);\n\n  function ticked() {\n    context.clearRect(0, 0, width, height);\n    context.save();\n    context.translate(width / 2, height / 2);\n\n    context.beginPath();\n    graph.links.forEach(drawLink);\n    context.strokeStyle = \"#aaa\";\n    context.stroke();\n\n    context.beginPath();\n    graph.nodes.forEach(drawNode);\n    context.fill();\n    context.strokeStyle = \"#fff\";\n    context.stroke();\n\n    context.restore();\n  }\n\n  function drawLink(d) {\n    context.moveTo(d.source.x, d.source.y);\n    context.lineTo(d.target.x, d.target.y);\n  }\n\n  function drawNode(d) {\n    context.moveTo(d.x + 3, d.y);\n    context.arc(d.x, d.y, 3, 0, 2 * Math.PI);\n  }\n});\n\n</script>\n","filenames":[".block","index.html","miserables.json","preview.png","thumbnail.png"],"thumb":"484a6578d945643011968e15d2d6788517d1b0c3","preview":"4218968a7a95ab56f17be6b9a487831cd5be1130"},"sort":[1461366997000]},{"_index":"blockbuilder","_type":"blocks","_id":"5583afd2a0d03b9c94918659fa151cac","_score":null,"_source":{"userId":"mbostock","description":"Hexagonal Binning","created_at":"2016-04-21T19:05:15Z","updated_at":"2016-05-03T18:41:22Z","api":["d3.randomNormal","d3.range","d3.scaleMagma","d3.max","d3.scaleIdentity","d3.axisTop","d3.axisLeft","d3.select"],"colors":["#000000","#ffffff"],"readme":"A demonstration of the [d3-hexbin](https://github.com/d3/d3-hexbin) plugin for D3 4.0.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.axis text {\n  font: 10px sans-serif;\n}\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n.hexagons {\n  fill: none;\n  stroke: #fff;\n  stroke-opacity: 0.5;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script src=\"//d3js.org/d3-hexbin.v0.2.min.js\"></script>\n<script>\n\nvar margin = {top: 40, right: 20, bottom: 20, left: 40},\n    width = 960 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar randomX = d3.randomNormal(width / 2, 80),\n    randomY = d3.randomNormal(height / 2, 80),\n    points = d3.range(2000).map(function() { return [randomX(), randomY()]; });\n\nvar hexbin = d3_hexbin.hexbin()\n    .extent([[-margin.left, -margin.top], [width + margin.right, height + margin.bottom]])\n    .radius(20);\n\nvar bins = hexbin(points);\n\nvar color = d3.scaleMagma()\n    .domain([d3.max(bins, function(d) { return d.length; }), 0]);\n\nvar x = d3.scaleIdentity()\n    .domain([0, width]);\n\nvar y = d3.scaleIdentity()\n    .domain([0, height]);\n\nvar xAxis = d3.axisTop(x);\n\nvar yAxis = d3.axisLeft(y);\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nsvg.append(\"g\")\n    .attr(\"class\", \"hexagons\")\n  .selectAll(\"path\")\n    .data(bins)\n  .enter().append(\"path\")\n    .attr(\"d\", hexbin.hexagon())\n    .attr(\"transform\", function(d) { return \"translate(\" + d.x + \",\" + d.y + \")\"; })\n    .style(\"fill\", function(d) { return color(d.length); });\n\nsvg.append(\"g\")\n    .attr(\"class\", \"axis axis--y\")\n    .call(yAxis);\n\nsvg.append(\"g\")\n    .attr(\"class\", \"axis axis--x\")\n    .call(xAxis);\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"1b1832d1cd7317d8152b92f4f9d383ab171f4633","preview":"618683d45d01c0fbcb452fa93417eb458d597e8b"},"sort":[1461265515000]},{"_index":"blockbuilder","_type":"blocks","_id":"2838bf53e0e65f369f476afd653663a2","_score":null,"_source":{"userId":"mbostock","description":"Nest Treemap","created_at":"2016-04-21T04:35:01Z","updated_at":"2016-05-04T20:58:09Z","api":["d3.formatEnGb.format","d3.nest","d3.sum","d3.treemap","d3.csv","d3.hierarchy","d3.select"],"colors":["#dddddd","#ffffff"],"readme":"Source: [data.gov.uk](https://data.gov.uk/dataset/home-office-flight-data), via [@davetaz](/davetaz/9954190).\n\nThis example demonstrates how to make a [treemap](https://github.com/d3/d3-hierarchy#treemap) using [d3.nest](https://github.com/d3/d3-collection#nests).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  font: 10px sans-serif;\n  position: relative;\n}\n\n.node {\n  box-sizing: border-box;\n  line-height: 1em;\n  overflow: hidden;\n  position: absolute;\n  white-space: pre;\n  background: #ddd;\n}\n\n.node-label,\n.node-value {\n  margin: 4px;\n}\n\n.node-value {\n  margin-top: -2px;\n}\n\n.node-value {\n  font-weight: bold;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 1060;\n\nvar format = d3.formatEnGb.format(\"$,d\");\n\nvar nest = d3.nest()\n    .key(function(d) { return d.Supplier_name; })\n    .key(function(d) { return d.Destination; })\n    .key(function(d) { return d.Ticket_class_description; })\n    .rollup(function(d) { return d3.sum(d, function(d) { return d.Paid_fare; }); });\n\nvar treemap = d3.treemap()\n    .size([width, height])\n    .padding(1)\n    .round(true);\n\nd3.csv(\"Home_Office_Air_Travel_Data_2011.csv\", type, function(error, data) {\n  if (error) throw error;\n\n  var root = d3.hierarchy({values: nest.entries(data)}, function(d) { return d.values; })\n      .sum(function(d) { return d.values; })\n      .sort(function(a, b) { return b.value - a.value; });\n\n  treemap(root);\n\n  var node = d3.select(\"body\")\n    .selectAll(\".node\")\n    .data(root.leaves())\n    .enter().append(\"div\")\n      .attr(\"class\", \"node\")\n      .style(\"left\", function(d) { return d.x0 + \"px\"; })\n      .style(\"top\", function(d) { return d.y0 + \"px\"; })\n      .style(\"width\", function(d) { return d.x1 - d.x0 + \"px\"; })\n      .style(\"height\", function(d) { return d.y1 - d.y0 + \"px\"; });\n\n  node.append(\"div\")\n      .attr(\"class\", \"node-label\")\n      .text(function(d) { return d.parent.parent.data.key + \" to \" + d.parent.data.key + \"\\n\" + d.data.key; });\n\n  node.append(\"div\")\n      .attr(\"class\", \"node-value\")\n      .text(function(d) { return format(d.value); });\n});\n\nfunction type(d) {\n  d.Paid_fare = +d.Paid_fare;\n  return d;\n}\n\n</script>\n","filenames":[".block","Home_Office_Air_Travel_Data_2011.csv","README.md","index.html","preview.png","thumbnail.png"],"thumb":"da9d8bcf5132a5b2993521caab8bb85ee630d1c9","preview":"25808d89b8da2dc33720949a8021932e4363a3c0"},"sort":[1461213301000]},{"_index":"blockbuilder","_type":"blocks","_id":"87fbdfc4533df2ffa02b5bb62bfb5cb6","_score":null,"_source":{"userId":"mbostock","description":"Animated Quadtree","created_at":"2016-04-15T19:17:38Z","updated_at":"2016-04-17T20:16:46Z","api":[],"colors":["#d2b48c","#666666","#000000","#ff0000"],"readme":"This animation shows how successively adding points to a quadtree changes its structure. Each red dot represents a point; each gray rectangle represents a leaf node in the quadtree; black lines separate internal nodes. Assuming no coincident points, each gray leaf contains exactly one point. (If some points are coincident, the leaf node contains a linked list of the coincident points.)\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ncanvas {\n  position: absolute;\n}\n\n</style>\n<canvas id=\"quadtree\" width=\"960\" height=\"960\"></canvas>\n<canvas id=\"points\" width=\"960\" height=\"960\"></canvas>\n<script src=\"d3-quadtree.debug.js\"></script>\n<script src=\"https://d3js.org/d3-timer.v0.4.min.js\"></script>\n<script src=\"https://d3js.org/d3-random.v0.2.min.js\"></script>\n<script>\n\nvar canvas0 = document.querySelector(\"#quadtree\"),\n    canvas1 = document.querySelector(\"#points\");\n\nvar width = canvas0.width,\n    height = canvas0.height,\n    radius = 1.5,\n    scale = window.devicePixelRatio;\n\nif (scale > 1) {\n  canvas1.style.width = canvas0.style.width = width + \"px\";\n  canvas1.style.height = canvas0.style.height = height + \"px\";\n  canvas1.width = canvas0.width = width *= scale;\n  canvas1.height = canvas0.height = height *= scale;\n  radius *= scale;\n}\n\nvar randomX = d3_random.randomNormal(width / 2, 100 * scale),\n    randomY = d3_random.randomNormal(height / 2, 100 * scale);\n\nvar quadtree = d3_quadtree.quadtree(width - 1, height - 1),\n    x0 = quadtree._x0,\n    y0 = quadtree._y0,\n    x1 = quadtree._x1,\n    y1 = quadtree._y1;\n\nvar context0 = canvas0.getContext(\"2d\"),\n    context1 = canvas1.getContext(\"2d\");\n\ncontext0.fillStyle = \"rgba(0,0,0,0.1)\";\ncontext0.strokeStyle = \"#666\";\ncontext1.fillStyle = \"rgba(240,0,0,1)\";\ncontext1.globalCompositeOperation = \"multiply\";\nredraw({node: quadtree._root, x0: x0, y0: y0, x1: x1, y1: y1});\n\nd3_timer.timer(function() {\n  var x, y;\n\n  do x = randomX(), y = randomY();\n  while (x0 > x || x > x1 || y0 > y || y > y1);\n\n  quadtree.add({x: x, y: y});\n  redraw(quadtree._added);\n  context1.beginPath();\n  context1.arc(x, y, radius, 0, 2 * Math.PI);\n  context1.fill();\n});\n\nfunction redraw(quad) {\n  var quads = [], xm, ym, x0 = quad.x0, y0 = quad.y0, x1 = quad.x1, y1 = quad.y1;\n\n  context0.clearRect(round(x0), round(y0), round(x1) - round(x0), round(y1) - round(y0));\n  quads.push(quad);\n  while (quad = quads.pop()) {\n    node = quad.node, x0 = quad.x0, y0 = quad.y0, x1 = quad.x1, y1 = quad.y1;\n    if (node.point) context0.fillRect(round(x0), round(y0), round(x1) - round(x0), round(y1) - round(y0));\n    xm = (x0 + x1) / 2, ym = (y0 + y1) / 2;\n    if (child = node[3]) quads.push({node: child, x0: xm, y0: ym, x1: x1, y1: y1});\n    if (child = node[2]) quads.push({node: child, x0: x0, y0: ym, x1: xm, y1: y1});\n    if (child = node[1]) quads.push({node: child, x0: xm, y0: y0, x1: x1, y1: ym});\n    if (child = node[0]) quads.push({node: child, x0: x0, y0: y0, x1: xm, y1: ym});\n    context0.strokeRect(round(x0) + 0.5, round(y0) + 0.5, round(x1) - round(x0), round(y1) - round(y0));\n  }\n}\n\nfunction round(x) {\n  return Math.round(x);\n}\n\n</script>\n","filenames":[".block","README.md","d3-quadtree.debug.js","index.html","preview.png","thumbnail.png"],"thumb":"589ee87254be858f0c62ce95d5da879d9962c97c","preview":"c0d51d5a59a6707d3376aa1472f3db82d1929b05"},"sort":[1460747858000]},{"_index":"blockbuilder","_type":"blocks","_id":"bf057ec744c0e2fc763c06a31ff292e1","_score":null,"_source":{"userId":"mbostock","description":"Rainbow Perceptual Distance","created_at":"2016-04-06T16:43:41Z","updated_at":"2016-04-06T16:46:14Z","api":["d3.hsl","d3.hcl","d3.scaleRainbow","d3.range","d3.scaleLinear","d3.scaleCategory10","d3.line","d3.select","d3.axisBottom","d3.axisLeft","d3.lab"],"colors":["#000000","#ffffff"],"readme":"This attempts to measure the perceptual uniformity of three [rainbow color scales](/mbostock/310c99e53880faec2434) by computing the [CIE76 color difference](https://en.wikipedia.org/wiki/Color_difference#CIE76) at various points along the scale. The flatness of the curve, not its absolute value, shows the uniformity of each scale. The HCL rainbow is perfectly flat by definition. Cubehelix is better than HSL, but is not uniform.\n\nIt would be better to use [CIEDE2000](https://en.wikipedia.org/wiki/Color_difference#CIEDE2000) to compute the difference, but I’m lazy.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.axis {\n  font: 10px sans-serif;\n}\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n.axis--y path {\n  display: none;\n}\n\n.line path {\n  fill: none;\n  stroke-width: 1.5px;\n  stroke-linejoin: round;\n}\n\n.line text {\n  font: bold 12px sans-serif;\n  text-shadow: 1px 1px 0 #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.29.min.js\"></script>\n<script>\n\nvar data = [\n  {name: \"HSL Rainbow\", labelOffset: 60, value: function(t) { return d3.hsl(t, 1, 0.5); }},\n  {name: \"HCL Rainbow\", labelOffset: 20, value: function(t) { return d3.hcl(t, 1, 0.5); }},\n  {name: \"Cubehelix Rainbow\", labelOffset: 40, value: d3.scaleRainbow().domain([0, 360])}\n].map(function(color) {\n  return color.deltas = d3.range(0, 360, 3).map(function(x) {\n    return {\n      input: x,\n      delta: delta(color.value(x - 10), color.value(x + 10))\n    };\n  }), color;\n});\n\nvar margin = {top: 20, right: 20, bottom: 30, left: 30},\n    width = 960 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar x = d3.scaleLinear()\n    .domain([0, 360])\n    .range([0, width]);\n\nvar y = d3.scaleLinear()\n    .domain([0, 80])\n    .range([height, 0]);\n\nvar z = d3.scaleCategory10();\n\nvar line = d3.line()\n    .curve(d3.curveBasis)\n    .x(function(d) { return x(d.input); })\n    .y(function(d) { return y(d.delta); });\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nsvg.append(\"g\")\n    .attr(\"class\", \"axis axis--x\")\n    .attr(\"transform\", \"translate(0,\" + y(0) + \")\")\n    .call(d3.axisBottom(x));\n\nsvg.append(\"g\")\n    .attr(\"class\", \"axis axis--y\")\n    .call(d3.axisLeft(y))\n  .selectAll(\".tick:last-of-type\")\n  .append(\"text\")\n    .attr(\"class\", \"axis-title\")\n    .attr(\"x\", 3)\n    .attr(\"dy\", \".32em\")\n    .text(\"Color Difference at ±10° (CIE76)\");\n\nvar g = svg.selectAll(\".line\")\n    .data(data)\n  .enter().append(\"g\")\n    .attr(\"class\", \"line\");\n\ng.append(\"path\")\n    .attr(\"d\", function(d) { return line(d.deltas); })\n    .attr(\"id\", function(d, i) { return \"path-\" + i; })\n    .style(\"stroke\", function(d, i) { return z(i); });\n\ng.append(\"text\")\n    .attr(\"x\", function(d) { return d.labelOffset; })\n    .attr(\"dy\", -5)\n    .style(\"fill\", function(d, i) { return d3.lab(z(i)).darker(); })\n  .append(\"textPath\")\n    .attr(\"class\", \"textpath\")\n    .attr(\"xlink:href\", function(d, i) { return \"#path-\" + i; })\n    .text(function(d) { return d.name; });\n\n// CIE76 per https://en.wikipedia.org/wiki/Color_difference#CIE76\n// Not as good as CIEDE2000 but a lot easier to implement.\nfunction delta(a, b) {\n  var dl = (a = d3.lab(a)).l - (b = d3.lab(b)).l, da = a.a - b.a, db = a.b - b.b;\n  return Math.sqrt(dl * dl + da * da + db * db);\n}\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"d1230c47dac080d297e28e9d5ed858a2b6532438","preview":"200169c3c8014feb0f513307d4e8be0552363132"},"sort":[1459961021000]},{"_index":"blockbuilder","_type":"blocks","_id":"07ec62d9957a29a30e71cad962ff2efd","_score":null,"_source":{"userId":"mbostock","description":"Circle-Packing II","created_at":"2016-04-01T17:02:32Z","updated_at":"2016-05-03T18:40:17Z","api":["d3.select","d3.format","d3.pack","d3.csv","d3.hierarchy"],"colors":["#dddddd","#000000"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ntext {\n  font: 10px sans-serif;\n  text-anchor: middle;\n}\n\n.node circle {\n  fill: #ddd;\n}\n\n.node:hover circle {\n  stroke: #000;\n  stroke-width: 1.2px;\n}\n\n</style>\n<svg width=\"960\" height=\"960\"><g transform=\"translate(1,1)\"></g></svg>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar svg = d3.select(\"svg\"),\n    width = +svg.attr(\"width\"),\n    height = +svg.attr(\"height\");\n\nvar format = d3.format(\",d\");\n\nvar pack = d3.pack()\n    .size([width - 2, height - 2])\n    .padding(3);\n\nd3.csv(\"flare.csv\", type, function(error, data) {\n  if (error) throw error;\n\n  var root = d3.hierarchy({children: data})\n      .sum(function(d) { return d.value; })\n      .sort(function(a, b) { return b.value - a.value; });\n\n  pack(root);\n\n  var node = svg.select(\"g\")\n    .selectAll(\"g\")\n    .data(root.children)\n    .enter().append(\"g\")\n      .attr(\"transform\", function(d) { return \"translate(\" + d.x + \",\" + d.y + \")\"; })\n      .attr(\"class\", \"node\");\n\n  node.append(\"circle\")\n      .attr(\"id\", function(d) { return \"node-\" + d.data.id; })\n      .attr(\"r\", function(d) { return d.r; });\n\n  node.append(\"clipPath\")\n      .attr(\"id\", function(d) { return \"clip-\" + d.data.id; })\n    .append(\"use\")\n      .attr(\"xlink:href\", function(d) { return \"#node-\" + d.data.id + \"\"; });\n\n  node.append(\"text\")\n      .attr(\"clip-path\", function(d) { return \"url(#clip-\" + d.data.id + \")\"; })\n    .selectAll(\"tspan\")\n      .data(function(d) { return d.data.id.split(\".\").pop().split(/(?=[A-Z][^A-Z])/g); })\n    .enter().append(\"tspan\")\n      .attr(\"x\", 0)\n      .attr(\"y\", function(d, i, nodes) { return 13 + (i - nodes.length / 2 - 0.5) * 10; })\n      .text(function(d) { return d; });\n\n  node.append(\"title\")\n      .text(function(d) { return d.data.id + \"\\n\" + format(d.value); });\n});\n\nfunction type(d) {\n  return (d.value = +d.value) ? d : null;\n}\n\n</script>\n","filenames":[".block","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"a13ac7639696096e8b8bfc33bf5bf45b6551c514","preview":"325137ea666fee75352330179f2cb641a7bdaf4c"},"sort":[1459530152000]},{"_index":"blockbuilder","_type":"blocks","_id":"4739610f6d96aaad2fb1e78a72b385ab","_score":null,"_source":{"userId":"mbostock","description":"Radial Dendrogram","created_at":"2016-04-01T00:18:12Z","updated_at":"2016-05-04T05:22:00Z","api":["d3.stratify","d3.cluster","d3.select","d3.csv"],"colors":["#999999","#555555","#ffffff"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.node circle {\n  fill: #999;\n}\n\n.node text {\n  font: 10px sans-serif;\n}\n\n.node--internal circle {\n  fill: #555;\n}\n\n.node--internal text {\n  text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;\n}\n\n.link {\n  fill: none;\n  stroke: #555;\n  stroke-opacity: 0.4;\n  stroke-width: 1.5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 900,\n    radius = 480;\n\nvar stratify = d3.stratify()\n    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(\".\")); });\n\nvar cluster = d3.cluster()\n    .size([360, radius - 120]);\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + width / 2 + \",\" + (height / 2 + 20) + \")\");\n\nd3.csv(\"flare.csv\", function(error, data) {\n  if (error) throw error;\n\n  var root = stratify(data)\n      .sort(function(a, b) { return a.height - b.height || a.id.localeCompare(b.id); });\n\n  cluster(root);\n\n  var link = svg.selectAll(\".link\")\n      .data(root.descendants().slice(1))\n    .enter().append(\"path\")\n      .attr(\"class\", \"link\")\n      .attr(\"d\", function(d) {\n        return \"M\" + project(d.x, d.y)\n            + \"C\" + project(d.x, (d.y + d.parent.y) / 2)\n            + \" \" + project(d.parent.x, (d.y + d.parent.y) / 2)\n            + \" \" + project(d.parent.x, d.parent.y);\n      });\n\n  var node = svg.selectAll(\".node\")\n      .data(root.descendants())\n    .enter().append(\"g\")\n      .attr(\"class\", function(d) { return \"node\" + (d.children ? \" node--internal\" : \" node--leaf\"); })\n      .attr(\"transform\", function(d) { return \"translate(\" + project(d.x, d.y) + \")\"; });\n\n  node.append(\"circle\")\n      .attr(\"r\", 2.5);\n\n  node.append(\"text\")\n      .attr(\"dy\", \".31em\")\n      .attr(\"x\", function(d) { return d.x < 180 === !d.children ? 6 : -6; })\n      .style(\"text-anchor\", function(d) { return d.x < 180 === !d.children ? \"start\" : \"end\"; })\n      .attr(\"transform\", function(d) { return \"rotate(\" + (d.x < 180 ? d.x - 90 : d.x + 90) + \")\"; })\n      .text(function(d) { return d.id.substring(d.id.lastIndexOf(\".\") + 1); });\n});\n\nfunction project(x, y) {\n  var angle = (x - 90) / 180 * Math.PI, radius = y;\n  return [radius * Math.cos(angle), radius * Math.sin(angle)];\n}\n\n</script>\n","filenames":[".block","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"9d30b843a44ca1a8acc1d8fb337678ba54d6cb11","preview":"6a77b3521571b547599bd5981157bded3bb7bb1f"},"sort":[1459469892000]},{"_index":"blockbuilder","_type":"blocks","_id":"e9ba78a2c1070980d1b530800ce7fa2b","_score":null,"_source":{"userId":"mbostock","description":"Tidy Tree vs. Dendrogram","created_at":"2016-03-31T21:22:28Z","updated_at":"2016-05-03T18:39:27Z","api":["d3.tree","d3.cluster","d3.stratify","d3.select","d3.csv","d3.selectAll","d3.transition"],"colors":["#999999","#555555","#ffffff"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.node circle {\n  fill: #999;\n}\n\n.node text {\n  font: 10px sans-serif;\n}\n\n.node--internal circle {\n  fill: #555;\n}\n\n.node--internal text {\n  text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;\n}\n\n.link {\n  fill: none;\n  stroke: #555;\n  stroke-opacity: 0.4;\n  stroke-width: 1.5px;\n}\n\nform {\n  font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n  position: absolute;\n  left: 10px;\n  top: 10px;\n}\n\n</style>\n<form>\n  <label><input type=\"radio\" name=\"mode\" value=\"cluster\" checked> Dendrogram</label>\n  <label><input type=\"radio\" name=\"mode\" value=\"tree\"> Tree</label>\n</form>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 2400;\n\nvar tree = d3.tree()\n    .size([height - 400, width - 160]);\n\nvar cluster = d3.cluster()\n    .size([height, width - 160]);\n\nvar stratify = d3.stratify()\n    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(\".\")); });\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(40,0)\");\n\nd3.csv(\"flare.csv\", function(error, data) {\n  if (error) throw error;\n\n  var root = stratify(data)\n      .sort(function(a, b) { return (a.height - b.height) || a.id.localeCompare(b.id); });\n\n  cluster(root);\n\n  var link = svg.selectAll(\".link\")\n      .data(root.descendants().slice(1))\n    .enter().append(\"path\")\n      .attr(\"class\", \"link\")\n      .attr(\"d\", diagonal);\n\n  var node = svg.selectAll(\".node\")\n      .data(root.descendants())\n    .enter().append(\"g\")\n      .attr(\"class\", function(d) { return \"node\" + (d.children ? \" node--internal\" : \" node--leaf\"); })\n      .attr(\"transform\", function(d) { return \"translate(\" + d.y + \",\" + d.x + \")\"; });\n\n  node.append(\"circle\")\n      .attr(\"r\", 2.5);\n\n  node.append(\"text\")\n      .attr(\"dy\", 3)\n      .attr(\"x\", function(d) { return d.children ? -8 : 8; })\n      .style(\"text-anchor\", function(d) { return d.children ? \"end\" : \"start\"; })\n      .text(function(d) { return d.id.substring(d.id.lastIndexOf(\".\") + 1); });\n\n  d3.selectAll(\"input\")\n      .on(\"change\", changed);\n\n  var timeout = setTimeout(function() {\n    d3.select(\"input[value=\\\"tree\\\"]\")\n        .property(\"checked\", true)\n        .dispatch(\"change\");\n  }, 1000);\n\n  function changed() {\n    timeout = clearTimeout(timeout);\n    (this.value === \"tree\" ? tree : cluster)(root);\n    var t = d3.transition().duration(750);\n    node.transition(t).attr(\"transform\", function(d) { return \"translate(\" + d.y + \",\" + d.x + \")\"; });\n    link.transition(t).attr(\"d\", diagonal);\n  }\n});\n\nfunction diagonal(d) {\n  return \"M\" + d.y + \",\" + d.x\n      + \"C\" + (d.parent.y + 100) + \",\" + d.x\n      + \" \" + (d.parent.y + 100) + \",\" + d.parent.x\n      + \" \" + d.parent.y + \",\" + d.parent.x;\n}\n\n</script>\n","filenames":[".block","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"204784cd731dc14dbbba1956681210cf74e6cc1d","preview":"df35a1f6c1e486529f27e75ab132cc51477c1d7d"},"sort":[1459459348000]},{"_index":"blockbuilder","_type":"blocks","_id":"2e12b0bd732e7fe4000e2d11ecab0268","_score":null,"_source":{"userId":"mbostock","description":"Radial Tidy Tree","created_at":"2016-03-31T19:57:26Z","updated_at":"2016-05-03T18:39:11Z","api":["d3.stratify","d3.tree","d3.select","d3.csv"],"colors":["#999999","#555555","#ffffff"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.node circle {\n  fill: #999;\n}\n\n.node text {\n  font: 10px sans-serif;\n}\n\n.node--internal circle {\n  fill: #555;\n}\n\n.node--internal text {\n  text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;\n}\n\n.link {\n  fill: none;\n  stroke: #555;\n  stroke-opacity: 0.4;\n  stroke-width: 1.5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 1060,\n    radius = 620;\n\nvar stratify = d3.stratify()\n    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(\".\")); });\n\nvar tree = d3.tree()\n    .size([360, radius - 120])\n    .separation(function(a, b) { return (a.parent == b.parent ? 1 : 2) / a.depth; });\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + (width / 2 + 40) + \",\" + (height / 2 + 90) + \")\");\n\nd3.csv(\"flare.csv\", function(error, data) {\n  if (error) throw error;\n\n  var root = stratify(data);\n\n  tree(root);\n\n  var link = svg.selectAll(\".link\")\n      .data(root.descendants().slice(1))\n    .enter().append(\"path\")\n      .attr(\"class\", \"link\")\n      .attr(\"d\", function(d) {\n        return \"M\" + project(d.x, d.y)\n            + \"C\" + project(d.x, (d.y + d.parent.y) / 2)\n            + \" \" + project(d.parent.x, (d.y + d.parent.y) / 2)\n            + \" \" + project(d.parent.x, d.parent.y);\n      });\n\n  var node = svg.selectAll(\".node\")\n      .data(root.descendants())\n    .enter().append(\"g\")\n      .attr(\"class\", function(d) { return \"node\" + (d.children ? \" node--internal\" : \" node--leaf\"); })\n      .attr(\"transform\", function(d) { return \"translate(\" + project(d.x, d.y) + \")\"; });\n\n  node.append(\"circle\")\n      .attr(\"r\", 2.5);\n\n  node.append(\"text\")\n      .attr(\"dy\", \".31em\")\n      .attr(\"x\", function(d) { return d.x < 180 === !d.children ? 6 : -6; })\n      .style(\"text-anchor\", function(d) { return d.x < 180 === !d.children ? \"start\" : \"end\"; })\n      .attr(\"transform\", function(d) { return \"rotate(\" + (d.x < 180 ? d.x - 90 : d.x + 90) + \")\"; })\n      .text(function(d) { return d.id.substring(d.id.lastIndexOf(\".\") + 1); });\n});\n\nfunction project(x, y) {\n  var angle = (x - 90) / 180 * Math.PI, radius = y;\n  return [radius * Math.cos(angle), radius * Math.sin(angle)];\n}\n\n</script>\n","filenames":[".block","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"9350f984e44befbe0cf54c5089bc4d962b463cac","preview":"932d51d632cbfb1c623c52b9acb51b8d1a41cb68"},"sort":[1459454246000]},{"_index":"blockbuilder","_type":"blocks","_id":"9d0899acb5d3b8d839d9d613a9e1fe04","_score":null,"_source":{"userId":"mbostock","description":"Tidy Tree","created_at":"2016-03-31T16:56:35Z","updated_at":"2016-05-04T05:22:18Z","api":["d3.tree","d3.stratify","d3.select","d3.csv"],"colors":["#999999","#555555","#ffffff"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.node circle {\n  fill: #999;\n}\n\n.node text {\n  font: 10px sans-serif;\n}\n\n.node--internal circle {\n  fill: #555;\n}\n\n.node--internal text {\n  text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;\n}\n\n.link {\n  fill: none;\n  stroke: #555;\n  stroke-opacity: 0.4;\n  stroke-width: 1.5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 2000;\n\nvar tree = d3.tree()\n    .size([height, width - 160]);\n\nvar stratify = d3.stratify()\n    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(\".\")); });\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(40,0)\");\n\nd3.csv(\"flare.csv\", function(error, data) {\n  if (error) throw error;\n\n  var root = stratify(data)\n      .sort(function(a, b) { return (a.height - b.height) || a.id.localeCompare(b.id); });\n\n  tree(root);\n\n  var link = svg.selectAll(\".link\")\n      .data(root.descendants().slice(1))\n    .enter().append(\"path\")\n      .attr(\"class\", \"link\")\n      .attr(\"d\", function(d) {\n        return \"M\" + d.y + \",\" + d.x\n            + \"C\" + (d.y + d.parent.y) / 2 + \",\" + d.x\n            + \" \" + (d.y + d.parent.y) / 2 + \",\" + d.parent.x\n            + \" \" + d.parent.y + \",\" + d.parent.x;\n      });\n\n  var node = svg.selectAll(\".node\")\n      .data(root.descendants())\n    .enter().append(\"g\")\n      .attr(\"class\", function(d) { return \"node\" + (d.children ? \" node--internal\" : \" node--leaf\"); })\n      .attr(\"transform\", function(d) { return \"translate(\" + d.y + \",\" + d.x + \")\"; })\n\n  node.append(\"circle\")\n      .attr(\"r\", 2.5);\n\n  node.append(\"text\")\n      .attr(\"dy\", 3)\n      .attr(\"x\", function(d) { return d.children ? -8 : 8; })\n      .style(\"text-anchor\", function(d) { return d.children ? \"end\" : \"start\"; })\n      .text(function(d) { return d.id.substring(d.id.lastIndexOf(\".\") + 1); });\n});\n\n</script>\n","filenames":[".block","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"bee24cbb7471d5e88c8c2e08e3f3ab9536f0660f","preview":"6eeffcd96ffffb97a76a628d228d9f556886f4e8"},"sort":[1459443395000]},{"_index":"blockbuilder","_type":"blocks","_id":"ff91c1558bc570b08539547ccc90050b","_score":null,"_source":{"userId":"mbostock","description":"Dendrogram","created_at":"2016-03-31T00:15:34Z","updated_at":"2016-05-03T18:38:47Z","api":["d3.cluster","d3.stratify","d3.select","d3.csv"],"colors":["#999999","#555555","#ffffff"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.node circle {\n  fill: #999;\n}\n\n.node text {\n  font: 10px sans-serif;\n}\n\n.node--internal circle {\n  fill: #555;\n}\n\n.node--internal text {\n  text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;\n}\n\n.link {\n  fill: none;\n  stroke: #555;\n  stroke-opacity: 0.4;\n  stroke-width: 1.5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 2400;\n\nvar cluster = d3.cluster()\n    .size([height, width - 160]);\n\nvar stratify = d3.stratify()\n    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(\".\")); });\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(40,0)\");\n\nd3.csv(\"flare.csv\", function(error, data) {\n  if (error) throw error;\n\n  var root = stratify(data)\n      .sort(function(a, b) { return (a.height - b.height) || a.id.localeCompare(b.id); });\n\n  cluster(root);\n\n  var link = svg.selectAll(\".link\")\n      .data(root.descendants().slice(1))\n    .enter().append(\"path\")\n      .attr(\"class\", \"link\")\n      .attr(\"d\", function(d) {\n        return \"M\" + d.y + \",\" + d.x\n            + \"C\" + (d.parent.y + 100) + \",\" + d.x\n            + \" \" + (d.parent.y + 100) + \",\" + d.parent.x\n            + \" \" + d.parent.y + \",\" + d.parent.x;\n      });\n\n  var node = svg.selectAll(\".node\")\n      .data(root.descendants())\n    .enter().append(\"g\")\n      .attr(\"class\", function(d) { return \"node\" + (d.children ? \" node--internal\" : \" node--leaf\"); })\n      .attr(\"transform\", function(d) { return \"translate(\" + d.y + \",\" + d.x + \")\"; })\n\n  node.append(\"circle\")\n      .attr(\"r\", 2.5);\n\n  node.append(\"text\")\n      .attr(\"dy\", 3)\n      .attr(\"x\", function(d) { return d.children ? -8 : 8; })\n      .style(\"text-anchor\", function(d) { return d.children ? \"end\" : \"start\"; })\n      .text(function(d) { return d.id.substring(d.id.lastIndexOf(\".\") + 1); });\n});\n\n</script>\n","filenames":[".block","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"204784cd731dc14dbbba1956681210cf74e6cc1d","preview":"df35a1f6c1e486529f27e75ab132cc51477c1d7d"},"sort":[1459383334000]},{"_index":"blockbuilder","_type":"blocks","_id":"c677b9bb3c926ba13f3a902acb006b0c","_score":null,"_source":{"userId":"mbostock","description":"Voronoi Spirals III","created_at":"2016-03-29T20:47:38Z","updated_at":"2016-03-29T20:47:41Z","api":["d3.select","d3.range","d3.voronoi","d3.format","d3.scaleRainbow","d3.rgb","d3.timer"],"colors":["#d2b48c"],"readme":"Inspired by [Adam Pearce](/1wheel/c7122eee6247b95dba09).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"960\"></canvas>\n<script src=\"https://d3js.org/d3.v4.0.0-alpha.28.min.js\"></script>\n<script>\n\nvar canvas = d3.select(\"canvas\").node(),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nvar sites = d3.range(100).map(function() { return [Math.random() * width, Math.random() * height]; }),\n    cells = d3.voronoi().size([width, height]).polygons(sites),\n    formatHex = d3.format(\"02x\");\n\nvar colors = d3.range(256)\n    .map(d3.scaleRainbow().domain([0, 255]))\n    .map(function(c) { return d3.rgb(c); });\n\nfor (var i = 0; i < 256; ++i) {\n  context.beginPath();\n  cells.forEach(function(cell) {\n    drawCell(cell);\n    var p0 = cell.shift(),\n        p1 = cell[0],\n        t = Math.min(0.5, 4 / distance(p0, p1)),\n        p2 = [p0[0] * (1 - t) + p1[0] * t, p0[1] * (1 - t) + p1[1] * t];\n    cell.push(p2);\n  });\n  context.fillStyle = \"#\" + formatHex(i) + \"0000\";\n  context.fill();\n}\n\nvar source = context.getImageData(0, 0, width, height).data,\n    targetBuffer = context.createImageData(width, height),\n    target = targetBuffer.data;\n\nfor (var i = 0, y = 0; y < height; ++y) {\n  for (var x = 0; x < width; ++x, i += 4) {\n    target[i + 0] =\n    target[i + 1] =\n    target[i + 2] =\n    target[i + 3] = 255;\n  }\n}\n\ncontext.clearRect(0, 0, width, height);\n\nd3.timer(function(elapsed) {\n  for (var i = 0, y = 0; y < height; ++y) {\n    for (var x = 0; x < width; ++x, i += 4) {\n      var c = colors[Math.floor(source[i] + elapsed / 10) % 256];\n      target[i + 0] = c.r;\n      target[i + 1] = c.g;\n      target[i + 2] = c.b;\n    }\n  }\n  context.putImageData(targetBuffer, 0, 0);\n});\n\nfunction drawCell(cell) {\n  context.moveTo(cell[0][0], cell[0][1]);\n  for (var i = 1, n = cell.length; i < n; ++i) context.lineTo(cell[i][0], cell[i][1]);\n  context.closePath();\n}\n\nfunction distance(a, b) {\n  var dx = a[0] - b[0], dy = a[1] - b[1];\n  return Math.sqrt(dx * dx + dy * dy);\n}\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"8e83cb7dc08cc12d7174c0e5d1bd7e84eb766195","preview":"1c16d1c2330ec592ec586f448e130af9787b1e53"},"sort":[1459284458000]},{"_index":"blockbuilder","_type":"blocks","_id":"50a8a5733b45c6287f7d32e3ac3241c4","_score":null,"_source":{"userId":"mbostock","description":"Voronoi Spirals II","created_at":"2016-03-29T17:49:42Z","updated_at":"2016-03-29T17:49:45Z","api":["d3.select","d3.range","d3.voronoi","d3.scaleCubehelix","d3.timer"],"colors":["#d2b48c"],"readme":"Inspired by [Adam Pearce](/1wheel/c7122eee6247b95dba09).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"960\"></canvas>\n<script src=\"https://d3js.org/d3.v4.0.0-alpha.28.min.js\"></script>\n<script>\n\nvar canvas = d3.select(\"canvas\").node(),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nvar sites = d3.range(100).map(function() { return [Math.random() * width, Math.random() * height]; }),\n    cells = d3.voronoi().size([width, height]).polygons(sites),\n    duration = 5000;\n\nvar color = d3.scaleCubehelix()\n    .domain([duration, 0]);\n\nvar timer = d3.timer(function(elapsed) {\n  context.beginPath();\n\n  cells.forEach(function(cell) {\n    drawCell(cell);\n    var p0 = cell.shift(),\n        p1 = cell[0],\n        t = Math.min(0.5, 4 / distance(p0, p1)),\n        p2 = [p0[0] * (1 - t) + p1[0] * t, p0[1] * (1 - t) + p1[1] * t];\n    cell.push(p2);\n  });\n\n  context.fillStyle = color(elapsed);\n  context.fill();\n\n  if (elapsed > duration) timer.stop();\n});\n\nfunction drawCell(cell) {\n  context.moveTo(cell[0][0], cell[0][1]);\n  for (var i = 1, n = cell.length; i < n; ++i) context.lineTo(cell[i][0], cell[i][1]);\n  context.closePath();\n}\n\nfunction distance(a, b) {\n  var dx = a[0] - b[0], dy = a[1] - b[1];\n  return Math.sqrt(dx * dx + dy * dy);\n}\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"95b08d49de083d3cc2473834017eee5744d31f28","preview":"91ea6aefc8c8bfe65ea417a8b893e4fbbd2716f4"},"sort":[1459273782000]},{"_index":"blockbuilder","_type":"blocks","_id":"6ca2c7bd062dff60f76077e73fdafa16","_score":null,"_source":{"userId":"mbostock","description":"Voronoi Spirals","created_at":"2016-03-29T17:04:44Z","updated_at":"2016-03-29T18:08:37Z","api":["d3.select","d3.range","d3.voronoi","d3.scaleCubehelix","d3.timer"],"colors":["#d2b48c"],"readme":"Inspired by [Adam Pearce](/1wheel/c7122eee6247b95dba09).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"960\"></canvas>\n<script src=\"https://d3js.org/d3.v4.0.0-alpha.28.min.js\"></script>\n<script>\n\nvar canvas = d3.select(\"canvas\").node(),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nvar sites = d3.range(100).map(function() { return [Math.random() * width, Math.random() * height]; }),\n    cells = d3.voronoi().size([width, height]).polygons(sites),\n    duration = 5000;\n\nvar color = d3.scaleCubehelix()\n    .domain([0, duration]);\n\nvar timer = d3.timer(function(elapsed) {\n  context.beginPath();\n\n  cells.forEach(function(cell) {\n    drawCell(cell);\n    var p0 = cell.shift(),\n        p1 = cell[0],\n        t = Math.min(0.5, 4 / distance(p0, p1)),\n        p2 = [p0[0] * (1 - t) + p1[0] * t, p0[1] * (1 - t) + p1[1] * t];\n    cell.push(p2);\n  });\n\n  context.fillStyle = color(elapsed);\n  context.fill();\n\n  if (elapsed > duration) timer.stop();\n});\n\nfunction drawCell(cell) {\n  context.moveTo(cell[0][0], cell[0][1]);\n  for (var i = 1, n = cell.length; i < n; ++i) context.lineTo(cell[i][0], cell[i][1]);\n  context.closePath();\n}\n\nfunction distance(a, b) {\n  var dx = a[0] - b[0], dy = a[1] - b[1];\n  return Math.sqrt(dx * dx + dy * dy);\n}\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"1d626241c6e7fe84e8f541ca70c2fb823ff28380","preview":"e6853137ac0db7ac03e8d7f358d6e889d8e927e4"},"sort":[1459271084000]},{"_index":"blockbuilder","_type":"blocks","_id":"e6962a152275373f8504","_score":null,"_source":{"userId":"mbostock","description":"Rainbow Treemap","created_at":"2016-03-28T18:05:33Z","updated_at":"2016-05-03T18:38:33Z","api":["d3.select","d3.format","d3.scaleRainbow","d3.stratify","d3.treemap","d3.csv"],"colors":[],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ntext {\n  font: 10px sans-serif;\n}\n\ntspan:last-child {\n  font-size: 9px;\n  fill-opacity: 0.8;\n}\n\n</style>\n<svg width=\"960\" height=\"1060\"></svg>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar svg = d3.select(\"svg\"),\n    width = +svg.attr(\"width\"),\n    height = +svg.attr(\"height\");\n\nvar format = d3.format(\",d\");\n\nvar color = d3.scaleRainbow();\n\nvar stratify = d3.stratify()\n    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(\".\")); });\n\nvar treemap = d3.treemap()\n    .size([width, height])\n    .round(true)\n    .padding(1);\n\nd3.csv(\"flare.csv\", function(error, data) {\n  if (error) throw error;\n\n  var sum = 0;\n\n  var root = stratify(data)\n      .sum(function(d) { return d.value; })\n      .sort(function(a, b) { return b.height - a.height || b.value - a.value; });\n\n  treemap(root);\n\n  color.domain([0, root.value]);\n\n  var cell = svg.selectAll(\"g\")\n    .data(root.leaves())\n    .enter().append(\"g\")\n      .attr(\"transform\", function(d) { return \"translate(\" + d.x0 + \",\" + d.y0 + \")\"; });\n\n  cell.append(\"rect\")\n      .attr(\"id\", function(d) { return \"rect-\" + d.id; })\n      .attr(\"width\", function(d) { return d.x1 - d.x0; })\n      .attr(\"height\", function(d) { return d.y1 - d.y0; })\n      .style(\"fill\", function(d) { return color(sum += d.value); });\n\n  cell.append(\"clipPath\")\n      .attr(\"id\", function(d) { return \"clip-\" + d.id; })\n    .append(\"use\")\n      .attr(\"xlink:href\", function(d) { return \"#rect-\" + d.id + \"\"; });\n\n  cell.append(\"text\")\n      .attr(\"clip-path\", function(d) { return \"url(#clip-\" + d.id + \")\"; })\n    .selectAll(\"tspan\")\n      .data(function(d) { return d.id.substring(d.id.lastIndexOf(\".\") + 1).split(/(?=[A-Z][^A-Z])/g).concat(format(d.value)); })\n    .enter().append(\"tspan\")\n      .attr(\"x\", 4)\n      .attr(\"y\", function(d, i) { return 13 + i * 10; })\n      .text(function(d) { return d; });\n\n  cell.append(\"title\")\n      .text(function(d) { return d.id + \"\\n\" + format(d.value); });\n});\n\n</script>\n","filenames":[".block","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"b5943fbb70cfcc304e7ad234e89f1493538b6ea6","preview":"ee155a01b842de2b7fefac08aa79607da883bb21"},"sort":[1459188333000]},{"_index":"blockbuilder","_type":"blocks","_id":"f85ffb3a5ac518598043","_score":null,"_source":{"userId":"mbostock","description":"Cascaded Treemap","created_at":"2016-03-28T17:36:20Z","updated_at":"2016-05-03T18:38:19Z","api":["d3.format","d3.scaleMagma","d3.stratify","d3.treemap","d3.csv","d3.select","d3.max","d3.selectAll"],"colors":["#000000","#ff0000"],"readme":"Based on work by [Matteo Abrate](http://bl.ocks.org/nitaku/142545ea7bac1866327a) and [Lü and Fogarty](https://homes.cs.washington.edu/~jfogarty/publications/gi2008.pdf).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  font: 10px sans-serif;\n  margin: 3px;\n  position: relative;\n}\n\n.node {\n  position: absolute;\n  overflow: hidden;\n  padding: 3px;\n  box-shadow: 0 2px 3px rgba(0,0,0,0.4);\n  box-sizing: border-box;\n}\n\n.node--internal {\n  font-weight: bold;\n}\n\n.node--hover {\n  padding: 2px;\n  border: solid 1px #000;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 1060,\n    offset = 3;\n\nvar format = d3.format(\",d\");\n\nvar color = d3.scaleMagma()\n    .domain([-4, 4]);\n\nvar stratify = d3.stratify()\n    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(\".\")); });\n\nvar treemap = d3.treemap()\n    .size([width, height])\n    .paddingInner(1)\n    .paddingOuter(offset)\n    .paddingTop(function(d) { return d.depth < 3 ? 19 : offset; })\n    .round(true);\n\nd3.csv(\"flare.csv\", function(error, data) {\n  if (error) throw error;\n\n  var root = stratify(data)\n      .sum(function(d) { return d.value; })\n      .sort(function(a, b) { return b.height - a.height || b.value - a.value; });\n\n  cascade(treemap(root));\n\n  d3.select(\"body\")\n    .selectAll(\".node\")\n    .data(root.descendants())\n    .enter().append(\"div\")\n      .attr(\"class\", function(d) { return \"node\" + (d.children ? \" node--internal\" : \" node--left\"); })\n      .attr(\"title\", function(d) { return d.id + \"\\n\" + format(d.value); })\n      .style(\"left\", function(d) { return d.x0 + \"px\"; })\n      .style(\"top\", function(d) { return d.y0 + \"px\"; })\n      .style(\"width\", function(d) { return d.x1 - d.x0 + \"px\"; })\n      .style(\"height\", function(d) { return d.y1 - d.y0 + \"px\"; })\n      .style(\"background\", function(d) { return color(d.depth); })\n      .each(function(d) { d.node = this; })\n      .on(\"mouseover\", hovered(true))\n      .on(\"mouseout\", hovered(false))\n      .text(function(d) { return d.id.substring(d.id.lastIndexOf(\".\") + 1).split(/(?=[A-Z][^A-Z])/g).join(\"\\u200b\"); });\n});\n\nfunction cascade(root) {\n  return root.eachAfter(function(d) {\n    if (d.children) {\n      d.heightRight = 1 + d3.max(d.children, function(c) { return c.x1 === d.x1 - offset ? c.heightRight : NaN; });\n      d.heightBottom = 1 + d3.max(d.children, function(c) { return c.y1 === d.y1 - offset  ? c.heightBottom : NaN; });\n    } else {\n      d.heightRight =\n      d.heightBottom = 0;\n    }\n  }).eachBefore(function(d) {\n    d.x1 -= 2 * offset * d.heightRight;\n    d.y1 -= 2 * offset * d.heightBottom;\n  });\n}\n\nfunction hovered(hover) {\n  return function(d) {\n    d3.selectAll(d.ancestors().map(function(d) { return d.node; }))\n        .classed(\"node--hover\", hover);\n  };\n}\n\n</script>\n","filenames":[".block","README.md","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"a06b75b659d2e34f1ba7b21d01f85a785f70bc30","preview":"5d6162e6dc98cac18f648c3660c08b5affa6d50d"},"sort":[1459186580000]},{"_index":"blockbuilder","_type":"blocks","_id":"911ad09bdead40ec0061","_score":null,"_source":{"userId":"mbostock","description":"Nested Treemap","created_at":"2016-03-25T17:34:51Z","updated_at":"2016-05-03T18:38:05Z","api":["d3.select","d3.format","d3.scaleMagma","d3.stratify","d3.treemap","d3.csv","d3.selectAll"],"colors":["#000000","#ff0000"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ntext {\n  font: 10px sans-serif;\n}\n\ntspan:last-child {\n  font-size: 9px;\n  fill-opacity: 0.8;\n}\n\n.node rect {\n  shape-rendering: crispEdges;\n}\n\n.node--hover rect {\n  stroke: #000;\n}\n\n</style>\n<svg width=\"960\" height=\"1060\"></svg>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar svg = d3.select(\"svg\"),\n    width = +svg.attr(\"width\"),\n    height = +svg.attr(\"height\");\n\nvar format = d3.format(\",d\");\n\nvar color = d3.scaleMagma()\n    .domain([-4, 4]);\n\nvar stratify = d3.stratify()\n    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(\".\")); });\n\nvar treemap = d3.treemap()\n    .size([width, height])\n    .paddingOuter(3)\n    .paddingTop(19)\n    .paddingInner(1)\n    .round(true);\n\nd3.csv(\"flare.csv\", function(error, data) {\n  if (error) throw error;\n\n  var root = stratify(data)\n      .sum(function(d) { return d.value; })\n      .sort(function(a, b) { return b.height - a.height || b.value - a.value; });\n\n  treemap(root);\n\n  var cell = svg\n    .selectAll(\".node\")\n    .data(root.descendants())\n    .enter().append(\"g\")\n      .attr(\"transform\", function(d) { return \"translate(\" + d.x0 + \",\" + d.y0 + \")\"; })\n      .attr(\"class\", \"node\")\n      .each(function(d) { d.node = this; })\n      .on(\"mouseover\", hovered(true))\n      .on(\"mouseout\", hovered(false));\n\n  cell.append(\"rect\")\n      .attr(\"id\", function(d) { return \"rect-\" + d.id; })\n      .attr(\"width\", function(d) { return d.x1 - d.x0; })\n      .attr(\"height\", function(d) { return d.y1 - d.y0; })\n      .style(\"fill\", function(d) { return color(d.depth); });\n\n  cell.append(\"clipPath\")\n      .attr(\"id\", function(d) { return \"clip-\" + d.id; })\n    .append(\"use\")\n      .attr(\"xlink:href\", function(d) { return \"#rect-\" + d.id + \"\"; });\n\n  var label = cell.append(\"text\")\n      .attr(\"clip-path\", function(d) { return \"url(#clip-\" + d.id + \")\"; });\n\n  label\n    .filter(function(d) { return d.children; })\n    .selectAll(\"tspan\")\n      .data(function(d) { return d.id.substring(d.id.lastIndexOf(\".\") + 1).split(/(?=[A-Z][^A-Z])/g).concat(\"\\xa0\" + format(d.value)); })\n    .enter().append(\"tspan\")\n      .attr(\"x\", function(d, i) { return i ? null : 4; })\n      .attr(\"y\", 13)\n      .text(function(d) { return d; });\n\n  label\n    .filter(function(d) { return !d.children; })\n    .selectAll(\"tspan\")\n      .data(function(d) { return d.id.substring(d.id.lastIndexOf(\".\") + 1).split(/(?=[A-Z][^A-Z])/g).concat(format(d.value)); })\n    .enter().append(\"tspan\")\n      .attr(\"x\", 4)\n      .attr(\"y\", function(d, i) { return 13 + i * 10; })\n      .text(function(d) { return d; });\n\n  cell.append(\"title\")\n      .text(function(d) { return d.id + \"\\n\" + format(d.value); });\n});\n\nfunction hovered(hover) {\n  return function(d) {\n    d3.selectAll(d.ancestors().map(function(d) { return d.node; }))\n        .classed(\"node--hover\", hover)\n      .select(\"rect\")\n        .attr(\"width\", function(d) { return d.x1 - d.x0 - hover; })\n        .attr(\"height\", function(d) { return d.y1 - d.y0 - hover; });\n  };\n}\n\n</script>\n","filenames":[".block","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"d0157a7dac74464b55259bae24cd0cec7488b26f","preview":"220d3e393605140a6f9bcd39ccba0c178a582888"},"sort":[1458927291000]},{"_index":"blockbuilder","_type":"blocks","_id":"ca5b03a33affa4160321","_score":null,"_source":{"userId":"mbostock","description":"Circle-Packing","created_at":"2016-03-22T19:33:03Z","updated_at":"2016-05-03T18:37:46Z","api":["d3.select","d3.format","d3.scaleMagma","d3.stratify","d3.pack","d3.csv","d3.selectAll"],"colors":["#000000","#ff0000"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ntext {\n  font: 10px sans-serif;\n  text-anchor: middle;\n}\n\n.node--hover circle {\n  stroke: #000;\n  stroke-width: 1.2px;\n}\n\n</style>\n<svg width=\"960\" height=\"960\"><g transform=\"translate(1,1)\"></g></svg>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar svg = d3.select(\"svg\"),\n    width = +svg.attr(\"width\"),\n    height = +svg.attr(\"height\");\n\nvar format = d3.format(\",d\");\n\nvar color = d3.scaleMagma()\n    .domain([-4, 4]);\n\nvar stratify = d3.stratify()\n    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(\".\")); });\n\nvar pack = d3.pack()\n    .size([width - 2, height - 2])\n    .padding(3);\n\nd3.csv(\"flare.csv\", function(error, data) {\n  if (error) throw error;\n\n  var root = stratify(data)\n      .sum(function(d) { return d.value; })\n      .sort(function(a, b) { return b.value - a.value; });\n\n  pack(root);\n\n  var node = svg.select(\"g\")\n    .selectAll(\"g\")\n    .data(root.descendants())\n    .enter().append(\"g\")\n      .attr(\"transform\", function(d) { return \"translate(\" + d.x + \",\" + d.y + \")\"; })\n      .attr(\"class\", function(d) { return \"node\" + (!d.children ? \" node--leaf\" : d.depth ? \"\" : \" node--root\"); })\n      .each(function(d) { d.node = this; })\n      .on(\"mouseover\", hovered(true))\n      .on(\"mouseout\", hovered(false));\n\n  node.append(\"circle\")\n      .attr(\"id\", function(d) { return \"node-\" + d.id; })\n      .attr(\"r\", function(d) { return d.r; })\n      .style(\"fill\", function(d) { return color(d.depth); });\n\n  var leaf = node.filter(function(d) { return !d.children; });\n\n  leaf.append(\"clipPath\")\n      .attr(\"id\", function(d) { return \"clip-\" + d.id; })\n    .append(\"use\")\n      .attr(\"xlink:href\", function(d) { return \"#node-\" + d.id + \"\"; });\n\n  leaf.append(\"text\")\n      .attr(\"clip-path\", function(d) { return \"url(#clip-\" + d.id + \")\"; })\n    .selectAll(\"tspan\")\n      .data(function(d) { return d.id.substring(d.id.lastIndexOf(\".\") + 1).split(/(?=[A-Z][^A-Z])/g); })\n    .enter().append(\"tspan\")\n      .attr(\"x\", 0)\n      .attr(\"y\", function(d, i, nodes) { return 13 + (i - nodes.length / 2 - 0.5) * 10; })\n      .text(function(d) { return d; });\n\n  node.append(\"title\")\n      .text(function(d) { return d.id + \"\\n\" + format(d.value); });\n});\n\nfunction hovered(hover) {\n  return function(d) {\n    d3.selectAll(d.ancestors().map(function(d) { return d.node; })).classed(\"node--hover\", hover);\n  };\n}\n\n</script>\n","filenames":[".block","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"1f294818c6274ee88499a20807accf7243cc6cea","preview":"c9e2dcc9235980079ad4f002ec8bbcaf484e24d1"},"sort":[1458675183000]},{"_index":"blockbuilder","_type":"blocks","_id":"b07f8ae91c5e9e45719c","_score":null,"_source":{"userId":"mbostock","description":"Rainbow Pack","created_at":"2016-03-18T05:11:37Z","updated_at":"2016-05-03T18:36:46Z","api":["d3.select","d3.scaleRainbow","d3.packSiblings","d3.range","d3.randomUniform"],"colors":["#333333","#000000","#d2b48c"],"readme":"A quick test of [d3-hierarchy](https://github.com/d3/d3-hierarchy)’s new circle-packing layout.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  background: #333;\n}\n\ncircle {\n  stroke: #000;\n  stroke-width: 1.5px;\n}\n\n</style>\n<svg width=\"960\" height=\"960\"><g transform=\"translate(480,480)\"></g></svg>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar svg = d3.select(\"svg\"),\n    width = +svg.attr(\"width\"),\n    height = +svg.attr(\"height\"),\n    size = Math.max(width, height);\n\nvar color = d3.scaleRainbow()\n    .domain([0, 2 * Math.PI]);\n\nvar circles = d3.packSiblings(d3.range(2000)\n    .map(d3.randomUniform(8, 26))\n    .map(function(r) { return {r: r}; }))\n  .filter(function(d) { return -500 < d.x && d.x < 500 && -500 < d.y && d.y < 500; });\n\nsvg\n  .select(\"g\")\n  .selectAll(\"circle\")\n  .data(circles)\n  .enter().append(\"circle\")\n    .style(\"fill\", function(d) { return color(d.angle = Math.atan2(d.y, d.x)); })\n    .attr(\"cx\", function(d) { return Math.cos(d.angle) * (size / Math.SQRT2 + 30); })\n    .attr(\"cy\", function(d) { return Math.sin(d.angle) * (size / Math.SQRT2 + 30); })\n    .attr(\"r\", function(d) { return d.r - 0.25; })\n  .transition()\n    .ease(d3.easeCubicOut)\n    .delay(function(d) { return Math.sqrt(d.x * d.x + d.y * d.y) * 10; })\n    .duration(1000)\n    .attr(\"cx\", function(d) { return d.x; })\n    .attr(\"cy\", function(d) { return d.y; });\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"c75eb032025d22ddac38932c57090bacbfeca739","preview":"23975b4e3868141acf9b06a868a63334ecc437ee"},"sort":[1458277897000]},{"_index":"blockbuilder","_type":"blocks","_id":"2e73ec84221cb9773f4c","_score":null,"_source":{"userId":"mbostock","description":"Partition","created_at":"2016-03-17T16:49:00Z","updated_at":"2016-05-03T18:35:31Z","api":["d3.select","d3.format","d3.scaleCategory10","d3.stratify","d3.partition","d3.csv"],"colors":["#dddddd"],"readme":"Each pixel represents approximately one byte.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.node rect {\n  fill: #ddd;\n}\n\n.node text {\n  font: 10px sans-serif;\n}\n\n.node tspan:last-child {\n  font-size: 9px;\n  fill-opacity: 0.8;\n}\n\n.node--internal text {\n  font-weight: bold;\n}\n\n.node--leaf rect {\n  fill-opacity: 0.6;\n}\n\n</style>\n<svg width=\"960\" height=\"4980\"></svg>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar svg = d3.select(\"svg\"),\n    width = +svg.attr(\"width\"),\n    height = +svg.attr(\"height\");\n\nvar format = d3.format(\",d\");\n\nvar color = d3.scaleCategory10();\n\nvar stratify = d3.stratify()\n    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(\".\")); });\n\nvar partition = d3.partition()\n    .size([height, width])\n    .padding(1)\n    .round(true);\n\nd3.csv(\"flare.csv\", function(error, data) {\n  if (error) throw error;\n\n  var root = stratify(data)\n      .sum(function(d) { return d.value; })\n      .sort(function(a, b) { return b.height - a.height || b.value - a.value; });\n\n  partition(root);\n\n  var cell = svg\n    .selectAll(\".node\")\n    .data(root.descendants())\n    .enter().append(\"g\")\n      .attr(\"class\", function(d) { return \"node\" + (d.children ? \" node--internal\" : \" node--leaf\"); })\n      .attr(\"transform\", function(d) { return \"translate(\" + d.y0 + \",\" + d.x0 + \")\"; });\n\n  cell.append(\"rect\")\n      .attr(\"id\", function(d) { return \"rect-\" + d.id; })\n      .attr(\"width\", function(d) { return d.y1 - d.y0; })\n      .attr(\"height\", function(d) { return d.x1 - d.x0; })\n    .filter(function(d) { return !d.children; })\n      .style(\"fill\", function(d) { while (d.depth > 1) d = d.parent; return color(d.id); });\n\n  cell.append(\"clipPath\")\n      .attr(\"id\", function(d) { return \"clip-\" + d.id; })\n    .append(\"use\")\n      .attr(\"xlink:href\", function(d) { return \"#rect-\" + d.id + \"\"; });\n\n  cell.append(\"text\")\n      .attr(\"clip-path\", function(d) { return \"url(#clip-\" + d.id + \")\"; })\n      .attr(\"x\", 4)\n    .selectAll(\"tspan\")\n      .data(function(d) { return [d.id.substring(d.id.lastIndexOf(\".\") + 1), \" \" + format(d.value)]; })\n    .enter().append(\"tspan\")\n      .attr(\"y\", 13)\n      .text(function(d) { return d; });\n\n  cell.append(\"title\")\n      .text(function(d) { return d.id + \"\\n\" + format(d.value); });\n});\n\n</script>\n","filenames":[".block","README.md","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"c686971c8870f2494afc0f39108fcb82fb503fbb","preview":"08135eee20a8da33633c15cfa55aec3a41afd4eb"},"sort":[1458233340000]},{"_index":"blockbuilder","_type":"blocks","_id":"6bbb0a7ff7686b124d80","_score":null,"_source":{"userId":"mbostock","description":"Treemap","created_at":"2016-03-16T22:20:37Z","updated_at":"2016-05-03T18:35:08Z","api":["d3.format","d3.scaleOrdinal","d3.scaleCategory10","d3.rgb","d3.stratify","d3.treemap","d3.csv","d3.select"],"colors":["#ffffff"],"readme":"Each pixel represents approximately one byte.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  font: 10px sans-serif;\n  position: relative;\n}\n\n.node {\n  box-sizing: border-box;\n  line-height: 1em;\n  overflow: hidden;\n  padding: 4px;\n  position: absolute;\n  white-space: pre;\n}\n\n.node-value {\n  color: rgba(0,0,0,0.8);\n  font-size: 9px;\n  margin-top: 1px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.35.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 1060;\n\nvar format = d3.format(\",d\");\n\nvar color = d3.scaleOrdinal()\n    .range(d3.scaleCategory10().range()\n        .map(function(c) { c = d3.rgb(c); c.opacity = 0.6; return c; }));\n\nvar stratify = d3.stratify()\n    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(\".\")); });\n\nvar treemap = d3.treemap()\n    .size([width, height])\n    .padding(1)\n    .round(true);\n\nd3.csv(\"flare.csv\", type, function(error, data) {\n  if (error) throw error;\n\n  var root = stratify(data)\n      .sum(function(d) { return d.value; })\n      .sort(function(a, b) { return b.height - a.height || b.value - a.value; });\n\n  treemap(root);\n\n  d3.select(\"body\")\n    .selectAll(\".node\")\n    .data(root.leaves())\n    .enter().append(\"div\")\n      .attr(\"class\", \"node\")\n      .attr(\"title\", function(d) { return d.id + \"\\n\" + format(d.value); })\n      .style(\"left\", function(d) { return d.x0 + \"px\"; })\n      .style(\"top\", function(d) { return d.y0 + \"px\"; })\n      .style(\"width\", function(d) { return d.x1 - d.x0 + \"px\"; })\n      .style(\"height\", function(d) { return d.y1 - d.y0 + \"px\"; })\n      .style(\"background\", function(d) { while (d.depth > 1) d = d.parent; return color(d.id); })\n      .text(function(d) { return d.id.substring(d.id.lastIndexOf(\".\") + 1).split(/(?=[A-Z][^A-Z])/g).join(\"\\n\"); })\n    .append(\"div\")\n      .attr(\"class\", \"node-value\")\n      .text(function(d) { return format(d.value); });\n});\n\nfunction type(d) {\n  d.value = +d.value;\n  return d;\n}\n\n</script>\n","filenames":[".block","README.md","flare.csv","index.html","preview.png","thumbnail.png"],"thumb":"b102917a03f36939bbddde6c51c49dc6a3b72b5e","preview":"f779a9b784a4003fc0224ee221d2df308e691648"},"sort":[1458166837000]},{"_index":"blockbuilder","_type":"blocks","_id":"346f4d967650b27c0511","_score":null,"_source":{"userId":"mbostock","description":"Chained Transitions II","created_at":"2016-03-08T23:11:50Z","updated_at":"2016-03-09T13:40:20Z","api":["d3.scalePoint","d3.range","d3.scaleLinear","d3.select","d3.active"],"colors":["#fdffcc","#242a42","#000000"],"readme":"This animation demonstrates the use of [d3.active](https://github.com/d3/d3-transition#active) to create [chained transitions](/mbostock/1125997) in D3 4.0.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ncircle {\n  fill: #000;\n  stroke: #000;\n  stroke-width: 1.5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.28.min.js\"></script>\n<script>\n\nvar margin = {top: 40, right: 40, bottom: 40, left: 40},\n    width = 960 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar y = d3.scalePoint()\n    .domain(d3.range(50))\n    .range([0, height]);\n\nvar z = d3.scaleLinear()\n    .domain([10, 0])\n    .range([\"hsl(62,100%,90%)\", \"hsl(228,30%,20%)\"])\n    .interpolate(d3.interpolateHcl);\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nsvg.selectAll(\"circle\")\n    .data(y.domain())\n  .enter().append(\"circle\")\n    .attr(\"r\", 25)\n    .attr(\"cx\", 0)\n    .attr(\"cy\", y)\n    .style(\"fill\", function(d) { return z(Math.abs(d % 20 - 10)); })\n  .transition()\n    .duration(2500)\n    .delay(function(d) { return d * 40; })\n    .on(\"start\", slide);\n\nfunction slide() {\n  d3.active(this)\n      .attr(\"cx\", width)\n    .transition()\n      .attr(\"cx\", 0)\n    .transition()\n      .on(\"start\", slide);\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"09df60ccc4056c2e69e6c0ee40c9ce8907cd9531"},"sort":[1457478710000]},{"_index":"blockbuilder","_type":"blocks","_id":"35964711079355050ff1","_score":null,"_source":{"userId":"mbostock","description":"Zoom vs. Drag","created_at":"2016-03-02T14:34:27Z","updated_at":"2016-03-02T14:34:31Z","api":["d3.range","d3.scale.category10","d3.behavior.zoom","d3.select","d3.event.preventDefault"],"colors":["#ffffff","#000000","#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],"readme":"This example demonstrates how to disambiguate a click from a zoom gesture using d3.event.defaultPrevented. Click and drag to pan, mousewheel to zoom, or click the background to briefly highlight it.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width\">\n<style>\n\nhtml,\nbody {\n  height: 100%;\n  margin: 0;\n  overflow: hidden;\n}\n\nsvg {\n  position: absolute;\n}\n\nrect {\n  fill: white;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar width = self.frameElement ? 960 : innerWidth,\n    height = self.frameElement ? 500 : innerHeight;\n\nvar data = d3.range(20).map(function() { return [Math.random() * width, Math.random() * height]; });\n\nvar color = d3.scale.category10();\n\nvar zoom = d3.behavior.zoom()\n    .on(\"zoom\", zoomed);\n\nvar svg = d3.select(\"body\")\n    .on(\"touchstart\", nozoom)\n    .on(\"touchmove\", nozoom)\n  .append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height);\n\nvar g = svg.append(\"g\")\n    .call(zoom);\n\ng.append(\"rect\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n    .on(\"click\", clicked);\n\nvar view = g.append(\"g\")\n    .attr(\"class\", \"view\");\n\nview.selectAll(\"circle\")\n    .data(data)\n  .enter().append(\"circle\")\n    .attr(\"transform\", function(d) { return \"translate(\" + d + \")\"; })\n    .attr(\"r\", 32)\n    .style(\"fill\", function(d, i) { return color(i); });\n\nfunction zoomed() {\n  view.attr(\"transform\", \"translate(\" + d3.event.translate + \") scale(\" + d3.event.scale + \")\");\n}\n\nfunction clicked(d, i) {\n  if (d3.event.defaultPrevented) return; // zoomed\n\n  d3.select(this).transition()\n      .style(\"fill\", \"black\")\n    .transition()\n      .style(\"fill\", \"white\");\n}\n\nfunction nozoom() {\n  d3.event.preventDefault();\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"683f586644d4b5c6f555a09cced3ea44a13c6edc"},"sort":[1456929267000]},{"_index":"blockbuilder","_type":"blocks","_id":"a84aeb78fea81e1ad806","_score":null,"_source":{"userId":"mbostock","description":"Click vs. Drag","created_at":"2016-03-01T20:44:39Z","updated_at":"2016-03-01T20:48:53Z","api":["d3.range","d3.scale.category10","d3.behavior.drag","d3.select","d3.event.preventDefault"],"colors":["#000000","#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],"readme":"This example demonstrates how to disambiguate a click from a drag gesture using d3.event.defaultPrevented. Drag any circle to change its position, or click it to briefly inflate.\n\nNote that you must be careful not to re-append the element on dragstart (mousedown), as this may prevent the browser from dispatching a click event! Instead, defer the move-to-front until the first drag event.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width\">\n<style>\n\nhtml,\nbody {\n  height: 100%;\n  margin: 0;\n  overflow: hidden;\n}\n\nsvg {\n  position: absolute;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar width = self.frameElement ? 960 : innerWidth,\n    height = self.frameElement ? 500 : innerHeight;\n\nvar data = d3.range(20).map(function() { return [Math.random() * width, Math.random() * height]; });\n\nvar color = d3.scale.category10();\n\nvar drag = d3.behavior.drag()\n    .origin(function(d) { return {x: d[0], y: d[1]}; })\n    .on(\"drag\", dragged);\n\nd3.select(\"body\")\n    .on(\"touchstart\", nozoom)\n    .on(\"touchmove\", nozoom)\n  .append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n  .selectAll(\"circle\")\n    .data(data)\n  .enter().append(\"circle\")\n    .attr(\"transform\", function(d) { return \"translate(\" + d + \")\"; })\n    .attr(\"r\", 32)\n    .style(\"fill\", function(d, i) { return color(i); })\n    .on(\"click\", clicked)\n    .call(drag);\n\nfunction dragged(d) {\n  d[0] = d3.event.x, d[1] = d3.event.y;\n  if (this.nextSibling) this.parentNode.appendChild(this);\n  d3.select(this).attr(\"transform\", \"translate(\" + d + \")\");\n}\n\nfunction clicked(d, i) {\n  if (d3.event.defaultPrevented) return; // dragged\n\n  d3.select(this).transition()\n      .style(\"fill\", \"black\")\n      .attr(\"r\", 64)\n    .transition()\n      .attr(\"r\", 32)\n      .style(\"fill\", color(i));\n}\n\nfunction nozoom() {\n  d3.event.preventDefault();\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"683f586644d4b5c6f555a09cced3ea44a13c6edc"},"sort":[1456865079000]},{"_index":"blockbuilder","_type":"blocks","_id":"f7dcecb19c4af317e464","_score":null,"_source":{"userId":"mbostock","description":"Text Transition II","created_at":"2016-02-26T23:32:22Z","updated_at":"2016-02-26T23:36:20Z","api":["d3.format","d3.select","d3.active"],"colors":[],"readme":"A demonstration of [transitioning text](/mbostock/7004f92cac972edef365) by fading-out the old element and fading-in a new replacement.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nh1 {\n  font: 400 120px/500px \"Helvetica Neue\";\n  text-align: center;\n  width: 960px;\n  height: 500px;\n  margin: 0;\n  position: absolute;\n}\n\n</style>\n<h1>0</h1>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.23.min.js\"></script>\n<script>\n\nvar format = d3.format(\",d\");\n\nd3.select(\"h1\")\n  .transition()\n    .duration(2500)\n    .on(\"start\", function repeat() {\n      var t = d3.active(this)\n          .style(\"opacity\", 0)\n          .remove();\n\n      d3.select(\"body\").append(\"h1\")\n          .style(\"opacity\", 0)\n          .text(format(Math.random() * 1e6))\n        .transition(t)\n          .style(\"opacity\", 1)\n        .transition()\n          .delay(1500)\n          .on(\"start\", repeat);\n    });\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"b424fe293b9fd2e5b6500cb6fabb365966224d41"},"sort":[1456529542000]},{"_index":"blockbuilder","_type":"blocks","_id":"7004f92cac972edef365","_score":null,"_source":{"userId":"mbostock","description":"Text Transition I","created_at":"2016-02-26T23:31:58Z","updated_at":"2016-02-26T23:32:51Z","api":["d3.format","d3.select","d3.active","d3.interpolateNumber"],"colors":[],"readme":"A demonstration of using [*transition*.tween](https://github.com/d3/d3-transition#transition_tween) to interpolate text. The [*transition*.text](https://github.com/d3/d3-transition#transition_text) method doesn’t do this by default because it’s often distracting; instead, it just sets the new text value when the transition starts. Another way to transition text is to [cross-fade](/mbostock/f7dcecb19c4af317e464).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nh1 {\n  font: 400 120px/500px \"Helvetica Neue\";\n  text-align: center;\n  width: 960px;\n  height: 500px;\n  margin: 0;\n}\n\n</style>\n<h1>0</h1>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.23.min.js\"></script>\n<script>\n\nvar format = d3.format(\",d\");\n\nd3.select(\"h1\")\n  .transition()\n    .duration(2500)\n    .on(\"start\", function repeat() {\n      d3.active(this)\n          .tween(\"text\", function() {\n            var that = d3.select(this),\n                i = d3.interpolateNumber(that.text().replace(/,/g, \"\"), Math.random() * 1e6);\n            return function(t) { that.text(format(i(t))); };\n          })\n        .transition()\n          .delay(1500)\n          .on(\"start\", repeat);\n    });\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"b424fe293b9fd2e5b6500cb6fabb365966224d41"},"sort":[1456529518000]},{"_index":"blockbuilder","_type":"blocks","_id":"43aebffeacf96d8d881f","_score":null,"_source":{"userId":"mbostock","description":"Transform Transitions II","created_at":"2016-02-26T22:06:01Z","updated_at":"2016-02-26T22:06:06Z","api":["d3.select","d3.range","d3.hsl"],"colors":["#ffffff"],"readme":"D3 4.0 can now interpolate [CSS transforms](https://github.com/d3/d3-interpolate#interpolateTransformCss)!\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  margin: 0;\n}\n\ndiv {\n  position: absolute;\n  width: 20px;\n  height: 20px;\n  border: solid 1px #fff;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.22.min.js\"></script>\n<script>\n\nvar z = 20,\n    x = 960 / z,\n    y = 500 / z;\n\nd3.select(\"body\").selectAll(\"div\")\n    .data(d3.range(x * y))\n  .enter().append(\"div\")\n    .style(\"transform\", function(d) { return \"translate(\" + (d % x) * z + \"px, \" + Math.floor(d / x) * z + \"px)\"; })\n    .style(\"background-color\", function(d) { return d3.hsl(d % x / x * 360, 1, Math.floor(d / x) / y); })\n    .on(\"mouseover\", mouseover);\n\nfunction mouseover(d) {\n  d3.select(this)\n      .style(\"pointer-events\", \"none\")\n      .raise()\n    .transition()\n      .duration(750)\n      .style(\"transform\", \"translate(480px, 240px) scale(20) rotate(180deg)\")\n    .transition()\n      .delay(1500)\n      .style(\"transform\", \"translate(480px, 240px) scale(0.01)\")\n      .remove();\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"88dafb2aa9fb34c1a145750bd3c4225fa84a1d26"},"sort":[1456524361000]},{"_index":"blockbuilder","_type":"blocks","_id":"a7ae83252305ed4d54d4","_score":null,"_source":{"userId":"mbostock","description":"Werner","created_at":"2016-02-25T01:57:41Z","updated_at":"2016-02-25T01:57:45Z","api":["d3.geo.bonne","d3.geo.path","d3.geo.graticule","d3.select","d3.json"],"colors":["#fcfcfa","#000000","#ffffff","#777777","#222222"],"readme":"The [Werner projection](https://en.wikipedia.org/wiki/Werner_projection) is a limiting form of the [Bonne projection](/mbostock/3734313), having its standard parallel at ±90°. It is available as d3.geo.bonne in [d3-geo-projection](https://github.com/d3/d3-geo-projection).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  background: #fcfcfa;\n}\n\n.stroke {\n  fill: none;\n  stroke: #000;\n  stroke-width: 3px;\n}\n\n.fill {\n  fill: #fff;\n}\n\n.graticule {\n  fill: none;\n  stroke: #777;\n  stroke-width: .5px;\n  stroke-opacity: .5;\n}\n\n.land {\n  fill: #222;\n}\n\n.boundary {\n  fill: none;\n  stroke: #fff;\n  stroke-width: .5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script src=\"//d3js.org/d3.geo.projection.v0.min.js\"></script>\n<script src=\"//d3js.org/topojson.v1.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 960;\n\nvar projection = d3.geo.bonne()\n    .center([0, 27])\n    .scale(220)\n    .translate([width / 2, height / 2])\n    .parallel(90)\n    .precision(0.2);\n\nvar path = d3.geo.path()\n    .projection(projection);\n\nvar graticule = d3.geo.graticule();\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height);\n\nsvg.append(\"defs\").append(\"path\")\n    .datum({type: \"Sphere\"})\n    .attr(\"id\", \"sphere\")\n    .attr(\"d\", path);\n\nsvg.append(\"use\")\n    .attr(\"class\", \"stroke\")\n    .attr(\"xlink:href\", \"#sphere\");\n\nsvg.append(\"use\")\n    .attr(\"class\", \"fill\")\n    .attr(\"xlink:href\", \"#sphere\");\n\nsvg.append(\"path\")\n    .datum(graticule)\n    .attr(\"class\", \"graticule\")\n    .attr(\"d\", path);\n\nd3.json(\"/mbostock/raw/4090846/world-50m.json\", function(error, world) {\n  if (error) throw error;\n\n  svg.insert(\"path\", \".graticule\")\n      .datum(topojson.feature(world, world.objects.land))\n      .attr(\"class\", \"land\")\n      .attr(\"d\", path);\n\n  svg.insert(\"path\", \".graticule\")\n      .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))\n      .attr(\"class\", \"boundary\")\n      .attr(\"d\", path);\n});\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"40b63676f7c2ec64470f7d78284fe497a9d2edd5","preview":"ae094e066c4f2dc8f59a4585ed289e2f1742128a"},"sort":[1456365461000]},{"_index":"blockbuilder","_type":"blocks","_id":"c150b717e18d387e1b98","_score":null,"_source":{"userId":"mbostock","description":"Polar Clock III","created_at":"2016-02-24T17:25:03Z","updated_at":"2016-03-11T21:44:01Z","api":["d3.select","d3.timeFormat","d3.scaleRainbow","d3.arc","d3.timeSecond.offset","d3.timeSecond"],"colors":["#222222","#000000","#d2b48c"],"readme":"Another [variation](/mbostock/b89c89ec6b58435956a1) of a [polar clock](/mbostock/1096355), inspired by a [Flash screensaver by pixelbreaker](http://blog.pixelbreaker.com/polarclock).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  background: #222;\n  margin: auto;\n  width: 960px;\n}\n\n.field-track,\n.field-arm {\n  fill: none;\n  stroke: #000;\n  stroke-width: 1.5px;\n}\n\n.field-tick {\n  transition: opacity 750ms linear;\n}\n\n.field-tick:not(.field-tick--active) circle,\n.field-tick:not(.field-tick--active):first-of-type text {\n  fill: #222 !important;\n}\n\n.field-tick:not(.field-tick--active):first-of-type circle {\n  fill: #000 !important;\n}\n\n.field-tick--disabled {\n  opacity: 0;\n}\n\n.field-tick circle,\n.field-tick text {\n  transition: fill 250ms linear;\n  transition-delay: 400ms;\n}\n\n.field-tick text {\n  font: 700 14px \"Helvetica Neue\";\n  text-anchor: middle;\n}\n\n</style>\n<svg width=\"960\" height=\"960\"></svg>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.28.min.js\"></script>\n<script>\n\nvar svg = d3.select(\"svg\"),\n    width = +svg.attr(\"width\"),\n    height = +svg.attr(\"height\"),\n    radius = Math.min(width, height) / 1.9,\n    armRadius = radius / 22,\n    dotRadius = armRadius - 6;\n\nvar duration = 750,\n    now = new Date(Date.now() + 2 * duration);\n\nvar pi = Math.PI,\n    tau = pi * 2;\n\nvar fields = [\n  {radius: 0.2 * radius, interval: d3.timeYear,   subinterval: d3.timeMonth,  format: d3.timeFormat(\"%b\")},\n  {radius: 0.3 * radius, interval: d3.timeMonth,  subinterval: d3.timeDay,    format: d3.timeFormat(\"%d\")},\n  {radius: 0.4 * radius, interval: d3.timeWeek,   subinterval: d3.timeDay,    format: d3.timeFormat(\"%a\")},\n  {radius: 0.6 * radius, interval: d3.timeDay,    subinterval: d3.timeHour,   format: d3.timeFormat(\"%H\")},\n  {radius: 0.7 * radius, interval: d3.timeHour,   subinterval: d3.timeMinute, format: d3.timeFormat(\"%M\")},\n  {radius: 0.8 * radius, interval: d3.timeMinute, subinterval: d3.timeSecond, format: d3.timeFormat(\"%S\")}\n];\n\nvar color = d3.scaleRainbow()\n    .domain([0, tau]);\n\nvar arcArm = d3.arc()\n    .startAngle(function(d) { return armRadius / d.radius; })\n    .endAngle(function(d) { return -pi - armRadius / d.radius; })\n    .innerRadius(function(d) { return d.radius - armRadius; })\n    .outerRadius(function(d) { return d.radius + armRadius; })\n    .cornerRadius(armRadius);\n\nvar field = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + width / 2 + \",\" + height / 2 + \")\")\n  .selectAll(\".field\")\n    .data(fields)\n  .enter().append(\"g\")\n    .attr(\"class\", \"field\");\n\nfield.append(\"circle\")\n    .attr(\"class\", \"field-track\")\n    .attr(\"r\", function(d) { return d.radius; });\n\nvar fieldTick = field.selectAll(\".field-tick\")\n    .data(function(d) {\n      var date = d.interval(new Date(2000, 0, 1));\n      d.range = d.subinterval.range(date, d.interval.offset(date, 1));\n      return d.range.map(function(t) { return {time: t, field: d}; });\n    })\n  .enter().append(\"g\")\n    .attr(\"class\", \"field-tick\")\n    .attr(\"transform\", function(d, i) {\n      var angle = i / d.field.range.length * tau - pi / 2;\n      return \"translate(\" + Math.cos(angle) * d.field.radius + \",\" + Math.sin(angle) * d.field.radius + \")\";\n    });\n\nfieldTick.append(\"circle\")\n    .attr(\"r\", dotRadius - 3)\n    .style(\"fill\", function(d, i) { return color(i / d.field.range.length * tau); });\n\nfieldTick.append(\"text\")\n    .attr(\"dy\", \"0.35em\")\n    .text(function(d) { return d.field.format(d.time).slice(0, 2); });\n\nvar fieldArm = field.append(\"path\")\n    .attr(\"class\", \"field-arm\")\n    .attr(\"transform\", \"rotate(0)\")\n    .attr(\"d\", function(d) {\n      return arcArm(d)\n          + \"M0,\" + (dotRadius - d.radius)\n          + \"a\" + dotRadius + \",\" + dotRadius + \" 0 0,1 0,\" + -dotRadius * 2\n          + \"a\" + dotRadius + \",\" + dotRadius + \" 0 0,1 0,\" + dotRadius * 2;\n    });\n\n(function tick() {\n  var now = new Date,\n      then = new Date(+now + duration),\n      next = d3.timeSecond.offset(d3.timeSecond(then), 1),\n      delay = next - duration - now;\n\n  // Skip ahead a second if there’s not time for this transition.\n  if (delay < duration) delay += 1000, then = next;\n\n  fieldArm.transition()\n      .duration(duration)\n      .each(function(d) {\n        var start = d.interval(then);\n        d.activeLength = d.subinterval.count(start, d.interval.offset(start, 1));\n        d.activeIndex = d.subinterval.count(start, then);\n        d.angle = d.activeIndex / d.range.length * tau;\n      })\n      .attr(\"transform\", function(d) { return \"rotate(\" + d.angle / pi * 180 + \")\"; })\n      .style(\"fill\", function(d) { return color(d.angle); });\n\n  fieldTick\n      .classed(\"field-tick--disabled\", function(d, i) { return i >= d.field.activeLength; })\n      .classed(\"field-tick--active\", function(d, i) { return i === d.field.activeIndex; });\n\n  setTimeout(tick, delay);\n})();\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"c30cb17859164bc28685a3de0c1c2cfc75982766","preview":"0808a11dd70856bb10449ecd7abeb1db913e503c"},"sort":[1456334703000]},{"_index":"blockbuilder","_type":"blocks","_id":"b89c89ec6b58435956a1","_score":null,"_source":{"userId":"mbostock","description":"Polar Clock II","created_at":"2016-02-23T21:43:08Z","updated_at":"2016-02-24T19:33:38Z","api":["d3.select","d3.timeFormat","d3.scaleRainbow","d3.arc","d3.timer"],"colors":["#222222","#000000","#d2b48c"],"readme":"A variation of a [polar clock](/mbostock/1096355), inspired by a [Flash screensaver by pixelbreaker](http://blog.pixelbreaker.com/polarclock).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  background: #222;\n  margin: auto;\n  width: 960px;\n}\n\n.tracks {\n  fill: none;\n  stroke: #000;\n  stroke-width: 1.5px;\n}\n\n.bodies path {\n  stroke: #000;\n  stroke-width: 1.5px;\n}\n\n.bodies .text-path {\n  stroke: none;\n}\n\n.bodies text {\n  fill: #000;\n  font: 500 16px \"Helvetica Neue\";\n}\n\n</style>\n<svg width=\"960\" height=\"960\"></svg>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.21.min.js\"></script>\n<script>\n\nvar svg = d3.select(\"svg\"),\n    width = +svg.attr(\"width\"),\n    height = +svg.attr(\"height\"),\n    radius = Math.min(width, height) / 1.9,\n    bodyRadius = radius / 23,\n    dotRadius = bodyRadius - 8;\n\nvar pi = Math.PI;\n\nvar fields = [\n  {radius: 0.2 * radius, format: d3.timeFormat(\"%B\"),          interval: d3.timeYear},\n  {radius: 0.3 * radius, format: formatDate,                   interval: d3.timeMonth},\n  {radius: 0.4 * radius, format: d3.timeFormat(\"%A\"),          interval: d3.timeWeek},\n  {radius: 0.6 * radius, format: d3.timeFormat(\"%-H hours\"),   interval: d3.timeDay},\n  {radius: 0.7 * radius, format: d3.timeFormat(\"%-M minutes\"), interval: d3.timeHour},\n  {radius: 0.8 * radius, format: d3.timeFormat(\"%-S seconds\"), interval: d3.timeMinute}\n];\n\nvar color = d3.scaleRainbow()\n    .domain([0, 360]);\n\nvar arcBody = d3.arc()\n    .startAngle(function(d) { return bodyRadius / d.radius; })\n    .endAngle(function(d) { return -pi - bodyRadius / d.radius; })\n    .innerRadius(function(d) { return d.radius - bodyRadius; })\n    .outerRadius(function(d) { return d.radius + bodyRadius; })\n    .cornerRadius(bodyRadius);\n\nvar arcTextPath = d3.arc()\n    .startAngle(function(d) { return -bodyRadius / d.radius; })\n    .endAngle(-pi)\n    .innerRadius(function(d) { return d.radius; })\n    .outerRadius(function(d) { return d.radius; });\n\nvar g = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + width / 2 + \",\" + height / 2 + \")\");\n\ng.append(\"g\")\n    .attr(\"class\", \"tracks\")\n  .selectAll(\"circle\")\n    .data(fields)\n  .enter().append(\"circle\")\n    .attr(\"r\", function(d) { return d.radius; });\n\nvar body = g.append(\"g\")\n    .attr(\"class\", \"bodies\")\n  .selectAll(\"g\")\n    .data(fields)\n  .enter().append(\"g\");\n\nbody.append(\"path\")\n    .attr(\"d\", function(d) {\n      return arcBody(d)\n          + \"M0,\" + (dotRadius - d.radius)\n          + \"a\" + dotRadius + \",\" + dotRadius + \" 0 0,1 0,\" + -dotRadius * 2\n          + \"a\" + dotRadius + \",\" + dotRadius + \" 0 0,1 0,\" + dotRadius * 2;\n    });\n\nbody.append(\"path\")\n    .attr(\"class\", \"text-path\")\n    .attr(\"id\", function(d, i) { return \"body-text-path-\" + i; })\n    .attr(\"d\", arcTextPath);\n\nvar bodyText = body.append(\"text\")\n    .attr(\"dy\", \".35em\")\n  .append(\"textPath\")\n    .attr(\"xlink:href\", function(d, i) { return \"#body-text-path-\" + i; });\n\ntick();\n\nd3.timer(tick);\n\nfunction tick() {\n  var now = Date.now();\n\n  fields.forEach(function(d) {\n    var start = d.interval(now),\n        end = d.interval.offset(start, 1);\n    d.angle = Math.round((now - start) / (end - start) * 360 * 100) / 100;\n  });\n\n  body\n      .style(\"fill\", function(d) { return color(d.angle); })\n      .attr(\"transform\", function(d) { return \"rotate(\" + d.angle + \")\"; });\n\n  bodyText\n      .attr(\"startOffset\", function(d, i) { return d.angle <= 90 || d.angle > 270 ? \"100%\" : \"0%\"; })\n      .attr(\"text-anchor\", function(d, i) { return d.angle <= 90 || d.angle > 270 ? \"end\" : \"start\"; })\n      .text(function(d) { return d.format(now); });\n}\n\nfunction formatDate(d) {\n  d = new Date(d).getDate();\n  switch (10 <= d && d <= 19 ? 10 : d % 10) {\n    case 1: d += \"st\"; break;\n    case 2: d += \"nd\"; break;\n    case 3: d += \"rd\"; break;\n    default: d += \"th\"; break;\n  }\n  return d;\n}\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"27a6edbb63827b3f301816626210bd06d0445f79","preview":"8120725a5eaf5d047ed180a16902a2369f1d2ea9"},"sort":[1456263788000]},{"_index":"blockbuilder","_type":"blocks","_id":"c7e85d2b47d11982db38","_score":null,"_source":{"userId":"mbostock","description":"Star Map","created_at":"2016-02-23T18:37:23Z","updated_at":"2016-02-23T19:20:05Z","api":["d3.scale.linear","d3.geo.projection","d3.geo.path","d3.select","d3.geo.circle","d3.geo.graticule","d3.range","d3.csv","d3.geom.voronoi"],"colors":["#081f2b","#061616","#ffffff","#000000","#ff0000","#ffff00","#d2b48c"],"readme":"A star map of the Northern Hemisphere using a flipped stereographic projection, showing [declination](https://en.wikipedia.org/wiki/Declination) and [right ascension](https://en.wikipedia.org/wiki/Right_ascension). I believe the data is from the [Yale Bright Star Catalog](http://tdc-www.harvard.edu/catalogs/bsc5.html), but I got it from [Matteo Abrate’s sky map](/nitaku/9607405).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  background: radial-gradient(720px at 490px, #081f2b 0%, #061616 100%);\n  height: 960px;\n}\n\npath {\n  fill: none;\n  stroke-linecap: round;\n  stroke-linejoin: round;\n}\n\ntext {\n  font: 10px sans-serif;\n}\n\n.horizon {\n  stroke: #fff;\n  stroke-width: 1.5px;\n}\n\n.graticule {\n  stroke: #fff;\n  stroke-opacity: .15;\n}\n\n.ticks line {\n  stroke: #fff;\n}\n\n.ticks text {\n  fill: #fff;\n  text-anchor: middle;\n}\n\n.ticks--right-ascension text:nth-of-type(6n + 1) {\n  font-weight: bold;\n  font-size: 14px;\n}\n\n.stars {\n  fill: #fff;\n  stroke: #000;\n}\n\n.star--active {\n  stroke: yellow;\n}\n\n.voronoi {\n  fill: none;\n  pointer-events: all;\n}\n\n.cross {\n  fill: none;\n  stroke: yellow;\n  stroke-width: 0.5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 960,\n    scale = width * 0.45;\n\nvar radius = d3.scale.linear()\n    .domain([-1, 6])\n    .range([8, 0]);\n\nvar projection = d3.geo.projection(flippedStereographic)\n    .scale(scale)\n    .clipAngle(130)\n    .rotate([0, -90])\n    .translate([width / 2, height / 2])\n    .precision(0.1);\n\nvar path = d3.geo.path()\n    .projection(projection);\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(0.5,0.5)\");\n\nsvg.append(\"path\")\n    .datum(d3.geo.circle().origin([0, 90]).angle(90))\n    .attr(\"class\", \"horizon\")\n    .attr(\"d\", path);\n\nsvg.append(\"path\")\n    .datum(d3.geo.graticule().minorStep([15, 10]))\n    .attr(\"class\", \"graticule\")\n    .attr(\"d\", path);\n\nvar crossDeclination = svg.append(\"circle\")\n    .attr(\"transform\", \"translate(\" + width / 2 + \",\" + height / 2 + \")\")\n    .attr(\"class\", \"cross cross--declination\");\n\nvar crossRightAscension = svg.append(\"line\")\n    .attr(\"x1\", width / 2)\n    .attr(\"y1\", height / 2)\n    .attr(\"x2\", width / 2)\n    .attr(\"y2\", height / 2)\n    .attr(\"class\", \"cross cross--right-ascension\");\n\nvar ticksRightAscension = svg.append(\"g\")\n    .attr(\"class\", \"ticks ticks--right-ascension\");\n\nticksRightAscension.selectAll(\"line\")\n    .data(d3.range(0, 1440, 5)) // every 5 minutes\n  .enter().append(\"line\")\n    .each(function(d) {\n      var p0 = projection([d / 4, 0]),\n          p1 = projection([d / 4, d % 60 ? -1 : -2]);\n\n      d3.select(this)\n          .attr(\"x1\", p0[0])\n          .attr(\"y1\", p0[1])\n          .attr(\"x2\", p1[0])\n          .attr(\"y2\", p1[1]);\n    });\n\nticksRightAscension.selectAll(\"text\")\n    .data(d3.range(24)) // every hour\n  .enter().append(\"text\")\n    .each(function(d) {\n      var p = projection([d * 15, -4]);\n\n      d3.select(this)\n          .attr(\"x\", p[0])\n          .attr(\"y\", p[1]);\n    })\n    .attr(\"dy\", \".35em\")\n    .text(function(d) { return d + \"h\"; });\n\nsvg.append(\"g\")\n    .attr(\"class\", \"ticks ticks--declination\")\n  .selectAll(\"text\")\n    .data(d3.range(10, 91, 10))\n  .enter().append(\"text\")\n    .each(function(d) {\n      var p = projection([0, d]);\n\n      d3.select(this)\n          .attr(\"x\", p[0])\n          .attr(\"y\", p[1]);\n    })\n    .attr(\"dy\", \".35em\")\n    .text(function(d) { return d + \"°\"; });\n\nd3.csv(\"stars.csv\", type, function(error, stars) {\n  if (error) throw error;\n\n  svg.insert(\"g\", \".ticks\")\n      .attr(\"class\", \"stars\")\n    .selectAll(\"circle\")\n      .data(stars)\n    .enter().append(\"circle\")\n      .attr(\"id\", function(d, i) { return \"star-\" + i; })\n      .attr(\"r\", function(d) { return radius(d.magnitude); })\n      .attr(\"transform\", function(d) { return \"translate(\" + d[0] + \",\" + d[1] + \")\"; });\n\n  svg.append(\"g\")\n      .attr(\"class\", \"voronoi\")\n    .selectAll(\"path\")\n      .data(d3.geom.voronoi()(stars))\n    .enter().append(\"path\")\n      .on(\"mouseover\", mouseovered)\n      .on(\"mouseout\", mouseouted)\n    .filter(function(d) { return d; })\n      .attr(\"d\", function(d) { return \"M\" + d.join(\"L\"); })\n      .datum(function(d) { return d.point; })\n    .append(\"title\")\n      .text(function(d) { return \"HR\" + d.ID + (d.greek_letter || d.constellation ? \"\\n\" + d.constellation + \" \" + d.greek_letter : \"\"); });\n});\n\nfunction mouseovered(d, i) {\n  var dx = d[0] - width / 2,\n      dy = d[1] - height / 2,\n      a = Math.atan2(dy, dx);\n  crossDeclination.attr(\"r\", Math.sqrt(dx * dx + dy * dy));\n  crossRightAscension.attr(\"x2\", width / 2 + width * Math.cos(a)).attr(\"y2\", height / 2 + height * Math.sin(a));\n  console.log(d3.select(\"#star-\" + i).node());\n  d3.select(\"#star-\" + i).classed(\"star--active\", true);\n}\n\nfunction mouseouted(d, i) {\n  d3.select(\"#star-\" + i).classed(\"star--active\", false);\n}\n\nfunction type(d) {\n  var p = projection([(+d.RA_hour + d.RA_min / 60 + d.RA_sec / 3600) * 15, +d.dec_deg + d.dec_min / 60 + d.dec_sec / 3600]);\n  d[0] = p[0], d[1] = p[1];\n  d.magnitude = +d.magnitude;\n  return d;\n}\n\nfunction flippedStereographic(lambda, phi)  {\n  var coslambda = Math.cos(lambda),\n      cosphi = Math.cos(phi),\n      k = 1 / (1 + coslambda * cosphi);\n  return [\n    k * cosphi * Math.sin(lambda),\n    -k * Math.sin(phi)\n  ];\n}\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","stars.csv","thumbnail.png"],"thumb":"e4d200d250907fcc8e07f2761790996fd0c85477","preview":"1c0ae6b4bb3c7c606c8ec991c5dc71b66167ddf4"},"sort":[1456252643000]},{"_index":"blockbuilder","_type":"blocks","_id":"a4b53ef57fce8fffc423","_score":null,"_source":{"userId":"mbostock","description":"N-Body Problem II","created_at":"2016-02-22T20:19:19Z","updated_at":"2016-05-02T23:07:27Z","api":["d3.range","d3.forceSimulation","d3.forceManyBody","d3.forceCenter","d3.scaleLinear"],"colors":["#000000","#ffff00","#ff00ff"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  background: #000;\n}\n\n</style>\n<canvas width=\"960\" height=\"960\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.33.min.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nvar n = 400,\n    pi = Math.PI,\n    tau = 2 * pi;\n\nvar nodes = d3.range(n).map(function() {\n  var r = Math.random() * width / 3,\n      a = Math.random() * tau,\n      x = width / 2 + r * Math.cos(a),\n      y = height / 2 + r * Math.sin(a);\n  return {\n    x: x,\n    y: y,\n    vx: (height / 2 - y) * 0.006,\n    vy: (x - width / 2) * 0.006\n  };\n});\n\nvar force = d3.forceSimulation(nodes)\n    .drag(0)\n    .alphaDecay(0)\n    .force(\"charge\", d3.forceManyBody().strength(0.02))\n    .force(\"center\", d3.forceCenter(width / 2, height / 2))\n    .on(\"tick\", ticked);\n\nvar stroke = d3.scaleLinear()\n    .domain([0, 10])\n    .range([\"magenta\", \"yellow\"]);\n\nfunction ticked() {\n  context.clearRect(0, 0, width, height);\n  context.lineWidth = 4;\n  context.lineCap = \"square\";\n\n  for (var i = 0, node, vx, vy; i < n; ++i) {\n    node = nodes[i];\n    context.beginPath();\n    context.moveTo(node.x, node.y);\n    context.lineTo(node.x + node.vx * 3, node.y + node.vy * 3);\n    context.strokeStyle = stroke(node.vx * node.vx + node.vy * node.vy);\n    context.stroke();\n  }\n}\n\n</script>\n","filenames":[".block","index.html","preview.png","thumbnail.png"],"thumb":"fc748f449c2319e206bff977620d40e9d488880b","preview":"2d6607a285a62fa8d63756742eedc05d5e811cbd"},"sort":[1456172359000]},{"_index":"blockbuilder","_type":"blocks","_id":"835cf2925ba217821434","_score":null,"_source":{"userId":"mbostock","description":"N-Body Problem","created_at":"2016-02-20T01:13:07Z","updated_at":"2016-03-02T11:18:20Z","api":["d3.range","d3.layout.force","d3.scale.linear","d3.geom.quadtree"],"colors":["#000000","#ffffff","#a52a2a","#4682b4","#0000ff"],"readme":"A recreation of an [earlier Protovis example](https://mbostock.github.io/protovis/ex/nbody.html).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  background: #000;\n}\n\n</style>\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nvar n = 200,\n    tau = 2 * Math.PI,\n    nodes = d3.range(n).map(function() { return {radius: Math.random() * 8 + 2}; });\n\nvar force = d3.layout.force()\n    .charge(0.5)\n    .gravity(0)\n    .friction(1)\n    .nodes(nodes)\n    .size([width, height])\n    .start();\n\nvar stroke = d3.scale.linear()\n    .domain([0, 1])\n    .range([\"steelblue\", \"brown\"]);\n\nforce.on(\"tick\", function(e) {\n  var q = d3.geom.quadtree(nodes), node, i, vx, vy;\n  context.clearRect(0, 0, width, height);\n  context.lineWidth = 1.5;\n\n  for (i = 0; i < n; ++i) {\n    q.visit(collide(nodes[i]));\n  }\n\n  for (i = 0; i < n; ++i) {\n    node = nodes[i];\n    context.beginPath();\n    context.arc(node.x, node.y, node.radius - 0.75, 0, tau);\n    context.strokeStyle = stroke((vx = node.x - node.px) * vx + (vy = node.y - node.py) * vy);\n    context.stroke();\n  }\n\n  context.beginPath();\n  for (i = 0; i < n; ++i) {\n    node = nodes[i];\n    context.moveTo(node.x, node.y);\n    context.lineTo(node.x + (node.x - node.px) * 3, node.y + (node.y - node.py) * 3);\n  }\n  context.strokeStyle = \"#fff\";\n  context.stroke();\n\n  force.resume();\n});\n\nfunction collide(node) {\n  var r = node.radius + 16,\n      nx1 = node.x - r,\n      nx2 = node.x + r,\n      ny1 = node.y - r,\n      ny2 = node.y + r;\n  return function(quad, x1, y1, x2, y2) {\n    if (quad.point && (quad.point !== node)) {\n      var x = node.x - quad.point.x,\n          y = node.y - quad.point.y,\n          l = Math.sqrt(x * x + y * y),\n          r = node.radius + quad.point.radius;\n      if (l < r) {\n        l = (l - r) / (l * 2);\n        node.x -= x *= l;\n        node.y -= y *= l;\n        quad.point.x += x;\n        quad.point.y += y;\n      }\n    }\n    return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;\n  }\n}\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"72b41c6c892a528fcc5df1c181ba280f0a348a4e","preview":"96d93eba6feccf4d400d5742ac4319736ca89b97"},"sort":[1455930787000]},{"_index":"blockbuilder","_type":"blocks","_id":"79a82f4b9bffb69d89ae","_score":null,"_source":{"userId":"mbostock","description":"Bar Chart with Negative Values II","created_at":"2016-02-18T05:36:10Z","updated_at":"2016-02-18T05:36:13Z","api":["d3.scale.linear","d3.scale.ordinal","d3.svg.axis","d3.select","d3.tsv","d3.extent"],"colors":["#000000","#a52a2a","#4682b4","#0000ff"],"readme":"A variation of the [bar chart with negative values](/mbostock/2368837) example using a [custom axis](/mbostock/4323929) to flip the tick orientation for the negative bars.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.bar--positive {\n  fill: steelblue;\n}\n\n.bar--negative {\n  fill: brown;\n}\n\n.axis text {\n  font: 10px sans-serif;\n}\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar margin = {top: 20, right: 30, bottom: 40, left: 30},\n    width = 960 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar x = d3.scale.linear()\n    .range([0, width]);\n\nvar y = d3.scale.ordinal()\n    .rangeRoundBands([0, height], 0.1);\n\nvar xAxis = d3.svg.axis()\n    .scale(x)\n    .orient(\"bottom\");\n\nvar yAxis = d3.svg.axis()\n    .scale(y)\n    .orient(\"left\")\n    .tickSize(6, 0);\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nd3.tsv(\"data.tsv\", type, function(error, data) {\n  x.domain(d3.extent(data, function(d) { return d.value; })).nice();\n  y.domain(data.map(function(d) { return d.name; }));\n\n  svg.selectAll(\".bar\")\n      .data(data)\n    .enter().append(\"rect\")\n      .attr(\"class\", function(d) { return \"bar bar--\" + (d.value < 0 ? \"negative\" : \"positive\"); })\n      .attr(\"x\", function(d) { return x(Math.min(0, d.value)); })\n      .attr(\"y\", function(d) { return y(d.name); })\n      .attr(\"width\", function(d) { return Math.abs(x(d.value) - x(0)); })\n      .attr(\"height\", y.rangeBand());\n\n  svg.append(\"g\")\n      .attr(\"class\", \"x axis\")\n      .attr(\"transform\", \"translate(0,\" + height + \")\")\n      .call(xAxis);\n\n  var tickNegative = svg.append(\"g\")\n      .attr(\"class\", \"y axis\")\n      .attr(\"transform\", \"translate(\" + x(0) + \",0)\")\n      .call(yAxis)\n    .selectAll(\".tick\")\n    .filter(function(d, i) { return data[i].value < 0; });\n\n  tickNegative.select(\"line\")\n      .attr(\"x2\", 6);\n\n  tickNegative.select(\"text\")\n      .attr(\"x\", 9)\n      .style(\"text-anchor\", \"start\");\n});\n\nfunction type(d) {\n  d.value = +d.value;\n  return d;\n}\n\n</script>\n","filenames":[".block","README.md","data.tsv","index.html","preview.png","thumbnail.png"],"thumb":"798ffd53c130855f12add0d8f9c1a865d8c82687","preview":"ecc95e5f7d5cea6f93023db0ee1a80adba7782d8"},"sort":[1455773770000]},{"_index":"blockbuilder","_type":"blocks","_id":"a8a5baa4c4a470cda598","_score":null,"_source":{"userId":"mbostock","description":"General Update Pattern 4.0","created_at":"2016-02-12T22:03:31Z","updated_at":"2016-05-03T21:32:24Z","api":["d3.select","d3.transition","d3.interval","d3.shuffle"],"colors":["#333333","#a52a2a","#008000"],"readme":"This example shows improvements to the [transitions API](https://github.com/d3/d3-transition) when using the [General Update Pattern](/mbostock/3808234) in [D3 4.0](https://github.com/mbostock/d3/tree/4). In 4.0, transition timing parameters don’t need to be repeated for the enter, update, and exit selections. Instead, a top-level transition `t` sets the duration, and then subsequent transitions use [*selection*.transition](https://github.com/d3/d3-transition#selection_transition), passing in `t` to inherit timing:\n\n```js\nvar t = d3.transition()\n    .duration(750);\n```\n\nThis fixes a (tiny) bug in the 3.x pattern, where occasionally the transitions would be out of sync by a millisecond or two. However, even without explicitly sharing a transition, D3 4.0 synchronizes transitions via [d3.now](https://github.com/d3/d3-timer#now)!\n\nThis example also uses [d3.interval](https://github.com/d3/d3-timer#interval) to pause transitions when the page is backgrounded. Unlike [setInterval](https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setInterval), this also ensures that the interval and transitions are precisely synchronized.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ntext {\n  font: bold 48px monospace;\n}\n\n.enter {\n  fill: green;\n}\n\n.update {\n  fill: #333;\n}\n\n.exit {\n  fill: brown;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.28.min.js\"></script>\n<script>\n\nvar alphabet = \"abcdefghijklmnopqrstuvwxyz\".split(\"\");\n\nvar width = 960,\n    height = 500;\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(32,\" + (height / 2) + \")\");\n\nfunction update(data) {\n  var t = d3.transition()\n      .duration(750);\n\n  // JOIN new data with old elements.\n  var text = svg.selectAll(\"text\")\n    .data(data, function(d) { return d; });\n\n  // EXIT old elements not present in new data.\n  text.exit()\n      .attr(\"class\", \"exit\")\n    .transition(t)\n      .attr(\"y\", 60)\n      .style(\"fill-opacity\", 1e-6)\n      .remove();\n\n  // UPDATE old elements present in new data.\n  text.attr(\"class\", \"update\")\n      .attr(\"y\", 0)\n      .style(\"fill-opacity\", 1)\n    .transition(t)\n      .attr(\"x\", function(d, i) { return i * 32; });\n\n  // ENTER new elements present in new data.\n  text.enter().append(\"text\")\n      .attr(\"class\", \"enter\")\n      .attr(\"dy\", \".35em\")\n      .attr(\"y\", -60)\n      .attr(\"x\", function(d, i) { return i * 32; })\n      .style(\"fill-opacity\", 1e-6)\n      .text(function(d) { return d; })\n    .transition(t)\n      .attr(\"y\", 0)\n      .style(\"fill-opacity\", 1);\n}\n\n// The initial display.\nupdate(alphabet);\n\n// Grab a random sample of letters from the alphabet, in alphabetical order.\nd3.interval(function() {\n  update(d3.shuffle(alphabet)\n      .slice(0, Math.floor(Math.random() * 26))\n      .sort());\n}, 1500);\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"aacb9d7da62db2e0adf5cff756ae445fd223de45"},"sort":[1455314611000]},{"_index":"blockbuilder","_type":"blocks","_id":"70d5541b547cc222aa02","_score":null,"_source":{"userId":"mbostock","description":"Chained Transitions","created_at":"2016-02-12T01:56:36Z","updated_at":"2016-04-18T02:47:23Z","api":["d3.interpolateRgb","d3.select","d3.range","d3.active"],"colors":["#eeeeee","#ffa500","#4682b4","#0000ff","#ffffff"],"readme":"A test of chained transition using [d3-transition](https://github.com/d3/d3-transition)’s new [d3.active](https://github.com/d3/d3-transition#active).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  max-width: 960px;\n  margin: 1px;\n}\n\ndiv {\n  width: 10px;\n  height: 10px;\n  margin: 1px 0 0 1px;\n  float: left;\n  background: #eee;\n  display: inline-block;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.24.min.js\"></script>\n<script>\n\nvar n = 4002;\n\nvar whiteblue = d3.interpolateRgb(\"#eee\", \"steelblue\"),\n    blueorange = d3.interpolateRgb(\"steelblue\", \"orange\"),\n    orangewhite = d3.interpolateRgb(\"orange\", \"#eee\");\n\nd3.select(\"body\").selectAll(\"div\")\n    .data(d3.range(n))\n  .enter().append(\"div\")\n  .transition()\n    .delay(function(d, i) { return i + Math.random() * n / 4; })\n    .ease(d3.easeLinear)\n    .on(\"start\", function repeat() {\n        d3.active(this)\n            .styleTween(\"background-color\", function() { return whiteblue; })\n          .transition()\n            .delay(1000)\n            .styleTween(\"background-color\", function() { return blueorange; })\n          .transition()\n            .delay(1000)\n            .styleTween(\"background-color\", function() { return orangewhite; })\n          .transition()\n            .delay(n)\n            .on(\"start\", repeat);\n      });\n\n</script>\n","filenames":[".block","README.md","index.html","preview.png","thumbnail.png"],"thumb":"41d8c4437e6ca2d44e33a85aad2e5a46f940249f","preview":"20f2b61f105785f507fb215415b04cb77d2e6f08"},"sort":[1455242196000]},{"_index":"blockbuilder","_type":"blocks","_id":"2b116e0a95b4c981d50a","_score":null,"_source":{"userId":"mbostock","description":"Isometric III","created_at":"2016-02-10T22:15:44Z","updated_at":"2016-02-10T22:15:46Z","api":[],"colors":["#ffffff","#000000","#d2b48c"],"readme":"A variation of [Isometric II](/mbostock/6047b93d9d37bc1d8f89).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3-timer.v0.3.min.js\"></script>\n<script src=\"//d3js.org/d3-ease.v0.7.min.js\"></script>\n<script src=\"isometric.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nvar isocontext = isometric(context);\nisocontext.scale3d(30, 30, 30);\n\nd3_timer.timer(function(elapsed) {\n  context.save();\n  context.clearRect(0, 0, width, height);\n  context.fillStyle = \"#fff\";\n  context.strokeStyle = \"#000\";\n  context.translate(width / 2, height * 0.6);\n  for (var x = 14, d, t = (elapsed / 5000) % 1; x >= -14; --x) {\n    for (var y = 14; y >= -14; --y) {\n      if ((d = distanceManhattan(x, y)) > 15) continue;\n      var te = d3_ease.easeCubic(Math.max(0, Math.min(1, t * 4.8 - distanceCartesian(x, y) / 5)));\n      drawCube((d & 1 ? -1 : +1) * (Math.PI / 4 - te * Math.PI / 2), x * 1.42, y * 1.42 + te * (x & 1 ? 1 : -1) * 1.42, te * 1.42 * 2);\n    }\n  }\n  context.restore();\n});\n\nfunction distanceCartesian(x, y) {\n  return Math.sqrt(x * x + y * y);\n}\n\nfunction distanceManhattan(x, y) {\n  return Math.abs(x) + Math.abs(y);\n}\n\nfunction drawCube(angle, x, y, z) {\n  if ((angle %= Math.PI / 2) < 0) angle += Math.PI / 2;\n  isocontext.save();\n  isocontext.translate3d(x, y, z);\n  isocontext.rotateZ(angle - Math.PI / 4);\n\n  context.beginPath();\n  isocontext.moveTo(+0.5, -0.5, +0.5);\n  isocontext.lineTo(+0.5, +0.5, +0.5);\n  isocontext.lineTo(-0.5, +0.5, +0.5);\n  isocontext.lineTo(-0.5, +0.5, -0.5);\n  isocontext.lineTo(-0.5, -0.5, -0.5);\n  isocontext.lineTo(+0.5, -0.5, -0.5);\n  isocontext.closePath();\n  context.fill();\n  context.lineWidth = 1.5;\n  context.stroke();\n\n  context.beginPath();\n  isocontext.moveTo(-0.5, -0.5, +0.5);\n  isocontext.lineTo(+0.5, -0.5, +0.5);\n  isocontext.moveTo(-0.5, -0.5, +0.5);\n  isocontext.lineTo(-0.5, +0.5, +0.5);\n  isocontext.moveTo(-0.5, -0.5, +0.5);\n  isocontext.lineTo(-0.5, -0.5, -0.5);\n  context.lineWidth = 0.75;\n  context.stroke();\n\n  isocontext.restore();\n}\n\n</script>\n","filenames":[".block","README.md","index.html","isometric.js","preview.png","thumbnail.png"],"thumb":"f7e74d5ec9ee537bbaff17dbc8a93892db1d1ae7","preview":"500049a30f3e40cae4596adb2cc72ede13befaf0"},"sort":[1455142544000]},{"_index":"blockbuilder","_type":"blocks","_id":"6047b93d9d37bc1d8f89","_score":null,"_source":{"userId":"mbostock","description":"Isometric II","created_at":"2016-02-10T20:46:31Z","updated_at":"2016-04-28T14:48:54Z","api":[],"colors":["#ffffff","#d2b48c"],"readme":"A recreation of one of my favorite [Bees & Bombs](https://twitter.com/beesandbombs/status/572095940921827328).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3-timer.v0.3.min.js\"></script>\n<script src=\"//d3js.org/d3-ease.v0.7.min.js\"></script>\n<script src=\"isometric.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nvar isocontext = isometric(context);\nisocontext.scale3d(30, 30, 30);\n\nd3_timer.timer(function(elapsed) {\n  context.save();\n  context.clearRect(0, 0, width, height);\n  context.fillStyle = \"#fff\";\n  context.translate(width / 2, height * 0.6);\n  for (var x = 10, d, t = (elapsed / 3500) % 1; x >= -10; --x) {\n    for (var y = 10; y >= -10; --y) {\n      if ((d = distanceManhattan(x, y)) > 10) continue;\n      var te = d3_ease.easeCubic(Math.max(0, Math.min(1, t * 3.3 - distanceCartesian(x, y) / 4)));\n      drawCube((d & 1 ? -1 : +1) * (Math.PI / 4 - te * Math.PI / 2), x * 2, y * 2, 2 * te);\n    }\n  }\n  context.restore();\n});\n\nfunction distanceCartesian(x, y) {\n  return Math.sqrt(x * x + y * y);\n}\n\nfunction distanceManhattan(x, y) {\n  return Math.abs(x) + Math.abs(y);\n}\n\nfunction drawCube(angle, x, y, z) {\n  if ((angle %= Math.PI / 2) < 0) angle += Math.PI / 2;\n  isocontext.save();\n  isocontext.translate3d(x, y, z);\n  isocontext.rotateZ(angle - Math.PI / 4);\n\n  context.beginPath();\n  isocontext.moveTo(+0.5, -0.5, +0.5);\n  isocontext.lineTo(+0.5, +0.5, +0.5);\n  isocontext.lineTo(-0.5, +0.5, +0.5);\n  isocontext.lineTo(-0.5, +0.5, -0.5);\n  isocontext.lineTo(-0.5, -0.5, -0.5);\n  isocontext.lineTo(+0.5, -0.5, -0.5);\n  isocontext.closePath();\n  context.fill();\n  context.lineWidth = 1.5;\n  context.stroke();\n\n  context.beginPath();\n  isocontext.moveTo(-0.5, -0.5, +0.5);\n  isocontext.lineTo(+0.5, -0.5, +0.5);\n  isocontext.moveTo(-0.5, -0.5, +0.5);\n  isocontext.lineTo(-0.5, +0.5, +0.5);\n  isocontext.moveTo(-0.5, -0.5, +0.5);\n  isocontext.lineTo(-0.5, -0.5, -0.5);\n  context.lineWidth = 0.75;\n  context.stroke();\n\n  isocontext.restore();\n}\n\n</script>\n","filenames":[".block","README.md","index.html","isometric.js","preview.png","thumbnail.png"],"thumb":"204a4fd947f8d258a01a2518f4b58224afe19ab6","preview":"ca463135dbf9aacfc37a353c69d336952b1f9e95"},"sort":[1455137191000]},{"_index":"blockbuilder","_type":"blocks","_id":"c5c0c7de6a357a6780a3","_score":null,"_source":{"userId":"mbostock","description":"Isometric","created_at":"2016-02-10T06:08:31Z","updated_at":"2016-02-11T13:37:49Z","api":[],"colors":["#eeeeee","#ffffff"],"readme":"A failed attempt to be like [Bees & Bombs](http://beesandbombs.tumblr.com/).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ncanvas {\n  background: #eee;\n}\n\n</style>\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3-timer.v0.2.min.js\"></script>\n<script src=\"isometric.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\"),\n    width = canvas.width,\n    height = canvas.height;\n\nvar isocontext = isometric(context);\nisocontext.scale3d(30, 30, 30);\ncontext.lineWidth = 1.5;\ncontext.lineJoin = \"round\";\n\nd3_timer.timer(function(elapsed) {\n  context.save();\n  context.clearRect(0, 0, width, height);\n  context.fillStyle = \"#fff\";\n  context.translate(width / 2, height / 2);\n\n  for (var x = -8; x <= 8; ++x) {\n    for (var y = -8; y <= 8; ++y) {\n      context.beginPath();\n      drawCube(Math.sin(elapsed / 2000) * Math.PI + (x * y / 20), x * 2, y * 2, 0);\n      context.fill();\n      context.stroke();\n    }\n  }\n\n  context.restore();\n});\n\nfunction drawCube(angle, x, y, z) {\n  if ((angle %= Math.PI / 2) < 0) angle += Math.PI / 2;\n  isocontext.save();\n  isocontext.translate3d(x, y, z);\n  isocontext.rotateZ(angle - Math.PI / 4);\n  isocontext.moveTo(-0.5, -0.5, +0.5);\n  isocontext.lineTo(+0.5, -0.5, +0.5);\n  isocontext.lineTo(+0.5, +0.5, +0.5);\n  isocontext.lineTo(-0.5, +0.5, +0.5);\n  isocontext.closePath();\n  isocontext.moveTo(-0.5, -0.5, -0.5);\n  isocontext.lineTo(-0.5, -0.5, +0.5);\n  isocontext.lineTo(-0.5, +0.5, +0.5);\n  isocontext.lineTo(-0.5, +0.5, -0.5);\n  isocontext.closePath();\n  isocontext.moveTo(-0.5, -0.5, -0.5);\n  isocontext.lineTo(+0.5, -0.5, -0.5);\n  isocontext.lineTo(+0.5, -0.5, +0.5);\n  isocontext.lineTo(-0.5, -0.5, +0.5);\n  isocontext.closePath();\n  isocontext.restore();\n}\n\n</script>\n","filenames":[".block","README.md","index.html","isometric.js","preview.png","thumbnail.png"],"thumb":"982c27293193d88e9a90c6d628fb4b900c73249b","preview":"449f833915de3c6a7b5dfec9b3720fea8e20337f"},"sort":[1455084511000]},{"_index":"blockbuilder","_type":"blocks","_id":"4c5fad723c87d2fd8273","_score":null,"_source":{"userId":"mbostock","description":"Sized Donut Multiples","created_at":"2016-01-21T00:21:23Z","updated_at":"2016-02-13T16:49:19Z","api":["d3.format","d3.scaleSqrt","d3.scaleOrdinal","d3.arc","d3.pie","d3.csv","d3.sum","d3.max","d3.select"],"colors":["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"],"readme":"This example demonstrates how to use [*selection*.each](https://github.com/d3/d3-selection#selection_each) to create a context to access parent and child data simultaneously. The [donut multiples](/mbostock/3888852) are sized such that the area of each donut is proportionate to the total population, such that the area of the arcs is comparable across states.\n\nThis is a technical demonstration rather than a design recommendation; you probably don’t want to use this visual form. A [normalized stacked bar chart](/mbostock/3886394) is better at comparing the age distribution across states, and a [stacked](/mbostock/3886208) or [grouped](/mbostock/3887051) bar chart is better at comparing absolute values.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  font: 10px sans-serif;\n}\n\nsvg {\n  padding: 10px 0 0 10px;\n}\n\n.legend {\n  vertical-align: top;\n}\n\n.label {\n  text-anchor: middle;\n}\n\n.label-name {\n  font-weight: bold;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.15.min.js\"></script>\n<script>\n\nvar formatSum = d3.format(\".1s\");\n\nvar padding = 10;\n\nvar radius = d3.scaleSqrt()\n    .range([0, 220]);\n\nvar color = d3.scaleOrdinal()\n    .range([\"#98abc5\", \"#8a89a6\", \"#7b6888\", \"#6b486b\", \"#a05d56\", \"#d0743c\", \"#ff8c00\"]);\n\nvar arc = d3.arc()\n    .padRadius(50);\n\nvar pie = d3.pie()\n    .sort(null)\n    .padAngle(0.02)\n    .value(function(d) { return d.population; });\n\nd3.csv(\"data.csv\", function(d, i, columns) {\n  return {\n    state: d.State,\n    sum: d3.sum(columns.slice(1), function(key) { return +d[key]; }),\n    ages: columns.slice(1).map(function(key) {\n      return {\n        age: key,\n        population: +d[key]\n      };\n    })\n  };\n}, function(error, data) {\n  if (error) throw error;\n\n  radius.domain([0, d3.max(data, function(d) { return d.sum; })]);\n\n  color.domain(data.columns.slice(1));\n\n  var legend = d3.select(\"body\").append(\"svg\")\n      .attr(\"class\", \"legend\")\n      .attr(\"width\", 120)\n      .attr(\"height\", (data.columns.length - 1) * 20)\n    .selectAll(\"g\")\n      .data(data.columns.slice(1).reverse())\n    .enter().append(\"g\")\n      .attr(\"transform\", function(d, i) { return \"translate(0,\" + i * 20 + \")\"; });\n\n  legend.append(\"rect\")\n      .attr(\"width\", 18)\n      .attr(\"height\", 18)\n      .style(\"fill\", color);\n\n  legend.append(\"text\")\n      .attr(\"x\", 24)\n      .attr(\"y\", 9)\n      .attr(\"dy\", \".35em\")\n      .text(function(d) { return d; });\n\n  var svg = d3.select(\"body\").selectAll(\".pie\")\n      .data(data.sort(function(a, b) { return b.sum - a.sum; }))\n    .enter().append(\"svg\")\n      .attr(\"class\", \"pie\")\n      .each(multiple)\n    .select(\"g\");\n\n  var label = svg.append(\"text\")\n      .attr(\"class\", \"label\");\n\n  label.append(\"tspan\")\n      .attr(\"class\", \"label-name\")\n      .attr(\"x\", 0)\n      .attr(\"dy\", \"-.2em\")\n      .text(function(d) { return d.state; });\n\n  label.append(\"tspan\")\n      .attr(\"class\", \"label-value\")\n      .attr(\"x\", 0)\n      .attr(\"dy\", \"1.1em\")\n      .text(function(d) { return formatSum(d.sum); });\n\n  function multiple(d) {\n    var r = radius(d.sum);\n\n    var svg = d3.select(this)\n        .attr(\"width\", r * 2)\n        .attr(\"height\", r * 2)\n      .append(\"g\")\n        .attr(\"transform\", \"translate(\" + r + \",\" + r + \")\");\n\n    svg.selectAll(\".arc\")\n        .data(function(d) { return pie(d.ages); })\n      .enter().append(\"path\")\n        .attr(\"class\", \"arc\")\n        .attr(\"d\", arc.outerRadius(r).innerRadius(r * 0.6))\n        .style(\"fill\", function(d) { return color(d.data.age); });\n  }\n});\n\n</script>\n","filenames":[".block","README.md","data.csv","index.html","thumbnail.png"],"thumb":"622eaa4daf990adde1fee6343da41dcf3d821a69"},"sort":[1453335683000]},{"_index":"blockbuilder","_type":"blocks","_id":"c957dc9c1f8a0bae58d5","_score":null,"_source":{"userId":"mbostock","description":"Waterfall","created_at":"2016-01-20T20:07:53Z","updated_at":"2016-02-09T01:47:31Z","api":["d3.format","d3.select","d3.requestTsv","d3.scaleLinear","d3.extent","d3.scaleBand","d3.axisBottom","d3.axisLeft"],"colors":["#000000","#333333","#ff0000","#a52a2a","#ffffff"],"readme":"A waterfall chart.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nsvg {\n  font: 10px sans-serif;\n}\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n.rect {\n  fill: #333;\n}\n\n.rect--negative {\n  fill: brown;\n}\n\n.label {\n  fill: white;\n  font-size: 12px;\n  text-anchor: end;\n}\n\n.label-change {\n  font-weight: bold;\n}\n\n.label-value {\n  fill-opacity: 0.8;\n}\n\n.label--negative {\n  text-anchor: start;\n}\n\n</style>\n<svg width=\"960\" height=\"500\"></svg>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.9.min.js\"></script>\n<script>\n\nvar formatChange = d3.format(\"+d\"),\n    formatValue = d3.format(\"d\");\n\nvar svg = d3.select(\"svg\");\n\nvar margin = {top: 20, right: 40, bottom: 40, left: 80},\n    width = +svg.attr(\"width\") - margin.left - margin.right,\n    height = +svg.attr(\"height\") - margin.top - margin.bottom;\n\nvar g = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nd3.requestTsv(\"data.tsv\", function(d) {\n  d.value = +d.value;\n  return d;\n}, function(error, data) {\n  if (error) throw error;\n\n  // Compute a simple “stack” by iterating over the data.\n  data.reduce(function(v, d) { return d.value1 = (d.value0 = v) + d.value; }, 0);\n\n  var x = d3.scaleLinear()\n      .domain(d3.extent(data, function(d) { return d.value1; })).nice()\n      .range([0, width]);\n\n  var y = d3.scaleBand()\n      .domain(data.map(function(d) { return d.region; }))\n      .rangeRound([0, height])\n      .padding(0.1);\n\n  g.append(\"g\")\n      .attr(\"transform\", \"translate(0,\" + height + \")\")\n      .attr(\"class\", \"axis axis--x\")\n      .call(d3.axisBottom(x));\n\n  g.append(\"g\").selectAll(\"rect\")\n      .data(data)\n    .enter().append(\"rect\")\n      .attr(\"class\", function(d) { return \"rect rect--\" + (d.value0 < d.value1 ? \"positive\" : \"negative\"); })\n      .attr(\"y\", function(d) { return y(d.region); })\n      .attr(\"x\", function(d) { return x(d.value0 < d.value1 ? d.value0 : d.value1); })\n      .attr(\"width\", function(d) { return d.value0 < d.value1 ? x(d.value1) - x(d.value0) : x(d.value0) - x(d.value1); })\n      .attr(\"height\", y.bandwidth());\n\n  var label = g.append(\"g\").selectAll(\"text\")\n      .data(data)\n    .enter().append(\"text\")\n      .attr(\"class\", function(d) { return \"label label--\" + (d.value0 < d.value1 ? \"positive\" : \"negative\"); })\n      .attr(\"y\", function(d) { return y(d.region) + y.bandwidth() / 2; });\n\n  label.append(\"tspan\")\n      .attr(\"class\", \"label-change\")\n      .attr(\"dy\", \"-.2em\")\n      .text(function(d) { return formatChange(d.value1 - d.value0); });\n\n  label.append(\"tspan\")\n      .attr(\"class\", \"label-value\")\n      .attr(\"dy\", \"1.1em\")\n      .text(function(d) { return formatValue(d.value1); });\n\n  label.selectAll(\"tspan\")\n      .attr(\"x\", function(d) { return x(d.value1) + (d.value0 < d.value1 ? -6 : 6); });\n\n  g.append(\"g\")\n      .attr(\"class\", \"axis axis--y\")\n      .attr(\"transform\", \"translate(\" + x(0) + \",0)\")\n      .call(d3.axisLeft(y).tickSize(0).tickPadding(x(0) + 6));\n});\n\n</script>\n","filenames":[".block","README.md","data.tsv","index.html","thumbnail.png"],"thumb":"464a0919fb3023f405b307caee36da9a649dd8a4"},"sort":[1453320473000]},{"_index":"blockbuilder","_type":"blocks","_id":"4b66c0d9be9a0d56484e","_score":null,"_source":{"userId":"mbostock","description":"Inline Labels","created_at":"2016-01-12T17:44:15Z","updated_at":"2016-03-10T20:15:13Z","api":["d3.timeParse","d3.select","d3.requestTsv","d3.scaleTime","d3.scaleLinear","d3.max","d3.scaleCategory10","d3.axisBottom","d3.line"],"colors":["#000000","#ffffff"],"readme":"This example shows how to implement Ann K. Emery’s technique of placings labels [directly on top of a line](http://annkemery.com/line-graph-labeling-how-to/) in [D3](https://d3js.org) [4.0 Alpha](https://github.com/mbostock/d3/tree/4).\n\nTo construct the [multi-series line chart](/mbostock/3884955), the data is first transformed into separate arrays for each series. (The series names are automatically derived from the columns in the TSV file, thanks to a new [*dsv*.parse](https://github.com/d3/d3-dsv#dsv_parse) feature.)\n\n```js\nvar series = data.columns.slice(1).map(function(key) {\n  return data.map(function(d) {\n    return {\n      key: key,\n      date: d.date,\n      value: d[key]\n    };\n  });\n});\n```\n\nA label is rendered for each point in each series. Beneath this label, a white rectangle is added, whose size and position is computed automatically using [*element*.getBBox](https://www.w3.org/TR/SVG/types.html#__svg__SVGLocatable__getBBox) plus a little bit of padding. The resulting label is thus legible. The last label for each series gets an additional tspan to show the series name.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ntext {\n  font: 10px sans-serif;\n}\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n.line {\n  fill: none;\n  stroke-width: 1.5px;\n}\n\n.label {\n  text-anchor: middle;\n}\n\n.label rect {\n  fill: white;\n}\n\n.label-key {\n  font-weight: bold;\n}\n\n</style>\n<svg width=\"960\" height=\"500\"></svg>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.9.min.js\"></script>\n<script>\n\nvar parseTime = d3.timeParse(\"%Y\");\n\nvar svg = d3.select(\"svg\");\n\nvar margin = {top: 30, right: 50, bottom: 30, left: 30},\n    width = +svg.attr(\"width\") - margin.left - margin.right,\n    height = +svg.attr(\"height\") - margin.top - margin.bottom,\n    labelPadding = 3;\n\nvar g = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nd3.requestTsv(\"data.tsv\", function(d) {\n  d.date = parseTime(d.date);\n  for (var k in d) if (k !== \"date\") d[k] = +d[k];\n  return d;\n}, function(error, data) {\n  if (error) throw error;\n\n  var series = data.columns.slice(1).map(function(key) {\n    return data.map(function(d) {\n      return {\n        key: key,\n        date: d.date,\n        value: d[key]\n      };\n    });\n  });\n\n  var x = d3.scaleTime()\n      .domain([data[0].date, data[data.length - 1].date])\n      .range([0, width]);\n\n  var y = d3.scaleLinear()\n      .domain([0, d3.max(series, function(s) { return d3.max(s, function(d) { return d.value; }); })])\n      .range([height, 0]);\n\n  var z = d3.scaleCategory10();\n\n  g.append(\"g\")\n      .attr(\"class\", \"axis axis--x\")\n      .attr(\"transform\", \"translate(0,\" + height + \")\")\n      .call(d3.axisBottom(x));\n\n  var serie = g.selectAll(\".serie\")\n      .data(series)\n    .enter().append(\"g\")\n      .attr(\"class\", \"serie\");\n\n  serie.append(\"path\")\n      .attr(\"class\", \"line\")\n      .style(\"stroke\", function(d) { return z(d[0].key); })\n      .attr(\"d\", d3.line()\n          .x(function(d) { return x(d.date); })\n          .y(function(d) { return y(d.value); }));\n\n  var label = serie.selectAll(\".label\")\n      .data(function(d) { return d; })\n    .enter().append(\"g\")\n      .attr(\"class\", \"label\")\n      .attr(\"transform\", function(d, i) { return \"translate(\" + x(d.date) + \",\" + y(d.value) + \")\"; });\n\n  label.append(\"text\")\n      .attr(\"dy\", \".35em\")\n      .text(function(d) { return d.value; })\n    .filter(function(d, i) { return i === data.length - 1; })\n    .append(\"tspan\")\n      .attr(\"class\", \"label-key\")\n      .text(function(d) { return \" \" + d.key; });\n\n  label.append(\"rect\", \"text\")\n      .datum(function() { return this.nextSibling.getBBox(); })\n      .attr(\"x\", function(d) { return d.x - labelPadding; })\n      .attr(\"y\", function(d) { return d.y - labelPadding; })\n      .attr(\"width\", function(d) { return d.width + 2 * labelPadding; })\n      .attr(\"height\", function(d) { return d.height + 2 * labelPadding; });\n});\n\n</script>\n","filenames":[".block","README.md","data.tsv","index.html","thumbnail.png"],"thumb":"08e2daf7f830b40ba24a9d92078788537faced3f"},"sort":[1452620655000]},{"_index":"blockbuilder","_type":"blocks","_id":"02d893e3486c70c4475f","_score":null,"_source":{"userId":"mbostock","description":"Line Chart 4.0","created_at":"2016-01-09T00:05:22Z","updated_at":"2016-05-04T15:40:17Z","api":["d3.timeParse","d3.scaleTime","d3.scaleLinear","d3.line","d3.select","d3.tsv","d3.extent","d3.axisBottom","d3.axisLeft"],"colors":["#000000","#4682b4","#0000ff"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.axis {\n  font: 10px sans-serif;\n}\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n.axis--x path {\n  display: none;\n}\n\n.line {\n  fill: none;\n  stroke: steelblue;\n  stroke-width: 1.5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.15.min.js\"></script>\n<script>\n\nvar margin = {top: 20, right: 20, bottom: 30, left: 50},\n    width = 960 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar parseTime = d3.timeParse(\"%d-%b-%y\");\n\nvar x = d3.scaleTime()\n    .range([0, width]);\n\nvar y = d3.scaleLinear()\n    .range([height, 0]);\n\nvar line = d3.line()\n    .x(function(d) { return x(d.date); })\n    .y(function(d) { return y(d.close); });\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nd3.tsv(\"data.tsv\", type, function(error, data) {\n  if (error) throw error;\n\n  x.domain(d3.extent(data, function(d) { return d.date; }));\n  y.domain(d3.extent(data, function(d) { return d.close; }));\n\n  svg.append(\"g\")\n      .attr(\"class\", \"axis axis--x\")\n      .attr(\"transform\", \"translate(0,\" + height + \")\")\n      .call(d3.axisBottom(x));\n\n  svg.append(\"g\")\n      .attr(\"class\", \"axis axis--y\")\n      .call(d3.axisLeft(y))\n    .append(\"text\")\n      .attr(\"class\", \"axis-title\")\n      .attr(\"transform\", \"rotate(-90)\")\n      .attr(\"y\", 6)\n      .attr(\"dy\", \".71em\")\n      .style(\"text-anchor\", \"end\")\n      .text(\"Price ($)\");\n\n  svg.append(\"path\")\n      .datum(data)\n      .attr(\"class\", \"line\")\n      .attr(\"d\", line);\n});\n\nfunction type(d) {\n  d.date = parseTime(d.date);\n  d.close = +d.close;\n  return d;\n}\n\n</script>\n","filenames":[".block","data.tsv","index.html","thumbnail.png"],"thumb":"7e04d9f6eef82742911a555868b808d3907a33ac"},"sort":[1452297922000]},{"_index":"blockbuilder","_type":"blocks","_id":"ad2d520dd26dcc5af13b","_score":null,"_source":{"userId":"mbostock","description":"Bottomley","created_at":"2016-01-06T17:02:20Z","updated_at":"2016-02-25T01:51:36Z","api":["d3.geo.bottomley","d3.geo.path","d3.geo.graticule","d3.select","d3.json"],"colors":["#fcfcfa","#000000","#ffffff","#777777","#222222"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  background: #fcfcfa;\n}\n\n.stroke {\n  fill: none;\n  stroke: #000;\n  stroke-width: 3px;\n}\n\n.fill {\n  fill: #fff;\n}\n\n.graticule {\n  fill: none;\n  stroke: #777;\n  stroke-width: .5px;\n  stroke-opacity: .5;\n}\n\n.land {\n  fill: #222;\n}\n\n.boundary {\n  fill: none;\n  stroke: #fff;\n  stroke-width: .5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script src=\"//d3js.org/d3.geo.projection.v0.min.js\"></script>\n<script src=\"//d3js.org/topojson.v1.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 600;\n\nvar projection = d3.geo.bottomley()\n    .scale(170)\n    .translate([width / 2, height / 2])\n    .precision(0.2);\n\nvar path = d3.geo.path()\n    .projection(projection);\n\nvar graticule = d3.geo.graticule();\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height);\n\nsvg.append(\"defs\").append(\"path\")\n    .datum({type: \"Sphere\"})\n    .attr(\"id\", \"sphere\")\n    .attr(\"d\", path);\n\nsvg.append(\"use\")\n    .attr(\"class\", \"stroke\")\n    .attr(\"xlink:href\", \"#sphere\");\n\nsvg.append(\"use\")\n    .attr(\"class\", \"fill\")\n    .attr(\"xlink:href\", \"#sphere\");\n\nsvg.append(\"path\")\n    .datum(graticule)\n    .attr(\"class\", \"graticule\")\n    .attr(\"d\", path);\n\nd3.json(\"/mbostock/raw/4090846/world-50m.json\", function(error, world) {\n  if (error) throw error;\n\n  svg.insert(\"path\", \".graticule\")\n      .datum(topojson.feature(world, world.objects.land))\n      .attr(\"class\", \"land\")\n      .attr(\"d\", path);\n\n  svg.insert(\"path\", \".graticule\")\n      .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))\n      .attr(\"class\", \"boundary\")\n      .attr(\"d\", path);\n});\n\n</script>\n","filenames":[".block","index.html","thumbnail.png"],"thumb":"bef4013ee39b35cbf45cf0721bc764371aa61780"},"sort":[1452099740000]},{"_index":"blockbuilder","_type":"blocks","_id":"1550e57e12e73b86ad9e","_score":null,"_source":{"userId":"mbostock","description":"Canvas Line","created_at":"2015-12-30T17:47:50Z","updated_at":"2016-02-09T01:47:42Z","api":["d3.timeParse","d3.scaleTime","d3.scaleLinear","d3.line","d3.requestTsv","d3.extent"],"colors":["#4682b4","#0000ff","#000000"],"readme":"A [line chart](http://bl.ocks.org/mbostock/3883245) rendered to Canvas using [d3-shape](https://github.com/d3/d3-shape). Rendering the axes is a bit tedious, but that’s we need a d3-axis module.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar margin = {top: 20, right: 20, bottom: 30, left: 50},\n    width = canvas.width - margin.left - margin.right,\n    height = canvas.height - margin.top - margin.bottom;\n\nvar parseTime = d3.timeParse(\"%d-%b-%y\");\n\nvar x = d3.scaleTime()\n    .range([0, width]);\n\nvar y = d3.scaleLinear()\n    .range([height, 0]);\n\nvar line = d3.line()\n    .x(function(d) { return x(d.date); })\n    .y(function(d) { return y(d.close); })\n    .curve(d3.curveStep)\n    .context(context);\n\ncontext.translate(margin.left, margin.top);\n\nd3.requestTsv(\"data.tsv\", function(d) {\n  d.date = parseTime(d.date);\n  d.close = +d.close;\n  return d;\n}, function(error, data) {\n  if (error) throw error;\n\n  x.domain(d3.extent(data, function(d) { return d.date; }));\n  y.domain(d3.extent(data, function(d) { return d.close; }));\n\n  xAxis();\n  yAxis();\n\n  context.beginPath();\n  line(data);\n  context.lineWidth = 1.5;\n  context.strokeStyle = \"steelblue\";\n  context.stroke();\n});\n\nfunction xAxis() {\n  var tickCount = 10,\n      tickSize = 6,\n      ticks = x.ticks(tickCount),\n      tickFormat = x.tickFormat();\n\n  context.beginPath();\n  ticks.forEach(function(d) {\n    context.moveTo(x(d), height);\n    context.lineTo(x(d), height + tickSize);\n  });\n  context.strokeStyle = \"black\";\n  context.stroke();\n\n  context.textAlign = \"center\";\n  context.textBaseline = \"top\";\n  ticks.forEach(function(d) {\n    context.fillText(tickFormat(d), x(d), height + tickSize);\n  });\n}\n\nfunction yAxis() {\n  var tickCount = 10,\n      tickSize = 6,\n      tickPadding = 3,\n      ticks = y.ticks(tickCount),\n      tickFormat = y.tickFormat(tickCount);\n\n  context.beginPath();\n  ticks.forEach(function(d) {\n    context.moveTo(0, y(d));\n    context.lineTo(-6, y(d));\n  });\n  context.strokeStyle = \"black\";\n  context.stroke();\n\n  context.beginPath();\n  context.moveTo(-tickSize, 0);\n  context.lineTo(0.5, 0);\n  context.lineTo(0.5, height);\n  context.lineTo(-tickSize, height);\n  context.strokeStyle = \"black\";\n  context.stroke();\n\n  context.textAlign = \"right\";\n  context.textBaseline = \"middle\";\n  ticks.forEach(function(d) {\n    context.fillText(tickFormat(d), -tickSize - tickPadding, y(d));\n  });\n\n  context.save();\n  context.rotate(-Math.PI / 2);\n  context.textAlign = \"right\";\n  context.textBaseline = \"top\";\n  context.font = \"bold 10px sans-serif\";\n  context.fillText(\"Price (US$)\", -10, 10);\n  context.restore();\n}\n\n</script>\n","filenames":[".block","README.md","data.tsv","index.html","thumbnail.png"],"thumb":"f1157c59da1c4b8bae212955a1440f16f80b501e"},"sort":[1451497670000]},{"_index":"blockbuilder","_type":"blocks","_id":"f41f50e06a6c04828b6e","_score":null,"_source":{"userId":"mbostock","description":"Arc Corners II","created_at":"2015-12-29T23:48:44Z","updated_at":"2016-02-09T01:47:45Z","api":["d3.arc","d3.pie"],"colors":["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#ffffff","#000000","#d2b48c"],"readme":"A demonstration of [*arc*.cornerRadius](https://github.com/d3/d3-shape#arc_cornerRadius).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar data = [1, 1, 2, 3, 5, 8, 13];\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height,\n    radius = Math.min(width, height) / 2;\n\nvar colors = [\n  \"#1f77b4\", \"#ff7f0e\", \"#2ca02c\", \"#d62728\", \"#9467bd\",\n  \"#8c564b\", \"#e377c2\", \"#7f7f7f\", \"#bcbd22\", \"#17becf\"\n];\n\nvar outerRadius = radius - 10,\n    innerRadius = radius - 70,\n    cornerRadius = 12;\n\nvar arc = d3.arc()\n    .outerRadius(outerRadius)\n    .innerRadius(innerRadius)\n    .cornerRadius(cornerRadius)\n    .context(context);\n\nvar circle = d3.arc()\n    .startAngle(0)\n    .endAngle(2 * Math.PI)\n    .innerRadius(0)\n    .context(context);\n\nvar pie = d3.pie();\n\nvar arcs = pie(data);\n\ncontext.translate(width / 2, height / 2);\n\ncontext.globalAlpha = 0.5;\narcs.forEach(function(d, i) {\n  context.beginPath();\n  arc(d);\n  context.fillStyle = colors[i];\n  context.fill();\n});\n\ncontext.globalAlpha = 1;\ncontext.beginPath();\narcs.forEach(arc);\ncontext.lineWidth = 1.5;\ncontext.strokeStyle = \"#fff\";\ncontext.stroke();\n\ncontext.beginPath();\narcs.forEach(function(d) {\n  corner(d.startAngle, outerRadius - cornerRadius, +1);\n  corner(  d.endAngle, outerRadius - cornerRadius, -1);\n  corner(  d.endAngle, innerRadius + cornerRadius, -1);\n  corner(d.startAngle, innerRadius + cornerRadius, +1);\n});\ncontext.strokeStyle = \"#000\";\ncontext.stroke();\n\nfunction corner(angle, radius, sign) {\n  context.save();\n  context.translate(\n    sign * cornerRadius * Math.cos(angle) + Math.sqrt(radius * radius - cornerRadius * cornerRadius) * Math.sin(angle),\n    sign * cornerRadius * Math.sin(angle) - Math.sqrt(radius * radius - cornerRadius * cornerRadius) * Math.cos(angle)\n  );\n  circle.outerRadius(cornerRadius - 1.5)();\n  context.restore();\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"c5044bd3916ee2cfdb9b715432873d9b4f351e1b"},"sort":[1451432924000]},{"_index":"blockbuilder","_type":"blocks","_id":"e5e3680f3079cf5c3437","_score":null,"_source":{"userId":"mbostock","description":"Arc Corners","created_at":"2015-12-29T23:45:31Z","updated_at":"2016-02-09T01:47:48Z","api":["d3.arc","d3.pie"],"colors":["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#ffffff","#000000","#d2b48c"],"readme":"A demonstration of [*arc*.cornerRadius](https://github.com/d3/d3-shape#arc_cornerRadius).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar data = [1, 1, 2, 3, 5, 8, 13];\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height,\n    radius = Math.min(width, height) / 2;\n\nvar colors = [\n  \"#1f77b4\", \"#ff7f0e\", \"#2ca02c\", \"#d62728\", \"#9467bd\",\n  \"#8c564b\", \"#e377c2\", \"#7f7f7f\", \"#bcbd22\", \"#17becf\"\n];\n\nvar outerRadius = radius - 10,\n    cornerRadius = 12;\n\nvar arc = d3.arc()\n    .outerRadius(outerRadius)\n    .innerRadius(0)\n    .cornerRadius(cornerRadius)\n    .context(context);\n\nvar circle = d3.arc()\n    .startAngle(0)\n    .endAngle(2 * Math.PI)\n    .innerRadius(0)\n    .context(context);\n\nvar pie = d3.pie();\n\nvar arcs = pie(data);\n\ncontext.translate(width / 2, height / 2);\n\ncontext.globalAlpha = 0.5;\narcs.forEach(function(d, i) {\n  context.beginPath();\n  arc(d);\n  context.fillStyle = colors[i];\n  context.fill();\n});\n\ncontext.globalAlpha = 1;\ncontext.beginPath();\narcs.forEach(arc);\ncontext.lineWidth = 1.5;\ncontext.strokeStyle = \"#fff\";\ncontext.stroke();\n\ncontext.beginPath();\narcs.forEach(function(d) {\n  corner(d.startAngle, outerRadius - cornerRadius, +1);\n  corner(  d.endAngle, outerRadius - cornerRadius, -1);\n});\ncontext.strokeStyle = \"#000\";\ncontext.stroke();\n\nfunction corner(angle, radius, sign) {\n  context.save();\n  context.translate(\n    sign * cornerRadius * Math.cos(angle) + Math.sqrt(radius * radius - cornerRadius * cornerRadius) * Math.sin(angle),\n    sign * cornerRadius * Math.sin(angle) - Math.sqrt(radius * radius - cornerRadius * cornerRadius) * Math.cos(angle)\n  );\n  circle.outerRadius(cornerRadius - 1.5)();\n  context.restore();\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"06c0074662b53aab6f0313fd36b20a32f03c5aa8"},"sort":[1451432731000]},{"_index":"blockbuilder","_type":"blocks","_id":"99f0a6533f7c949cf8b8","_score":null,"_source":{"userId":"mbostock","description":"Arc Padding III","created_at":"2015-12-29T23:32:17Z","updated_at":"2016-02-09T01:47:51Z","api":["d3.arc","d3.pie"],"colors":["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],"readme":"A demonstration of [*arc*.padAngle](https://github.com/d3/d3-shape#arc_padAngle).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar data = [1, 1, 2, 3, 5, 8, 13];\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height,\n    radius = Math.min(width, height) / 2;\n\nvar colors = [\n  \"#1f77b4\", \"#ff7f0e\", \"#2ca02c\", \"#d62728\", \"#9467bd\",\n  \"#8c564b\", \"#e377c2\", \"#7f7f7f\", \"#bcbd22\", \"#17becf\"\n];\n\nvar arc = d3.arc()\n    .outerRadius(radius - 10)\n    .innerRadius(radius - 70)\n    .padAngle(0.03)\n    .context(context);\n\nvar pie = d3.pie();\n\nvar arcs = pie(data);\n\ncontext.translate(width / 2, height / 2);\n\ncontext.globalAlpha = 0.5;\narcs.forEach(function(d, i) {\n  context.beginPath();\n  arc(d);\n  context.fillStyle = colors[i];\n  context.fill();\n});\n\ncontext.globalAlpha = 1;\ncontext.beginPath();\narcs.forEach(arc);\ncontext.lineWidth = 1.5;\ncontext.stroke();\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"142f7de316ef2fbd4060ba247077cf1e241d656f"},"sort":[1451431937000]},{"_index":"blockbuilder","_type":"blocks","_id":"f37b07b92633781a46f7","_score":null,"_source":{"userId":"mbostock","description":"Arc Padding II","created_at":"2015-12-29T23:30:50Z","updated_at":"2016-02-09T01:47:55Z","api":["d3.arc","d3.pie"],"colors":["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],"readme":"A demonstration of [*arc*.padAngle](https://github.com/d3/d3-shape#arc_padAngle).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar data = [1, 1, 2, 3, 5, 8, 13];\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height,\n    radius = Math.min(width, height) / 2;\n\nvar colors = [\n  \"#1f77b4\", \"#ff7f0e\", \"#2ca02c\", \"#d62728\", \"#9467bd\",\n  \"#8c564b\", \"#e377c2\", \"#7f7f7f\", \"#bcbd22\", \"#17becf\"\n];\n\nvar arc = d3.arc()\n    .outerRadius(radius - 10)\n    .innerRadius(0)\n    .padAngle(0.03)\n    .context(context);\n\nvar pie = d3.pie();\n\nvar arcs = pie(data);\n\ncontext.translate(width / 2, height / 2);\n\ncontext.globalAlpha = 0.5;\narcs.forEach(function(d, i) {\n  context.beginPath();\n  arc(d);\n  context.fillStyle = colors[i];\n  context.fill();\n});\n\ncontext.globalAlpha = 1;\ncontext.beginPath();\narcs.forEach(arc);\ncontext.lineWidth = 1.5;\ncontext.stroke();\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"0283b892a70bc559b4543dd6f31659b64a8a8d61"},"sort":[1451431850000]},{"_index":"blockbuilder","_type":"blocks","_id":"c274877f647361f3df7d","_score":null,"_source":{"userId":"mbostock","description":"Donut Centroid","created_at":"2015-12-29T22:51:47Z","updated_at":"2016-02-09T01:47:57Z","api":["d3.arc","d3.symbol","d3.pie"],"colors":["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#000000"],"readme":"The black dots show the midpoint computed by [d3-shape](https://github.com/d3/d3-shape)’s [*arc*.centroid](https://github.com/d3/d3-shape#arc_centroid). Note that this is not the geometric center of the arc, which may be outside the arc; this method is merely a convenience for positioning labels.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar data = [1, 1, 2, 3, 5, 8, 13];\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height,\n    radius = Math.min(width, height) / 2;\n\nvar colors = [\n  \"#1f77b4\", \"#ff7f0e\", \"#2ca02c\", \"#d62728\", \"#9467bd\",\n  \"#8c564b\", \"#e377c2\", \"#7f7f7f\", \"#bcbd22\", \"#17becf\"\n];\n\nvar arc = d3.arc()\n    .outerRadius(radius - 10)\n    .innerRadius(radius - 70)\n    .context(context);\n\nvar dot = d3.symbol()\n    .context(context);\n\nvar pie = d3.pie();\n\nvar arcs = pie(data);\n\ncontext.translate(width / 2, height / 2);\n\ncontext.globalAlpha = 0.5;\narcs.forEach(function(d, i) {\n  context.beginPath();\n  arc(d);\n  context.fillStyle = colors[i];\n  context.fill();\n});\n\ncontext.globalAlpha = 1;\ncontext.beginPath();\narcs.forEach(arc);\ncontext.lineWidth = 1.5;\ncontext.stroke();\n\ncontext.beginPath();\narcs.forEach(function(d) {\n  var c = arc.centroid(d);\n  context.save();\n  context.translate(c[0], c[1]);\n  dot();\n  context.restore();\n});\ncontext.fillStyle = \"#000\";\ncontext.fill();\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"23a92308c93d31b874382700a46d7cdfc1b6d0d2"},"sort":[1451429507000]},{"_index":"blockbuilder","_type":"blocks","_id":"9b5a2fd1ce1a146f27e4","_score":null,"_source":{"userId":"mbostock","description":"Pie Centroid","created_at":"2015-12-29T22:50:36Z","updated_at":"2016-02-09T01:48:00Z","api":["d3.arc","d3.symbol","d3.pie"],"colors":["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#000000"],"readme":"The black dots show the midpoint computed by [d3-shape](https://github.com/d3/d3-shape)’s [*arc*.centroid](https://github.com/d3/d3-shape#arc_centroid). Note that this is not the geometric center of the arc, which may be outside the arc; this method is merely a convenience for positioning labels.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar data = [1, 1, 2, 3, 5, 8, 13];\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height,\n    radius = Math.min(width, height) / 2;\n\nvar colors = [\n  \"#1f77b4\", \"#ff7f0e\", \"#2ca02c\", \"#d62728\", \"#9467bd\",\n  \"#8c564b\", \"#e377c2\", \"#7f7f7f\", \"#bcbd22\", \"#17becf\"\n];\n\nvar arc = d3.arc()\n    .outerRadius(radius - 10)\n    .innerRadius(0)\n    .context(context);\n\nvar dot = d3.symbol()\n    .context(context);\n\nvar pie = d3.pie();\n\nvar arcs = pie(data);\n\ncontext.translate(width / 2, height / 2);\n\ncontext.globalAlpha = 0.5;\narcs.forEach(function(d, i) {\n  context.beginPath();\n  arc(d);\n  context.fillStyle = colors[i];\n  context.fill();\n});\n\ncontext.globalAlpha = 1;\ncontext.beginPath();\narcs.forEach(arc);\ncontext.lineWidth = 1.5;\ncontext.stroke();\n\ncontext.beginPath();\narcs.forEach(function(d) {\n  var c = arc.centroid(d);\n  context.save();\n  context.translate(c[0], c[1]);\n  dot();\n  context.restore();\n});\ncontext.fillStyle = \"#000\";\ncontext.fill();\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"8c5d1636bccfeeb4814bf772ffee69eb617e7c30"},"sort":[1451429436000]},{"_index":"blockbuilder","_type":"blocks","_id":"2394b23da1994fc202e1","_score":null,"_source":{"userId":"mbostock","description":"Canvas Donut","created_at":"2015-12-29T22:41:39Z","updated_at":"2016-02-09T01:48:05Z","api":["d3.arc","d3.pie","d3.requestTsv"],"colors":["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00","#ffffff","#000000"],"readme":"A minimalist [donut chart](http://bl.ocks.org/mbostock/3887193) rendered to Canvas using [d3-shape](https://github.com/d3/d3-shape).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height,\n    radius = Math.min(width, height) / 2;\n\nvar colors = [\"#98abc5\", \"#8a89a6\", \"#7b6888\", \"#6b486b\", \"#a05d56\", \"#d0743c\", \"#ff8c00\"];\n\nvar arc = d3.arc()\n    .outerRadius(radius - 10)\n    .innerRadius(radius - 70)\n    .context(context);\n\nvar labelArc = d3.arc()\n    .outerRadius(radius - 40)\n    .innerRadius(radius - 40)\n    .context(context);\n\nvar pie = d3.pie()\n    .sort(null)\n    .value(function(d) { return d.population; });\n\ncontext.translate(width / 2, height / 2);\n\nd3.requestTsv(\"data.tsv\", function(d) {\n  d.population = +d.population;\n  return d;\n}, function(error, data) {\n  if (error) throw error;\n\n  var arcs = pie(data);\n\n  arcs.forEach(function(d, i) {\n    context.beginPath();\n    arc(d);\n    context.fillStyle = colors[i];\n    context.fill();\n  });\n\n  context.beginPath();\n  arcs.forEach(arc);\n  context.strokeStyle = \"#fff\";\n  context.stroke();\n\n  context.textAlign = \"center\";\n  context.textBaseline = \"middle\";\n  context.fillStyle = \"#000\";\n  arcs.forEach(function(d) {\n    var c = labelArc.centroid(d);\n    context.fillText(d.data.age, c[0], c[1]);\n  });\n});\n\n</script>\n","filenames":[".block","README.md","data.tsv","index.html","thumbnail.png"],"thumb":"88ee7367c1d4efb66c42362fbfadb4022b455e27"},"sort":[1451428899000]},{"_index":"blockbuilder","_type":"blocks","_id":"8878e7fd82034f1d63cf","_score":null,"_source":{"userId":"mbostock","description":"Canvas Pie","created_at":"2015-12-29T22:39:16Z","updated_at":"2016-02-09T01:48:07Z","api":["d3.arc","d3.pie","d3.requestTsv"],"colors":["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00","#ffffff","#000000"],"readme":"A minimalist [pie chart](http://bl.ocks.org/mbostock/3887235) rendered to Canvas using [d3-shape](https://github.com/d3/d3-shape).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height,\n    radius = Math.min(width, height) / 2;\n\nvar colors = [\"#98abc5\", \"#8a89a6\", \"#7b6888\", \"#6b486b\", \"#a05d56\", \"#d0743c\", \"#ff8c00\"];\n\nvar arc = d3.arc()\n    .outerRadius(radius - 10)\n    .innerRadius(0)\n    .context(context);\n\nvar labelArc = d3.arc()\n    .outerRadius(radius - 40)\n    .innerRadius(radius - 40)\n    .context(context);\n\nvar pie = d3.pie()\n    .sort(null)\n    .value(function(d) { return d.population; });\n\ncontext.translate(width / 2, height / 2);\n\nd3.requestTsv(\"data.tsv\", function(d) {\n  d.population = +d.population;\n  return d;\n}, function(error, data) {\n  if (error) throw error;\n\n  var arcs = pie(data);\n\n  arcs.forEach(function(d, i) {\n    context.beginPath();\n    arc(d);\n    context.fillStyle = colors[i];\n    context.fill();\n  });\n\n  context.beginPath();\n  arcs.forEach(arc);\n  context.strokeStyle = \"#fff\";\n  context.stroke();\n\n  context.textAlign = \"center\";\n  context.textBaseline = \"middle\";\n  context.fillStyle = \"#000\";\n  arcs.forEach(function(d) {\n    var c = labelArc.centroid(d);\n    context.fillText(d.data.age, c[0], c[1]);\n  });\n});\n\n</script>\n","filenames":[".block","README.md","data.tsv","index.html","thumbnail.png"],"thumb":"663f6e974babef35bcc8aacd81287436b01efbc5"},"sort":[1451428756000]},{"_index":"blockbuilder","_type":"blocks","_id":"c3034eef9d73b5fdf274","_score":null,"_source":{"userId":"mbostock","description":"Diamonds II","created_at":"2015-12-24T18:45:27Z","updated_at":"2016-02-09T01:48:10Z","api":["d3.scaleLog","d3.requestTsv","d3.extent","d3.shuffle","d3.timer"],"colors":["#f3f3f3","#ffffff","#777777","#000000"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"960\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar margin = {top: 20, right: 20, bottom: 30, left: 40},\n    width = canvas.width - margin.left - margin.right,\n    height = canvas.height - margin.top - margin.bottom;\n\nvar x = d3.scaleLog()\n    .rangeRound([0, width - 2]);\n\nvar y = d3.scaleLog()\n    .rangeRound([height - 2, 0]);\n\ncontext.translate(margin.left, margin.top);\ncontext.fillStyle = \"#f3f3f3\";\ncontext.fillRect(0, 0, width, height);\n\nd3.requestTsv(\"diamonds.tsv\", function(d) {\n  d.carat = +d.carat;\n  d.price = +d.price;\n  return d;\n}, function(error, diamonds) {\n  if (error) throw error;\n\n  x.domain(d3.extent(diamonds, function(d) { return d.carat; }));\n  y.domain(d3.extent(diamonds, function(d) { return d.price; }));\n\n  var xTickCount = 20,\n      xTicks = x.ticks(xTickCount),\n      xTickFormat = x.tickFormat(xTickCount, \".1f\"),\n      yTickCount = 20,\n      yTicks = y.ticks(yTickCount),\n      yTickFormat = y.tickFormat(yTickCount, \".1s\");\n\n  context.fillStyle = \"#fff\";\n  xTicks.forEach(function(t) {\n    context.fillRect(x(t), 0, 1, height);\n  });\n  yTicks.forEach(function(t) {\n    context.fillRect(0, y(t), width, 1);\n  });\n\n  context.fillStyle = \"#777\";\n  xTicks.forEach(function(t) {\n    context.fillRect(x(t), height, 1, 4);\n  });\n  yTicks.forEach(function(t) {\n    context.fillRect(-4, y(t), 4, 1);\n  });\n\n  context.fillStyle = \"#000\";\n  context.textAlign = \"center\";\n  context.textBaseline = \"top\";\n  xTicks.forEach(function(d) {\n    context.fillText(xTickFormat(d), x(d), height + 6);\n  });\n\n  context.fillStyle = \"#000\";\n  context.textAlign = \"right\";\n  context.textBaseline = \"middle\";\n  yTicks.forEach(function(d) {\n    context.fillText(yTickFormat(d), -6, y(d));\n  });\n\n  context.fillStyle = \"#000\";\n  context.textAlign = \"right\";\n  context.textBaseline = \"bottom\";\n  context.font = \"bold 10px sans-serif\";\n  context.fillText(\"Mass (carats)\", width - 10, height - 10);\n\n  context.save();\n  context.rotate(-Math.PI / 2);\n  context.textBaseline = \"top\";\n  context.fillText(\"Price (US$)\", -10, 10);\n  context.restore();\n\n  context.globalCompositeOperation = \"multiply\";\n  context.fillStyle = \"rgba(60,180,240,0.6)\";\n  d3.shuffle(diamonds);\n  var t = d3.timer(function() {\n    for (var i = 0, n = 500, d; i < n; ++i) {\n      if (!(d = diamonds.pop())) return t.stop();\n      context.fillRect(x(d.carat), y(d.price), Math.max(2, x(d.carat + 0.01) - x(d.carat)), 2);\n    }\n  });\n});\n\nif (self.frameElement) self.frameElement.style.height = height + margin.top + margin.bottom + \"px\";\n\n</script>\n","filenames":[".block","diamonds.tsv","index.html","thumbnail.png"],"thumb":"436d6734deda980a80ce2427720f4109c7c962da"},"sort":[1450982727000]},{"_index":"blockbuilder","_type":"blocks","_id":"ebb45892cc6ec5e6c902","_score":null,"_source":{"userId":"mbostock","description":"Diamonds","created_at":"2015-12-23T01:16:58Z","updated_at":"2016-02-09T01:48:13Z","api":["d3.scaleLinear","d3.requestTsv","d3.extent","d3.shuffle","d3.timer"],"colors":["#f3f3f3","#ffffff","#777777","#000000"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"960\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar margin = {top: 20, right: 20, bottom: 30, left: 40},\n    width = canvas.width - margin.left - margin.right,\n    height = canvas.height - margin.top - margin.bottom;\n\nvar x = d3.scaleLinear()\n    .rangeRound([0, width - 2]);\n\nvar y = d3.scaleLinear()\n    .rangeRound([height - 2, 0]);\n\ncontext.translate(margin.left, margin.top);\ncontext.fillStyle = \"#f3f3f3\";\ncontext.fillRect(0, 0, width, height);\n\nd3.requestTsv(\"diamonds.tsv\", function(d) {\n  d.carat = +d.carat;\n  d.price = +d.price;\n  return d;\n}, function(error, diamonds) {\n  if (error) throw error;\n\n  x.domain(d3.extent(diamonds, function(d) { return d.carat; }));\n  y.domain(d3.extent(diamonds, function(d) { return d.price; }));\n\n  var xTickCount = 10,\n      xTicks = x.ticks(xTickCount),\n      xTickFormat = x.tickFormat(xTickCount),\n      yTickCount = 10,\n      yTicks = y.ticks(yTickCount),\n      yTickFormat = y.tickFormat(yTickCount, \"s\");\n\n  context.fillStyle = \"#fff\";\n  xTicks.forEach(function(t) {\n    context.fillRect(x(t), 0, 1, height);\n  });\n  yTicks.forEach(function(t) {\n    context.fillRect(0, y(t), width, 1);\n  });\n\n  context.fillStyle = \"#777\";\n  xTicks.forEach(function(t) {\n    context.fillRect(x(t), height, 1, 4);\n  });\n  yTicks.forEach(function(t) {\n    context.fillRect(-4, y(t), 4, 1);\n  });\n\n  context.fillStyle = \"#000\";\n  context.textAlign = \"center\";\n  context.textBaseline = \"top\";\n  xTicks.forEach(function(d) {\n    context.fillText(xTickFormat(d), x(d), height + 6);\n  });\n\n  context.fillStyle = \"#000\";\n  context.textAlign = \"right\";\n  context.textBaseline = \"middle\";\n  yTicks.forEach(function(d) {\n    context.fillText(yTickFormat(d), -6, y(d));\n  });\n\n  context.fillStyle = \"#000\";\n  context.textAlign = \"right\";\n  context.textBaseline = \"bottom\";\n  context.font = \"bold 10px sans-serif\";\n  context.fillText(\"Mass (carats)\", width - 10, height - 10);\n\n  context.save();\n  context.rotate(-Math.PI / 2);\n  context.textBaseline = \"top\";\n  context.fillText(\"Price (US$)\", -10, 10);\n  context.restore();\n\n  context.globalCompositeOperation = \"multiply\";\n  context.fillStyle = \"rgba(60,180,240,0.6)\";\n  d3.shuffle(diamonds);\n  var t = d3.timer(function() {\n    for (var i = 0, n = 500, d; i < n; ++i) {\n      if (!(d = diamonds.pop())) return t.stop();\n      context.fillRect(x(d.carat), y(d.price), Math.max(2, x(d.carat + 0.01) - x(d.carat)), 2);\n    }\n  });\n});\n\nif (self.frameElement) self.frameElement.style.height = height + margin.top + margin.bottom + \"px\";\n\n</script>\n","filenames":[".block","diamonds.tsv","index.html","thumbnail.png"],"thumb":"424276a697176260aa2c505b6117dbf9b03e46a7"},"sort":[1450833418000]},{"_index":"blockbuilder","_type":"blocks","_id":"978f6c03c9aab8af8594","_score":null,"_source":{"userId":"mbostock","description":"Percentage Change II","created_at":"2015-12-14T17:07:58Z","updated_at":"2016-02-09T01:48:16Z","api":["d3.format","d3.time.format","d3.time.scale","d3.scale.log","d3.svg.axis","d3.svg.line","d3.svg.area","d3.select","d3.tsv","d3.extent","d3.scale.linear"],"colors":["#000000","#de77ae","#7fbc41"],"readme":"A variation of the [percentage change example](/mbostock/c69f5960c6b1a95b6f78) using clipping to apply different colors for positive change (green) and negative change (purple).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.axis {\n  font: 10px sans-serif;\n}\n\n.axis-title {\n  text-anchor: end;\n}\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n.axis--x path {\n  display: none;\n}\n\n.axis--y .tick:not(.tick--one) line {\n  stroke-opacity: .15;\n}\n\n.line {\n  fill: none;\n  stroke: #000;\n  stroke-width: 1.5px;\n  stroke-linejoin: round;\n  stroke-linecap: round;\n}\n\n.area {\n  fill-opacity: 0.6;\n}\n\n.area--below {\n  fill: #de77ae;\n}\n\n.area--above {\n  fill: #7fbc41;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar margin = {top: 30, right: 30, bottom: 40, left: 50},\n    width = 960 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar formatPercent = d3.format(\"+.0%\"),\n    formatChange = function(x) { return formatPercent(x - 1); },\n    parseDate = d3.time.format(\"%d-%b-%y\").parse;\n\nvar x = d3.time.scale()\n    .range([0, width]);\n\nvar y = d3.scale.log()\n    .range([height, 0]);\n\nvar xAxis = d3.svg.axis()\n    .scale(x)\n    .orient(\"bottom\");\n\nvar yAxis = d3.svg.axis()\n    .scale(y)\n    .orient(\"left\")\n    .tickSize(-width, 0)\n    .tickFormat(formatChange);\n\nvar line = d3.svg.line()\n    .x(function(d) { return x(d.date); })\n    .y(function(d) { return y(d.ratio); });\n\nvar area = d3.svg.area()\n    .x(function(d) { return x(d.date); })\n    .y(function(d) { return y(d.ratio); });\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nvar gX = svg.append(\"g\")\n    .attr(\"class\", \"axis axis--x\")\n    .attr(\"transform\", \"translate(0,\" + height + \")\");\n\nvar gY = svg.append(\"g\")\n    .attr(\"class\", \"axis axis--y\");\n\ngY.append(\"text\")\n    .attr(\"class\", \"axis-title\")\n    .attr(\"transform\", \"rotate(-90)\")\n    .attr(\"y\", 6)\n    .attr(\"dy\", \".71em\")\n    .text(\"Change in Price\");\n\nd3.tsv(\"data.tsv\", function(error, data) {\n  if (error) throw error;\n\n  // Compute price relative to base value (hypothetical purchase price).\n  var baseValue = +data[0].close;\n  data.forEach(function(d) {\n    d.date = parseDate(d.date);\n    d.ratio = d.close / baseValue;\n  });\n\n  x.domain(d3.extent(data, function(d) { return d.date; }));\n  y.domain(d3.extent(data, function(d) { return d.ratio; }));\n\n  area.y0(y(1));\n\n  // Use a second linear scale for ticks.\n  yAxis.tickValues(d3.scale.linear()\n      .domain(y.domain())\n      .ticks(20));\n\n  gX.call(xAxis);\n\n  gY.call(yAxis)\n    .selectAll(\".tick\")\n      .classed(\"tick--one\", function(d) { return Math.abs(d - 1) < 1e-6; });\n\n  var defs = svg.append(\"defs\");\n\n  defs.append(\"clipPath\")\n      .attr(\"id\", \"clip-above\")\n    .append(\"rect\")\n      .attr(\"width\", width)\n      .attr(\"height\", y(1));\n\n  defs.append(\"clipPath\")\n      .attr(\"id\", \"clip-below\")\n    .append(\"rect\")\n      .attr(\"y\", y(1))\n      .attr(\"width\", width)\n      .attr(\"height\", height - y(1));\n\n  svg.append(\"path\")\n      .datum(data)\n      .attr(\"clip-path\", \"url(#clip-above)\")\n      .attr(\"class\", \"area area--above\")\n      .attr(\"d\", area);\n\n  svg.append(\"path\")\n      .datum(data)\n      .attr(\"clip-path\", \"url(#clip-below)\")\n      .attr(\"class\", \"area area--below\")\n      .attr(\"d\", area);\n\n  svg.append(\"path\")\n      .datum(data)\n      .attr(\"class\", \"line\")\n      .attr(\"d\", line);\n});\n\n</script>\n","filenames":[".block","README.md","data.tsv","index.html","thumbnail.png"],"thumb":"ca6ccaacb9b4f29c50e44d16991a3242ee7963fb"},"sort":[1450112878000]},{"_index":"blockbuilder","_type":"blocks","_id":"c69f5960c6b1a95b6f78","_score":null,"_source":{"userId":"mbostock","description":"Percentage Change","created_at":"2015-12-14T16:51:49Z","updated_at":"2016-04-29T14:09:18Z","api":["d3.format","d3.time.format","d3.time.scale","d3.scale.log","d3.svg.axis","d3.svg.line","d3.select","d3.tsv","d3.extent","d3.scale.linear"],"colors":["#000000","#4682b4","#0000ff"],"readme":"Assuming you bought AAPL stock at its closing price on January 2, 2008, how would your investment fare over the next four and a half years? (Quite well, for the most part…)\n\nRather than simply plot the absolute price on a linear scale, which would exaggerate gains and understate losses, instead compute the *relative* price, *i.e.*, the current price divided by the purchase price. Then, use a log scale to accurately show proportional gains and losses: a +100% gain (2×) is as good as a -50% loss is bad (0.5×). As long as the current value never reaches absolute zero, meaning as long as the stock is not completely worthless, the scale domain never crosses zero.\n\nTo show [percentage change](https://en.wikipedia.org/wiki/Relative_change_and_difference#Percentage_change) (+20%, -20%), simply subtract 1 from the relative price:\n\n```js\nvar formatPercent = d3.format(\"+.0%\");\n\n// Formats a relative price (e.g., 2) as percentage change (e.g., +100%).\nfunction formatChange(x) {\n  return formatPercent(x - 1);\n}\n```\n\nAlthough the log scale ticks are adequate in relative price space, a second linear scale can also be used to generate uniformly-spaced ticks.\n\nA nice related technique is to add color to show [positive or negative change](/mbostock/978f6c03c9aab8af8594).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.axis {\n  font: 10px sans-serif;\n}\n\n.axis-title {\n  text-anchor: end;\n}\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n.axis--x path {\n  display: none;\n}\n\n.axis--y .tick:not(.tick--one) line {\n  stroke-opacity: .15;\n}\n\n.line {\n  fill: none;\n  stroke: steelblue;\n  stroke-width: 1.5px;\n  stroke-linejoin: round;\n  stroke-linecap: round;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar margin = {top: 30, right: 30, bottom: 40, left: 50},\n    width = 960 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar formatPercent = d3.format(\"+.0%\"),\n    formatChange = function(x) { return formatPercent(x - 1); },\n    parseDate = d3.time.format(\"%d-%b-%y\").parse;\n\nvar x = d3.time.scale()\n    .range([0, width]);\n\nvar y = d3.scale.log()\n    .range([height, 0]);\n\nvar xAxis = d3.svg.axis()\n    .scale(x)\n    .orient(\"bottom\");\n\nvar yAxis = d3.svg.axis()\n    .scale(y)\n    .orient(\"left\")\n    .tickSize(-width, 0)\n    .tickFormat(formatChange);\n\nvar line = d3.svg.line()\n    .x(function(d) { return x(d.date); })\n    .y(function(d) { return y(d.ratio); });\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nvar gX = svg.append(\"g\")\n    .attr(\"class\", \"axis axis--x\")\n    .attr(\"transform\", \"translate(0,\" + height + \")\");\n\nvar gY = svg.append(\"g\")\n    .attr(\"class\", \"axis axis--y\");\n\ngY.append(\"text\")\n    .attr(\"class\", \"axis-title\")\n    .attr(\"transform\", \"rotate(-90)\")\n    .attr(\"y\", 6)\n    .attr(\"dy\", \".71em\")\n    .text(\"Change in Price\");\n\nd3.tsv(\"data.tsv\", function(error, data) {\n  if (error) throw error;\n\n  // Compute price relative to base value (hypothetical purchase price).\n  var baseValue = +data[0].close;\n  data.forEach(function(d) {\n    d.date = parseDate(d.date);\n    d.ratio = d.close / baseValue;\n  });\n\n  x.domain(d3.extent(data, function(d) { return d.date; }));\n  y.domain(d3.extent(data, function(d) { return d.ratio; }));\n\n  // Use a second linear scale for ticks.\n  yAxis.tickValues(d3.scale.linear()\n      .domain(y.domain())\n      .ticks(20));\n\n  gX.call(xAxis);\n\n  gY.call(yAxis)\n    .selectAll(\".tick\")\n      .classed(\"tick--one\", function(d) { return Math.abs(d - 1) < 1e-6; });\n\n  svg.append(\"path\")\n      .datum(data)\n      .attr(\"class\", \"line\")\n      .attr(\"d\", line);\n});\n\n</script>\n","filenames":[".block","README.md","data.tsv","index.html","thumbnail.png"],"thumb":"7f6401caaacb8980fa0fe614f493806e6b343b82"},"sort":[1450111909000]},{"_index":"blockbuilder","_type":"blocks","_id":"fe656fdbb04fd723efd4","_score":null,"_source":{"userId":"mbostock","description":"D3 Outline Logo","created_at":"2015-12-11T20:10:54Z","updated_at":"2016-02-09T01:48:23Z","api":[],"colors":["#fcfcfa","#ddeeee","#ffffff","#000000"],"readme":"A new version of the [D3 logo](https://github.com/d3/d3-logo) with a high-contrast outline. This was designed for the [official D3 sticker](https://www.stickermule.com/marketplace/9699-d3-outline), which is available for only $4.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  background: #fcfcfa;\n}\n\n</style>\n<svg width=\"960\" height=\"500\" viewBox=\"-20 -20 136 131\">\n  <defs>\n    <path id=\"deethree\" d=\"M0,0h7.75a45.5,45.5 0 1 1 0,91h-7.75v-20h7.75a25.5,25.5 0 1 0 0,-51h-7.75zM36.2510,0h32a27.75,27.75 0 0 1 21.331,45.5a27.75,27.75 0 0 1 -21.331,45.5h-32a53.6895,53.6895 0 0 0 18.7464,-20h13.2526a7.75,7.75 0 1 0 0,-15.5h-7.75a53.6895,53.6895 0 0 0 0,-20h7.75a7.75,7.75 0 1 0 0,-15.5h-13.2526a53.6895,53.6895 0 0 0 -18.7464,-20z\"/>\n  </defs>\n  <use xlink:href=\"#deethree\" stroke=\"black\" stroke-width=\"20\"/>\n  <use xlink:href=\"#deethree\" fill=\"white\"/>\n</svg>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"071e23fe1eadb3202571dd47be2e0170d7889051"},"sort":[1449864654000]},{"_index":"blockbuilder","_type":"blocks","_id":"6f14f7b7f267a85f7cdc","_score":null,"_source":{"userId":"mbostock","description":"Convex Hull","created_at":"2015-12-08T18:24:52Z","updated_at":"2016-02-09T01:48:25Z","api":[],"colors":["#4682b4","#0000ff","#ffffff","#000000"],"readme":"Andrew’s [monotone chain algorithm](https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain) computes the [convex hull](https://github.com/d3/d3-polygon#hull) of a set of two-dimensional points.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3-random.v0.1.min.js\"></script>\n<script src=\"//d3js.org/d3-polygon.v0.1.min.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height;\n\nvar randomX = d3_random.normal(width / 2, 60),\n    randomY = d3_random.normal(height / 2, 60),\n    points = new Array(100);\n\nfor (var i = 0, n = points.length; i < n; ++i) points[i] = [randomX(), randomY()];\n\nrender();\n\nwindow.addEventListener(\"mousemove\", function(event) {\n  var rect = canvas.getBoundingClientRect(),\n      x = event.clientX - rect.left - canvas.clientLeft,\n      y = event.clientY - rect.top - canvas.clientTop;\n\n  points[0][0] = x;\n  points[0][1] = y;\n  render();\n});\n\nfunction render() {\n  context.clearRect(0, 0, width, height);\n\n  var hull = d3_polygon.hull(points);\n  context.beginPath();\n  context.moveTo(hull[0][0], hull[0][1]);\n  for (var i = 1, n = hull.length; i < n; ++i) {\n    context.lineTo(hull[i][0], hull[i][1]);\n  }\n  context.closePath();\n  context.fillStyle = \"steelblue\";\n  context.fill();\n  context.lineWidth = 15;\n  context.lineJoin = \"round\";\n  context.strokeStyle = \"steelblue\";\n  context.stroke();\n\n  context.beginPath();\n  for (var i = 0, n = points.length; i < n; ++i) {\n    context.moveTo(points[i][0] + 2.5, points[i][1]);\n    context.arc(points[i][0], points[i][1], 2.5, 0, 2 * Math.PI);\n  }\n  context.fillStyle = \"white\";\n  context.fill();\n  context.lineWidth = 1.5;\n  context.strokeStyle = \"black\";\n  context.stroke();\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"889b26ea68ffb278d0c7268ecb59b3977fe5ffa0"},"sort":[1449599092000]},{"_index":"blockbuilder","_type":"blocks","_id":"6d9d75ee13abbcfea6e0","_score":null,"_source":{"userId":"mbostock","description":"Seven Symbols","created_at":"2015-12-08T16:58:33Z","updated_at":"2016-02-09T01:48:28Z","api":[],"colors":["#ff0000","#000000","#d2b48c"],"readme":"The seven [symbols](https://github.com/d3/d3-shape#symbols) supported by [d3-shape](https://github.com/d3/d3-shape). Each has a configurable area (here, 2500 square pixels) and is positioned around its centroid.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nsvg {\n  float: left;\n}\n\ncircle {\n  fill: none;\n  stroke: #f00;\n  stroke-width: 1.5px;\n}\n\npath {\n  fill: #000;\n}\n\n</style>\n<div style=\"width:700px;margin:200px auto;display:block;\">\n  <svg width=\"100\" height=\"100\"><g transform=\"translate(50,50)\"><path data-type=\"circle\"/><circle r=\"28\"></circle></g></svg>\n  <svg width=\"100\" height=\"100\"><g transform=\"translate(50,50)\"><path data-type=\"cross\"/><circle r=\"35\"></circle></g></svg>\n  <svg width=\"100\" height=\"100\"><g transform=\"translate(50,50)\"><path data-type=\"diamond\"/><circle r=\"46\"></circle></g></svg>\n  <svg width=\"100\" height=\"100\"><g transform=\"translate(50,50)\"><path data-type=\"square\"/><circle r=\"36\"></circle></g></svg>\n  <svg width=\"100\" height=\"100\"><g transform=\"translate(50,50)\"><path data-type=\"star\"/><circle r=\"47\"></circle></g></svg>\n  <svg width=\"100\" height=\"100\"><g transform=\"translate(50,50)\"><path data-type=\"triangle\"/><circle r=\"44\"></circle></g></svg>\n  <svg width=\"100\" height=\"100\"><g transform=\"translate(50,50)\"><path data-type=\"wye\"/><circle r=\"37\"></circle></g></svg>\n</div>\n<script>\n\n/* https://github.com/d3/d3-path Copyright 2015 Mike Bostock */\n!function(t,s){\"object\"==typeof exports&&\"undefined\"!=typeof module?s(exports):\"function\"==typeof define&&define.amd?define(\"d3-path\",[\"exports\"],s):s(t.d3_path={})}(this,function(t){\"use strict\";function s(){this._x0=this._y0=this._x1=this._y1=null,this._=[]}function i(){return new s}var h=Math.PI,_=2*h,n=1e-6,e=_-n;s.prototype=i.prototype={moveTo:function(t,s){this._.push(\"M\",this._x0=this._x1=+t,\",\",this._y0=this._y1=+s)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._.push(\"Z\"))},lineTo:function(t,s){this._.push(\"L\",this._x1=+t,\",\",this._y1=+s)},quadraticCurveTo:function(t,s,i,h){this._.push(\"Q\",+t,\",\",+s,\",\",this._x1=+i,\",\",this._y1=+h)},bezierCurveTo:function(t,s,i,h,_,n){this._.push(\"C\",+t,\",\",+s,\",\",+i,\",\",+h,\",\",this._x1=+_,\",\",this._y1=+n)},arcTo:function(t,s,i,_,e){t=+t,s=+s,i=+i,_=+_,e=+e;var o=this._x1,u=this._y1,a=i-t,r=_-s,p=o-t,f=u-s,c=p*p+f*f;if(0>e)throw new Error(\"negative radius: \"+e);if(null===this._x1)this._.push(\"M\",this._x1=t,\",\",this._y1=s);else if(c>n)if(Math.abs(f*a-r*p)>n&&e){var x=i-o,y=_-u,M=a*a+r*r,l=x*x+y*y,d=Math.sqrt(M),v=Math.sqrt(c),b=e*Math.tan((h-Math.acos((M+c-l)/(2*d*v)))/2),w=b/v,T=b/d;Math.abs(w-1)>n&&this._.push(\"L\",t+w*p,\",\",s+w*f),this._.push(\"A\",e,\",\",e,\",0,0,\",+(f*x>p*y),\",\",this._x1=t+T*a,\",\",this._y1=s+T*r)}else this._.push(\"L\",this._x1=t,\",\",this._y1=s);else;},arc:function(t,s,i,o,u,a){t=+t,s=+s,i=+i;var r=i*Math.cos(o),p=i*Math.sin(o),f=t+r,c=s+p,x=1^a,y=a?o-u:u-o;if(0>i)throw new Error(\"negative radius: \"+i);null===this._x1?this._.push(\"M\",f,\",\",c):(Math.abs(this._x1-f)>n||Math.abs(this._y1-c)>n)&&this._.push(\"L\",f,\",\",c),i&&(y>e?this._.push(\"A\",i,\",\",i,\",0,1,\",x,\",\",t-r,\",\",s-p,\"A\",i,\",\",i,\",0,1,\",x,\",\",this._x1=f,\",\",this._y1=c):(0>y&&(y=y%_+_),this._.push(\"A\",i,\",\",i,\",0,\",+(y>=h),\",\",x,\",\",this._x1=t+i*Math.cos(u),\",\",this._y1=s+i*Math.sin(u))))},rect:function(t,s,i,h){this._.push(\"M\",this._x0=this._x1=+t,\",\",this._y0=this._y1=+s,\"h\",+i,\"v\",+h,\"h\",-i,\"Z\")},toString:function(){return this._.join(\"\")}};var o=\"0.1.2\";t.version=o,t.path=i});\n\n/* https://github.com/d3/d3-shape Copyright 2015 Mike Bostock */\n!function(t,i){\"object\"==typeof exports&&\"undefined\"!=typeof module?i(exports,require(\"d3-path\")):\"function\"==typeof define&&define.amd?define(\"d3-shape\",[\"exports\",\"d3-path\"],i):i(t.d3_shape={},t.d3_path)}(this,function(t,i){\"use strict\";function n(t){return function(){return t}}function s(t){return t.innerRadius}function e(t){return t.outerRadius}function h(t){return t.startAngle}function _(t){return t.endAngle}function o(t){return t&&t.padAngle}function a(t){return t>=1?yt:-1>=t?-yt:Math.asin(t)}function r(t,i,n,s,e,h,_,o){var a=n-t,r=s-i,l=_-e,c=o-h,u=(l*(i-h)-c*(t-e))/(c*a-l*r);return[t+u*a,i+u*r]}function l(t,i,n,s,e,h,_){var o=t-n,a=i-s,r=(_?h:-h)/Math.sqrt(o*o+a*a),l=r*a,c=-r*o,u=t+l,x=i+c,f=n+l,y=s+c,p=(u+f)/2,d=(x+y)/2,v=f-u,g=y-x,m=v*v+g*g,T=e-h,M=u*y-f*x,b=(0>g?-1:1)*Math.sqrt(Math.max(0,T*T*m-M*M)),w=(M*g-v*b)/m,N=(-M*v-g*b)/m,k=(M*g+v*b)/m,E=(-M*v+g*b)/m,S=w-p,P=N-d,A=k-p,q=E-d;return S*S+P*P>A*A+q*q&&(w=k,N=E),{cx:w,cy:N,x01:-l,y01:-c,x11:w*(e/T-1),y11:N*(e/T-1)}}function c(){function t(){var t,n,s=+c.apply(this,arguments),e=+u.apply(this,arguments),h=y.apply(this,arguments)-yt,_=p.apply(this,arguments)-yt,o=Math.abs(_-h),g=_>h;if(v||(v=t=i.path()),s>e&&(n=e,e=s,s=n),e>0)if(o>=pt)v.moveTo(e*Math.cos(h),e*Math.sin(h)),v.arc(0,0,e,h,_,!g),s>0&&(v.moveTo(s*Math.cos(_),s*Math.sin(_)),v.arc(0,0,s,_,h,g));else{var m=h,T=_,M=h,b=_,w=o,N=o,k=d.apply(this,arguments)/2,E=k>0&&(f?+f.apply(this,arguments):Math.sqrt(s*s+e*e)),S=Math.min(Math.abs(e-s)/2,+x.apply(this,arguments)),P=S,A=S;if(E>0){var q=a(E/s*Math.sin(k)),R=a(E/e*Math.sin(k));(w-=2*q)>0?(q*=g?1:-1,M+=q,b-=q):(w=0,M=b=(h+_)/2),(N-=2*R)>0?(R*=g?1:-1,m+=R,T-=R):(N=0,m=T=(h+_)/2)}var C=e*Math.cos(m),z=e*Math.sin(m),O=s*Math.cos(b),j=s*Math.sin(b);if(S>0){var B=e*Math.cos(T),I=e*Math.sin(T),L=s*Math.cos(M),V=s*Math.sin(M);if(ft>o){var D=w>0?r(C,z,L,V,B,I,O,j):[O,j],F=C-D[0],G=z-D[1],H=B-D[0],J=I-D[1],K=1/Math.sin(Math.acos((F*H+G*J)/(Math.sqrt(F*F+G*G)*Math.sqrt(H*H+J*J)))/2),Q=Math.sqrt(D[0]*D[0]+D[1]*D[1]);P=Math.min(S,(s-Q)/(K-1)),A=Math.min(S,(e-Q)/(K+1))}}if(N>0)if(A>0){var U=l(L,V,C,z,e,A,g),W=l(B,I,O,j,e,A,g);v.moveTo(U.cx+U.x01,U.cy+U.y01),S>A?v.arc(U.cx,U.cy,A,Math.atan2(U.y01,U.x01),Math.atan2(W.y01,W.x01),!g):(v.arc(U.cx,U.cy,A,Math.atan2(U.y01,U.x01),Math.atan2(U.y11,U.x11),!g),v.arc(0,0,e,Math.atan2(U.cy+U.y11,U.cx+U.x11),Math.atan2(W.cy+W.y11,W.cx+W.x11),!g),v.arc(W.cx,W.cy,A,Math.atan2(W.y11,W.x11),Math.atan2(W.y01,W.x01),!g))}else v.moveTo(C,z),v.arc(0,0,e,m,T,!g);else v.moveTo(C,z);if(s>0&&w>0)if(P>0){var U=l(O,j,B,I,s,-P,g),W=l(C,z,L,V,s,-P,g);v.lineTo(U.cx+U.x01,U.cy+U.y01),S>P?v.arc(U.cx,U.cy,P,Math.atan2(U.y01,U.x01),Math.atan2(W.y01,W.x01),!g):(v.arc(U.cx,U.cy,P,Math.atan2(U.y01,U.x01),Math.atan2(U.y11,U.x11),!g),v.arc(0,0,s,Math.atan2(U.cy+U.y11,U.cx+U.x11),Math.atan2(W.cy+W.y11,W.cx+W.x11),g),v.arc(W.cx,W.cy,P,Math.atan2(W.y11,W.x11),Math.atan2(W.y01,W.x01),!g))}else v.arc(0,0,s,b,M,g);else v.lineTo(O,j)}else v.moveTo(0,0);return v.closePath(),t?(v=null,t+\"\"||null):void 0}var c=s,u=e,x=n(0),f=null,y=h,p=_,d=o,v=null,g=null;return t.centroid=function(){var t=(+c.apply(this,arguments)+ +u.apply(this,arguments))/2,i=(+y.apply(this,arguments)+ +p.apply(this,arguments))/2-ft/2;return[Math.cos(i)*t,Math.sin(i)*t]},t.innerRadius=function(i){return arguments.length?(c=\"function\"==typeof i?i:n(+i),t):c},t.outerRadius=function(i){return arguments.length?(u=\"function\"==typeof i?i:n(+i),t):u},t.cornerRadius=function(i){return arguments.length?(x=\"function\"==typeof i?i:n(+i),t):x},t.padRadius=function(i){return arguments.length?(f=null==i?null:\"function\"==typeof i?i:n(+i),t):f},t.startAngle=function(i){return arguments.length?(y=\"function\"==typeof i?i:n(+i),t):y},t.endAngle=function(i){return arguments.length?(p=\"function\"==typeof i?i:n(+i),t):p},t.padAngle=function(i){return arguments.length?(d=\"function\"==typeof i?i:n(+i),t):d},t.context=function(i){return arguments.length?(v=g=null==i?null:i,t):v},t}function u(t,i){return i.length<2?t:(i=dt.call(i),i[0]=null,function(n){return i[0]=n,t.apply(null,i)})}function x(t){this._context=t}function f(t){return new x(t)}function y(t){return t[0]}function p(t){return t[1]}function d(){function t(t){var n,c,u,x,f,y=t.length,p=!1,d=new Array(y),v=new Array(y);for(a||(l=r(f=i.path())),n=0;y>=n;++n){if(!(y>n&&o(x=t[n],n,t))===p)if(p=!p)c=n,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),u=n-1;u>=c;--u)l.point(d[u],v[u]);l.lineEnd(),l.areaEnd()}p&&(d[n]=+s(x,n,t),v[n]=+h(x,n,t),l.point(e?+e(x,n,t):d[n],_?+_(x,n,t):v[n]))}return f?(l=null,f+\"\"||null):void 0}var s=y,e=null,h=n(0),_=p,o=n(!0),a=null,r=f,l=null;return t.x=function(i){return arguments.length?(s=\"function\"==typeof i?i:n(+i),e=null,t):s},t.x0=function(i){return arguments.length?(s=\"function\"==typeof i?i:n(+i),t):s},t.x1=function(i){return arguments.length?(e=null==i?null:\"function\"==typeof i?i:n(+i),t):e},t.y=function(i){return arguments.length?(h=\"function\"==typeof i?i:n(+i),_=null,t):h},t.y0=function(i){return arguments.length?(h=\"function\"==typeof i?i:n(+i),t):h},t.y1=function(i){return arguments.length?(_=null==i?null:\"function\"==typeof i?i:n(+i),t):_},t.defined=function(i){return arguments.length?(o=\"function\"==typeof i?i:n(!!i),t):o},t.curve=function(i){return arguments.length?(r=u(i,arguments),null!=a&&(l=r(a)),t):r},t.context=function(i){return arguments.length?(null==i?a=l=null:l=r(a=i),t):a},t}function v(){}function g(t,i,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+i)/6,(t._y0+4*t._y1+n)/6)}function m(t){this._context=t}function T(t){return new m(t)}function M(t){this._context=t}function b(t){return new M(t)}function w(t){this._context=t}function N(t){return new w(t)}function k(t,i){this._basis=T(t),this._beta=i}function E(t,i){return null==i?new k(t,.85):1===(i=+i)?T(t):new k(t,i)}function S(t,i,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-i),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function P(t,i){this._context=t,this._k=i}function A(t,i){return new P(t,(null==i?1:1-i)/6)}function q(t,i){this._context=t,this._k=i}function R(t,i){return new q(t,(null==i?1:1-i)/6)}function C(t,i){this._context=t,this._k=i}function z(t,i){return new C(t,(null==i?1:1-i)/6)}function O(t,i,n){var s=t._x1,e=t._y1,h=t._x2,_=t._y2;if(t._l01_a>vt){var o=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,a=3*t._l01_a*(t._l01_a+t._l12_a);s=(s*o-t._x0*t._l12_2a+t._x2*t._l01_2a)/a,e=(e*o-t._y0*t._l12_2a+t._y2*t._l01_2a)/a}if(t._l23_a>vt){var r=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,l=3*t._l23_a*(t._l23_a+t._l12_a);h=(h*r+t._x1*t._l23_2a-i*t._l12_2a)/l,_=(_*r+t._y1*t._l23_2a-n*t._l12_2a)/l}t._context.bezierCurveTo(s,e,h,_,t._x2,t._y2)}function j(t,i){this._context=t,this._alpha=i}function B(t,i){return(i=null==i?.5:+i)?new j(t,i):A(t,0)}function I(t,i){this._context=t,this._alpha=i}function L(t,i){return(i=null==i?.5:+i)?new I(t,i):R(t,0)}function V(t,i){this._context=t,this._alpha=i}function D(t,i){return(i=null==i?.5:+i)?new V(t,i):z(t,0)}function F(t){this._context=t}function G(t){return new F(t)}function H(){function t(t){var n,r,l,c=t.length,u=!1;for(_||(a=o(l=i.path())),n=0;c>=n;++n)!(c>n&&h(r=t[n],n,t))===u&&((u=!u)?a.lineStart():a.lineEnd()),u&&a.point(+s(r,n,t),+e(r,n,t));return l?(a=null,l+\"\"||null):void 0}var s=y,e=p,h=n(!0),_=null,o=f,a=null;return t.x=function(i){return arguments.length?(s=\"function\"==typeof i?i:n(+i),t):s},t.y=function(i){return arguments.length?(e=\"function\"==typeof i?i:n(+i),t):e},t.defined=function(i){return arguments.length?(h=\"function\"==typeof i?i:n(!!i),t):h},t.curve=function(i){return arguments.length?(o=u(i,arguments),null!=_&&(a=o(_)),t):o},t.context=function(i){return arguments.length?(null==i?_=a=null:a=o(_=i),t):_},t}function J(t){return 0>t?-1:1}function K(t,i,n){var s=t._x1-t._x0,e=i-t._x1,h=(t._y1-t._y0)/s,_=(n-t._y1)/e,o=(h*e+_*s)/(s+e);return(J(h)+J(_))*Math.min(Math.abs(h),Math.abs(_),.5*Math.abs(o))||0}function Q(t,i){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-i)/2:i}function U(t,i,n){var s=t._x0,e=t._y0,h=t._x1,_=t._y1,o=(h-s)/3;t._context.bezierCurveTo(s+o,e+o*i,h-o,_-o*n,h,_)}function W(t){this._context=t}function X(t){return new W(t)}function Y(t){this._context=t}function Z(t){var i,n,s=t.length-1,e=new Array(s),h=new Array(s),_=new Array(s);for(e[0]=0,h[0]=2,_[0]=t[0]+2*t[1],i=1;s-1>i;++i)e[i]=1,h[i]=4,_[i]=4*t[i]+2*t[i+1];for(e[s-1]=2,h[s-1]=7,_[s-1]=8*t[s-1]+t[s],i=1;s>i;++i)n=e[i]/h[i-1],h[i]-=n,_[i]-=n*_[i-1];for(e[s-1]=_[s-1]/h[s-1],i=s-2;i>=0;--i)e[i]=(_[i]-e[i+1])/h[i];for(h[s-1]=(t[s]+e[s-1])/2,i=0;s-1>i;++i)h[i]=2*t[i+1]-e[i+1];return[e,h]}function $(t){return new Y(t)}function tt(t,i){return t>i?-1:i>t?1:i>=t?0:NaN}function it(t){return t}function nt(){function t(t){for(var n,a,r=t.length,l=0,c=new Array(r),u=new Array(r),x=+h.apply(this,arguments),f=Math.min(pt,Math.max(-pt,_.apply(this,arguments)-x)),y=Math.min(Math.abs(f)/r,o.apply(this,arguments)),p=y*(0>f?-1:1),d=0;r>d;++d)(a=u[c[d]=d]=+i(t[d],d,t))>0&&(l+=a);null!=s?c.sort(function(t,i){return s(u[t],u[i])}):null!==e&&c.sort(function(i,n){return e(t[i],t[n])});for(var v,d=0,g=l?(f-r*p)/l:0;r>d;++d,x=n)v=c[d],a=u[v],n=x+(a>0?a*g:0)+p,u[v]={data:t[v],value:a,startAngle:x,endAngle:n,padAngle:y};return u}var i=it,s=tt,e=null,h=n(0),_=n(pt),o=n(0);return t.value=function(s){return arguments.length?(i=\"function\"==typeof s?s:n(+s),t):i},t.sortValues=function(i){return arguments.length?(s=i,e=null,t):s},t.sort=function(i){return arguments.length?(e=i,s=null,t):e},t.startAngle=function(i){return arguments.length?(h=\"function\"==typeof i?i:n(+i),t):h},t.endAngle=function(i){return arguments.length?(_=\"function\"==typeof i?i:n(+i),t):_},t.padAngle=function(i){return arguments.length?(o=\"function\"==typeof i?i:n(+i),t):o},t}function st(t){this._curve=t}function et(t,i){function n(i){return new st(t(i))}return t=u(t,i),n._curve=t,n}function ht(){var t=d(),i=t.curve;return t.angle=t.x,delete t.x,t.startAngle=t.x0,delete t.x0,t.endAngle=t.x1,delete t.x1,t.radius=t.y,delete t.y,t.innerRadius=t.y0,delete t.y0,t.outerRadius=t.y1,delete t.y1,t.curve=function(t){return arguments.length?i(et(t,arguments)):i()._curve},t.curve(f)}function _t(){var t=H(),i=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(t){return arguments.length?i(et(t,arguments)):i()._curve},t.curve(f)}function ot(t){this._context=t}function at(t){return new ot(t)}function rt(t){this._context=t}function lt(t){return new rt(t)}function ct(t){this._context=t}function ut(t){return new ct(t)}function xt(){function t(){var t;return h||(h=t=i.path()),s.apply(this,arguments).draw(h,+e.apply(this,arguments)),t?(h=null,t+\"\"||null):void 0}var s=n(gt),e=n(64),h=null;return t.type=function(i){return arguments.length?(s=\"function\"==typeof i?i:n(i),t):s},t.size=function(i){return arguments.length?(e=\"function\"==typeof i?i:n(+i),t):e},t.context=function(i){return arguments.length?(h=null==i?null:i,t):h},t}var ft=Math.PI,yt=ft/2,pt=2*ft,dt=Array.prototype.slice;x.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;default:this._context.lineTo(t,i)}}},m.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:g(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:g(this,t,i)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=i}},M.prototype={areaStart:v,areaEnd:v,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._x2=t,this._y2=i;break;case 1:this._point=2,this._x3=t,this._y3=i;break;case 2:this._point=3,this._x4=t,this._y4=i,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+i)/6);break;default:g(this,t,i)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=i}},w.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,s=(this._y0+4*this._y1+i)/6;this._line?this._context.lineTo(n,s):this._context.moveTo(n,s);break;case 3:this._point=4;default:g(this,t,i)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=i}},k.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,i=this._y,n=t.length-1;if(n>0)for(var s,e=t[0],h=i[0],_=t[n]-e,o=i[n]-h,a=-1;++a<=n;)s=a/n,this._basis.point(this._beta*t[a]+(1-this._beta)*(e+s*_),this._beta*i[a]+(1-this._beta)*(h+s*o));this._x=this._y=null,this._basis.lineEnd()},point:function(t,i){this._x.push(+t),this._y.push(+i)}},P.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:S(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2,this._x1=t,this._y1=i;break;case 2:this._point=3;default:S(this,t,i)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}},q.prototype={areaStart:v,areaEnd:v,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._x3=t,this._y3=i;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=i);break;case 2:this._point=3,this._x5=t,this._y5=i;break;default:S(this,t,i)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}},C.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:S(this,t,i)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}};var vt=1e-6;j.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this,this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){if(t=+t,i=+i,this._point){var n=this._x2-t,s=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+s*s,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;break;case 2:this._point=3;default:O(this,t,i)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}},I.prototype={areaStart:v,areaEnd:v,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,i){if(t=+t,i=+i,this._point){var n=this._x2-t,s=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+s*s,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=i;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=i);break;case 2:this._point=3,this._x5=t,this._y5=i;break;default:O(this,t,i)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}},V.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){if(t=+t,i=+i,this._point){var n=this._x2-t,s=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+s*s,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:O(this,t,i)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}};var gt={draw:function(t,i){var n=Math.sqrt(i/ft);t.moveTo(n,0),t.arc(0,0,n,0,pt)}},mt={draw:function(t,i){var n=Math.sqrt(i/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}},Tt=Math.sqrt(1/3),Mt=2*Tt,bt={draw:function(t,i){var n=Math.sqrt(i/Mt),s=n*Tt;t.moveTo(0,-n),t.lineTo(s,0),t.lineTo(0,n),t.lineTo(-s,0),t.closePath()}};F.prototype={areaStart:v,areaEnd:v,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,i){t=+t,i=+i,this._point?this._context.lineTo(t,i):(this._point=1,this._context.moveTo(t,i))}},W.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:U(this,this._t0,Q(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){var n=NaN;if(t=+t,i=+i,t!==this._x1||i!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;break;case 2:this._point=3,U(this,Q(this,n=K(this,t,i)),n);break;default:U(this,this._t0,n=K(this,t,i))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=i,this._t0=n}}},Y.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,i=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],i[0]):this._context.moveTo(t[0],i[0]),2===n)this._context.lineTo(t[1],i[1]);else for(var s=Z(t),e=Z(i),h=0,_=1;n>_;++h,++_)this._context.bezierCurveTo(s[0][h],e[0][h],s[1][h],e[1][h],t[_],i[_]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,i){this._x.push(+t),this._y.push(+i)}},st.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,i){t-=yt,this._curve.point(i*Math.cos(t),i*Math.sin(t))}};var wt={draw:function(t,i){var n=Math.sqrt(i),s=-n/2;t.rect(s,s,n,n)}},Nt=.8908130915292852,kt=Math.sin(ft/10)/Math.sin(7*ft/10),Et=Math.sin(pt/10)*kt,St=-Math.cos(pt/10)*kt,Pt={draw:function(t,i){var n=Math.sqrt(i*Nt),s=Et*n,e=St*n;t.moveTo(0,-n),t.lineTo(s,e);for(var h=1;5>h;++h){var _=pt*h/5,o=Math.cos(_),a=Math.sin(_);t.lineTo(a*n,-o*n),t.lineTo(o*s-a*e,a*s+o*e)}t.closePath()}};ot.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._y=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;default:this._context.lineTo(t,this._y),this._context.lineTo(t,i)}this._y=i}},rt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;default:this._context.lineTo(this._x,i),this._context.lineTo(t,i)}this._x=t}},ct.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;default:var n=(this._x+t)/2;this._context.lineTo(n,this._y),this._context.lineTo(n,i)}this._x=t,this._y=i}};var At=-.5,qt=Math.sqrt(3)/2,Rt=1/Math.sqrt(12),Ct=3*(Rt/2+1),zt={draw:function(t,i){var n=Math.sqrt(i/Ct),s=n/2,e=n*Rt,h=s,_=n*Rt+n,o=-h,a=_;t.moveTo(s,e),t.lineTo(h,_),t.lineTo(o,a),t.lineTo(At*s-qt*e,qt*s+At*e),t.lineTo(At*h-qt*_,qt*h+At*_),t.lineTo(At*o-qt*a,qt*o+At*a),t.lineTo(At*s+qt*e,At*e-qt*s),t.lineTo(At*h+qt*_,At*_-qt*h),t.lineTo(At*o+qt*a,At*a-qt*o),t.closePath()}},Ot=Math.sqrt(3),jt={draw:function(t,i){var n=-Math.sqrt(i/(3*Ot));t.moveTo(0,2*n),t.lineTo(-Ot*n,-n),t.lineTo(Ot*n,-n),t.closePath()}},Bt=[gt,mt,bt,wt,Pt,jt,zt],It=\"0.1.0\";t.version=It,t.arc=c,t.area=d,t.basisClosed=b,t.basisOpen=N,t.basis=T,t.bundle=E,t.cardinalClosed=R,t.cardinalOpen=z,t.cardinal=A,t.catmullRomClosed=L,t.catmullRomOpen=D,t.catmullRom=B,t.circle=gt,t.cross=mt,t.diamond=bt,t.linearClosed=G,t.linear=f,t.line=H,t.monotone=X,t.natural=$,t.pie=nt,t.radialArea=ht,t.radialLine=_t,t.square=wt,t.star=Pt,t.stepAfter=at,t.stepBefore=lt,t.step=ut,t.symbol=xt,t.symbols=Bt,t.triangle=jt,t.wye=zt});\n\n/* https://github.com/d3/d3-timer Copyright 2015 Mike Bostock */\n!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?e(exports):\"function\"==typeof define&&define.amd?define(\"d3-timer\",[\"exports\"],e):e(t.d3_timer={})}(this,function(t){\"use strict\";function e(t,e,n){this.id=++c,this.restart(t,e,n)}function n(t,n,i){return new e(t,n,i)}function i(t){t=null==t?Date.now():+t,++l;try{for(var e,n=a;n;)t>=n.time&&(e=n.callback)(t-n.time,t),n=n.next}finally{--l}}function o(){l=f=0;try{i()}finally{for(var t,e=a,n=1/0;e;)e.callback?(n>e.time&&(n=e.time),e=(t=e).next):e=t?t.next=e.next:a=e.next;u=t,r(n)}}function r(t){if(!l){f&&(f=clearTimeout(f));var e=t-Date.now();e>24?1/0>t&&(f=setTimeout(o,e)):(l=1,s(o))}}var a,u,l=0,f=0,c=0,m={},s=\"undefined\"!=typeof window&&(window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame)||function(t){return setTimeout(t,17)};e.prototype=n.prototype={restart:function(t,e,n){if(\"function\"!=typeof t)throw new TypeError(\"callback is not a function\");n=(null==n?Date.now():+n)+(null==e?0:+e);var i=this.id,o=m[i];o?(o.callback=t,o.time=n):(o={next:null,callback:t,time:n},u?u.next=o:a=o,m[i]=u=o),r()},stop:function(){var t=this.id,e=m[t];e&&(e.callback=null,e.time=1/0,delete m[t],r())}};var d=\"0.0.6\";t.version=d,t.timer=n,t.timerFlush=i});\n\nvar paths = document.querySelectorAll(\"path\");\n\nvar symbol = d3_shape.symbol().size(2500);\n\nd3_timer.timer(function(elapsed) {\n  Array.prototype.forEach.call(paths, function(path) {\n    path.setAttribute(\"d\", symbol.type(d3_shape[path.getAttribute(\"data-type\")])());\n    path.setAttribute(\"transform\", \"rotate(\" + elapsed / 20 + \")\");\n  });\n});\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"9bb03ccc3a4a0ec77675ff843072811d93f1eb52"},"sort":[1449593913000]},{"_index":"blockbuilder","_type":"blocks","_id":"c2b2a129696be78830d8","_score":null,"_source":{"userId":"mbostock","description":"T-minus Time","created_at":"2015-12-04T23:03:35Z","updated_at":"2016-02-09T01:48:31Z","api":["d3.format","d3.time.scale.utc","d3.time.minute.utc.offset","d3.svg.axis","d3.select"],"colors":["#000000"],"readme":"Although we think of time as absolute—a specific moment—computers typically represent time *relative* to a particular epoch. The most common epoch is the [Unix epoch](https://en.wikipedia.org/wiki/Unix_time) of 00:00:00 UTC on January 1, 1970.\n\nSometimes, however, we may want to display time relative to a particular event, such as [T-minus time](https://en.wikipedia.org/wiki/Countdown) for a rocket launch. This example demonstrates how to go back and forth betwen the two time spaces, converting standard UTC times to relative times. Note that we want to compute the axis ticks relative to the epoch, too. Since the relative time space is simply a translation of the absolute time space (*i.e.*, both have exactly 24 hours a day), a second translated time scale can be used to compute the ticks while keeping the primary time scale in absolute time.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n.axis text {\n  font: 10px sans-serif;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar epoch = new Date(Date.UTC(2015, 11, 4, 12, 36, 47, 121));\n\nvar pad = d3.format(\"02d\");\n\nvar margin = {top: 250, right: 40, bottom: 250, left: 40},\n    width = 960 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar x = d3.time.scale.utc()\n    .domain([d3.time.minute.utc.offset(epoch, -1), d3.time.minute.utc.offset(epoch, +5)])\n    .range([0, width]);\n\nvar xAxis = d3.svg.axis()\n    .scale(x)\n    .orient(\"bottom\")\n    .tickFormat(formatRelativeTime)\n    .tickValues(d3.time.scale.utc() // Compute ticks relative to epoch.\n        .domain(x.domain().map(toRelative))\n        .ticks(10)\n        .map(toAbsolute));\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nsvg.append(\"g\")\n    .attr(\"class\", \"axis\")\n    .call(xAxis);\n\n// Format an absolute time relative to the epoch (e.g., thirty seconds after the\n// epoch is formatted as \"T+0:30\").\nfunction formatRelativeTime(absolute) {\n  var delta = absolute - epoch;\n  if (!delta) return \"T\";\n  var milliseconds = Math.abs(delta);\n  return \"T\" + (delta < 0 ? \"-\" : \"+\")\n      + Math.floor(milliseconds / 6e4) + \":\"\n      + pad(Math.floor(milliseconds % 6e4 / 1e3));\n}\n\n// Convert an absolute time to a time relative to the epoch.\nfunction toRelative(absolute) {\n  return new Date(absolute - epoch);\n}\n\n// Convert a time relative to the epoch to an absolute time.\nfunction toAbsolute(relative) {\n  return new Date(+relative + +epoch);\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"3035bd27ac22386548529f7db50ce7bbf19d5dbe"},"sort":[1449270215000]},{"_index":"blockbuilder","_type":"blocks","_id":"3e961b4c97a1b543fff2","_score":null,"_source":{"userId":"mbostock","description":"Pie Padding","created_at":"2015-12-02T17:04:42Z","updated_at":"2016-02-09T01:48:33Z","api":["d3.arc","d3.pie","d3.timer"],"colors":["#777777","#cccccc","#000000"],"readme":"This animation demonstrates the benefit of setting [*pie*.padAngle](https://github.com/d3/d3-shape#pie_padAngle) directly: the relative areas of arcs are preserved. Setting [*arc*.padAngle](https://github.com/d3/d3-shape#arc_padAngle) [instead](/mbostock/053fcc2295a445afab07) disproportionately affects small arcs, introducing bias.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar data = [1, 1, 2, 3, 5, 8, 13, 21];\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height,\n    outerRadius = height / 2 - 30,\n    innerRadius = outerRadius / 3;\n\nvar arc = d3.arc()\n    .innerRadius(innerRadius)\n    .outerRadius(outerRadius)\n    .context(context);\n\nvar pie = d3.pie();\n\nvar ease = d3.easeCubicInOut,\n    duration = 2500;\n\nd3.timer(function(elapsed) {\n  var t = ease(1 - Math.abs((elapsed % duration) / duration - 0.5) * 2),\n      arcs = pie.padAngle(0.06 * t)(data);\n\n  context.save();\n  context.clearRect(0, 0, width, height);\n  context.translate(width / 2, height / 2);\n\n  context.beginPath();\n  arcs.forEach(arc.padAngle(0));\n  context.lineWidth = 1;\n  context.strokeStyle = \"#777\";\n  context.stroke();\n\n  context.beginPath();\n  arcs.forEach(arc.padAngle(0.06 * t));\n  context.fillStyle = \"#ccc\";\n  context.fill();\n  context.lineWidth = 1.5;\n  context.lineJoin = \"round\";\n  context.strokeStyle = \"#000\";\n  context.stroke();\n\n  context.restore();\n});\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"67456bf1d5fbc2cc96e6c09920d06d63c307d39e"},"sort":[1449075882000]},{"_index":"blockbuilder","_type":"blocks","_id":"053fcc2295a445afab07","_score":null,"_source":{"userId":"mbostock","description":"Arc Padding","created_at":"2015-12-02T17:01:52Z","updated_at":"2016-02-09T01:48:38Z","api":["d3.arc","d3.pie","d3.timer"],"colors":["#777777","#cccccc","#000000"],"readme":"This animation demonstrates the pitfall of setting [*arc*.padAngle](https://github.com/d3/d3-shape#arc_padAngle) directly: small arcs are disproportionately affected, introducing bias. If you set [*pie*.padAngle](https://github.com/d3/d3-shape#pie_padAngle) [instead](/mbostock/3e961b4c97a1b543fff2), the relative areas of arcs are preserved.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar data = [1, 1, 2, 3, 5, 8, 13, 21];\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height,\n    outerRadius = height / 2 - 30,\n    innerRadius = outerRadius / 3;\n\nvar arc = d3.arc()\n    .innerRadius(innerRadius)\n    .outerRadius(outerRadius)\n    .context(context);\n\nvar pie = d3.pie();\n\nvar ease = d3.easeCubicInOut,\n    duration = 2500;\n\nd3.timer(function(elapsed) {\n  var t = ease(1 - Math.abs((elapsed % duration) / duration - 0.5) * 2),\n      arcs = pie(data);\n\n  context.save();\n  context.clearRect(0, 0, width, height);\n  context.translate(width / 2, height / 2);\n\n  context.beginPath();\n  arcs.forEach(arc.padAngle(0));\n  context.lineWidth = 1;\n  context.strokeStyle = \"#777\";\n  context.stroke();\n\n  context.beginPath();\n  arcs.forEach(arc.padAngle(0.06 * t));\n  context.fillStyle = \"#ccc\";\n  context.fill();\n  context.lineWidth = 1.5;\n  context.lineJoin = \"round\";\n  context.strokeStyle = \"#000\";\n  context.stroke();\n\n  context.restore();\n});\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"f818e01b51ac53f57f15e1450c6edb6855cdecdb"},"sort":[1449075712000]},{"_index":"blockbuilder","_type":"blocks","_id":"963c4d246e96963856bf","_score":null,"_source":{"userId":"mbostock","description":"Kernel Smoothing","created_at":"2015-12-01T23:33:03Z","updated_at":"2016-05-04T16:23:16Z","api":["d3.utcParse","d3.scaleUtc","d3.scaleLinear","d3.symbol","d3.line","d3.requestCsv","d3.extent","d3.max","d3.curveLinear"],"colors":["#4682b4","#0000ff","#000000"],"readme":"A quick-and-dirty attempt at [kernel smoothing](https://en.wikipedia.org/wiki/Kernel_smoother). See [d3/d3-shape#43](https://github.com/d3/d3-shape/issues/43).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar parseTime = d3.utcParse(\"%H:%M\");\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar margin = {top: 40, right: 40, bottom: 40, left: 40},\n    width = canvas.width - margin.left - margin.right,\n    height = canvas.height - margin.top - margin.bottom;\n\nvar x = d3.scaleUtc()\n    .range([0, width]);\n\nvar y = d3.scaleLinear()\n    .range([height, 0]);\n\nvar symbol = d3.symbol()\n    .context(context);\n\nvar line = d3.line()\n    .x(function(d) { return x(d.time); })\n    .y(function(d) { return y(d.count); })\n    .curve(kernelSmooth, 50, 100)\n    .context(context);\n\ncontext.translate(margin.left, margin.top);\n\nd3.requestCsv(\"data.csv\", function(d) {\n  d.time = parseTime(d.time);\n  d.count = +d.count;\n  return d;\n}, function(error, data) {\n  if (error) throw error;\n\n  x.domain(d3.extent(data, function(d) { return d.time; })).nice(d3.utcDay);\n  y.domain([0, d3.max(data, function(d) { return d.count; })]);\n\n  context.globalAlpha = 0.5;\n  context.lineWidth = 1;\n  context.strokeStyle = \"steelblue\";\n  data.forEach(function(d) {\n    context.save();\n    context.translate(x(d.time), y(d.count));\n    context.beginPath();\n    symbol(d);\n    context.stroke();\n    context.restore();\n  });\n\n  context.beginPath();\n  line(data);\n  context.globalAlpha = 1;\n  context.lineWidth = 2;\n  context.strokeStyle = \"black\";\n  context.stroke();\n});\n\nfunction epanechnikov(u) {\n  return (u *= u) <= 1 ? 0.75 * (1 - u) : 0;\n}\n\nfunction kernelSmooth(context, bandwidth, count) {\n  var linear = d3.curveLinear(context), x0 = Infinity, x1 = -x0, xv, yv;\n  return {\n    lineStart: function() {\n      xv = [], yv = [];\n    },\n    lineEnd: function() {\n      linear.lineStart();\n      for (var x = x0, dx = (x1 - x0) / count; x <= x1; x += dx) {\n        for (var j = 0, yi = 0, wi = 0, m = xv.length; j < m; ++j) {\n          var wji = epanechnikov((xv[j] - x) / bandwidth);\n          wi += wji, yi += yv[j] * wji;\n        }\n        linear.point(x, yi / wi);\n      }\n      linear.lineEnd();\n    },\n    point: function(x, y) {\n      xv.push(x = +x), yv.push(+y);\n      if (x < x0) x0 = x;\n      if (x > x1) x1 = x;\n    }\n  };\n}\n\n</script>\n","filenames":[".block","README.md","data.csv","index.html","thumbnail.png"],"thumb":"ec6751c97578a8f571d99e0395e505086633a742"},"sort":[1449012783000]},{"_index":"blockbuilder","_type":"blocks","_id":"0533f44f2cfabecc5e3a","_score":null,"_source":{"userId":"mbostock","description":"Line with Missing Data","created_at":"2015-12-01T21:42:38Z","updated_at":"2016-04-29T14:08:49Z","api":["d3.range","d3.scaleLinear","d3.line","d3.select","d3.axisBottom","d3.axisLeft"],"colors":["#000000","#b0c4de","#4682b4","#0000ff","#ffffff"],"readme":"A demonstration of [*line*.defined](https://github.com/mbostock/d3/wiki/SVG-Shapes#line_defined).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  font: 10px sans-serif;\n}\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n.area {\n  fill: lightsteelblue;\n}\n\n.line {\n  fill: none;\n  stroke: steelblue;\n  stroke-width: 1.5px;\n}\n\n.dot {\n  fill: white;\n  stroke: steelblue;\n  stroke-width: 1.5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v4.0.0-alpha.4.min.js\"></script>\n<script>\n\nvar data = d3.range(40).map(function(i) {\n  return i % 5 ? {x: i / 39, y: (Math.sin(i / 3) + 2) / 4} : null;\n});\n\nvar margin = {top: 40, right: 40, bottom: 40, left: 40},\n    width = 960 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar x = d3.scaleLinear()\n    .range([0, width]);\n\nvar y = d3.scaleLinear()\n    .range([height, 0]);\n\nvar line = d3.line()\n    .defined(function(d) { return d; })\n    .x(function(d) { return x(d.x); })\n    .y(function(d) { return y(d.y); });\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .datum(data)\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nsvg.append(\"g\")\n    .attr(\"class\", \"axis axis--x\")\n    .attr(\"transform\", \"translate(0,\" + height + \")\")\n    .call(d3.axisBottom().scale(x));\n\nsvg.append(\"g\")\n    .attr(\"class\", \"axis axis--y\")\n    .call(d3.axisLeft().scale(y));\n\nsvg.append(\"path\")\n    .attr(\"class\", \"line\")\n    .attr(\"d\", line);\n\nsvg.selectAll(\".dot\")\n    .data(data.filter(function(d) { return d; }))\n  .enter().append(\"circle\")\n    .attr(\"class\", \"dot\")\n    .attr(\"cx\", line.x())\n    .attr(\"cy\", line.y())\n    .attr(\"r\", 3.5);\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"cb9dafee40dad0fe5b44fe824b22f1a0fc93c6c4"},"sort":[1449006158000]},{"_index":"blockbuilder","_type":"blocks","_id":"d8bcc4b130df420d6c40","_score":null,"_source":{"userId":"mbostock","description":"Time of Day","created_at":"2015-12-01T04:57:40Z","updated_at":"2016-04-29T14:04:34Z","api":["d3.time.format.utc","d3.time.scale.utc","d3.time.day.utc.offset","d3.scale.linear","d3.select","d3.csv","d3.max","d3.svg.axis","d3.svg.symbol"],"colors":["#000000","#4682b4","#0000ff"],"readme":"This graph plots the observed rate of tweets for [Eric Fischer’s Twitter feed](https://twitter.com/enf/status/671475255202967553) over the period from January 8, 2015 through November 30, 2015.\n\nThis graph uses a [time scale](https://github.com/d3/d3-scale#time-scales) to plot time-of-day. Time scales are normally used to plot absolute time: a specific moment on a specific day in a specific year. Here, though, we’re interested in studying the daily pattern, so data from many days is collapsed onto a single day. (That day happens to be January 1, 1900, but the choice is arbitrary as long as we’re consistent.)\n\nOne wrinkle here is that the data is stored in UTC, but we want to view the pattern in Eric’s local time. To do this, we offset the time by seven hours, since the majority of the data was collected during Pacific Daylight Time (-0700). However, this is incorrect because *some* of the data was collected during Pacific Standard Time (-0800). Since the local time zone offset changed during data collection, the pattern is somewhat blurred. To fix this, you would need to aggregate the data by local time-of-day instead of UTC time-of-day.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.dots path {\n  fill: none;\n  stroke: steelblue;\n  stroke-width: 1.5px;\n}\n\n.axis path,\n.axis line {\n  fill: none;\n  stroke: #000;\n  shape-rendering: crispEdges;\n}\n\n.axis--y line {\n  stroke-opacity: 0.2;\n}\n\n.axis--y path {\n  stroke: none;\n}\n\n.axis text {\n  font: 10px sans-serif;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar parseTime = d3.time.format.utc(\"%H:%M\").parse,\n    midnight = parseTime(\"00:00\");\n\nvar margin = {top: 30, right: 30, bottom: 30, left: 30},\n    width = 960 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar x = d3.time.scale.utc()\n    .domain([midnight, d3.time.day.utc.offset(midnight, 1)])\n    .range([0, width]);\n\nvar y = d3.scale.linear()\n    .range([height, 0]);\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nd3.csv(\"tweets.csv\", type, function(error, data) {\n  if (error) throw error;\n\n  y.domain([0, d3.max(data, function(d) { return d.rate; })]);\n\n  svg.append(\"g\")\n      .attr(\"class\", \"axis axis--x\")\n      .attr(\"transform\", \"translate(0,\" + height + \")\")\n      .call(d3.svg.axis()\n          .scale(x)\n          .orient(\"bottom\")\n          .tickFormat(d3.time.format.utc(\"%I %p\")));\n\n  svg.append(\"g\")\n      .attr(\"class\", \"dots\")\n    .selectAll(\"path\")\n      .data(data)\n    .enter().append(\"path\")\n      .attr(\"transform\", function(d) { return \"translate(\" + x(d.time) + \",\" + y(d.rate) + \")\"; })\n      .attr(\"d\", d3.svg.symbol()\n          .size(40));\n\n  var tick = svg.append(\"g\")\n      .attr(\"class\", \"axis axis--y\")\n      .call(d3.svg.axis()\n          .scale(y)\n          .tickSize(-width)\n          .orient(\"left\"))\n    .select(\".tick:last-of-type\");\n\n  var title = tick.append(\"text\")\n      .attr(\"dy\", \".32em\")\n      .text(\"tweets per hour\");\n\n  tick.select(\"line\")\n      .attr(\"x1\", title.node().getBBox().width + 6);\n});\n\nfunction type(d) {\n  d.rate = +d.count / 327 * 60; // January 8 to November 30\n  d.time = parseTime(d.time);\n  d.time.setUTCHours((d.time.getUTCHours() + 24 - 7) % 24);\n  return d;\n}\n\n</script>\n","filenames":["README.md","index.html","thumbnail.png","tweets.csv"],"thumb":"f415348b1e992527ab135d3a4ae92977411fd0fc"},"sort":[1448945860000]},{"_index":"blockbuilder","_type":"blocks","_id":"c66ab1426f4b8945a7ef","_score":null,"_source":{"userId":"mbostock","description":"Wave Motion\n","created_at":"2015-11-29T16:44:26Z","updated_at":"2016-02-09T01:48:45Z","api":[],"colors":["#999999","#d2b48c"],"readme":"A recreation of a [lovely GIF](http://beesandbombs.tumblr.com/post/45513650541/orbiters) by Dave Whyte. As the [Exploratorium explains](https://twitter.com/exploratorium/status/670667375172329472), “Wave motion at the surface of water is made up of small circular motions of parcels of water.”\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ncanvas {\n  position: absolute;\n}\n\n</style>\n<canvas id=\"canvas-back\" width=\"960\" height=\"500\"></canvas>\n<canvas id=\"canvas-front\" width=\"960\" height=\"500\"></canvas>\n<script>\n\n/* https://github.com/d3/d3-timer Copyright 2015 Mike Bostock */\n!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?e(exports):\"function\"==typeof define&&define.amd?define(\"d3-timer\",[\"exports\"],e):e(t.d3_timer={})}(this,function(t){\"use strict\";function e(t,e,n){this.id=++c,this.restart(t,e,n)}function n(t,n,i){return new e(t,n,i)}function i(t){t=null==t?Date.now():+t,++l;try{for(var e,n=a;n;)t>=n.time&&(e=n.callback)(t-n.time,t),n=n.next}finally{--l}}function o(){l=f=0;try{i()}finally{for(var t,e=a,n=1/0;e;)e.callback?(n>e.time&&(n=e.time),e=(t=e).next):e=t?t.next=e.next:a=e.next;u=t,r(n)}}function r(t){if(!l){f&&(f=clearTimeout(f));var e=t-Date.now();e>24?1/0>t&&(f=setTimeout(o,e)):(l=1,s(o))}}var a,u,l=0,f=0,c=0,m={},s=\"undefined\"!=typeof window&&(window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame)||function(t){return setTimeout(t,17)};e.prototype=n.prototype={restart:function(t,e,n){if(\"function\"!=typeof t)throw new TypeError(\"callback is not a function\");n=(null==n?Date.now():+n)+(null==e?0:+e);var i=this.id,o=m[i];o?(o.callback=t,o.time=n):(o={next:null,callback:t,time:n},u?u.next=o:a=o,m[i]=u=o),r()},stop:function(){var t=this.id,e=m[t];e&&(e.callback=null,e.time=1/0,delete m[t],r())}};var d=\"0.0.6\";t.version=d,t.timer=n,t.timerFlush=i});\n\nvar canvasBack = document.getElementById(\"canvas-back\"),\n    canvasFront = document.getElementById(\"canvas-front\");\n\nvar width = canvasBack.width,\n    height = canvasBack.height,\n    ringRadius = 24,\n    ringSeparation = 1.1 * ringRadius,\n    dotRadius = 3.5,\n    n = (width + ringRadius) / ringSeparation,\n    m = (height + ringRadius) / ringSeparation;\n\nvar contextBack,\n    contextFront,\n    scale = window.devicePixelRatio;\n\nif (scale > 1) {\n  canvasFront.style.width = canvasBack.style.width = width + \"px\";\n  canvasFront.style.height = canvasBack.style.height = height + \"px\";\n  canvasFront.width = canvasBack.width = width * scale;\n  canvasFront.height = canvasBack.height = height * scale;\n  contextBack = canvasBack.getContext(\"2d\");\n  contextFront = canvasFront.getContext(\"2d\");\n  contextBack.scale(scale, scale);\n  contextFront.scale(scale, scale);\n} else {\n  contextBack = canvasBack.getContext(\"2d\");\n  contextFront = canvasFront.getContext(\"2d\");\n}\n\ncontextBack.strokeStyle = \"#999\";\nfor (var i = -1; i < n; ++i) {\n  for (var j = -1; j < m; ++j) {\n    contextBack.beginPath();\n    contextBack.arc(i * ringSeparation, j * ringSeparation, ringRadius, 0, 2 * Math.PI);\n    contextBack.stroke();\n  }\n}\n\nd3_timer.timer(function(elapsed) {\n  contextFront.clearRect(0, 0, width, height);\n  for (var i = -1; i < n; ++i) {\n    for (var j = -1; j < m; ++j) {\n      contextFront.save();\n      contextFront.beginPath();\n      contextFront.translate(i * ringSeparation, j * ringSeparation);\n      contextFront.rotate((i + j) / 6 + elapsed / 200);\n      contextFront.arc(ringRadius, 0, dotRadius, 0, 2 * Math.PI);\n      contextFront.fill();\n      contextFront.restore();\n    }\n  }\n});\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"163aca0910d6d1889e90068066dd9ad5e8e14b79"},"sort":[1448815466000]},{"_index":"blockbuilder","_type":"blocks","_id":"1401b7a1459f2ffa975e","_score":null,"_source":{"userId":"mbostock","description":"Rounded Arc Test","created_at":"2015-11-20T23:56:23Z","updated_at":"2016-02-09T01:48:48Z","api":[],"colors":["#d2b48c","#777777","#cccccc","#000000"],"readme":"A test of rounded (and padded) arcs rendered to Canvas using [d3-shape](https://github.com/d3/d3-shape).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"d3.min.js\"></script>\n<script>\n\nvar data = [1, 1, 2, 3, 5, 8, 13, 21];\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar width = canvas.width,\n    height = canvas.height,\n    outerRadius = height / 2 - 30,\n    innerRadius = outerRadius / 3;\n\nvar arc = d3_shape.arc()\n    .innerRadius(innerRadius)\n    .outerRadius(outerRadius)\n    .context(context);\n\nvar pie = d3_shape.pie()\n    .padAngle(0.03);\n\nvar ease = d3_ease.cubicInOut,\n    duration = 2500;\n\nd3_timer.timer(function(elapsed) {\n  var t = ease(1 - Math.abs((elapsed % duration) / duration - 0.5) * 2),\n      arcs = pie(data);\n\n  context.save();\n  context.clearRect(0, 0, width, height);\n  context.translate(width / 2, height / 2);\n\n  context.beginPath();\n  arcs.forEach(arc.cornerRadius(0));\n  context.lineWidth = 1;\n  context.strokeStyle = \"#777\";\n  context.stroke();\n\n  context.beginPath();\n  arcs.forEach(arc.cornerRadius((outerRadius - innerRadius) / 2 * t));\n  context.fillStyle = \"#ccc\";\n  context.fill();\n  context.lineWidth = 1.5;\n  context.lineJoin = \"round\";\n  context.strokeStyle = \"#000\";\n  context.stroke();\n\n  context.restore();\n});\n\n</script>\n","filenames":[".block","README.md","d3.min.js","index.html","thumbnail.png"],"thumb":"f677131e075315ce8abc14fe0df5cd2102b3fea1"},"sort":[1448063783000]},{"_index":"blockbuilder","_type":"blocks","_id":"22c3971eed37127f2ba8","_score":null,"_source":{"userId":"mbostock","description":"Catmull–Rom Curves","created_at":"2015-11-13T22:33:04Z","updated_at":"2015-11-18T08:13:37Z","api":[],"colors":["#d2b48c","#ffffff"],"readme":"Cubic Catmull–Rom curves with (b) uniform, (c) chordal and (d) centripetal parameterization. From [Yuksel et. al](http://www.cemyuksel.com/research/catmullrom_param/): “Uniform parameterization overshoots and often generates cusps and intersections within short curve segments, while chord-length parameterization exhibits similar behavior for longer curve segments. Centripetal parameterization is the only one that guarantees no intersections within curve segments.”\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ndiv {\n  margin: 0 122px;\n  width: 715px;\n  height: 471px;\n  overflow: hidden;\n  position: relative;\n}\n\ncanvas,\nimg {\n  position: absolute;\n}\n\n</style>\n<div>\n  <img src=\"example-uniform.png\" style=\"left:-3px;top:-1px;\">\n  <canvas data-alpha=\"0.0\" width=\"715\" height=\"471\"></canvas>\n</div>\n<div>\n  <img src=\"example-chordal.png\" style=\"left:-4px;top:-2px;\">\n  <canvas data-alpha=\"1.0\" width=\"715\" height=\"471\"></canvas>\n</div>\n<div>\n  <img src=\"example-centripetal.png\" style=\"left:-4px;top:-1px;\">\n  <canvas data-alpha=\"0.5\" width=\"715\" height=\"471\"></canvas>\n</div>\n<script src=\"d3.js\"></script>\n<script>\n\nvar points = [\n  [133.5, 424.0],\n  [ 56.5, 352.0],\n  [344.0,  73.0],\n  [360.5,  88.0],\n  [593.0, 412.5],\n  [621.5, 386.0],\n  [662.5, 129.0]\n];\n\n[].forEach.call(document.querySelectorAll(\"canvas\"), function(canvas) {\n  var context = canvas.getContext(\"2d\");\n\n  var line = d3_shape.line()\n      .context(context)\n      .interpolate(\"catmull-rom\", canvas.getAttribute(\"data-alpha\"));\n\n  context.beginPath();\n  line(points);\n  context.lineWidth = 1.5;\n  context.strokeStyle = \"white\";\n  context.stroke();\n});\n\nif (self.frameElement) self.frameElement.style.height = 471 * 3 + \"px\";\n\n</script>\n","filenames":["README.md","d3.js","example-centripetal.png","example-chordal.png","example-uniform.png","index.html","thumbnail.png"],"thumb":"0d221b9e36e0b1cdaab38b72cac9aeaea8d22364"},"sort":[1447453984000]},{"_index":"blockbuilder","_type":"blocks","_id":"9bd540de6728a1fb9343","_score":null,"_source":{"userId":"mbostock","description":"New Splines!","created_at":"2015-11-09T22:37:33Z","updated_at":"2015-12-25T18:38:58Z","api":["d3.scale.category10","d3.shape.line"],"colors":["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#ffc0cb","#ffb6c1","#ff69b4","#ff1493","#db7093","#c71585","#ffa07a","#fa8072","#e9967a","#f08080","#cd5c5c","#dc143c","#b22222","#8b0000","#ff0000","#ff4500","#ff6347","#ff7f50","#ff8c00","#ffa500","#ffff00","#ffffe0","#fffacd","#fafad2","#ffefd5","#ffe4b5","#ffdab9","#eee8aa","#f0e68c","#bdb76b","#ffd700","#fff8dc","#ffebcd","#ffe4c4","#ffdead","#f5deb3","#deb887","#d2b48c","#bc8f8f","#f4a460","#daa520","#b8860b","#cd853f","#d2691e","#8b4513","#a0522d","#a52a2a","#800000","#556b2f","#808000","#6b8e23","#9acd32","#32cd32","#00ff00","#7cfc00","#7fff00","#adff2f","#00ff7f","#00fa9a","#90ee90","#98fb98","#8fbc8f","#3cb371","#2e8b57","#228b22","#008000","#006400","#66cdaa","#00ffff","#e0ffff","#afeeee","#7fffd4","#40e0d0","#48d1cc","#00ced1","#20b2aa","#5f9ea0","#008b8b","#008080","#b0c4de","#b0e0e6","#add8e6","#87ceeb","#87cefa","#00bfff","#1e90ff","#6495ed","#4682b4","#4169e1","#0000ff","#0000cd","#00008b","#000080","#191970","#e6e6fa","#d8bfd8","#dda0dd","#ee82ee","#da70d6","#ff00ff","#ba55d3","#9370db","#8a2be2","#9400d3","#9932cc","#8b008b","#800080","#4b0082","#483d8b","#663399","#6a5acd","#7b68ee","#ffffff","#fffafa","#f0fff0","#f5fffa","#f0ffff","#f0f8ff","#f8f8ff","#f5f5f5","#fff5ee","#f5f5dc","#fdf5e6","#fffaf0","#fffff0","#faebd7","#faf0e6","#fff0f5","#ffe4e1","#dcdcdc","#d3d3d3","#c0c0c0","#a9a9a9","#808080","#696969","#778899","#708090","#2f4f4f","#000000"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"d3.min.js\"></script>\n<script>\n\nvar points = [\n  [  0,   0],\n  [ 90,   0],\n  [180,  15],\n  [270,  73],\n  [360, 293],\n  [450, 308],\n  [540, 323],\n  [630, 367],\n  [720, 411],\n  [810, 425],\n  [900, 425]\n];\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar margin = {top: 30, right: 30, bottom: 30, left: 30},\n    width = canvas.width - margin.left - margin.right,\n    height = canvas.height - margin.top - margin.bottom,\n    radius = 3.5;\n\nvar color = d3.scale.category10()\n    .domain([\n      \"cubic\",\n      \"catmull-rom:0.0\",\n      \"catmull-rom:0.5\",\n      \"catmull-rom:1.0\"\n    ]);\n\nvar line = d3.shape.line()\n    .context(context);\n\ncontext.translate(margin.left, margin.top);\n\n// Axes\ncontext.moveTo(0.5, height + 0.5);\ncontext.lineTo(0.5, 0.5);\ncontext.moveTo(0.5, height + 0.5);\ncontext.lineTo(width + 0.5, height + 0.5);\ncontext.stroke();\n\n// Points\npoints.forEach(function(d) {\n  context.beginPath();\n  context.moveTo(d[0] + radius, d[1]);\n  context.arc(d[0], d[1], radius, 0, 2 * Math.PI, true);\n  context.fill();\n});\n\n// Splines\ncolor.domain().forEach(function(i) {\n  var parts = i.split(\":\"), name = parts[0], value = +parts[1];\n  context.beginPath();\n  line.interpolate(name, value)(points);\n  context.lineWidth = 1.5;\n  context.strokeStyle = color(i);\n  context.stroke();\n});\n\n</script>\n","filenames":[".gitignore","d3.js","d3.min.js","index.html","package.json","rollup.config.js","thumbnail.png"],"thumb":"e2870578747bf76e529842a154c418a0e7e781fe"},"sort":[1447108653000]},{"_index":"blockbuilder","_type":"blocks","_id":"3dd515e692504c92ab65","_score":null,"_source":{"userId":"mbostock","description":"Fitted Symbols","created_at":"2015-10-22T04:21:55Z","updated_at":"2016-02-09T01:48:51Z","api":["d3.select","d3.svg.symbol"],"colors":["#aaaaaa"],"readme":"This example demonstrates how to scale a D3 symbol to fit inside a specified rectangular bounding box using getBBox.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nrect {\n  fill: none;\n  stroke: #aaa;\n  stroke-width: 2px;\n  shape-rendering: crispEdges;\n}\n\n</style>\n<svg width=\"960\" height=\"500\">\n  <rect width=\"400\" height=\"400\" x=\"280\" y=\"50\"/>\n  <g transform=\"translate(480,250)\">\n    <path id=\"symbol\"/>\n  </g>\n</svg>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar path = d3.select(\"path\"),\n    rect = d3.select(\"rect\"),\n    width = +rect.attr(\"width\"),\n    height = +rect.attr(\"height\");\n\nvar symbol = d3.svg.symbol(),\n    symbolIndex = -1,\n    symbolTypes = d3.svg.symbolTypes;\n\nsetInterval(function() {\n  symbolIndex = (symbolIndex + 1) % symbolTypes.length;\n  symbol.type(symbolTypes[symbolIndex]);\n  path.attr(\"d\", symbol.size(64));\n\n  var box = path.node().getBBox(),\n      error = Math.min(width / box.width, height / box.height);\n\n  path.transition().duration(1500).attr(\"d\", symbol.size(error * error * 64));\n}, 2000);\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"a7c2aee06dc16e29be68b85330792fd53b610740"},"sort":[1445487715000]},{"_index":"blockbuilder","_type":"blocks","_id":"3f987887d5c2148661ae","_score":null,"_source":{"userId":"mbostock","description":"Transition to Default","created_at":"2015-10-22T02:50:05Z","updated_at":"2016-02-09T01:48:54Z","api":["d3.select","d3.hcl"],"colors":["#333333"],"readme":"This example demonstrates how to transition back to a default style value after setting an inline style. Inside transition.style, temporarily remove the style to retrieve its default value; then restore the style before starting the transition.\n\nIn a future version of D3 (see [related issue](https://github.com/mbostock/d3/issues/2396)), transition.style(name, null) will probably do this for you automatically, rather than its current behavior of immediately removing the specified style at the start of the transition.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\ncircle {\n  fill: #333;\n}\n\n</style>\n<svg width=\"960\" height=\"500\">\n  <circle cx=\"480\" cy=\"250\" r=\"200\"/>\n</svg>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nsetInterval(function() {\n  d3.select(\"circle\")\n      .style(\"fill\", d3.hcl(Math.random() * 360, 100, 50))\n    .transition()\n      .duration(2000)\n      .style(\"fill\", function() {\n        var that = d3.select(this),\n            fill0 = that.style(\"fill\"),\n            fill1 = that.style(\"fill\", null).style(\"fill\");\n        that.style(\"fill\", fill0);\n        return fill1;\n      });\n}, 2500);\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"b7923a373ccc488acd3df2cee673d1a4e2bf8304"},"sort":[1445482205000]},{"_index":"blockbuilder","_type":"blocks","_id":"62d550b83fada6dc3005","_score":null,"_source":{"userId":"mbostock","description":"Nightly Show","created_at":"2015-10-21T15:43:11Z","updated_at":"2016-02-09T01:48:58Z","api":["d3.geo.mollweide","d3.geo.path","d3.geo.graticule","d3.select","d3.json"],"colors":["#fcfcfa","#000000","#ffffff","#777777","#222222"],"readme":"A guess at the map projection used by [The Nightly Show with Larry Wilmore](http://www.cc.com/shows/the-nightly-show).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  background: #fcfcfa;\n}\n\n.stroke {\n  fill: none;\n  stroke: #000;\n  stroke-width: 3px;\n}\n\n.fill {\n  fill: #fff;\n}\n\n.graticule {\n  fill: none;\n  stroke: #777;\n  stroke-width: .5px;\n  stroke-opacity: .5;\n}\n\n.land {\n  fill: #222;\n}\n\n.boundary {\n  fill: none;\n  stroke: #fff;\n  stroke-width: .5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script src=\"//d3js.org/d3.geo.projection.v0.min.js\"></script>\n<script src=\"//d3js.org/topojson.v1.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 500;\n\nvar projection = d3.geo.mollweide()\n    .scale(165)\n    .translate([width / 2, height / 2])\n    .rotate([25, 180])\n    .precision(.1);\n\nvar path = d3.geo.path()\n    .projection(projection);\n\nvar graticule = d3.geo.graticule();\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height);\n\nsvg.append(\"defs\").append(\"path\")\n    .datum({type: \"Sphere\"})\n    .attr(\"id\", \"sphere\")\n    .attr(\"d\", path);\n\nsvg.append(\"use\")\n    .attr(\"class\", \"stroke\")\n    .attr(\"xlink:href\", \"#sphere\");\n\nsvg.append(\"use\")\n    .attr(\"class\", \"fill\")\n    .attr(\"xlink:href\", \"#sphere\");\n\nsvg.append(\"path\")\n    .datum(graticule)\n    .attr(\"class\", \"graticule\")\n    .attr(\"d\", path);\n\nd3.json(\"/mbostock/raw/4090846/world-50m.json\", function(error, world) {\n  if (error) throw error;\n\n  svg.insert(\"path\", \".graticule\")\n      .datum(topojson.feature(world, world.objects.land))\n      .attr(\"class\", \"land\")\n      .attr(\"d\", path);\n\n  svg.insert(\"path\", \".graticule\")\n      .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))\n      .attr(\"class\", \"boundary\")\n      .attr(\"d\", path);\n});\n\nd3.select(self.frameElement).style(\"height\", height + \"px\");\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"3d6e54983393938e8365bec0592bdae856d55b31"},"sort":[1445442191000]},{"_index":"blockbuilder","_type":"blocks","_id":"c034d66572fd6bd6815a","_score":null,"_source":{"userId":"mbostock","description":"Tree of Life","created_at":"2015-10-19T18:29:51Z","updated_at":"2016-03-30T03:46:40Z","api":["d3.scale.category10","d3.layout.cluster","d3.ascending","d3.select","d3.text","d3.transition","d3.max"],"colors":["#000000","#ff0000","#d2b48c","#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],"readme":"A re-implementation of Jason Davies’ [Phylogenetic Tree of Life](https://www.jasondavies.com/tree-of-life/), with faded gray lines to connect the leaf nodes of the tree to their corresponding labels inspired by [a figure from *Nature*](http://www.nature.com/nature/journal/v462/n7276/fig_tab/nature08656_F1.html).\n\nThis implementation modifies the depth of interior nodes in a [cluster layout](https://github.com/mbostock/d3/wiki/Cluster-Layout) to show branch lengths. Toggle the checkbox in the top-left corner to show or hide branch lengths, and mouseover a label to highlight its path to the root.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n  margin: 0;\n}\n\n#show-length {\n  position: absolute;\n  top: 10px;\n  left: 10px;\n}\n\n.links {\n  fill: none;\n  stroke: #000;\n}\n\n.link-extensions {\n  fill: none;\n  stroke: #000;\n  stroke-opacity: .25;\n}\n\n.labels {\n  font: 10px sans-serif;\n}\n\n.link--active {\n  stroke: #000 !important;\n  stroke-width: 1.5px;\n}\n\n.link-extension--active {\n  stroke-opacity: .6;\n}\n\n.label--active {\n  font-weight: bold;\n}\n\n</style>\n<label id=\"show-length\">\n  <input type=\"checkbox\"> Show branch length\n</label>\n\n<!-- Copyright 2011 Jason Davies https://github.com/jasondavies/newick.js -->\n<script>function parseNewick(a){for(var e=[],r={},s=a.split(/\\s*(;|\\(|\\)|,|:)\\s*/),t=0;t<s.length;t++){var n=s[t];switch(n){case\"(\":var c={};r.branchset=[c],e.push(r),r=c;break;case\",\":var c={};e[e.length-1].branchset.push(c),r=c;break;case\")\":r=e.pop();break;case\":\":break;default:var h=s[t-1];\")\"==h||\"(\"==h||\",\"==h?r.name=n:\":\"==h&&(r.length=parseFloat(n))}}return r}</script>\n\n<!-- Copyright 2015 Mike Bostock http://d3js.org -->\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar outerRadius = 960 / 2,\n    innerRadius = outerRadius - 170;\n\nvar color = d3.scale.category10()\n    .domain([\"Bacteria\", \"Eukaryota\", \"Archaea\"]);\n\nvar cluster = d3.layout.cluster()\n    .size([360, innerRadius])\n    .children(function(d) { return d.branchset; })\n    .value(function(d) { return 1; })\n    .sort(function(a, b) { return (a.value - b.value) || d3.ascending(a.length, b.length); })\n    .separation(function(a, b) { return 1; });\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", outerRadius * 2)\n    .attr(\"height\", outerRadius * 2);\n\nvar legend = svg.append(\"g\")\n    .attr(\"class\", \"legend\")\n  .selectAll(\"g\")\n    .data(color.domain())\n  .enter().append(\"g\")\n    .attr(\"transform\", function(d, i) { return \"translate(\" + (outerRadius * 2 - 10) + \",\" + (i * 20 + 10) + \")\"; });\n\nlegend.append(\"rect\")\n    .attr(\"x\", -18)\n    .attr(\"width\", 18)\n    .attr(\"height\", 18)\n    .style(\"fill\", color);\n\nlegend.append(\"text\")\n    .attr(\"x\", -24)\n    .attr(\"y\", 9)\n    .attr(\"dy\", \".35em\")\n    .style(\"text-anchor\", \"end\")\n    .text(function(d) { return d; });\n\nvar chart = svg.append(\"g\")\n    .attr(\"transform\", \"translate(\" + outerRadius + \",\" + outerRadius + \")\");\n\nd3.text(\"life.txt\", function(error, life) {\n  if (error) throw error;\n\n  var root = parseNewick(life),\n      nodes = cluster.nodes(root),\n      links = cluster.links(nodes),\n      input = d3.select(\"#show-length input\").on(\"change\", changed),\n      timeout = setTimeout(function() { input.property(\"checked\", true).each(changed); }, 2000);\n\n  setRadius(root, root.length = 0, innerRadius / maxLength(root));\n  setColor(root);\n\n  var linkExtension = chart.append(\"g\")\n      .attr(\"class\", \"link-extensions\")\n    .selectAll(\"path\")\n      .data(links.filter(function(d) { return !d.target.children; }))\n    .enter().append(\"path\")\n      .each(function(d) { d.target.linkExtensionNode = this; })\n      .attr(\"d\", function(d) { return step(d.target.x, d.target.y, d.target.x, innerRadius); });\n\n  var link = chart.append(\"g\")\n      .attr(\"class\", \"links\")\n    .selectAll(\"path\")\n      .data(links)\n    .enter().append(\"path\")\n      .each(function(d) { d.target.linkNode = this; })\n      .attr(\"d\", function(d) { return step(d.source.x, d.source.y, d.target.x, d.target.y) })\n      .style(\"stroke\", function(d) { return d.target.color; });\n\n  chart.append(\"g\")\n      .attr(\"class\", \"labels\")\n    .selectAll(\"text\")\n      .data(nodes.filter(function(d) { return !d.children; }))\n    .enter().append(\"text\")\n      .attr(\"dy\", \".31em\")\n      .attr(\"transform\", function(d) { return \"rotate(\" + (d.x - 90) + \")translate(\" + (innerRadius + 4) + \",0)\" + (d.x < 180 ? \"\" : \"rotate(180)\"); })\n      .style(\"text-anchor\", function(d) { return d.x < 180 ? \"start\" : \"end\"; })\n      .text(function(d) { return d.name.replace(/_/g, \" \"); })\n      .on(\"mouseover\", mouseovered(true))\n      .on(\"mouseout\", mouseovered(false));\n\n  function changed() {\n    clearTimeout(timeout);\n    var checked = this.checked;\n    d3.transition().duration(750).each(function() {\n      linkExtension.transition().attr(\"d\", function(d) { return step(d.target.x, checked ? d.target.radius : d.target.y, d.target.x, innerRadius); });\n      link.transition().attr(\"d\", function(d) { return step(d.source.x, checked ? d.source.radius : d.source.y, d.target.x, checked ? d.target.radius : d.target.y) });\n    });\n  }\n\n  function mouseovered(active) {\n    return function(d) {\n      d3.select(this).classed(\"label--active\", active);\n      d3.select(d.linkExtensionNode).classed(\"link-extension--active\", active).each(moveToFront);\n      do d3.select(d.linkNode).classed(\"link--active\", active).each(moveToFront); while (d = d.parent);\n    };\n  }\n\n  function moveToFront() {\n    this.parentNode.appendChild(this);\n  }\n});\n\n// Compute the maximum cumulative length of any node in the tree.\nfunction maxLength(d) {\n  return d.length + (d.children ? d3.max(d.children, maxLength) : 0);\n}\n\n// Set the radius of each node by recursively summing and scaling the distance from the root.\nfunction setRadius(d, y0, k) {\n  d.radius = (y0 += d.length) * k;\n  if (d.children) d.children.forEach(function(d) { setRadius(d, y0, k); });\n}\n\n// Set the color of each node by recursively inheriting.\nfunction setColor(d) {\n  d.color = color.domain().indexOf(d.name) >= 0 ? color(d.name) : d.parent ? d.parent.color : null;\n  if (d.children) d.children.forEach(setColor);\n}\n\n// Like d3.svg.diagonal.radial, but with square corners.\nfunction step(startAngle, startRadius, endAngle, endRadius) {\n  var c0 = Math.cos(startAngle = (startAngle - 90) / 180 * Math.PI),\n      s0 = Math.sin(startAngle),\n      c1 = Math.cos(endAngle = (endAngle - 90) / 180 * Math.PI),\n      s1 = Math.sin(endAngle);\n  return \"M\" + startRadius * c0 + \",\" + startRadius * s0\n      + (endAngle === startAngle ? \"\" : \"A\" + startRadius + \",\" + startRadius + \" 0 0 \" + (endAngle > startAngle ? 1 : 0) + \" \" + startRadius * c1 + \",\" + startRadius * s1)\n      + \"L\" + endRadius * c1 + \",\" + endRadius * s1;\n}\n\nd3.select(self.frameElement).style(\"height\", outerRadius * 2 + \"px\");\n\n</script>\n","filenames":[".block","README.md","index.html","life.txt","thumbnail.png"],"thumb":"e1bc5534439c4b56b338310529bbeac26dcc2d93"},"sort":[1445279391000]},{"_index":"blockbuilder","_type":"blocks","_id":"e787e283b8cf9d5a8f8a","_score":null,"_source":{"userId":"mbostock","description":"D3 Logo","created_at":"2015-10-16T18:41:38Z","updated_at":"2016-02-09T01:49:04Z","api":[],"colors":[],"readme":"The official D3 logo is available is several forms in the [d3-logo repository](https://github.com/d3/d3-logo).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<img width=\"960\" height=\"500\" src=\"d3.svg\">\n","filenames":[".block","README.md","d3.svg","index.html","thumbnail.png"],"thumb":"4b3e5a0508aa06c64e9f6dc39774d8801b3f930d"},"sort":[1445020898000]},{"_index":"blockbuilder","_type":"blocks","_id":"bc4e32ec71636b498c46","_score":null,"_source":{"userId":"mbostock","description":"Animated D3 Logo","created_at":"2015-10-16T04:33:43Z","updated_at":"2016-02-09T01:49:09Z","api":["d3.select","d3.selectAll"],"colors":["#cccccc","#000000","#ddeeee"],"readme":"Animating the [D3 logo](/mbostock/c9455b842a01f6907020) as if it were being drawn by hand.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.fill {\n  fill: #ccc;\n}\n\n.stroke {\n  fill: none;\n  stroke: #000;\n  stroke-width: 20px;\n}\n\n</style>\n<svg width=\"960\" height=\"500\" viewBox=\"-10 -10 116 111\">\n  <defs>\n    <path id=\"dee\" d=\"M0,0h7.75a45.5,45.5 0 1 1 0,91h-7.75v-20h7.75a25.5,25.5 0 1 0 0,-51h-7.75z\"/>\n    <path id=\"three\" d=\"M36.2510,0h32a27.75,27.75 0 0 1 21.331,45.5a27.75,27.75 0 0 1 -21.331,45.5h-32a53.6895,53.6895 0 0 0 18.7464,-20h13.2526a7.75,7.75 0 1 0 0,-15.5h-7.75a53.6895,53.6895 0 0 0 0,-20h7.75a7.75,7.75 0 1 0 0,-15.5h-13.2526a53.6895,53.6895 0 0 0 -18.7464,-20z\"/>\n    <clipPath id=\"clip-three\">\n      <use xlink:href=\"#three\"/>\n    </clipPath>\n  </defs>\n  <use class=\"fill\" xlink:href=\"#dee\"/>\n  <use class=\"fill\" xlink:href=\"#three\"/>\n  <path class=\"stroke\" style=\"display:none;\" d=\"M0,10h7.75a35.5,35.5 0 1 1 0,71h-7.75\"/>\n  <path class=\"stroke\" style=\"display:none;\" clip-path=\"url(#clip-three)\" d=\"M36.2510,10h32a17.75,17.75 0 0 1 0,35.5h-7.75h7.75a17.75,17.75 0 0 1 0,35.5h-32\"/>\n</svg>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nd3.select(this)\n    .on(\"touchstart\", animate)\n    .on(\"click\", animate)\n    .on(\"load\", animate);\n\nfunction animate() {\n  var delay = 0,\n      stroke = d3.selectAll(\".stroke\");\n\n  // First cancel any active or scheduled transitions.\n  stroke.interrupt().transition();\n\n  // Then schedule the new transition.\n  stroke.transition().each(function() {\n    var length = this.getTotalLength(),\n        duration = length * 20;\n\n    d3.select(this)\n        .style(\"display\", null)\n        .style(\"stroke-dasharray\", \"0,\" + length)\n      .transition()\n        .delay(delay)\n        .duration(duration)\n        .style(\"stroke-dasharray\", length + \",\" + length);\n\n    delay += duration;\n  });\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"9f03e291949f11b96fd8fbad9067f854162764ff"},"sort":[1444970023000]},{"_index":"blockbuilder","_type":"blocks","_id":"c9455b842a01f6907020","_score":null,"_source":{"userId":"mbostock","description":"Revised D3 Logo","created_at":"2015-10-16T03:51:49Z","updated_at":"2016-02-09T01:49:11Z","api":[],"colors":["#bbbbbb","#000000"],"readme":"An updated, more geometrically precise implementation of the [D3 logo](https://github.com/d3/d3-logo) using strictly circular arcs and lines (rather than cubic Béziers). Some of the points are computed using circle-line and [circle-circle](https://gist.github.com/mbostock/3095037) intersection.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.fill {\n  fill: #bbb;\n}\n\n.point {\n  fill: #000;\n}\n\n.line,\n.circle,\n.point--intersection {\n  fill: none;\n  stroke: #000;\n  stroke-width: .15px;\n}\n\n.line {\n  stroke-opacity: .3;\n}\n\n.point--intersection {\n  display: none;\n}\n\n</style>\n<svg width=\"960\" height=\"500\" viewBox=\"-10 -10 116 111\">\n  <path class=\"fill\" d=\"\n    M0,0\n    h7.75\n    a45.5,45.5 0 1 1 0,91\n    h-7.75\n    v-20\n    h7.75\n    a25.5,25.5 0 1 0 0,-51\n    h-7.75\n    z\n    m36.2510,0\n    h32\n    a27.75,27.75 0 0 1 21.331,45.5\n    a27.75,27.75 0 0 1 -21.331,45.5\n    h-32\n    a53.6895,53.6895 0 0 0 18.7464,-20\n    h13.2526\n    a7.75,7.75 0 1 0 0,-15.5\n    h-7.75\n    a53.6895,53.6895 0 0 0 0,-20\n    h7.75\n    a7.75,7.75 0 1 0 0,-15.5\n    h-13.2526\n    a53.6895,53.6895 0 0 0 -18.7464,-20\n    z\"/>\n\n  <line class=\"line line--horizontal\" x1=\"-100\" x2=\"200\" y1=\"0\" y2=\"0\"/>\n  <line class=\"line line--horizontal\" x1=\"-100\" x2=\"200\" y1=\"20\" y2=\"20\"/>\n  <line class=\"line line--horizontal\" x1=\"-100\" x2=\"200\" y1=\"35.5\" y2=\"35.5\"/>\n  <line class=\"line line--horizontal\" x1=\"-100\" x2=\"200\" y1=\"45.5\" y2=\"45.5\"/>\n  <line class=\"line line--horizontal\" x1=\"-100\" x2=\"200\" y1=\"55.5\" y2=\"55.5\"/>\n  <line class=\"line line--horizontal\" x1=\"-100\" x2=\"200\" y1=\"71\" y2=\"71\"/>\n  <line class=\"line line--horizontal\" x1=\"-100\" x2=\"200\" y1=\"91\" y2=\"91\"/>\n\n  <line class=\"line line--vertical\" x1=\"0\" x2=\"0\" y1=\"-100\" y2=\"200\"/>\n  <line class=\"line line--vertical\" x1=\"7.75\" x2=\"7.75\" y1=\"-100\" y2=\"200\"/>\n  <line class=\"line line--vertical\" x1=\"60.5\" x2=\"60.5\" y1=\"-100\" y2=\"200\"/> <!-- XXX  -->\n  <line class=\"line line--vertical\" x1=\"68.25\" x2=\"68.25\" y1=\"-100\" y2=\"200\"/>\n  <line class=\"line line--vertical\" x1=\"96\" x2=\"96\" y1=\"-100\" y2=\"200\"/>\n\n  <circle class=\"point\" cx=\"7.75\" cy=\"45.5\" r=\".5\"/>\n  <circle class=\"circle\" cx=\"7.75\" cy=\"45.5\" r=\"25.5\"/>\n  <circle class=\"circle\" cx=\"7.75\" cy=\"45.5\" r=\"45.5\"/>\n\n  <!-- Radius is computed to intersect at the intended x=60.5. -->\n  <circle class=\"circle\" cx=\"7.75\" cy=\"45.5\" r=\"53.6895\"/>\n\n  <!-- Intersecting horizontal lines with the r=53.6895 circle. -->\n  <circle class=\"point point--intersection\" cx=\"36.2510\" cy=\"0\" r=\".5\"/>\n  <circle class=\"point point--intersection\" cx=\"54.9974\" cy=\"20\" r=\".5\"/>\n  <circle class=\"point point--intersection\" cx=\"60.5\" cy=\"35.5\" r=\".5\"/>\n  <circle class=\"point point--intersection\" cx=\"60.5\" cy=\"55.5\" r=\".5\"/>\n  <circle class=\"point point--intersection\" cx=\"54.9974\" cy=\"71\" r=\".5\"/>\n  <circle class=\"point point--intersection\" cx=\"36.2510\" cy=\"91\" r=\".5\"/>\n\n  <!-- Intersecting the two r=27.75 circles. -->\n  <circle class=\"point point--intersection\" cx=\"89.5807\" cy=\"45.5\" r=\".5\"/>\n\n  <circle class=\"point\" cx=\"68.25\" cy=\"27.75\" r=\".5\"/>\n  <circle class=\"circle\" cx=\"68.25\" cy=\"27.75\" r=\"7.75\"/>\n  <circle class=\"circle\" cx=\"68.25\" cy=\"27.75\" r=\"27.75\"/>\n\n  <circle class=\"point\" cx=\"68.25\" cy=\"63.25\" r=\".5\"/>\n  <circle class=\"circle\" cx=\"68.25\" cy=\"63.25\" r=\"7.75\"/>\n  <circle class=\"circle\" cx=\"68.25\" cy=\"63.25\" r=\"27.75\"/>\n</svg>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"f83b02bdf16ce0848bfb8100917504f846c32038"},"sort":[1444967509000]},{"_index":"blockbuilder","_type":"blocks","_id":"467f1a0db47753cc630e","_score":null,"_source":{"userId":"mbostock","description":"Improved Circle Packing","created_at":"2015-09-15T17:43:20Z","updated_at":"2016-02-09T01:49:14Z","api":[],"colors":["#1f77b4","#ff7f0e","#ff0000"],"readme":"D3 4.0’s pack layout has been improved by computing the [smallest enclosing circle](/mbostock/29c534ff0b270054a01c) for each node. Compare to [D3 3.x’s implementation](/mbostock/4063530).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"960\"></canvas>\n<script>\n\n/* https://github.com/d3/d3-xhr Copyright 2015 Mike Bostock */\n\"undefined\"==typeof Map?(Map=function(){this.clear()},Map.prototype={set:function(e,n){return this._[e]=n,this},get:function(e){return this._[e]},has:function(e){return e in this._},\"delete\":function(e){return e in this._&&delete this._[e]},clear:function(){this._=Object.create(null)},get size(){var e=0;for(var n in this._)++e;return e},forEach:function(e){for(var n in this._)e(this._[n],n,this)}}):function(){var e=new Map;e.set(0,0)!==e&&(e=e.set,Map.prototype.set=function(){return e.apply(this,arguments),this})}(),function(e,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?n(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],n):n(e.xhr={})}(this,function(e){\"use strict\";function n(e){function n(e,n){var r;return t(e,function(e,t){if(r)return r(e,t-1);var o=new Function(\"d\",\"return {\"+e.map(function(e,n){return JSON.stringify(e)+\": d[\"+n+\"]\"}).join(\",\")+\"}\");r=n?function(e,t){return n(o(e),t)}:o})}function t(e,n){function t(){if(f>=c)return i;if(o)return o=!1,u;var n=f;if(34===e.charCodeAt(n)){for(var t=n;t++<c;)if(34===e.charCodeAt(t)){if(34!==e.charCodeAt(t+1))break;++t}f=t+2;var r=e.charCodeAt(t+1);return 13===r?(o=!0,10===e.charCodeAt(t+2)&&++f):10===r&&(o=!0),e.slice(n+1,t).replace(/\"\"/g,'\"')}for(;c>f;){var r=e.charCodeAt(f++),a=1;if(10===r)o=!0;else if(13===r)o=!0,10===e.charCodeAt(f)&&(++f,++a);else if(r!==s)continue;return e.slice(n,f-a)}return e.slice(n)}for(var r,o,u={},i={},a=[],c=e.length,f=0,l=0;(r=t())!==i;){for(var p=[];r!==u&&r!==i;)p.push(r),r=t();n&&null==(p=n(p,l++))||a.push(p)}return a}function r(n){if(Array.isArray(n[0]))return o(n);var t=Object.create(null),r=[];return n.forEach(function(e){for(var n in e)(n+=\"\")in t||r.push(t[n]=n)}),[r.map(i).join(e)].concat(n.map(function(n){return r.map(function(e){return i(n[e])}).join(e)})).join(\"\\n\")}function o(e){return e.map(u).join(\"\\n\")}function u(n){return n.map(i).join(e)}function i(e){return a.test(e)?'\"'+e.replace(/\\\"/g,'\"\"')+'\"':e}var a=new RegExp('[\"'+e+\"\\n]\"),s=e.charCodeAt(0);return{parse:n,parseRows:t,format:r,formatRows:o}}function t(e,n){return function(t){return e.parse(t.responseText,n)}}function r(e){return function(n,t){e(null==n?t:null)}}function o(e){var n=e.responseType;return n&&\"text\"!==n?e.response:e.responseText}function u(e){function n(e){var n=(e+=\"\").indexOf(\".\"),t=e;if(n>=0?e=e.slice(0,n):t+=\".\",e&&!i.hasOwnProperty(e))throw new Error(\"unknown type: \"+e);return{type:e,name:t}}function t(e){return function(){for(var n,t,r=i[e],o=-1,u=r.length;++o<u;)(t=(n=r[o]).value)&&t.apply(this,arguments);return s}}var r,o=-1,u=e.length,i={},a={},s=this;for(s.on=function(e,t){if(e=n(e),arguments.length<2)return(t=a[e.name])&&t.value;if(e.type){var r,o=i[e.type],u=a[e.name];u&&(u.value=null,r=o.indexOf(u),i[e.type]=o=o.slice(0,r).concat(o.slice(r+1)),delete a[e.name]),t&&(t={value:t},a[e.name]=t,o.push(t))}else if(null==t)for(var c in i)if(t=a[c+e.name]){t.value=null;var o=i[c],r=o.indexOf(t);i[c]=o.slice(0,r).concat(o.slice(r+1)),delete a[t.name]}return s};++o<u;){if(r=e[o]+\"\",!r||r in s)throw new Error(\"illegal or duplicate type: \"+r);i[r]=[],s[r]=t(r)}}function i(){return new u(arguments)}function a(e,n){function t(){var e,n=p.status;if(!n&&o(p)||n>=200&&300>n||304===n){if(s)try{e=s.call(u,p)}catch(t){return void f.error.call(u,t)}else e=p;f.load.call(u,e)}else f.error.call(u,p)}var u,a,s,c,f=i(\"beforesend\",\"progress\",\"load\",\"error\"),l=new Map,p=new XMLHttpRequest;return\"undefined\"==typeof XDomainRequest||\"withCredentials\"in p||!/^(http(s)?:)?\\/\\//.test(e)||(p=new XDomainRequest),\"onload\"in p?p.onload=p.onerror=t:p.onreadystatechange=function(){p.readyState>3&&t()},p.onprogress=function(e){f.progress.call(u,e)},u={header:function(e,n){return e=(e+\"\").toLowerCase(),arguments.length<2?l.get(e):(null==n?l[\"delete\"](e):l.set(e,n+\"\"),u)},mimeType:function(e){return arguments.length?(a=null==e?null:e+\"\",u):a},responseType:function(e){return arguments.length?(c=e,u):c},response:function(e){return s=e,u},get:function(e,n){return u.send(\"GET\",e,n)},post:function(e,n){return u.send(\"POST\",e,n)},send:function(n,t,o){return o||\"function\"!=typeof t||(o=t,t=null),o&&1===o.length&&(o=r(o)),p.open(n,e,!0),null==a||l.has(\"accept\")||l.set(\"accept\",a+\",*/*\"),p.setRequestHeader&&l.forEach(function(e,n){p.setRequestHeader(n,e)}),null!=a&&p.overrideMimeType&&p.overrideMimeType(a),null!=c&&(p.responseType=c),o&&u.on(\"error\",o).on(\"load\",function(e){o(null,e)}),f.beforesend.call(u,p),p.send(null==t?null:t),u},abort:function(){return p.abort(),u},on:function(){var e=f.on.apply(f,arguments);return e===f?u:e}},n?u.get(n):u}function s(e,n){return function(r,o,u){arguments.length<3&&(u=o,o=null);var i=a(r).mimeType(e);return i.row=function(e){return arguments.length?i.response(t(n,o=e)):o},i.row(o),u?i.get(u):i}}function c(e,n){return function(t,r){var o=a(t).mimeType(e).response(n);return r?o.get(r):o}}var f=n(\" \");i.prototype=u.prototype;var l=s(\"text/tab-separated-values\",f),p=n(\",\"),h=s(\"text/csv\",p),d=c(\"application/xml\",function(e){return e.responseXML}),m=c(\"text/plain\",function(e){return e.responseText}),v=c(\"application/json\",function(e){return JSON.parse(e.responseText)}),g=c(\"text/html\",function(e){return document.createRange().createContextualFragment(e.responseText)});e.xhr=a,e.html=g,e.json=v,e.text=m,e.xml=d,e.csv=h,e.tsv=l});\n\n/* https://github.com/d3/d3-hierarchy Copyright 2015 Mike Bostock */\n!function(n,r){\"object\"==typeof exports&&\"undefined\"!=typeof module?r(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],r):r(n.hierarchy={})}(this,function(n){\"use strict\";function r(n){var r=[];return n.forEach(function(n){n.children&&n.children.forEach(function(e){r.push({source:n,target:e})})}),r}function e(n,e){return n.sort=function(){var r=e.sort.apply(e,arguments);return r===e?n:r},n.children=function(){var r=e.children.apply(e,arguments);return r===e?n:r},n.value=function(){var r=e.value.apply(e,arguments);return r===e?n:r},n.nodes=n,n.links=r,n}function t(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function u(n,r){var e=n.x+r[3],t=n.y+r[0],u=n.dx-r[1]-r[3],a=n.dy-r[0]-r[2];return 0>u&&(e+=u/2,u=0),0>a&&(t+=a/2,a=0),{x:e,y:t,dx:u,dy:a}}function a(n,r){for(var e=[n],t=[];null!=(n=e.pop());)if(t.push(n),(a=n.children)&&(u=a.length))for(var u,a,l=-1;++l<u;)e.push(a[l]);for(;null!=(n=t.pop());)r(n)}function l(n,r){for(var e=[n];null!=(n=e.pop());)if(r(n),(u=n.children)&&(t=u.length))for(var t,u;--t>=0;)e.push(u[t])}function i(n){return n.value}function c(n){return n.children}function o(n,r){return r.value-n.value}function f(){function n(r){var l,i=[r],c=[];for(r.parent=null,r.depth=0;null!=(l=i.pop());)if(c.push(l),(f=t.call(n,l,l.depth))&&(o=f.length)){for(var o,f,h;--o>=0;)i.push(h=f[o]),h.parent=l,h.depth=l.depth+1;u&&(l.value=0),l.children=f}else u&&(l.value=+u.call(n,l,l.depth)||0),delete l.children;return a(r,function(n){var r,t;e&&(r=n.children)&&r.sort(e),u&&(t=n.parent)&&(t.value+=n.value)}),c}var e=o,t=c,u=i;return n.nodes=n,n.links=r,n.sort=function(r){return arguments.length?(e=r,n):e},n.children=function(r){return arguments.length?(t=r,n):t},n.value=function(r){return arguments.length?(u=r,n):u},n.revalue=function(r){return u&&(l(r,function(n){n.children&&(n.value=0)}),a(r,function(r){var e;r.children||(r.value=+u.call(n,r,r.depth)||0),(e=r.parent)&&(e.value+=r.value)})),r},n}function h(){function n(n){var r=x.call(h,n,n.depth);return null==r?t(n):u(n,\"number\"==typeof r?[r,r,r,r]:r)}function r(n){return u(n,x)}function a(n,r){for(var e,t,u=-1,a=n.length;++u<a;)t=(e=n[u]).value*(0>r?0:r),e.area=isNaN(t)||0>=t?0:t}function l(n){var r=n.children;if(r&&r.length){var e,t,u,i=y(n),f=[],h=r.slice(),d=1/0,p=\"slice\"===m?i.dx:\"dice\"===m?i.dy:\"slice-dice\"===m?1&n.depth?i.dy:i.dx:Math.min(i.dx,i.dy);for(a(h,i.dx*i.dy/n.value),f.area=0;(u=h.length)>0;)f.push(e=h[u-1]),f.area+=e.area,\"squarify\"!==m||(t=c(f,p))<=d?(h.pop(),d=t):(f.area-=f.pop().area,o(f,p,i,!1),p=Math.min(i.dx,i.dy),f.length=f.area=0,d=1/0);f.length&&(o(f,p,i,!0),f.length=f.area=0),r.forEach(l)}}function i(n){var r=n.children;if(r&&r.length){var e,t=y(n),u=r.slice(),l=[];for(a(u,t.dx*t.dy/n.value),l.area=0;e=u.pop();)l.push(e),l.area+=e.area,null!=e.z&&(o(l,e.z?t.dx:t.dy,t,!u.length),l.length=l.area=0);r.forEach(i)}}function c(n,r){for(var e,t=n.area,u=0,a=1/0,l=-1,i=n.length;++l<i;)(e=n[l].area)&&(a>e&&(a=e),e>u&&(u=e));return t*=t,r*=r,t?Math.max(r*u*_/t,t/(r*a*_)):1/0}function o(n,r,e,t){var u,a=-1,l=n.length,i=e.x,c=e.y,o=r?v(n.area/r):0;if(r==e.dx){for((t||o>e.dy)&&(o=e.dy);++a<l;)u=n[a],u.x=i,u.y=c,u.dy=o,i+=u.dx=Math.min(e.x+e.dx-i,o?v(u.area/o):0);u.z=!0,u.dx+=e.x+e.dx-i,e.y+=o,e.dy-=o}else{for((t||o>e.dx)&&(o=e.dx);++a<l;)u=n[a],u.x=i,u.y=c,u.dx=o,c+=u.dy=Math.min(e.y+e.dy-c,o?v(u.area/o):0);u.z=!1,u.dy+=e.y+e.dy-c,e.x+=o,e.dx-=o}}function h(n){var r=d||p(n),e=r[0];return e.x=0,e.y=0,e.dx=s[0],e.dy=s[1],d&&p.revalue(e),a([e],e.dx*e.dy/e.value),(d?i:l)(e),g&&(d=r),r}var d,p=f(),v=Number,s=[1,1],x=null,y=t,g=!1,m=\"squarify\",_=V;return h.size=function(n){return arguments.length?(s=[+n[0],+n[1]],h):s.slice()},h.padding=function(e){if(!arguments.length)return Array.isArray(x)?x.slice():x;var u;return y=null==e?(x=null,t):\"function\"==(u=typeof e)?(x=e,n):\"number\"===u?(x=[e,e,e,e],r):(x=[+e[0],+e[1],+e[2],+e[3]],r),h},h.round=function(n){return arguments.length?(v=n?Math.round:Number,h):v!==Number},h.sticky=function(n){return arguments.length?(g=!!n,d=null,h):g},h.ratio=function(n){return arguments.length?(_=+n,h):_},h.mode=function(n){return arguments.length?(m=U.hasOwnProperty(n)?n+\"\":\"squarify\",h):m},e(h,p)}function d(n){var r=n.children;return r.length?r[0]:n.t}function p(n){var r,e=n.children;return(r=e.length)?e[r-1]:n.t}function v(n,r,e){return n.a.parent===r.parent?n.a:e}function s(n,r,e){var t=e/(r.i-n.i);r.c-=t,r.s+=e,n.c+=t,r.z+=e,r.m+=e}function x(n){for(var r,e=0,t=0,u=n.children,a=u.length;--a>=0;)r=u[a],r.z+=e,r.m+=e,e+=r.s+(t+=r.c)}function y(n,r){return n.parent===r.parent?1:2}function g(){function n(n,e){var i=o.call(this,n,e),f=i[0],d=r(f);if(a(d,t),d.parent.m=-d.z,l(d,u),m)l(f,c);else{var p=f,v=f,s=f;l(f,function(n){n.x<p.x&&(p=n),n.x>v.x&&(v=n),n.depth>s.depth&&(s=n)});var x=h(p,v)/2-p.x,y=g[0]/(v.x+h(v,p)/2+x),_=g[1]/(s.depth||1);l(f,function(n){n.x=(n.x+x)*y,n.y=n.depth*_})}return i}function r(n){for(var r,e={A:null,children:[n]},t=[e];null!=(r=t.pop());)for(var u,a=r.children,l=0,i=a.length;i>l;++l)t.push((a[l]=u={_:a[l],parent:r,children:(u=a[l].children)&&u.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:l}).a=u);return e.children[0]}function t(n){var r=n.children,e=n.parent.children,t=n.i?e[n.i-1]:null;if(r.length){x(n);var u=(r[0].z+r[r.length-1].z)/2;t?(n.z=t.z+h(n._,t._),n.m=n.z-u):n.z=u}else t&&(n.z=t.z+h(n._,t._));n.parent.A=i(n,t,n.parent.A||e[0])}function u(n){n._.x=n.z+n.parent.m,n.m+=n.parent.m}function i(n,r,e){if(r){for(var t,u=n,a=n,l=r,i=u.parent.children[0],c=u.m,o=a.m,f=l.m,x=i.m;l=p(l),u=d(u),l&&u;)i=d(i),a=p(a),a.a=n,t=l.z+f-u.z-c+h(l._,u._),t>0&&(s(v(l,n,e),n,t),c+=t,o+=t),f+=l.m,c+=u.m,x+=i.m,o+=a.m;l&&!p(a)&&(a.t=l,a.m+=f-o),u&&!d(i)&&(i.t=u,i.m+=c-x,e=n)}return e}function c(n){n.x*=g[0],n.y=n.depth*g[1]}var o=f().sort(null).value(null),h=y,g=[1,1],m=null;return n.separation=function(r){return arguments.length?(h=r,n):h},n.size=function(r){return arguments.length?(m=null==(g=r)?c:null,n):m?null:g},n.nodeSize=function(r){return arguments.length?(m=null==(g=r)?null:c,n):m?g:null},e(n,o)}function m(n){var r,e,t=n.children,u=0;if(t)for(r=0,e=t.length;e>r;++r)u=Math.max(u,m(t[r]));return 1+u}function _(n,r,e,t){var u=n.children;if(n.x=r,n.y=n.depth*t,n.dx=e,n.dy=t,u&&(a=u.length)){var a,l,i,c=-1;for(e=n.value?e/n.value:0;++c<a;)_(l=u[c],r,i=l.value*e,t),r+=i}}function k(){function n(n,e){var u=r.call(this,n,e);return _(u[0],0,t[0],t[1]/m(u[0])),u}var r=f(),t=[1,1];return n.size=function(r){return arguments.length?(t=[+r[0],+r[1]],n):t.slice()},e(n,r)}function z(n,r,e,t){var u=n.children;if(n.x=r+=t*n.x,n.y=e+=t*n.y,n.r*=t,u)for(var a=-1,l=u.length;++a<l;)z(u[a],r,e,t)}function M(n){delete n._pack_next,delete n._pack_prev}function b(n){for(var r,e=(n=n.slice()).length,t=null,u=t;e;){var a={id:n.length-e,value:n[e-1],next:null};u=u?u.next=a:t=a,n[r]=n[--e]}return{head:t,tail:u}}function q(n,r){var e=n.x-r.x,t=n.y-r.y;return Math.sqrt(e*e+t*t)<n.r-r.r+1e-6}function A(n,r,e){var t=n.x,u=n.y,a=n.r,l=r.x,i=r.y,c=r.r,o=e.x,f=e.y,h=e.r,d=2*(t-l),p=2*(u-i),v=2*(c-a),s=t*t+u*u-a*a-l*l-i*i+c*c,x=2*(t-o),y=2*(u-f),g=2*(h-a),m=t*t+u*u-a*a-o*o-f*f+h*h,_=x*p-d*y,k=(p*m-y*s)/_-t,z=(y*v-p*g)/_,M=(x*s-d*m)/_-u,b=(d*g-x*v)/_,q=z*z+b*b-1,A=2*(k*z+M*b+a),E=k*k+M*M-a*a,N=(-A-Math.sqrt(A*A-4*q*E))/(2*q);return{x:k+z*N+t,y:M+b*N+u,r:N}}function E(n,r){var e=n.x,t=n.y,u=n.r,a=r.x,l=r.y,i=r.r,c=a-e,o=l-t,f=i-u,h=Math.sqrt(c*c+o*o);return{x:(e+a+c/h*f)/2,y:(t+l+o/h*f)/2,r:(h+u+i)/2}}function N(n,r){var e,t,u,a=null,l=n.head;switch(r.length){case 1:e=r[0];break;case 2:e=E(r[0],r[1]);break;case 3:e=A(r[0],r[1],r[2])}for(;l;)u=l.value,t=l.next,e&&q(e,u)?a=l:(a?(n.tail=a,a.next=null):n.head=n.tail=null,r.push(u),e=N(n,r),r.pop(),n.head?(l.next=n.head,n.head=l):(l.next=null,n.head=n.tail=l),a=n.tail,a.next=t),l=t;return n.tail=a,e}function w(n){return N(b(n),[])}function S(n,r){var e=n._pack_next;n._pack_next=r,r._pack_prev=n,r._pack_next=e,e._pack_prev=r}function j(n,r){n._pack_next=r,r._pack_prev=n}function O(n,r){var e=r.x-n.x,t=r.y-n.y,u=n.r+r.r;return.999*u*u>e*e+t*t}function P(n,r,e){var t=n.r+e.r,u=r.x-n.x,a=r.y-n.y;if(t&&(u||a)){var l=r.r+e.r,i=u*u+a*a;l*=l,t*=t;var c=.5+(t-l)/(2*i),o=Math.sqrt(Math.max(0,2*l*(t+i)-(t-=i)*t-l*l))/(2*i);e.x=n.x+c*u+o*a,e.y=n.y+c*a-o*u}else e.x=n.x+t,e.y=n.y}function B(n){n._pack_next=n._pack_prev=n}function C(n){if((r=n.children)&&(c=r.length)){var r,e,t,u,a,l,i,c;if(r.forEach(B),e=r[0],e.x=-e.r,e.y=0,c>1&&(t=r[1],t.x=t.r,t.y=0,c>2))for(u=r[2],P(e,t,u),S(e,u),e._pack_prev=u,S(u,t),t=e._pack_next,a=3;c>a;a++){P(e,t,u=r[a]);var o=0,f=1,h=1;for(l=t._pack_next;l!==t;l=l._pack_next,f++)if(O(l,u)){o=1;break}if(1==o)for(i=e._pack_prev;i!==l._pack_prev&&!O(i,u);i=i._pack_prev,h++);o?(h>f||f==h&&t.r<e.r?j(e,t=l):j(e=i,t),a--):(S(e,u),t=u)}var u=w(r);for(a=0;c>a;++a)e=r[a],e.x-=u.x,e.y-=u.y;n.r=u.r,r.forEach(M)}}function D(n,r){return n.value-r.value}function F(){function n(n,e){var i=t.call(this,n,e),c=i[0],o=l[0],f=l[1],h=null==r?Math.sqrt:\"function\"==typeof r?r:function(){return r};if(c.x=c.y=0,a(c,function(n){n.r=+h(n.value)}),a(c,C),u){var d=u*(r?1:Math.max(2*c.r/o,2*c.r/f))/2;a(c,function(n){n.r+=d}),a(c,C),a(c,function(n){n.r-=d})}return z(c,o/2,f/2,r?1:1/Math.max(2*c.r/o,2*c.r/f)),i}var r,t=f().sort(D),u=0,l=[1,1];return n.size=function(r){return arguments.length?(l=[+r[0],+r[1]],n):l.slice()},n.radius=function(e){return arguments.length?(r=null==e||\"function\"==typeof e?e:+e,n):r},n.padding=function(r){return arguments.length?(u=+r,n):u},e(n,t)}function G(n){for(var r,e;(r=n.children)&&(e=r.length);)n=r[e-1];return n}function H(n){for(var r;(r=n.children)&&r.length;)n=r[0];return n}function I(n){return 1+n.reduce(function(n,r){return Math.max(n,r.y)},0)}function J(n){return n.reduce(function(n,r){return n+r.x},0)/n.length}function K(){function n(n,e){var i,c=r.call(this,n,e),o=c[0],f=0;a(o,function(n){var r=n.children;r&&r.length?(n.x=J(r),n.y=I(r)):(n.x=i?f+=t(n,i):0,n.y=0,i=n)});var h=H(o),d=G(o),p=h.x-t(h,d)/2,v=d.x+t(d,h)/2;return a(o,l?function(n){n.x=(n.x-o.x)*u[0],n.y=(o.y-n.y)*u[1]}:function(n){n.x=(n.x-p)/(v-p)*u[0],n.y=(1-(o.y?n.y/o.y:1))*u[1]}),c}var r=f().sort(null).value(null),t=y,u=[1,1],l=!1;return n.separation=function(r){return arguments.length?(t=r,n):t},n.size=function(r){return arguments.length?(l=null==(u=r),n):l?null:u},n.nodeSize=function(r){return arguments.length?(l=null!=(u=r),n):l?u:null},e(n,r)}function L(n){for(var r=[],e=n.parent;null!=e;)r.push(n),n=e,e=e.parent;return r.push(n),r}function Q(n,r){if(n===r)return n;var e=L(n),t=L(r),u=null;for(n=e.pop(),r=t.pop();n===r;)u=n,n=e.pop(),r=t.pop();return u}function R(n,r){for(var e=Q(n,r),t=[n];n!==e;)n=n.parent,t.push(n);for(var u=t.length;r!==e;)t.splice(u,0,r),r=r.parent;return t}function T(){return function(n){for(var r,e=-1,t=n.length,u=new Array(t);++e<t;)r=n[e],u[e]=R(r.source,r.end);return u}}var U={slice:1,dice:1,\"slice-dice\":1,squarify:1},V=(1+Math.sqrt(5))/2;n.bundle=T,n.cluster=K,n.links=r,n.pack=F,n.partition=k,n.tree=g,n.treemap=h});\n\nvar canvas = document.querySelector(\"canvas\"),\n    context = canvas.getContext(\"2d\");\n\nvar tau = 2 * Math.PI,\n    margin = 2,\n    diameter = canvas.width;\n\nvar pack = hierarchy.pack()\n    .size([diameter - margin * 2, diameter - margin * 2]);\n\nxhr.json(\"flare.json\", function(error, root) {\n  if (error) throw error;\n\n  context.translate(margin, margin);\n  context.strokeStyle = \"rgb(31,119,180)\";\n  pack.nodes(root).forEach(function(node) {\n    context.beginPath();\n    context.moveTo(node.x + node.r, node.y);\n    context.arc(node.x, node.y, node.r, 0, tau);\n    context.fillStyle = node.children ? \"rgba(31,119,180,.25)\" : \"rgb(255,127,14)\";\n    context.fill();\n    context.stroke();\n  });\n});\n\nif (self.frameElement) self.frameElement.style.height = diameter + \"px\";\n\n</script>\n","filenames":[".block","README.md","flare.json","index.html","thumbnail.png"],"thumb":"1ff3cb13f92a4e3acdb860b1070df9461706d251"},"sort":[1442339000000]},{"_index":"blockbuilder","_type":"blocks","_id":"533daf20348023dfdd76","_score":null,"_source":{"userId":"mbostock","description":"Link Nodes by Name","created_at":"2015-09-15T04:08:46Z","updated_at":"2016-02-29T21:24:40Z","api":["d3.layout.force","d3.select","d3.json","d3.map"],"colors":["#000000","#999999","#d2b48c"],"readme":"This example shows how to link nodes in a [force-directed graph](/mbostock/4062045) using a named identifier rather than a numeric index.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.node {\n  stroke: #000;\n  stroke-width: 1.5px;\n}\n\n.link {\n  stroke: #999;\n  stroke-width: 1.5px;\n}\n\n</style>\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 500;\n\nvar force = d3.layout.force()\n    .charge(-200)\n    .linkDistance(40)\n    .size([width, height]);\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height);\n\nd3.json(\"graph.json\", function(error, graph) {\n  if (error) throw error;\n\n  var nodeById = d3.map();\n\n  graph.nodes.forEach(function(node) {\n    nodeById.set(node.id, node);\n  });\n\n  graph.links.forEach(function(link) {\n    link.source = nodeById.get(link.source);\n    link.target = nodeById.get(link.target);\n  });\n\n  force\n      .nodes(graph.nodes)\n      .links(graph.links)\n      .start();\n\n  var link = svg.selectAll(\".link\")\n      .data(graph.links)\n    .enter().append(\"line\")\n      .attr(\"class\", \"link\");\n\n  var node = svg.selectAll(\".node\")\n      .data(graph.nodes)\n    .enter().append(\"circle\")\n      .attr(\"class\", \"node\")\n      .attr(\"r\", 6)\n      .style(\"fill\", function(d) { return d.id; })\n      .call(force.drag);\n\n  force.on(\"tick\", function() {\n    link.attr(\"x1\", function(d) { return d.source.x; })\n        .attr(\"y1\", function(d) { return d.source.y; })\n        .attr(\"x2\", function(d) { return d.target.x; })\n        .attr(\"y2\", function(d) { return d.target.y; });\n\n    node.attr(\"cx\", function(d) { return d.x; })\n        .attr(\"cy\", function(d) { return d.y; });\n  });\n});\n\n</script>\n","filenames":[".block","README.md","graph.json","index.html","thumbnail.png"],"thumb":"eaf24cec5dad45a73d4ae330550bb71ff058cf36"},"sort":[1442290126000]},{"_index":"blockbuilder","_type":"blocks","_id":"29c534ff0b270054a01c","_score":null,"_source":{"userId":"mbostock","description":"Smallest Enclosing Circle","created_at":"2015-08-05T18:04:35Z","updated_at":"2016-02-09T01:49:19Z","api":["d3.select","d3.behavior.drag"],"colors":["#000000"],"readme":"The smallest circle that encloses a set of given circles can be computed using a variant of [Welzl’s algorithm](https://en.wikipedia.org/wiki/Smallest-circle_problem). Instead of testing whether a circle contains a point, test whether a circle contains another circle; likewise instead of computing the circle that intersects two or three points, compute the circle that has internal tangents to two or three circles. (The latter is [Apollonius’ problem](http://bl.ocks.org/mbostock/751fdd637f4bc2e3f08b).)\n\nDrag the circles to see the enclosing circle change.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.circle {\n  fill-opacity: .5;\n}\n\n.ring {\n  fill: none;\n  stroke: #000;\n  pointer-events: none;\n}\n\n.ring-inner {\n  stroke-width: 5px;\n  stroke-opacity: .25;\n}\n\n</style>\n<svg width=\"960\" height=\"500\"></svg>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar circles = [\n  {x: 380, y: 250, r: 80},\n  {x: 600, y: 100, r: 20},\n  {x: 600, y: 300, r: 120},\n  {x: 500, y: 150, r: 40},\n  {x: 450, y: 400, r: 20}\n];\n\nvar svg = d3.select(\"svg\");\n\nvar circle = svg.selectAll(\".circle\")\n    .data(circles)\n  .enter().append(\"g\")\n    .attr(\"class\", \"circle\")\n    .attr(\"transform\", function(d) { return \"translate(\" + d.x + \",\" + d.y + \")\"; })\n    .call(d3.behavior.drag()\n        .origin(function(d) { return d; })\n        .on(\"dragstart\", dragstarted)\n        .on(\"drag\", dragged));\n\ncircle.append(\"circle\")\n    .attr(\"r\", function(d) { return d.r; });\n\nvar ring = svg.append(\"g\")\n    .attr(\"class\", \"ring\");\n\nring.append(\"circle\")\n    .attr(\"class\", \"ring-outer\");\n\nring.append(\"circle\")\n    .attr(\"class\", \"ring-inner\");\n\nupdate();\n\nfunction dragstarted(d) {\n  this.parentNode.appendChild(this);\n}\n\nfunction dragged(d) {\n  d3.select(this).attr(\"transform\", \"translate(\" + (d.x = d3.event.x) + \",\" + (d.y = d3.event.y) + \")\");\n  update();\n}\n\nfunction update() {\n  var c = enclosingCircle(circles);\n  ring.attr(\"transform\", \"translate(\" + c.x + \",\" + c.y + \")\");\n  ring.select(\".ring-inner\").attr(\"r\", c.r - 3);\n  ring.select(\".ring-outer\").attr(\"r\", c.r);\n}\n\n// Returns a linked list from the specified array in random order.\nfunction randomizedList(array) {\n  var i,\n      n = (array = array.slice()).length,\n      head = null,\n      node = head;\n\n  while (n) {\n    var next = {id: array.length - n, value: array[n - 1], next: null};\n    if (node) node = node.next = next;\n    else node = head = next;\n    array[i] = array[--n];\n  }\n\n  return {head: head, tail: node};\n}\n\n// Returns the smallest circle that contains the specified circles.\nfunction enclosingCircle(circles) {\n  return enclosingCircleIntersectingCircles(randomizedList(circles), []);\n}\n\n// Returns the smallest circle that contains the circles L\n// and intersects the circles B.\nfunction enclosingCircleIntersectingCircles(L, B) {\n  var circle,\n      l0 = null,\n      l1 = L.head,\n      l2,\n      p1;\n\n  switch (B.length) {\n    case 1: circle = B[0]; break;\n    case 2: circle = circleIntersectingTwoCircles(B[0], B[1]); break;\n    case 3: circle = circleIntersectingThreeCircles(B[0], B[1], B[2]); break;\n  }\n\n  while (l1) {\n    p1 = l1.value, l2 = l1.next;\n    if (!circle || !circleContainsCircle(circle, p1)) {\n\n      // Temporarily truncate L before l1.\n      if (l0) L.tail = l0, l0.next = null;\n      else L.head = L.tail = null;\n\n      B.push(p1);\n      circle = enclosingCircleIntersectingCircles(L, B); // Note: reorders L!\n      B.pop();\n\n      // Move l1 to the front of L and reconnect the truncated list L.\n      if (L.head) l1.next = L.head, L.head = l1;\n      else l1.next = null, L.head = L.tail = l1;\n      l0 = L.tail, l0.next = l2;\n\n    } else {\n      l0 = l1;\n    }\n    l1 = l2;\n  }\n\n  L.tail = l0;\n  return circle;\n}\n\n// Returns true if the specified circle1 contains the specified circle2.\nfunction circleContainsCircle(circle1, circle2) {\n  var xc0 = circle1.x - circle2.x,\n      yc0 = circle1.y - circle2.y;\n  return Math.sqrt(xc0 * xc0 + yc0 * yc0) < circle1.r - circle2.r + 1e-6;\n}\n\n// Returns the smallest circle that intersects the two specified circles.\nfunction circleIntersectingTwoCircles(circle1, circle2) {\n  var x1 = circle1.x, y1 = circle1.y, r1 = circle1.r,\n      x2 = circle2.x, y2 = circle2.y, r2 = circle2.r,\n      x12 = x2 - x1, y12 = y2 - y1, r12 = r2 - r1,\n      l = Math.sqrt(x12 * x12 + y12 * y12);\n  return {\n    x: (x1 + x2 + x12 / l * r12) / 2,\n    y: (y1 + y2 + y12 / l * r12) / 2,\n    r: (l + r1 + r2) / 2\n  };\n}\n\n// Returns the smallest circle that intersects the three specified circles.\nfunction circleIntersectingThreeCircles(circle1, circle2, circle3) {\n  var x1 = circle1.x, y1 = circle1.y, r1 = circle1.r,\n      x2 = circle2.x, y2 = circle2.y, r2 = circle2.r,\n      x3 = circle3.x, y3 = circle3.y, r3 = circle3.r,\n      a2 = 2 * (x1 - x2),\n      b2 = 2 * (y1 - y2),\n      c2 = 2 * (r2 - r1),\n      d2 = x1 * x1 + y1 * y1 - r1 * r1 - x2 * x2 - y2 * y2 + r2 * r2,\n      a3 = 2 * (x1 - x3),\n      b3 = 2 * (y1 - y3),\n      c3 = 2 * (r3 - r1),\n      d3 = x1 * x1 + y1 * y1 - r1 * r1 - x3 * x3 - y3 * y3 + r3 * r3,\n      ab = a3 * b2 - a2 * b3,\n      xa = (b2 * d3 - b3 * d2) / ab - x1,\n      xb = (b3 * c2 - b2 * c3) / ab,\n      ya = (a3 * d2 - a2 * d3) / ab - y1,\n      yb = (a2 * c3 - a3 * c2) / ab,\n      A = xb * xb + yb * yb - 1,\n      B = 2 * (xa * xb + ya * yb + r1),\n      C = xa * xa + ya * ya - r1 * r1,\n      r = (-B - Math.sqrt(B * B - 4 * A * C)) / (2 * A);\n  return {\n    x: xa + xb * r + x1,\n    y: ya + yb * r + y1,\n    r: r\n  };\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"02adb172e7acea3bdfaa529e561f5ffd9e5b35f9"},"sort":[1438797875000]},{"_index":"blockbuilder","_type":"blocks","_id":"7115f7a0393de96f2fdc","_score":null,"_source":{"userId":"mbostock","description":"Apollonius’ Problem II","created_at":"2015-08-03T20:50:48Z","updated_at":"2016-02-09T01:49:22Z","api":["d3.scale.category10","d3.select","d3.behavior.drag"],"colors":["#000000","#d2b48c","#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],"readme":"[Apollonius’ problem](http://mathworld.wolfram.com/ApolloniusProblem.html) is to compute the circle that is tangent to three given circles. There are up to eight such circles.\n\nDrag the circles to see the tangent circles change.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.circle {\n  fill-opacity: .5;\n}\n\n.ring {\n  fill: none;\n  stroke: #000;\n  pointer-events: none;\n}\n\n.ring-inner {\n  stroke-width: 5px;\n  stroke-opacity: .25;\n}\n\n</style>\n<svg width=\"960\" height=\"500\"></svg>\n<script src=\"//d3js.org/d3.v3.min.js\" charset=\"utf-8\"></script>\n<script>\n\nfunction apolloniusCircle(x1, y1, r1, x2, y2, r2, x3, y3, r3) {\n\n  // The quadratic equation (1):\n  //\n  //          0 = (x - x1)² + (y - y1)² - (r ± r1)²\n  //          0 = (x - x2)² + (y - y2)² - (r ± r2)²\n  //          0 = (x - x3)² + (y - y3)² - (r ± r3)²\n  //\n  // Use a negative radius to choose a different circle.\n  // We must rewrite this in standard form Ar² + Br + C = 0 to solve for r.\n  // Per http://mathworld.wolfram.com/ApolloniusProblem.html\n\n  var a2 = 2 * (x1 - x2),\n      b2 = 2 * (y1 - y2),\n      c2 = 2 * (r2 - r1),\n      d2 = x1 * x1 + y1 * y1 - r1 * r1 - x2 * x2 - y2 * y2 + r2 * r2,\n      a3 = 2 * (x1 - x3),\n      b3 = 2 * (y1 - y3),\n      c3 = 2 * (r3 - r1),\n      d3 = x1 * x1 + y1 * y1 - r1 * r1 - x3 * x3 - y3 * y3 + r3 * r3;\n\n  // Giving:\n  //\n  //          x = (b2 * d3 - b3 * d2 + (b3 * c2 - b2 * c3) * r) / (a3 * b2 - a2 * b3)\n  //          y = (a3 * d2 - a2 * d3 + (a2 * c3 - a3 * c2) * r) / (a3 * b2 - a2 * b3)\n  //\n  // Expand x - x1, substituting definition of x in terms of r.\n  //\n  //     x - x1 = (b2 * d3 - b3 * d2 + (b3 * c2 - b2 * c3) * r) / (a3 * b2 - a2 * b3) - x1\n  //            = (b2 * d3 - b3 * d2) / (a3 * b2 - a2 * b3) + (b3 * c2 - b2 * c3) / (a3 * b2 - a2 * b3) * r - x1\n  //            = bd / ab + bc / ab * r - x1\n  //            = xa + xb * r\n  //\n  // Where:\n\n  var ab = a3 * b2 - a2 * b3,\n      xa = (b2 * d3 - b3 * d2) / ab - x1,\n      xb = (b3 * c2 - b2 * c3) / ab;\n\n  // Likewise expand y - y1, substituting definition of y in terms of r.\n  //\n  //     y - y1 = (a3 * d2 - a2 * d3 + (a2 * c3 - a3 * c2) * r) / (a3 * b2 - a2 * b3) - y1\n  //            = (a3 * d2 - a2 * d3) / (a3 * b2 - a2 * b3) + (a2 * c3 - a3 * c2) / (a3 * b2 - a2 * b3) * r - y1\n  //            = ad / ab + ac / ab * r - y1\n  //            = ya + yb * r\n  //\n  // Where:\n\n  var ya = (a3 * d2 - a2 * d3) / ab - y1,\n      yb = (a2 * c3 - a3 * c2) / ab;\n\n  // Expand (x - x1)², (y - y1)² and (r - r1)²:\n  //\n  //  (x - x1)² = xb * xb * r² + 2 * xa * xb * r + xa * xa\n  //  (y - y1)² = yb * yb * r² + 2 * ya * yb * r + ya * ya\n  //  (r - r1)² = r² - 2 * r1 * r + r1 * r1.\n  //\n  // Substitute back into quadratic equation (1):\n  //\n  //          0 = xb * xb * r² + yb * yb * r² - r²\n  //              + 2 * xa * xb * r + 2 * ya * yb * r + 2 * r1 * r\n  //              + xa * xa + ya * ya - r1 * r1\n  //\n  // Rewrite in standard form Ar² + Br + C = 0,\n  // then plug into the quadratic formula to solve for r, x and y.\n\n  var A = xb * xb + yb * yb - 1,\n      B = 2 * (xa * xb + ya * yb + r1),\n      C = xa * xa + ya * ya - r1 * r1,\n      r = (-B - Math.sqrt(B * B - 4 * A * C)) / (2 * A);\n  return isNaN(r) ? null : {x: xa + xb * r + x1, y: ya + yb * r + y1, r: r < 0 ? -r : r};\n}\n\nvar c1 = {x: 380, y: 250, r: 80},\n    c2 = {x: 600, y: 100, r: 20},\n    c3 = {x: 600, y: 300, r: 120};\n\nvar color = d3.scale.category10();\n\nvar svg = d3.select(\"svg\");\n\nvar circle = svg.selectAll(\".circle\")\n    .data([c1, c2, c3])\n  .enter().append(\"g\")\n    .attr(\"class\", \"circle\")\n    .attr(\"transform\", function(d) { return \"translate(\" + d.x + \",\" + d.y + \")\"; })\n    .call(d3.behavior.drag()\n        .origin(function(d) { return d; })\n        .on(\"dragstart\", dragstarted)\n        .on(\"drag\", dragged));\n\ncircle.append(\"circle\")\n    .attr(\"r\", function(d) { return d.r; });\n\nvar ring = svg.selectAll(\".ring\")\n    .data([\n      function() { return apolloniusCircle(c1.x, c1.y, +c1.r, c2.x, c2.y, +c2.r, c3.x, c3.y, +c3.r); },\n      function() { return apolloniusCircle(c1.x, c1.y, +c1.r, c2.x, c2.y, +c2.r, c3.x, c3.y, -c3.r); },\n      function() { return apolloniusCircle(c1.x, c1.y, +c1.r, c2.x, c2.y, -c2.r, c3.x, c3.y, +c3.r); },\n      function() { return apolloniusCircle(c1.x, c1.y, +c1.r, c2.x, c2.y, -c2.r, c3.x, c3.y, -c3.r); },\n      function() { return apolloniusCircle(c1.x, c1.y, -c1.r, c2.x, c2.y, +c2.r, c3.x, c3.y, +c3.r); },\n      function() { return apolloniusCircle(c1.x, c1.y, -c1.r, c2.x, c2.y, +c2.r, c3.x, c3.y, -c3.r); },\n      function() { return apolloniusCircle(c1.x, c1.y, -c1.r, c2.x, c2.y, -c2.r, c3.x, c3.y, +c3.r); },\n      function() { return apolloniusCircle(c1.x, c1.y, -c1.r, c2.x, c2.y, -c2.r, c3.x, c3.y, -c3.r); }\n    ])\n  .enter().insert(\"g\", \".circle\")\n    .attr(\"class\", \"ring\")\n    .style(\"stroke\", function(d, i) { return color(i); });\n\nring.append(\"circle\")\n    .attr(\"class\", \"ring-outer\");\n\nring.append(\"circle\")\n    .attr(\"class\", \"ring-inner\");\n\nupdate();\n\nfunction dragstarted(d) {\n  this.parentNode.appendChild(this);\n}\n\nfunction dragged(d) {\n  d3.select(this).attr(\"transform\", \"translate(\" + (d.x = d3.event.x) + \",\" + (d.y = d3.event.y) + \")\");\n  update();\n}\n\nfunction update() {\n  ring.each(function(f) {\n    var c = f();\n    if (c) {\n      var ring = d3.select(this).style(\"display\", null).attr(\"transform\", \"translate(\" + c.x + \",\" + c.y + \")\");\n      ring.select(\".ring-inner\").attr(\"r\", c.r - 3);\n      ring.select(\".ring-outer\").attr(\"r\", c.r);\n    } else {\n      d3.select(this).style(\"display\", \"none\");\n    }\n  });\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"c7da6ceba8f3209bc3bc36d500215cace9b5c17d"},"sort":[1438635048000]},{"_index":"blockbuilder","_type":"blocks","_id":"751fdd637f4bc2e3f08b","_score":null,"_source":{"userId":"mbostock","description":"Apollonius’ Problem","created_at":"2015-08-03T19:05:52Z","updated_at":"2016-02-09T01:49:25Z","api":["d3.select","d3.behavior.drag"],"colors":["#000000","#d2b48c"],"readme":"[Apollonius’ problem](http://mathworld.wolfram.com/ApolloniusProblem.html) is to compute the circle that is tangent to three given circles. There are up to [eight such circles](/mbostock/7115f7a0393de96f2fdc). Above, only one is shown: the circle that is internally tangent to the three given circles, if it exists.\n\nDrag the circles to see the tangent circle change.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\n.circle {\n  fill-opacity: .5;\n}\n\n.ring {\n  fill: none;\n  stroke: #000;\n  pointer-events: none;\n}\n\n.ring-inner {\n  stroke-width: 5px;\n  stroke-opacity: .25;\n}\n\n</style>\n<svg width=\"960\" height=\"500\"></svg>\n<script src=\"//d3js.org/d3.v3.min.js\" charset=\"utf-8\"></script>\n<script>\n\nfunction apolloniusCircle(x1, y1, r1, x2, y2, r2, x3, y3, r3) {\n\n  // The quadratic equation (1):\n  //\n  //          0 = (x - x1)² + (y - y1)² - (r ± r1)²\n  //          0 = (x - x2)² + (y - y2)² - (r ± r2)²\n  //          0 = (x - x3)² + (y - y3)² - (r ± r3)²\n  //\n  // Use a negative radius to choose a different circle.\n  // We must rewrite this in standard form Ar² + Br + C = 0 to solve for r.\n  // Per http://mathworld.wolfram.com/ApolloniusProblem.html\n\n  var a2 = 2 * (x1 - x2),\n      b2 = 2 * (y1 - y2),\n      c2 = 2 * (r2 - r1),\n      d2 = x1 * x1 + y1 * y1 - r1 * r1 - x2 * x2 - y2 * y2 + r2 * r2,\n      a3 = 2 * (x1 - x3),\n      b3 = 2 * (y1 - y3),\n      c3 = 2 * (r3 - r1),\n      d3 = x1 * x1 + y1 * y1 - r1 * r1 - x3 * x3 - y3 * y3 + r3 * r3;\n\n  // Giving:\n  //\n  //          x = (b2 * d3 - b3 * d2 + (b3 * c2 - b2 * c3) * r) / (a3 * b2 - a2 * b3)\n  //          y = (a3 * d2 - a2 * d3 + (a2 * c3 - a3 * c2) * r) / (a3 * b2 - a2 * b3)\n  //\n  // Expand x - x1, substituting definition of x in terms of r.\n  //\n  //     x - x1 = (b2 * d3 - b3 * d2 + (b3 * c2 - b2 * c3) * r) / (a3 * b2 - a2 * b3) - x1\n  //            = (b2 * d3 - b3 * d2) / (a3 * b2 - a2 * b3) + (b3 * c2 - b2 * c3) / (a3 * b2 - a2 * b3) * r - x1\n  //            = bd / ab + bc / ab * r - x1\n  //            = xa + xb * r\n  //\n  // Where:\n\n  var ab = a3 * b2 - a2 * b3,\n      xa = (b2 * d3 - b3 * d2) / ab - x1,\n      xb = (b3 * c2 - b2 * c3) / ab;\n\n  // Likewise expand y - y1, substituting definition of y in terms of r.\n  //\n  //     y - y1 = (a3 * d2 - a2 * d3 + (a2 * c3 - a3 * c2) * r) / (a3 * b2 - a2 * b3) - y1\n  //            = (a3 * d2 - a2 * d3) / (a3 * b2 - a2 * b3) + (a2 * c3 - a3 * c2) / (a3 * b2 - a2 * b3) * r - y1\n  //            = ad / ab + ac / ab * r - y1\n  //            = ya + yb * r\n  //\n  // Where:\n\n  var ya = (a3 * d2 - a2 * d3) / ab - y1,\n      yb = (a2 * c3 - a3 * c2) / ab;\n\n  // Expand (x - x1)², (y - y1)² and (r - r1)²:\n  //\n  //  (x - x1)² = xb * xb * r² + 2 * xa * xb * r + xa * xa\n  //  (y - y1)² = yb * yb * r² + 2 * ya * yb * r + ya * ya\n  //  (r - r1)² = r² - 2 * r1 * r + r1 * r1.\n  //\n  // Substitute back into quadratic equation (1):\n  //\n  //          0 = xb * xb * r² + yb * yb * r² - r²\n  //              + 2 * xa * xb * r + 2 * ya * yb * r + 2 * r1 * r\n  //              + xa * xa + ya * ya - r1 * r1\n  //\n  // Rewrite in standard form Ar² + Br + C = 0,\n  // then plug into the quadratic formula to solve for r, x and y.\n\n  var A = xb * xb + yb * yb - 1,\n      B = 2 * (xa * xb + ya * yb + r1),\n      C = xa * xa + ya * ya - r1 * r1,\n      r = (-B - Math.sqrt(B * B - 4 * A * C)) / (2 * A);\n  return r > 0 ? {x: xa + xb * r + x1, y: ya + yb * r + y1, r: r} : null;\n}\n\nvar c1 = {x: 380, y: 250, r: 80},\n    c2 = {x: 600, y: 100, r: 20},\n    c3 = {x: 600, y: 300, r: 120};\n\nvar svg = d3.select(\"svg\");\n\nvar circle = svg.selectAll(\".circle\")\n    .data([c1, c2, c3])\n  .enter().append(\"g\")\n    .attr(\"class\", \"circle\")\n    .attr(\"transform\", function(d) { return \"translate(\" + d.x + \",\" + d.y + \")\"; })\n    .call(d3.behavior.drag()\n        .origin(function(d) { return d; })\n        .on(\"dragstart\", dragstarted)\n        .on(\"drag\", dragged));\n\ncircle.append(\"circle\")\n    .attr(\"r\", function(d) { return d.r; });\n\nvar ring = svg.append(\"g\")\n    .attr(\"class\", \"ring\");\n\nring.append(\"circle\")\n    .attr(\"class\", \"ring-outer\");\n\nring.append(\"circle\")\n    .attr(\"class\", \"ring-inner\");\n\nupdate();\n\nfunction dragstarted(d) {\n  this.parentNode.appendChild(this);\n}\n\nfunction dragged(d) {\n  d3.select(this).attr(\"transform\", \"translate(\" + (d.x = d3.event.x) + \",\" + (d.y = d3.event.y) + \")\");\n  update();\n}\n\nfunction update() {\n  var c = apolloniusCircle(c1.x, c1.y, c1.r, c2.x, c2.y, c2.r, c3.x, c3.y, c3.r);\n  if (c) {\n    ring.style(\"display\", null).attr(\"transform\", \"translate(\" + c.x + \",\" + c.y + \")\");\n    ring.select(\".ring-inner\").attr(\"r\", c.r - 3);\n    ring.select(\".ring-outer\").attr(\"r\", c.r);\n  } else {\n    ring.style(\"display\", \"none\");\n  }\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"5755c13232181898ea6f53013ebd0b96a7ac1d4c"},"sort":[1438628752000]},{"_index":"blockbuilder","_type":"blocks","_id":"b75883984a032ea0ba26","_score":null,"_source":{"userId":"mbostock","description":"Matplotlib Colormaps","created_at":"2015-07-11T20:32:29Z","updated_at":"2016-02-09T01:49:28Z","api":[],"colors":["#000000"],"readme":"The [mpl colormaps](https://bids.github.io/colormap/): magma, inferno, plasma and viridis. I previously attempted to implement these in the Cubehelix color space, but the originals are much better. You could presumably plug these colors into a D3 [quantize scale](https://github.com/d3/d3-scale#quantize-scales), if you were so inclined.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  margin: 10px;\n}\n\ncanvas {\n  width: 936px;\n  height: 108px;\n  border: solid 2px #000;\n  display: block;\n  margin: 0 0 10px 0;\n}\n\n</style>\n<canvas width=\"936\" height=\"1\" data-scale=\"000004,010005,010106,010108,020109,02020b,02020d,03030f,030312,040414,050416,060518,06051a,07061c,08071e,090720,0a0822,0b0924,0c0926,0d0a29,0e0b2b,100b2d,110c2f,120d31,130d34,140e36,150e38,160f3b,180f3d,19103f,1a1042,1c1044,1d1147,1e1149,20114b,21114e,221150,241253,251255,271258,29115a,2a115c,2c115f,2d1161,2f1163,311165,331067,341069,36106b,38106c,390f6e,3b0f70,3d0f71,3f0f72,400f74,420f75,440f76,451077,471078,491078,4a1079,4c117a,4e117b,4f127b,51127c,52137c,54137d,56147d,57157e,59157e,5a167e,5c167f,5d177f,5f187f,601880,621980,641a80,651a80,671b80,681c81,6a1c81,6b1d81,6d1d81,6e1e81,701f81,721f81,732081,752181,762181,782281,792282,7b2382,7c2382,7e2482,802582,812581,832681,842681,862781,882781,892881,8b2981,8c2981,8e2a81,902a81,912b81,932b80,942c80,962c80,982d80,992d80,9b2e7f,9c2e7f,9e2f7f,a02f7f,a1307e,a3307e,a5317e,a6317d,a8327d,aa337d,ab337c,ad347c,ae347b,b0357b,b2357b,b3367a,b5367a,b73779,b83779,ba3878,bc3978,bd3977,bf3a77,c03a76,c23b75,c43c75,c53c74,c73d73,c83e73,ca3e72,cc3f71,cd4071,cf4070,d0416f,d2426f,d3436e,d5446d,d6456c,d8456c,d9466b,db476a,dc4869,de4968,df4a68,e04c67,e24d66,e34e65,e44f64,e55064,e75263,e85362,e95462,ea5661,eb5760,ec5860,ed5a5f,ee5b5e,ef5d5e,f05f5e,f1605d,f2625d,f2645c,f3655c,f4675c,f4695c,f56b5c,f66c5c,f66e5c,f7705c,f7725c,f8745c,f8765c,f9785d,f9795d,f97b5d,fa7d5e,fa7f5e,fa815f,fb835f,fb8560,fb8761,fc8961,fc8a62,fc8c63,fc8e64,fc9065,fd9266,fd9467,fd9668,fd9869,fd9a6a,fd9b6b,fe9d6c,fe9f6d,fea16e,fea36f,fea571,fea772,fea973,feaa74,feac76,feae77,feb078,feb27a,feb47b,feb67c,feb77e,feb97f,febb81,febd82,febf84,fec185,fec287,fec488,fec68a,fec88c,feca8d,fecc8f,fecd90,fecf92,fed194,fed395,fed597,fed799,fed89a,fdda9c,fddc9e,fddea0,fde0a1,fde2a3,fde3a5,fde5a7,fde7a9,fde9aa,fdebac,fcecae,fceeb0,fcf0b2,fcf2b4,fcf4b6,fcf6b8,fcf7b9,fcf9bb,fcfbbd,fcfdbf\"></canvas>\n<canvas width=\"936\" height=\"1\" data-scale=\"000004,010005,010106,010108,02010a,02020c,02020e,030210,040312,040314,050417,060419,07051b,08051d,09061f,0a0722,0b0724,0c0826,0d0829,0e092b,10092d,110a30,120a32,140b34,150b37,160b39,180c3c,190c3e,1b0c41,1c0c43,1e0c45,1f0c48,210c4a,230c4c,240c4f,260c51,280b53,290b55,2b0b57,2d0b59,2f0a5b,310a5c,320a5e,340a5f,360961,380962,390963,3b0964,3d0965,3e0966,400a67,420a68,440a68,450a69,470b6a,490b6a,4a0c6b,4c0c6b,4d0d6c,4f0d6c,510e6c,520e6d,540f6d,550f6d,57106e,59106e,5a116e,5c126e,5d126e,5f136e,61136e,62146e,64156e,65156e,67166e,69166e,6a176e,6c186e,6d186e,6f196e,71196e,721a6e,741a6e,751b6e,771c6d,781c6d,7a1d6d,7c1d6d,7d1e6d,7f1e6c,801f6c,82206c,84206b,85216b,87216b,88226a,8a226a,8c2369,8d2369,8f2469,902568,922568,932667,952667,972766,982766,9a2865,9b2964,9d2964,9f2a63,a02a63,a22b62,a32c61,a52c60,a62d60,a82e5f,a92e5e,ab2f5e,ad305d,ae305c,b0315b,b1325a,b3325a,b43359,b63458,b73557,b93556,ba3655,bc3754,bd3853,bf3952,c03a51,c13a50,c33b4f,c43c4e,c63d4d,c73e4c,c83f4b,ca404a,cb4149,cc4248,ce4347,cf4446,d04545,d24644,d34743,d44842,d54a41,d74b3f,d84c3e,d94d3d,da4e3c,db503b,dd513a,de5238,df5337,e05536,e15635,e25734,e35933,e45a31,e55c30,e65d2f,e75e2e,e8602d,e9612b,ea632a,eb6429,eb6628,ec6726,ed6925,ee6a24,ef6c23,ef6e21,f06f20,f1711f,f1731d,f2741c,f3761b,f37819,f47918,f57b17,f57d15,f67e14,f68013,f78212,f78410,f8850f,f8870e,f8890c,f98b0b,f98c0a,f98e09,fa9008,fa9207,fa9407,fb9606,fb9706,fb9906,fb9b06,fb9d07,fc9f07,fca108,fca309,fca50a,fca60c,fca80d,fcaa0f,fcac11,fcae12,fcb014,fcb216,fcb418,fbb61a,fbb81d,fbba1f,fbbc21,fbbe23,fac026,fac228,fac42a,fac62d,f9c72f,f9c932,f9cb35,f8cd37,f8cf3a,f7d13d,f7d340,f6d543,f6d746,f5d949,f5db4c,f4dd4f,f4df53,f4e156,f3e35a,f3e55d,f2e661,f2e865,f2ea69,f1ec6d,f1ed71,f1ef75,f1f179,f2f27d,f2f482,f3f586,f3f68a,f4f88e,f5f992,f6fa96,f8fb9a,f9fc9d,fafda1,fcffa4\"></canvas>\n<canvas width=\"936\" height=\"1\" data-scale=\"0d0887,100788,130789,16078a,19068c,1b068d,1d068e,20068f,220690,240691,260591,280592,2a0593,2c0594,2e0595,2f0596,310597,330597,350498,370499,38049a,3a049a,3c049b,3e049c,3f049c,41049d,43039e,44039e,46039f,48039f,4903a0,4b03a1,4c02a1,4e02a2,5002a2,5102a3,5302a3,5502a4,5601a4,5801a4,5901a5,5b01a5,5c01a6,5e01a6,6001a6,6100a7,6300a7,6400a7,6600a7,6700a8,6900a8,6a00a8,6c00a8,6e00a8,6f00a8,7100a8,7201a8,7401a8,7501a8,7701a8,7801a8,7a02a8,7b02a8,7d03a8,7e03a8,8004a8,8104a7,8305a7,8405a7,8606a6,8707a6,8808a6,8a09a5,8b0aa5,8d0ba5,8e0ca4,8f0da4,910ea3,920fa3,9410a2,9511a1,9613a1,9814a0,99159f,9a169f,9c179e,9d189d,9e199d,a01a9c,a11b9b,a21d9a,a31e9a,a51f99,a62098,a72197,a82296,aa2395,ab2494,ac2694,ad2793,ae2892,b02991,b12a90,b22b8f,b32c8e,b42e8d,b52f8c,b6308b,b7318a,b83289,ba3388,bb3488,bc3587,bd3786,be3885,bf3984,c03a83,c13b82,c23c81,c33d80,c43e7f,c5407e,c6417d,c7427c,c8437b,c9447a,ca457a,cb4679,cc4778,cc4977,cd4a76,ce4b75,cf4c74,d04d73,d14e72,d24f71,d35171,d45270,d5536f,d5546e,d6556d,d7566c,d8576b,d9586a,da5a6a,da5b69,db5c68,dc5d67,dd5e66,de5f65,de6164,df6263,e06363,e16462,e26561,e26660,e3685f,e4695e,e56a5d,e56b5d,e66c5c,e76e5b,e76f5a,e87059,e97158,e97257,ea7457,eb7556,eb7655,ec7754,ed7953,ed7a52,ee7b51,ef7c51,ef7e50,f07f4f,f0804e,f1814d,f1834c,f2844b,f3854b,f3874a,f48849,f48948,f58b47,f58c46,f68d45,f68f44,f79044,f79143,f79342,f89441,f89540,f9973f,f9983e,f99a3e,fa9b3d,fa9c3c,fa9e3b,fb9f3a,fba139,fba238,fca338,fca537,fca636,fca835,fca934,fdab33,fdac33,fdae32,fdaf31,fdb130,fdb22f,fdb42f,fdb52e,feb72d,feb82c,feba2c,febb2b,febd2a,febe2a,fec029,fdc229,fdc328,fdc527,fdc627,fdc827,fdca26,fdcb26,fccd25,fcce25,fcd025,fcd225,fbd324,fbd524,fbd724,fad824,fada24,f9dc24,f9dd25,f8df25,f8e125,f7e225,f7e425,f6e626,f6e826,f5e926,f5eb27,f4ed27,f3ee27,f3f027,f2f227,f1f426,f1f525,f0f724,f0f921\"></canvas>\n<canvas width=\"936\" height=\"1\" data-scale=\"440154,440256,450457,450559,46075a,46085c,460a5d,460b5e,470d60,470e61,471063,471164,471365,481467,481668,481769,48186a,481a6c,481b6d,481c6e,481d6f,481f70,482071,482173,482374,482475,482576,482677,482878,482979,472a7a,472c7a,472d7b,472e7c,472f7d,46307e,46327e,46337f,463480,453581,453781,453882,443983,443a83,443b84,433d84,433e85,423f85,424086,424186,414287,414487,404588,404688,3f4788,3f4889,3e4989,3e4a89,3e4c8a,3d4d8a,3d4e8a,3c4f8a,3c508b,3b518b,3b528b,3a538b,3a548c,39558c,39568c,38588c,38598c,375a8c,375b8d,365c8d,365d8d,355e8d,355f8d,34608d,34618d,33628d,33638d,32648e,32658e,31668e,31678e,31688e,30698e,306a8e,2f6b8e,2f6c8e,2e6d8e,2e6e8e,2e6f8e,2d708e,2d718e,2c718e,2c728e,2c738e,2b748e,2b758e,2a768e,2a778e,2a788e,29798e,297a8e,297b8e,287c8e,287d8e,277e8e,277f8e,27808e,26818e,26828e,26828e,25838e,25848e,25858e,24868e,24878e,23888e,23898e,238a8d,228b8d,228c8d,228d8d,218e8d,218f8d,21908d,21918c,20928c,20928c,20938c,1f948c,1f958b,1f968b,1f978b,1f988b,1f998a,1f9a8a,1e9b8a,1e9c89,1e9d89,1f9e89,1f9f88,1fa088,1fa188,1fa187,1fa287,20a386,20a486,21a585,21a685,22a785,22a884,23a983,24aa83,25ab82,25ac82,26ad81,27ad81,28ae80,29af7f,2ab07f,2cb17e,2db27d,2eb37c,2fb47c,31b57b,32b67a,34b679,35b779,37b878,38b977,3aba76,3bbb75,3dbc74,3fbc73,40bd72,42be71,44bf70,46c06f,48c16e,4ac16d,4cc26c,4ec36b,50c46a,52c569,54c568,56c667,58c765,5ac864,5cc863,5ec962,60ca60,63cb5f,65cb5e,67cc5c,69cd5b,6ccd5a,6ece58,70cf57,73d056,75d054,77d153,7ad151,7cd250,7fd34e,81d34d,84d44b,86d549,89d548,8bd646,8ed645,90d743,93d741,95d840,98d83e,9bd93c,9dd93b,a0da39,a2da37,a5db36,a8db34,aadc32,addc30,b0dd2f,b2dd2d,b5de2b,b8de29,bade28,bddf26,c0df25,c2df23,c5e021,c8e020,cae11f,cde11d,d0e11c,d2e21b,d5e21a,d8e219,dae319,dde318,dfe318,e2e418,e5e419,e7e419,eae51a,ece51b,efe51c,f1e51d,f4e61e,f6e620,f8e621,fbe723,fde725\"></canvas>\n<script>\n\n[].forEach.call(document.querySelectorAll(\"canvas\"), function(canvas) {\n  var width = canvas.width,\n      context = canvas.getContext(\"2d\"),\n      image = context.createImageData(width, 1),\n      colors = canvas.getAttribute(\"data-scale\").split(\",\");\n\n  for (var i = 0, j = -1, c, t; i < width; ++i) {\n    c = colors[Math.floor(i / width * colors.length)];\n    image.data[++j] = +(\"0x\" + c.slice(0, 2));\n    image.data[++j] = +(\"0x\" + c.slice(2, 4));\n    image.data[++j] = +(\"0x\" + c.slice(4, 6));\n    image.data[++j] = 255;\n  }\n\n  context.putImageData(image, 0, 0);\n});\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"a63b5d9946ea972d481d8418919b04822c06bbf0"},"sort":[1436646749000]},{"_index":"blockbuilder","_type":"blocks","_id":"85d7dce6fca6277f75fe","_score":null,"_source":{"userId":"mbostock","description":"Colorcomb II","created_at":"2015-07-10T00:29:44Z","updated_at":"2016-02-09T01:49:31Z","api":[],"colors":["#000000","#ffc0cb","#ffb6c1","#ff69b4","#ff1493","#db7093","#c71585","#ffa07a","#fa8072","#e9967a","#f08080","#cd5c5c","#dc143c","#b22222","#8b0000","#ff0000","#ff4500","#ff6347","#ff7f50","#ff8c00","#ffa500","#ffff00","#ffffe0","#fffacd","#fafad2","#ffefd5","#ffe4b5","#ffdab9","#eee8aa","#f0e68c","#bdb76b","#ffd700","#fff8dc","#ffebcd","#ffe4c4","#ffdead","#f5deb3","#deb887","#d2b48c","#bc8f8f","#f4a460","#daa520","#b8860b","#cd853f","#d2691e","#8b4513","#a0522d","#a52a2a","#800000","#556b2f","#808000","#6b8e23","#9acd32","#32cd32","#00ff00","#7cfc00","#7fff00","#adff2f","#00ff7f","#00fa9a","#90ee90","#98fb98","#8fbc8f","#3cb371","#2e8b57","#228b22","#008000","#006400","#66cdaa","#00ffff","#e0ffff","#afeeee","#7fffd4","#40e0d0","#48d1cc","#00ced1","#20b2aa","#5f9ea0","#008b8b","#008080","#b0c4de","#b0e0e6","#add8e6","#87ceeb","#87cefa","#00bfff","#1e90ff","#6495ed","#4682b4","#4169e1","#0000ff","#0000cd","#00008b","#000080","#191970","#e6e6fa","#d8bfd8","#dda0dd","#ee82ee","#da70d6","#ff00ff","#ba55d3","#9370db","#8a2be2","#9400d3","#9932cc","#8b008b","#800080","#4b0082","#483d8b","#663399","#6a5acd","#7b68ee","#ffffff","#fffafa","#f0fff0","#f5fffa","#f0ffff","#f0f8ff","#f8f8ff","#f5f5f5","#fff5ee","#f5f5dc","#fdf5e6","#fffaf0","#fffff0","#faebd7","#faf0e6","#fff0f5","#ffe4e1","#dcdcdc","#d3d3d3","#c0c0c0","#a9a9a9","#808080","#696969","#778899","#708090","#2f4f4f"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  background: #000;\n}\n\n</style>\n<canvas width=\"960\" height=\"500\"></canvas>\n<script>\n\n/* https://github.com/d3/d3-voronoi Copyright 2015 Mike Bostock */\n!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t(e.voronoi={})}(this,function(e){\"use strict\";function t(e){return function(){return e}}function n(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function i(e,t){return t.angle-e.angle}function r(e,t){this.l=e,this.r=t,this.a=this.b=null}function s(e,t,n){var i=new r(e,null);return i.a=t,i.b=n,D.push(i),i}function u(e,t,n){this.edge=e,this.site=t,this.angle=n}function f(e,t,n){var i=e.a,r=e.b;return new u(e,t,n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y))}function a(e,t,n,i){for(var r,u,a,l,o,c,h,y,x,v,g=B.length;g--;)if(o=B[g],o&&o.prepare())for(h=o.edges,y=h.length,c=0;y>c;)v=h[c].end(),a=v.x,l=v.y,x=h[++c%y].start(),r=x.x,u=x.y,(Math.abs(a-r)>I||Math.abs(l-u)>I)&&(h.splice(c,0,f(s(o.site,v,Math.abs(a-e)<I&&i-l>I?{x:e,y:Math.abs(r-e)<I?u:i}:Math.abs(l-i)<I&&n-a>I?{x:Math.abs(u-i)<I?r:n,y:i}:Math.abs(a-n)<I&&l-t>I?{x:n,y:Math.abs(r-n)<I?u:t}:Math.abs(l-t)<I&&a-e>I?{x:Math.abs(u-t)<I?r:e,y:t}:null),o.site,null)),++y)}function l(e,t,n,i,r){var s,u=e.a,f=e.b,a=u.x,l=u.y,o=f.x,c=f.y,h=0,y=1,x=o-a,v=c-l;if(s=t-a,x||!(s>0)){if(s/=x,0>x){if(h>s)return;y>s&&(y=s)}else if(x>0){if(s>y)return;s>h&&(h=s)}if(s=i-a,x||!(0>s)){if(s/=x,0>x){if(s>y)return;s>h&&(h=s)}else if(x>0){if(h>s)return;y>s&&(y=s)}if(s=n-l,v||!(s>0)){if(s/=v,0>v){if(h>s)return;y>s&&(y=s)}else if(v>0){if(s>y)return;s>h&&(h=s)}if(s=r-l,v||!(0>s)){if(s/=v,0>v){if(s>y)return;s>h&&(h=s)}else if(v>0){if(h>s)return;y>s&&(y=s)}return h>0&&(e.a={x:a+h*x,y:l+h*v}),1>y&&(e.b={x:a+y*x,y:l+y*v}),e}}}}}function o(e,t,n,i,r){var s=e.b;if(s)return!0;var u,f,a=e.a,l=e.l,o=e.r,c=l.x,h=l.y,y=o.x,x=o.y,v=(c+y)/2,g=(h+x)/2;if(x===h){if(t>v||v>=i)return;if(c>y){if(a){if(a.y>=r)return}else a={x:v,y:n};s={x:v,y:r}}else{if(a){if(a.y<n)return}else a={x:v,y:r};s={x:v,y:n}}}else if(u=(c-y)/(x-h),f=g-u*v,-1>u||u>1)if(c>y){if(a){if(a.y>=r)return}else a={x:(n-f)/u,y:n};s={x:(r-f)/u,y:r}}else{if(a){if(a.y<n)return}else a={x:(r-f)/u,y:r};s={x:(n-f)/u,y:n}}else if(x>h){if(a){if(a.x>=i)return}else a={x:t,y:u*t+f};s={x:i,y:u*i+f}}else{if(a){if(a.x<t)return}else a={x:i,y:u*i+f};s={x:t,y:u*t+f}}return e.a=a,e.b=s,!0}function c(e,t,n,i){for(var r,s=D.length;s--;)r=D[s],(!o(r,e,t,n,i)||!l(r,e,t,n,i)||Math.abs(r.a.x-r.b.x)<I&&Math.abs(r.a.y-r.b.y)<I)&&(r.a=r.b=null,D.splice(s,1))}function h(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function y(e){var t=e.circle;t&&(t.P||(J=t.N),F.remove(t),K.push(t),h(t),e.circle=null)}function x(){h(this),this.x=this.y=this.arc=this.site=this.cy=null}function v(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,s=n.site;if(i!==s){var u=r.x,f=r.y,a=i.x-u,l=i.y-f,o=s.x-u,c=s.y-f,h=2*(a*c-l*o);if(!(h>=-O)){var y=a*a+l*l,v=o*o+c*c,g=(c*y-l*v)/h,C=(a*v-o*y)/h,c=C+f,d=K.pop()||new x;d.arc=e,d.site=r,d.x=g+u,d.y=c+Math.sqrt(g*g+C*C),d.cy=c,e.circle=d;for(var p=null,L=F._;L;)if(d.y<L.y||d.y===L.y&&d.x<=L.x){if(!L.L){p=L.P;break}L=L.L}else{if(!L.R){p=L;break}L=L.R}F.insert(p,d),p||(J=d)}}}}function g(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function C(e,t,n,i){var s=new r(e,t);return D.push(s),n&&g(s,e,t,n),i&&g(s,t,e,i),B[e.i].edges.push(f(s,e,t)),B[t.i].edges.push(f(s,t,e)),s}function d(){h(this),this.edge=this.site=this.circle=null}function p(e){var t=Q.pop()||new d;return t.site=e,t}function L(e){y(e),G.remove(e),Q.push(e),h(e)}function b(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},s=e.P,u=e.N,f=[e];L(e);for(var a=s;a.circle&&Math.abs(n-a.circle.x)<I&&Math.abs(i-a.circle.cy)<I;)s=a.P,f.unshift(a),L(a),a=s;f.unshift(a),y(a);for(var l=u;l.circle&&Math.abs(n-l.circle.x)<I&&Math.abs(i-l.circle.cy)<I;)u=l.N,f.push(l),L(l),l=u;f.push(l),y(l);var o,c=f.length;for(o=1;c>o;++o)l=f[o],a=f[o-1],g(l.edge,a.site,l.site,r);a=f[0],l=f[c-1],l.edge=C(a.site,l.site,null,r),v(a),v(l)}function R(e){this.site=e,this.edges=[]}function M(e){return B[e.i]=new R(e)}function U(e,t){var n=e.site,i=n.x,r=n.y,s=r-t;if(!s)return i;var u=e.P;if(!u)return-(1/0);n=u.site;var f=n.x,a=n.y,l=a-t;if(!l)return f;var o=f-i,c=1/s-1/l,h=o/l;return c?(-h+Math.sqrt(h*h-2*c*(o*o/(-2*l)-a+l/2+r-s/2)))/c+i:(i+f)/2}function N(e,t){var n=e.N;if(n)return U(n,t);var i=e.site;return i.y===t?i.x:1/0}function P(e){for(var t,n,i,r,s=e.x,u=e.y,f=G._;f;)if(i=U(f,u)-s,i>I)f=f.L;else{if(r=s-N(f,u),!(r>I)){i>-I?(t=f.P,n=f):r>-I?(t=f,n=f.N):t=n=f;break}if(!f.R){t=f;break}f=f.R}M(e);var a=p(e);if(G.insert(t,a),t||n){if(t===n)return y(t),n=p(t.site),G.insert(a,n),a.edge=n.edge=C(t.site,a.site),v(t),void v(n);if(!n)return void(a.edge=C(t.site,a.site));y(t),y(n);var l=t.site,o=l.x,c=l.y,h=e.x-o,x=e.y-c,d=n.site,L=d.x-o,b=d.y-c,R=2*(h*b-x*L),P=h*h+x*x,_=L*L+b*b,m={x:(b*P-x*_)/R+o,y:(h*_-L*P)/R+c};g(n.edge,l,d,m),a.edge=C(l,e,null,m),n.edge=C(e,d,null,m),v(t),v(n)}}function _(){this._=null}function m(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function w(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function k(e){for(;e.L;)e=e.L;return e}function q(e,t){return t.y-e.y||t.x-e.x}function A(e,t){var n,i,r,s=e.sort(q).pop();for(D=[],B=new Array(e.length),G=new _,F=new _;;)if(r=J,s&&(!r||s.y<r.y||s.y===r.y&&s.x<r.x))(s.x!==n||s.y!==i)&&(P(s),n=s.x,i=s.y),s=e.pop();else{if(!r)break;b(r.arc)}if(t){var n=t[0][0],i=t[0][1],u=t[1][0],f=t[1][1];c(n,i,u,f),a(n,i,u,f)}var l={cells:B,edges:D};return G=F=D=B=null,l}function E(e){return e[1]}function j(e){return e[0]}function z(){function e(e){var t=new Array(e.length),n=l[0][0],i=l[0][1],s=l[1][0],u=l[1][1];return A(r(e),l).cells.forEach(function(r,f){var a=r.edges,l=r.site,o=t[f]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):l.x>=n&&l.x<=s&&l.y>=i&&l.y<=u?[[n,u],[s,u],[s,i],[n,i]]:[];o.point=e[f]}),t}function r(e){return e.map(function(e,t){return{x:Math.round(f(e,t)/I)*I,y:Math.round(a(e,t)/I)*I,i:t}})}var s=j,u=E,f=s,a=u,l=H;return e.links=function(e){return A(r(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},e.triangles=function(e){var t=[];return A(r(e)).cells.forEach(function(r,s){for(var u,f,a=r.site,l=r.edges.sort(i),o=-1,c=l.length,h=l[c-1].edge,y=h.l===a?h.r:h.l;++o<c;)u=h,f=y,h=l[o].edge,y=h.l===a?h.r:h.l,s<f.i&&s<y.i&&n(a,f,y)<0&&t.push([e[s],e[f.i],e[y.i]])}),t},e.x=function(n){return arguments.length?(s=n,f=\"function\"==typeof n?s:t(s),e):s},e.y=function(n){return arguments.length?(u=n,a=\"function\"==typeof n?u:t(u),e):u},e.extent=function(t){return arguments.length?(l=null==t?H:t,e):l===H?null:l},e.size=function(t){return arguments.length?e.extent(t&&[[0,0],t]):l===H?null:l&&l[1]},e}var B,D,F,G,H=[[-1e6,-1e6],[1e6,1e6]],I=1e-6;u.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}};var J,K=[],O=1e-12,Q=[];R.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(i),t.length},_.prototype={insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=k(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(w(this,n),e=n,n=e.U),n.C=!1,i.C=!0,m(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(m(this,n),e=n,n=e.U),n.C=!1,i.C=!0,w(this,i))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,s=e.L,u=e.R;if(n=s?u?k(u):s:u,r?r.L===e?r.L=n:r.R=n:this._=n,s&&u?(i=n.C,n.C=e.C,n.L=s,s.U=n,n!==u?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=u,u.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,w(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,m(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,w(this,r),e=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,m(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,w(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,m(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}},e.voronoi=z});\n\n/* https://github.com/d3/d3-timer Copyright 2015 Mike Bostock */\n\"undefined\"==typeof requestAnimationFrame&&(requestAnimationFrame=\"undefined\"!=typeof window&&(window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame)||function(e){return setTimeout(e,17)}),function(e,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?n(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],n):n(e.timer={})}(this,function(e){\"use strict\";function n(){r=m=0,c=1/0,t(u())}function t(e){if(!r){var t=e-Date.now();t>24?c>e&&(m&&clearTimeout(m),m=setTimeout(n,t),c=e):(m&&(m=clearTimeout(m),c=1/0),r=requestAnimationFrame(n))}}function i(e,n,i){i=null==i?Date.now():+i,null!=n&&(i+=+n);var o={callback:e,time:i,flush:!1,next:null};a?a.next=o:f=o,a=o,t(i)}function o(e,n,t){t=null==t?Date.now():+t,null!=n&&(t+=+n),l.callback=e,l.time=t}function u(e){e=null==e?Date.now():+e;var n=l;for(l=f;l;)e>=l.time&&(l.flush=l.callback(e-l.time,e)),l=l.next;l=n,e=1/0;for(var t,i=f;i;)i.flush?i=t?t.next=i.next:f=i.next:(i.time<e&&(e=i.time),i=(t=i).next);return a=t,e}var a,m,r,f,l,c=1/0;e.timer=i,e.timerReplace=o,e.timerFlush=u});\n\n/* https://github.com/d3/d3-color Copyright 2015 Mike Bostock */\n\"undefined\"==typeof Map?(Map=function(){this.clear()},Map.prototype={set:function(t,e){return this._[t]=e,this},get:function(t){return this._[t]},has:function(t){return t in this._},\"delete\":function(t){return t in this._&&delete this._[t]},clear:function(){this._=Object.create(null)},get size(){var t=0;for(var e in this._)++t;return t},forEach:function(t){for(var e in this._)t(this._[e],e,this)}}):function(){var t=new Map;t.set(0,0)!==t&&(t=t.set,Map.prototype.set=function(){return t.apply(this,arguments),this})}(),function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?e(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],e):e(t.color={})}(this,function(t){\"use strict\";function e(){}function s(t,e,s){this.r=Math.max(0,Math.min(255,Math.round(t))),this.g=Math.max(0,Math.min(255,Math.round(e))),this.b=Math.max(0,Math.min(255,Math.round(s)))}function n(t,e,s){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),isNaN(s)&&(s=0),\"#\"+(16>t?\"0\"+t.toString(16):t.toString(16))+(16>e?\"0\"+e.toString(16):e.toString(16))+(16>s?\"0\"+s.toString(16):s.toString(16))}function r(t,n,r){return 1===arguments.length&&(t instanceof e||(t=l(t)),t?(t=t.rgb(),r=t.b,n=t.g,t=t.r):t=n=r=NaN),new s(t,n,r)}function i(t){return r(t>>16&255,t>>8&255,255&t)}function a(t,e,s){this.h=+t,this.s=Math.max(0,Math.min(1,+e)),this.l=Math.max(0,Math.min(1,+s))}function o(t,e,s){return 255*(60>t?e+(s-e)*t/60:180>t?s:240>t?e+(s-e)*(240-t)/60:e)}function h(t,s,n){if(1===arguments.length)if(t instanceof a)n=t.l,s=t.s,t=t.h;else if(t instanceof e||(t=l(t)),t){if(t instanceof a)return t;t=t.rgb();var r=t.r/255,i=t.g/255,o=t.b/255,h=Math.min(r,i,o),u=Math.max(r,i,o),c=u-h;n=(u+h)/2,c?(s=.5>n?c/(u+h):c/(2-u-h),t=r===u?(i-o)/c+6*(o>i):i===u?(o-r)/c+2:(r-i)/c+4,t*=60):(t=NaN,s=n>0&&1>n?0:t)}else t=s=n=NaN;return new a(t,s,n)}function l(t){var e;return t=(t+\"\").trim().toLowerCase(),(e=R.exec(t))?(e=parseInt(e[1],16),r(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e)):(e=E.exec(t))?i(parseInt(e[1],16)):(e=z.exec(t))?r(e[1],e[2],e[3]):(e=P.exec(t))?r(2.55*e[1],2.55*e[2],2.55*e[3]):(e=O.exec(t))?h(e[1],.01*e[2],.01*e[3]):L.has(t)?i(L.get(t)):null}function u(t,e,s){this.l=+t,this.a=+e,this.b=+s}function c(t){return 255*(.0031308>=t?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function g(t){return t>F?t*t*t:G*(t-D)}function f(t){return t>T?Math.pow(t,1/3):t/G+D}function d(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function p(t,e,s){this.h=+t,this.c=+e,this.l=+s}function b(t,e,n){if(1===arguments.length)if(t instanceof u)n=t.b,e=t.a,t=t.l;else if(t instanceof p){var i=t.h*U;n=Math.sin(i)*t.c,e=Math.cos(i)*t.c,t=t.l}else{t instanceof s||(t=r(t));var a=d(t.r),o=d(t.g),n=d(t.b),h=f((.4124564*a+.3575761*o+.1804375*n)/K),l=f((.2126729*a+.7151522*o+.072175*n)/Q),c=f((.0193339*a+.119192*o+.9503041*n)/J);n=200*(l-c),e=500*(h-l),t=116*l-16}return new u(t,e,n)}function N(t,e,s){return 1===arguments.length&&(t instanceof p?(s=t.l,e=t.c,t=t.h):(t instanceof u||(t=b(t)),s=t.l,e=Math.sqrt(t.a*t.a+t.b*t.b),t=Math.atan2(t.b,t.a)*W,0>t&&(t+=360))),new p(t,e,s)}function m(t,e,s){this.h=+t,this.s=+e,this.l=+s}function w(t,e,n){if(1===arguments.length)if(t instanceof m)n=t.l,e=t.s,t=t.h;else{t instanceof s||(t=r(t));var i=t.r/255,a=t.g/255,o=t.b/255;n=(at*o+it*i-rt*a)/(at+it-rt);var h=o-n,l=(Y*(a-n)-tt*h)/Z,u=Math.pow(n,nt);e=Math.sqrt(l*l+h*h)/(Y*u*(1-u)),t=e?Math.atan2(l,h)*W-120:NaN,0>t&&(t+=360)}return new m(t,e,n)}function y(t,e){t=w(t),e=w(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function v(t,e){var s=(t-e)%360;return s+(s>180?-360:-180>s?360:0)}function M(t,e){t=w(t),e=w(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function k(t,e){t=N(t),e=N(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.c)?e.c:t.c,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.c)?0:e.c-n,o=e.l-r;return function(e){return t.h=s+i*e,t.c=n+a*e,t.l=r+o*e,t+\"\"}}function x(t,e){t=N(t),e=N(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.c)?e.c:t.c,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.c)?0:e.c-n,o=e.l-r;return function(e){return t.h=s+i*e,t.c=n+a*e,t.l=r+o*e,t+\"\"}}function q(t,e){t=b(t),e=b(e);var s=t.l,n=t.a,r=t.b,i=e.l-s,a=e.a-n,o=e.b-r;return function(e){return t.l=s+i*e,t.a=n+a*e,t.b=r+o*e,t+\"\"}}function _(t,e){t=h(t),e=h(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function S(t,e){t=h(t),e=h(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function j(t,e){t=r(t),e=r(e);var s=t.r,i=t.g,a=t.b,o=e.r-s,h=e.g-i,l=e.b-a;return function(t){return n(Math.round(s+o*t),Math.round(i+h*t),Math.round(a+l*t))}}e.prototype={toString:function(){return this.rgb()+\"\"}};var L=(new Map).set(\"aliceblue\",15792383).set(\"antiquewhite\",16444375).set(\"aqua\",65535).set(\"aquamarine\",8388564).set(\"azure\",15794175).set(\"beige\",16119260).set(\"bisque\",16770244).set(\"black\",0).set(\"blanchedalmond\",16772045).set(\"blue\",255).set(\"blueviolet\",9055202).set(\"brown\",10824234).set(\"burlywood\",14596231).set(\"cadetblue\",6266528).set(\"chartreuse\",8388352).set(\"chocolate\",13789470).set(\"coral\",16744272).set(\"cornflowerblue\",6591981).set(\"cornsilk\",16775388).set(\"crimson\",14423100).set(\"cyan\",65535).set(\"darkblue\",139).set(\"darkcyan\",35723).set(\"darkgoldenrod\",12092939).set(\"darkgray\",11119017).set(\"darkgreen\",25600).set(\"darkgrey\",11119017).set(\"darkkhaki\",12433259).set(\"darkmagenta\",9109643).set(\"darkolivegreen\",5597999).set(\"darkorange\",16747520).set(\"darkorchid\",10040012).set(\"darkred\",9109504).set(\"darksalmon\",15308410).set(\"darkseagreen\",9419919).set(\"darkslateblue\",4734347).set(\"darkslategray\",3100495).set(\"darkslategrey\",3100495).set(\"darkturquoise\",52945).set(\"darkviolet\",9699539).set(\"deeppink\",16716947).set(\"deepskyblue\",49151).set(\"dimgray\",6908265).set(\"dimgrey\",6908265).set(\"dodgerblue\",2003199).set(\"firebrick\",11674146).set(\"floralwhite\",16775920).set(\"forestgreen\",2263842).set(\"fuchsia\",16711935).set(\"gainsboro\",14474460).set(\"ghostwhite\",16316671).set(\"gold\",16766720).set(\"goldenrod\",14329120).set(\"gray\",8421504).set(\"green\",32768).set(\"greenyellow\",11403055).set(\"grey\",8421504).set(\"honeydew\",15794160).set(\"hotpink\",16738740).set(\"indianred\",13458524).set(\"indigo\",4915330).set(\"ivory\",16777200).set(\"khaki\",15787660).set(\"lavender\",15132410).set(\"lavenderblush\",16773365).set(\"lawngreen\",8190976).set(\"lemonchiffon\",16775885).set(\"lightblue\",11393254).set(\"lightcoral\",15761536).set(\"lightcyan\",14745599).set(\"lightgoldenrodyellow\",16448210).set(\"lightgray\",13882323).set(\"lightgreen\",9498256).set(\"lightgrey\",13882323).set(\"lightpink\",16758465).set(\"lightsalmon\",16752762).set(\"lightseagreen\",2142890).set(\"lightskyblue\",8900346).set(\"lightslategray\",7833753).set(\"lightslategrey\",7833753).set(\"lightsteelblue\",11584734).set(\"lightyellow\",16777184).set(\"lime\",65280).set(\"limegreen\",3329330).set(\"linen\",16445670).set(\"magenta\",16711935).set(\"maroon\",8388608).set(\"mediumaquamarine\",6737322).set(\"mediumblue\",205).set(\"mediumorchid\",12211667).set(\"mediumpurple\",9662683).set(\"mediumseagreen\",3978097).set(\"mediumslateblue\",8087790).set(\"mediumspringgreen\",64154).set(\"mediumturquoise\",4772300).set(\"mediumvioletred\",13047173).set(\"midnightblue\",1644912).set(\"mintcream\",16121850).set(\"mistyrose\",16770273).set(\"moccasin\",16770229).set(\"navajowhite\",16768685).set(\"navy\",128).set(\"oldlace\",16643558).set(\"olive\",8421376).set(\"olivedrab\",7048739).set(\"orange\",16753920).set(\"orangered\",16729344).set(\"orchid\",14315734).set(\"palegoldenrod\",15657130).set(\"palegreen\",10025880).set(\"paleturquoise\",11529966).set(\"palevioletred\",14381203).set(\"papayawhip\",16773077).set(\"peachpuff\",16767673).set(\"peru\",13468991).set(\"pink\",16761035).set(\"plum\",14524637).set(\"powderblue\",11591910).set(\"purple\",8388736).set(\"rebeccapurple\",6697881).set(\"red\",16711680).set(\"rosybrown\",12357519).set(\"royalblue\",4286945).set(\"saddlebrown\",9127187).set(\"salmon\",16416882).set(\"sandybrown\",16032864).set(\"seagreen\",3050327).set(\"seashell\",16774638).set(\"sienna\",10506797).set(\"silver\",12632256).set(\"skyblue\",8900331).set(\"slateblue\",6970061).set(\"slategray\",7372944).set(\"slategrey\",7372944).set(\"snow\",16775930).set(\"springgreen\",65407).set(\"steelblue\",4620980).set(\"tan\",13808780).set(\"teal\",32896).set(\"thistle\",14204888).set(\"tomato\",16737095).set(\"turquoise\",4251856).set(\"violet\",15631086).set(\"wheat\",16113331).set(\"white\",16777215).set(\"whitesmoke\",16119285).set(\"yellow\",16776960).set(\"yellowgreen\",10145074),$=s.prototype=new e,H=.7;$.darker=function(t){return t=null==t?H:Math.pow(H,t),new s(this.r*t,this.g*t,this.b*t)};var I=1/H;$.brighter=function(t){return t=null==t?I:Math.pow(I,t),new s(this.r*t,this.g*t,this.b*t)},$.rgb=function(){return this},$.toString=function(){return n(this.r,this.g,this.b)};var C=a.prototype=new e;C.brighter=function(t){return t=null==t?I:Math.pow(I,t),new a(this.h,this.s,this.l*t)},C.darker=function(t){return t=null==t?H:Math.pow(H,t),new a(this.h,this.s,this.l*t)},C.rgb=function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=.5>=n?n*(1+e):n+e-n*e,i=2*n-r;return new s(o(t>=240?t-240:t+120,i,r),o(t,i,r),o(120>t?t+240:t-120,i,r))};var O=/^hsl\\(\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*\\)$/,P=/^rgb\\(\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*\\)$/,z=/^rgb\\(\\s*([-+]?\\d+)\\s*,\\s*([-+]?\\d+)\\s*,\\s*([-+]?\\d+)\\s*\\)$/,E=/^#([0-9a-f]{6})$/,R=/^#([0-9a-f]{3})$/;l.prototype=e.prototype,r.prototype=s.prototype,h.prototype=a.prototype;var A=u.prototype=new e,B=18;A.brighter=function(t){return new u(this.l+B*(null==t?1:t),this.a,this.b)},A.darker=function(t){return new u(this.l-B*(null==t?1:t),this.a,this.b)};var D=4/29,F=6/29,G=3*F*F,J=1.08883,K=.95047,Q=1;A.rgb=function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=Q*g(t),e=K*g(e),n=J*g(n),new s(c(3.2404542*e-1.5371385*t-.4985314*n),c(-.969266*e+1.8760108*t+.041556*n),c(.0556434*e-.2040259*t+1.0572252*n))};var T=F*F*F,U=Math.PI/180,V=p.prototype=new e;V.brighter=function(t){return new p(this.h,this.c,this.l+B*(null==t?1:t))},V.darker=function(t){return new p(this.h,this.c,this.l-B*(null==t?1:t))},V.rgb=function(){return b(this).rgb()},b.prototype=u.prototype;var W=180/Math.PI;N.prototype=p.prototype;var X=m.prototype=new e;X.brighter=function(t){return t=null==t?I:Math.pow(I,t),new m(this.h,this.s,this.l*t)},X.darker=function(t){return t=null==t?H:Math.pow(H,t),new m(this.h,this.s,this.l*t)};var Y=1.97294,Z=-.90649,tt=-.29227,et=1.78277,st=-.14861,nt=1,rt=Y*et,it=Y*Z,at=et*tt-Z*st;X.rgb=function(){var t=isNaN(this.h)?0:(this.h+120)*U,e=Math.pow(this.l,nt),n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new s(255*(e+n*(st*r+et*i)),255*(e+n*(tt*r+Z*i)),255*(e+n*Y*r))},w.prototype=m.prototype,t.color=l,t.rgb=r,t.hsl=h,t.lab=b,t.hcl=N,t.cubehelix=w,t.interpolateRgb=j,t.interpolateHsl=S,t.interpolateHslLong=_,t.interpolateLab=q,t.interpolateHcl=x,t.interpolateHclLong=k,t.interpolateCubehelix=M,t.interpolateCubehelixLong=y});\n\nvar canvas = document.querySelector(\"canvas\"),\n    width = canvas.width,\n    height = canvas.height,\n    context = canvas.getContext(\"2d\"),\n    voro = voronoi.voronoi().extent([[0.5, 0.5], [width - 0.5, height - 0.5]]);\n\nvar rainbow1 = color.interpolateCubehelixLong(color.cubehelix(-100, 0.75, 0.35), color.cubehelix(80, 1.50, 0.8)),\n    rainbow2 = color.interpolateCubehelixLong(color.cubehelix(80, 1.50, 0.8), color.cubehelix(260, 0.75, 0.35));\n\nvar n = 50,\n    particles = new Array(n),\n    radius = 20;\n\nfor (var i = 0; i < n; ++i) particles[i] = {0: Math.random() * width, 1: Math.random() * height, vx: 0, vy: 0};\n\ntimer.timer(function(elapsed) {\n  for (var i = 0; i < n; ++i) {\n    var p = particles[i];\n    p[0] += p.vx; if (p[0] < 0) p[0] = p.vx *= -1; else if (p[0] > width) p[0] = width + (p.vx *= -1);\n    p[1] += p.vy; if (p[1] < 0) p[1] = p.vy *= -1; else if (p[1] > height) p[1] = height + (p.vy *= -1);\n    p.vx += 0.1 * (Math.random() - .5) - 0.01 * p.vx;\n    p.vy += 0.1 * (Math.random() - .5) - 0.01 * p.vy;\n  }\n\n  var cells = voro(particles);\n\n  context.beginPath();\n  cells.forEach(function(cell) { drawRoundedPolygon(cell, radius); });\n  context.globalAlpha = 0.2;\n  context.lineWidth = 4;\n  context.strokeStyle = \"#000\";\n  context.stroke();\n\n  context.beginPath();\n  cells.forEach(function(cell) { drawRoundedPolygon(cell, radius); });\n  context.globalAlpha = 1;\n  var t = (elapsed / 5000) % 2;\n  context.strokeStyle = t > 1 ? rainbow2(t - 1) : rainbow1(t);\n  context.lineWidth = 1.5;\n  context.stroke();\n});\n\nfunction drawPoint(point) {\n  context.moveTo(point[0] + 1.5, point[1]);\n  context.arc(point[0], point[1], 1.5, 0, 2 * Math.PI);\n}\n\nfunction drawPolygon(points) {\n  context.moveTo(points[0][0], points[0][1]);\n  for (var i = 1, n = points.length; i < n; ++i) context.lineTo(points[i][0], points[i][1]);\n  context.closePath();\n}\n\nfunction drawRoundedPolygon(points, r) {\n  var i,\n      n = points.length,\n      p0,\n      p1,\n      p2,\n      p3,\n      n1 = 0,\n      t012,\n      t123,\n      x21, y21,\n      x4, y4,\n      x5, y5,\n      moved,\n      circle = polygonIncircle(points);\n\n  // Build a linked list from the array of vertices so we can splice.\n  for (i = 0, p1 = points[n - 2], p2 = points[n - 1]; i < n; ++i) {\n    p0 = p1, p1 = p2, p2 = points[i];\n    p1.previous = p0;\n    p1.next = p2;\n  }\n\n  // The rounding radius can’t be bigger than the polygon’s incircle.\n  // The fudge factor of 1px lets the rounded polygon get squished a bit.\n  // TODO Abort the search for the incircle if one is found larger than r.\n  r = Math.min(r, circle.radius - 1);\n  if (r <= 0) return;\n\n  // TODO do we need to make all these extra passes?\n  for (i = 0, p3 = p2.next; n1 <= n; ++n1) {\n    p0 = p1, p1 = p2, p2 = p3, p3 = p3.next;\n    t012 = cornerTangent(p0[0], p0[1], p1[0], p1[1], p2[0], p2[1], r);\n    t123 = 1 - cornerTangent(p3[0], p3[1], p2[0], p2[1], p1[0], p1[1], r);\n\n    // If the following corner’s tangent is before this corner’s tangent,\n    // replace p1 and p2 with the intersection of the lines 01 and 23.\n    if (t012 >= t123) {\n      p2 = p0.next = p3.previous = lineLineIntersection(p0[0], p0[1], p1[0], p1[1], p2[0], p2[1], p3[0], p3[1]);\n      p2.previous = p0;\n      p2.next = p3;\n      p3 = p2;\n      p2 = p3.previous;\n      p1 = p2.previous;\n      p0 = p1.previous;\n      n1 = 0;\n      if (--n < 3) break;\n    }\n  }\n\n  // If we removed too many points, just draw the previously computed incircle.\n  if (n < 3) {\n    context.moveTo(circle[0] + circle.radius, circle[1]);\n    context.arc(circle[0], circle[1], circle.radius, 0, 2 * Math.PI);\n    return;\n  }\n\n  // Draw the rounded polygon, compting the corner tangents.\n  for (i = 0; i <= n; ++i) {\n    p0 = p1, p1 = p2, p2 = p3, p3 = p3.next;\n    t012 = cornerTangent(p0[0], p0[1], p1[0], p1[1], p2[0], p2[1], r);\n    t123 = 1 - cornerTangent(p3[0], p3[1], p2[0], p2[1], p1[0], p1[1], r);\n    x21 = p2[0] - p1[0], y21 = p2[1] - p1[1];\n    x4 = p1[0] + t012 * x21, y4 = p1[1] + t012 * y21;\n    x5 = p1[0] + t123 * x21, y5 = p1[1] + t123 * y21;\n    if (moved) context.arcTo(p1[0], p1[1], x4, y4, r);\n    else moved = true, context.moveTo(x4, y4);\n    context.lineTo(x5, y5);\n  }\n}\n\n// Given a circle of radius r that is tangent to the line segments 01 and 12,\n// returns the parameter t of the tangent along the line segment 12.\nfunction cornerTangent(x0, y0, x1, y1, x2, y2, r) {\n  var theta = innerAngle(x0, y0, x1, y1, x2, y2),\n      x21 = x2 - x1, y21 = y2 - y1,\n      l21 = Math.sqrt(x21 * x21 + y21 * y21),\n      l14 = r / Math.tan(theta / 2);\n  return l14 / l21;\n}\n\n// A horrible brute-force algorithm for determining the largest circle that can\n// fit inside a convex polygon. For each distinct set of three sides of the\n// polygon, compute the tangent circle. Then reduce the circle’s radius against\n// the remaining sides of the polygon.\nfunction polygonIncircle(points) {\n  var circle = {radius: 0};\n\n  for (var i = 0, n = points.length; i < n; ++i) {\n    var pi0 = points[i],\n        pi1 = points[(i + 1) % n];\n    for (var j = i + 1; j < n; ++j) {\n      var pj0 = points[j],\n          pj1 = points[(j + 1) % n],\n          pij = j === i + 1 ? pj0 : lineLineIntersection(pi0[0], pi0[1], pi1[0], pi1[1], pj0[0], pj0[1], pj1[0], pj1[1]);\n      search: for (var k = j + 1; k < n; ++k) {\n        var pk0 = points[k],\n            pk1 = points[(k + 1) % n],\n            pik = lineLineIntersection(pi0[0], pi0[1], pi1[0], pi1[1], pk0[0], pk0[1], pk1[0], pk1[1]),\n            pjk = k === j + 1 ? pk0 : lineLineIntersection(pj0[0], pj0[1], pj1[0], pj1[1], pk0[0], pk0[1], pk1[0], pk1[1]),\n            candidate = triangleIncircle(pij[0], pij[1], pik[0], pik[1], pjk[0], pjk[1]),\n            radius = candidate.radius;\n\n        for (var l = 0; l < n; ++l) {\n          var pl0 = points[l],\n              pl1 = points[(l + 1) % n],\n              r = pointLineDistance(candidate[0], candidate[1], pl0[0], pl0[1], pl1[0], pl1[1]);\n          if (r < circle.radius) continue search;\n          if (r < radius) radius = r;\n        }\n\n        circle = candidate;\n        circle.radius = radius;\n      }\n    }\n  }\n\n  return circle;\n}\n\n// Returns the angle between segments 01 and 12.\nfunction innerAngle(x0, y0, x1, y1, x2, y2) {\n  var x01 = x0 - x1, y01 = y0 - y1,\n      x12 = x1 - x2, y12 = y1 - y2,\n      x02 = x0 - x2, y02 = y0 - y2,\n      l01_2 = x01 * x01 + y01 * y01,\n      l12_2 = x12 * x12 + y12 * y12,\n      l02_2 = x02 * x02 + y02 * y02;\n  return Math.acos((l12_2 + l01_2 - l02_2) / (2 * Math.sqrt(l12_2 * l01_2)));\n}\n\n// Returns the intersection of the infinite lines 01 and 23.\nfunction lineLineIntersection(x0, y0, x1, y1, x2, y2, x3, y3) {\n  var x02 = x0 - x2, y02 = y0 - y2,\n      x10 = x1 - x0, y10 = y1 - y0,\n      x32 = x3 - x2, y32 = y3 - y2,\n      t = (x32 * y02 - y32 * x02) / (y32 * x10 - x32 * y10);\n  return [x0 + t * x10, y0 + t * y10];\n}\n\n// Returns the signed distance from point 0 to the infinite line 12.\nfunction pointLineDistance(x0, y0, x1, y1, x2, y2) {\n  var x21 = x2 - x1, y21 = y2 - y1;\n  return (y21 * x0 - x21 * y0 + x2 * y1 - y2 * x1) / Math.sqrt(y21 * y21 + x21 * x21);\n}\n\n// Returns the largest circle inside the triangle 012.\nfunction triangleIncircle(x0, y0, x1, y1, x2, y2) {\n  var x01 = x0 - x1, y01 = y0 - y1,\n      x02 = x0 - x2, y02 = y0 - y2,\n      x12 = x1 - x2, y12 = y1 - y2,\n      l01 = Math.sqrt(x01 * x01 + y01 * y01),\n      l02 = Math.sqrt(x02 * x02 + y02 * y02),\n      l12 = Math.sqrt(x12 * x12 + y12 * y12),\n      k0 = l01 / (l01 + l02),\n      k1 = l12 / (l12 + l01),\n      center = lineLineIntersection(x0, y0, x1 - k0 * x12, y1 - k0 * y12, x1, y1, x2 + k1 * x02, y2 + k1 * y02);\n  center.radius = Math.sqrt((l02 + l12 - l01) * (l12 + l01 - l02) * (l01 + l02 - l12) / (l01 + l02 + l12)) / 2;\n  return center;\n}\n\n</script>\n","filenames":[".block","index.html","thumbnail.png"],"thumb":"a668f9c1749bb14746b218f4a3fa8872b7c3cf2e"},"sort":[1436488184000]},{"_index":"blockbuilder","_type":"blocks","_id":"d1d81455dc21e10f742f","_score":null,"_source":{"userId":"mbostock","description":"Voronoi Circles","created_at":"2015-07-09T22:59:30Z","updated_at":"2016-02-09T01:49:34Z","api":[],"colors":["#dddddd","#aaaaaa","#000000","#ff0000","#d2b48c"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script>\n\n/* https://github.com/d3/d3-voronoi Copyright 2015 Mike Bostock */\n!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t(e.voronoi={})}(this,function(e){\"use strict\";function t(e){return function(){return e}}function n(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function i(e,t){return t.angle-e.angle}function r(e,t){this.l=e,this.r=t,this.a=this.b=null}function s(e,t,n){var i=new r(e,null);return i.a=t,i.b=n,D.push(i),i}function u(e,t,n){this.edge=e,this.site=t,this.angle=n}function f(e,t,n){var i=e.a,r=e.b;return new u(e,t,n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y))}function a(e,t,n,i){for(var r,u,a,l,o,c,h,y,x,v,g=B.length;g--;)if(o=B[g],o&&o.prepare())for(h=o.edges,y=h.length,c=0;y>c;)v=h[c].end(),a=v.x,l=v.y,x=h[++c%y].start(),r=x.x,u=x.y,(Math.abs(a-r)>I||Math.abs(l-u)>I)&&(h.splice(c,0,f(s(o.site,v,Math.abs(a-e)<I&&i-l>I?{x:e,y:Math.abs(r-e)<I?u:i}:Math.abs(l-i)<I&&n-a>I?{x:Math.abs(u-i)<I?r:n,y:i}:Math.abs(a-n)<I&&l-t>I?{x:n,y:Math.abs(r-n)<I?u:t}:Math.abs(l-t)<I&&a-e>I?{x:Math.abs(u-t)<I?r:e,y:t}:null),o.site,null)),++y)}function l(e,t,n,i,r){var s,u=e.a,f=e.b,a=u.x,l=u.y,o=f.x,c=f.y,h=0,y=1,x=o-a,v=c-l;if(s=t-a,x||!(s>0)){if(s/=x,0>x){if(h>s)return;y>s&&(y=s)}else if(x>0){if(s>y)return;s>h&&(h=s)}if(s=i-a,x||!(0>s)){if(s/=x,0>x){if(s>y)return;s>h&&(h=s)}else if(x>0){if(h>s)return;y>s&&(y=s)}if(s=n-l,v||!(s>0)){if(s/=v,0>v){if(h>s)return;y>s&&(y=s)}else if(v>0){if(s>y)return;s>h&&(h=s)}if(s=r-l,v||!(0>s)){if(s/=v,0>v){if(s>y)return;s>h&&(h=s)}else if(v>0){if(h>s)return;y>s&&(y=s)}return h>0&&(e.a={x:a+h*x,y:l+h*v}),1>y&&(e.b={x:a+y*x,y:l+y*v}),e}}}}}function o(e,t,n,i,r){var s=e.b;if(s)return!0;var u,f,a=e.a,l=e.l,o=e.r,c=l.x,h=l.y,y=o.x,x=o.y,v=(c+y)/2,g=(h+x)/2;if(x===h){if(t>v||v>=i)return;if(c>y){if(a){if(a.y>=r)return}else a={x:v,y:n};s={x:v,y:r}}else{if(a){if(a.y<n)return}else a={x:v,y:r};s={x:v,y:n}}}else if(u=(c-y)/(x-h),f=g-u*v,-1>u||u>1)if(c>y){if(a){if(a.y>=r)return}else a={x:(n-f)/u,y:n};s={x:(r-f)/u,y:r}}else{if(a){if(a.y<n)return}else a={x:(r-f)/u,y:r};s={x:(n-f)/u,y:n}}else if(x>h){if(a){if(a.x>=i)return}else a={x:t,y:u*t+f};s={x:i,y:u*i+f}}else{if(a){if(a.x<t)return}else a={x:i,y:u*i+f};s={x:t,y:u*t+f}}return e.a=a,e.b=s,!0}function c(e,t,n,i){for(var r,s=D.length;s--;)r=D[s],(!o(r,e,t,n,i)||!l(r,e,t,n,i)||Math.abs(r.a.x-r.b.x)<I&&Math.abs(r.a.y-r.b.y)<I)&&(r.a=r.b=null,D.splice(s,1))}function h(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function y(e){var t=e.circle;t&&(t.P||(J=t.N),F.remove(t),K.push(t),h(t),e.circle=null)}function x(){h(this),this.x=this.y=this.arc=this.site=this.cy=null}function v(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,s=n.site;if(i!==s){var u=r.x,f=r.y,a=i.x-u,l=i.y-f,o=s.x-u,c=s.y-f,h=2*(a*c-l*o);if(!(h>=-O)){var y=a*a+l*l,v=o*o+c*c,g=(c*y-l*v)/h,C=(a*v-o*y)/h,c=C+f,d=K.pop()||new x;d.arc=e,d.site=r,d.x=g+u,d.y=c+Math.sqrt(g*g+C*C),d.cy=c,e.circle=d;for(var p=null,L=F._;L;)if(d.y<L.y||d.y===L.y&&d.x<=L.x){if(!L.L){p=L.P;break}L=L.L}else{if(!L.R){p=L;break}L=L.R}F.insert(p,d),p||(J=d)}}}}function g(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function C(e,t,n,i){var s=new r(e,t);return D.push(s),n&&g(s,e,t,n),i&&g(s,t,e,i),B[e.i].edges.push(f(s,e,t)),B[t.i].edges.push(f(s,t,e)),s}function d(){h(this),this.edge=this.site=this.circle=null}function p(e){var t=Q.pop()||new d;return t.site=e,t}function L(e){y(e),G.remove(e),Q.push(e),h(e)}function b(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},s=e.P,u=e.N,f=[e];L(e);for(var a=s;a.circle&&Math.abs(n-a.circle.x)<I&&Math.abs(i-a.circle.cy)<I;)s=a.P,f.unshift(a),L(a),a=s;f.unshift(a),y(a);for(var l=u;l.circle&&Math.abs(n-l.circle.x)<I&&Math.abs(i-l.circle.cy)<I;)u=l.N,f.push(l),L(l),l=u;f.push(l),y(l);var o,c=f.length;for(o=1;c>o;++o)l=f[o],a=f[o-1],g(l.edge,a.site,l.site,r);a=f[0],l=f[c-1],l.edge=C(a.site,l.site,null,r),v(a),v(l)}function R(e){this.site=e,this.edges=[]}function M(e){return B[e.i]=new R(e)}function U(e,t){var n=e.site,i=n.x,r=n.y,s=r-t;if(!s)return i;var u=e.P;if(!u)return-(1/0);n=u.site;var f=n.x,a=n.y,l=a-t;if(!l)return f;var o=f-i,c=1/s-1/l,h=o/l;return c?(-h+Math.sqrt(h*h-2*c*(o*o/(-2*l)-a+l/2+r-s/2)))/c+i:(i+f)/2}function N(e,t){var n=e.N;if(n)return U(n,t);var i=e.site;return i.y===t?i.x:1/0}function P(e){for(var t,n,i,r,s=e.x,u=e.y,f=G._;f;)if(i=U(f,u)-s,i>I)f=f.L;else{if(r=s-N(f,u),!(r>I)){i>-I?(t=f.P,n=f):r>-I?(t=f,n=f.N):t=n=f;break}if(!f.R){t=f;break}f=f.R}M(e);var a=p(e);if(G.insert(t,a),t||n){if(t===n)return y(t),n=p(t.site),G.insert(a,n),a.edge=n.edge=C(t.site,a.site),v(t),void v(n);if(!n)return void(a.edge=C(t.site,a.site));y(t),y(n);var l=t.site,o=l.x,c=l.y,h=e.x-o,x=e.y-c,d=n.site,L=d.x-o,b=d.y-c,R=2*(h*b-x*L),P=h*h+x*x,_=L*L+b*b,m={x:(b*P-x*_)/R+o,y:(h*_-L*P)/R+c};g(n.edge,l,d,m),a.edge=C(l,e,null,m),n.edge=C(e,d,null,m),v(t),v(n)}}function _(){this._=null}function m(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function w(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function k(e){for(;e.L;)e=e.L;return e}function q(e,t){return t.y-e.y||t.x-e.x}function A(e,t){var n,i,r,s=e.sort(q).pop();for(D=[],B=new Array(e.length),G=new _,F=new _;;)if(r=J,s&&(!r||s.y<r.y||s.y===r.y&&s.x<r.x))(s.x!==n||s.y!==i)&&(P(s),n=s.x,i=s.y),s=e.pop();else{if(!r)break;b(r.arc)}if(t){var n=t[0][0],i=t[0][1],u=t[1][0],f=t[1][1];c(n,i,u,f),a(n,i,u,f)}var l={cells:B,edges:D};return G=F=D=B=null,l}function E(e){return e[1]}function j(e){return e[0]}function z(){function e(e){var t=new Array(e.length),n=l[0][0],i=l[0][1],s=l[1][0],u=l[1][1];return A(r(e),l).cells.forEach(function(r,f){var a=r.edges,l=r.site,o=t[f]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):l.x>=n&&l.x<=s&&l.y>=i&&l.y<=u?[[n,u],[s,u],[s,i],[n,i]]:[];o.point=e[f]}),t}function r(e){return e.map(function(e,t){return{x:Math.round(f(e,t)/I)*I,y:Math.round(a(e,t)/I)*I,i:t}})}var s=j,u=E,f=s,a=u,l=H;return e.links=function(e){return A(r(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},e.triangles=function(e){var t=[];return A(r(e)).cells.forEach(function(r,s){for(var u,f,a=r.site,l=r.edges.sort(i),o=-1,c=l.length,h=l[c-1].edge,y=h.l===a?h.r:h.l;++o<c;)u=h,f=y,h=l[o].edge,y=h.l===a?h.r:h.l,s<f.i&&s<y.i&&n(a,f,y)<0&&t.push([e[s],e[f.i],e[y.i]])}),t},e.x=function(n){return arguments.length?(s=n,f=\"function\"==typeof n?s:t(s),e):s},e.y=function(n){return arguments.length?(u=n,a=\"function\"==typeof n?u:t(u),e):u},e.extent=function(t){return arguments.length?(l=null==t?H:t,e):l===H?null:l},e.size=function(t){return arguments.length?e.extent(t&&[[0,0],t]):l===H?null:l&&l[1]},e}var B,D,F,G,H=[[-1e6,-1e6],[1e6,1e6]],I=1e-6;u.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}};var J,K=[],O=1e-12,Q=[];R.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(i),t.length},_.prototype={insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=k(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(w(this,n),e=n,n=e.U),n.C=!1,i.C=!0,m(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(m(this,n),e=n,n=e.U),n.C=!1,i.C=!0,w(this,i))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,s=e.L,u=e.R;if(n=s?u?k(u):s:u,r?r.L===e?r.L=n:r.R=n:this._=n,s&&u?(i=n.C,n.C=e.C,n.L=s,s.U=n,n!==u?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=u,u.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,w(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,m(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,w(this,r),e=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,m(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,w(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,m(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}},e.voronoi=z});\n\n/* https://github.com/d3/d3-timer Copyright 2015 Mike Bostock */\n\"undefined\"==typeof requestAnimationFrame&&(requestAnimationFrame=\"undefined\"!=typeof window&&(window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame)||function(e){return setTimeout(e,17)}),function(e,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?n(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],n):n(e.timer={})}(this,function(e){\"use strict\";function n(){r=m=0,c=1/0,t(u())}function t(e){if(!r){var t=e-Date.now();t>24?c>e&&(m&&clearTimeout(m),m=setTimeout(n,t),c=e):(m&&(m=clearTimeout(m),c=1/0),r=requestAnimationFrame(n))}}function i(e,n,i){i=null==i?Date.now():+i,null!=n&&(i+=+n);var o={callback:e,time:i,flush:!1,next:null};a?a.next=o:f=o,a=o,t(i)}function o(e,n,t){t=null==t?Date.now():+t,null!=n&&(t+=+n),l.callback=e,l.time=t}function u(e){e=null==e?Date.now():+e;var n=l;for(l=f;l;)e>=l.time&&(l.flush=l.callback(e-l.time,e)),l=l.next;l=n,e=1/0;for(var t,i=f;i;)i.flush?i=t?t.next=i.next:f=i.next:(i.time<e&&(e=i.time),i=(t=i).next);return a=t,e}var a,m,r,f,l,c=1/0;e.timer=i,e.timerReplace=o,e.timerFlush=u});\n\nvar canvas = document.querySelector(\"canvas\"),\n    width = canvas.width,\n    height = canvas.height,\n    context = canvas.getContext(\"2d\"),\n    voro = voronoi.voronoi().extent([[0.5, 0.5], [width - 0.5, height - 0.5]]);\n\nvar n = 100,\n    particles = new Array(n);\n\nfor (var i = 0; i < n; ++i) particles[i] = {0: Math.random() * width, 1: Math.random() * height, vx: 0, vy: 0};\n\ntimer.timer(function(elapsed) {\n  for (var i = 0; i < n; ++i) {\n    var p = particles[i];\n    p[0] += p.vx; if (p[0] < 0) p[0] = p.vx *= -1; else if (p[0] > width) p[0] = width + (p.vx *= -1);\n    p[1] += p.vy; if (p[1] < 0) p[1] = p.vy *= -1; else if (p[1] > height) p[1] = height + (p.vy *= -1);\n    p.vx += 0.1 * (Math.random() - .5) - 0.01 * p.vx;\n    p.vy += 0.1 * (Math.random() - .5) - 0.01 * p.vy;\n  }\n\n  var cells = voro(particles);\n  context.clearRect(0, 0, width, height);\n\n  context.beginPath();\n  cells.forEach(function(cell) { drawPolygonIncircle(cell, -2.5); });\n  context.fillStyle = \"#ddd\";\n  context.fill();\n\n  context.beginPath();\n  cells.forEach(function(cell) { drawPolygon(cell); });\n  context.lineWidth = 1;\n  context.strokeStyle = \"#aaa\";\n  context.stroke();\n\n  context.beginPath();\n  particles.forEach(function(particle) { drawPoint(particle); });\n  context.fillStyle = \"#000\";\n  context.fill();\n});\n\nfunction drawPoint(point) {\n  context.moveTo(point[0] + 1.5, point[1]);\n  context.arc(point[0], point[1], 1.5, 0, 2 * Math.PI);\n}\n\nfunction drawPolygon(points) {\n  context.moveTo(points[0][0], points[0][1]);\n  for (var i = 1, n = points.length; i < n; ++i) context.lineTo(points[i][0], points[i][1]);\n  context.closePath();\n}\n\nfunction drawPolygonIncircle(points, offsetRadius) {\n  var circle = polygonIncircle(points),\n      radius = circle.radius + offsetRadius;\n  if (radius > 0) {\n    context.moveTo(circle[0] + radius, circle[1]);\n    context.arc(circle[0], circle[1], radius, 0, 2 * Math.PI);\n  }\n}\n\n// A horrible brute-force algorithm for determining the largest circle that can\n// fit inside a convex polygon. For each distinct set of three sides of the\n// polygon, compute the tangent circle. Then reduce the circle’s radius against\n// the remaining sides of the polygon.\nfunction polygonIncircle(points) {\n  var circle = {radius: 0};\n\n  for (var i = 0, n = points.length; i < n; ++i) {\n    var pi0 = points[i],\n        pi1 = points[(i + 1) % n];\n    for (var j = i + 1; j < n; ++j) {\n      var pj0 = points[j],\n          pj1 = points[(j + 1) % n],\n          pij = j === i + 1 ? pj0 : lineLineIntersection(pi0[0], pi0[1], pi1[0], pi1[1], pj0[0], pj0[1], pj1[0], pj1[1]);\n      search: for (var k = j + 1; k < n; ++k) {\n        var pk0 = points[k],\n            pk1 = points[(k + 1) % n],\n            pik = lineLineIntersection(pi0[0], pi0[1], pi1[0], pi1[1], pk0[0], pk0[1], pk1[0], pk1[1]),\n            pjk = k === j + 1 ? pk0 : lineLineIntersection(pj0[0], pj0[1], pj1[0], pj1[1], pk0[0], pk0[1], pk1[0], pk1[1]),\n            candidate = triangleIncircle(pij[0], pij[1], pik[0], pik[1], pjk[0], pjk[1]),\n            radius = candidate.radius;\n\n        for (var l = 0; l < n; ++l) {\n          var pl0 = points[l],\n              pl1 = points[(l + 1) % n],\n              r = pointLineDistance(candidate[0], candidate[1], pl0[0], pl0[1], pl1[0], pl1[1]);\n          if (r < circle.radius) continue search;\n          if (r < radius) radius = r;\n        }\n\n        circle = candidate;\n        circle.radius = radius;\n      }\n    }\n  }\n\n  return circle;\n}\n\n// Returns the incircle of the triangle 012.\nfunction triangleIncircle(x0, y0, x1, y1, x2, y2) {\n  var x01 = x0 - x1, y01 = y0 - y1,\n      x02 = x0 - x2, y02 = y0 - y2,\n      x12 = x1 - x2, y12 = y1 - y2,\n      l01 = Math.sqrt(x01 * x01 + y01 * y01),\n      l02 = Math.sqrt(x02 * x02 + y02 * y02),\n      l12 = Math.sqrt(x12 * x12 + y12 * y12),\n      k0 = l01 / (l01 + l02),\n      k1 = l12 / (l12 + l01),\n      center = lineLineIntersection(x0, y0, x1 - k0 * x12, y1 - k0 * y12, x1, y1, x2 + k1 * x02, y2 + k1 * y02);\n  center.radius = Math.sqrt((l02 + l12 - l01) * (l12 + l01 - l02) * (l01 + l02 - l12) / (l01 + l02 + l12)) / 2;\n  return center;\n}\n\n// Returns the intersection of the infinite lines 01 and 23.\nfunction lineLineIntersection(x0, y0, x1, y1, x2, y2, x3, y3) {\n  var x02 = x0 - x2, y02 = y0 - y2,\n      x10 = x1 - x0, y10 = y1 - y0,\n      x32 = x3 - x2, y32 = y3 - y2,\n      t = (x32 * y02 - y32 * x02) / (y32 * x10 - x32 * y10);\n  return [x0 + t * x10, y0 + t * y10];\n}\n\n// Returns the signed distance from point 0 to the infinite line 12.\nfunction pointLineDistance(x0, y0, x1, y1, x2, y2) {\n  var x21 = x2 - x1, y21 = y2 - y1;\n  return (y21 * x0 - x21 * y0 + x2 * y1 - y2 * x1) / Math.sqrt(y21 * y21 + x21 * x21);\n}\n\n</script>\n","filenames":[".block","index.html","thumbnail.png"],"thumb":"cec5269bdc8b7c798555add840604c96b2c70b3b"},"sort":[1436482770000]},{"_index":"blockbuilder","_type":"blocks","_id":"1d127e44b53a3cbebe7b","_score":null,"_source":{"userId":"mbostock","description":"Delaunay Circles III","created_at":"2015-07-09T00:49:20Z","updated_at":"2016-02-09T01:49:36Z","api":[],"colors":["#dddddd","#aaaaaa","#000000","#ffc0cb","#ffb6c1","#ff69b4","#ff1493","#db7093","#c71585","#ffa07a","#fa8072","#e9967a","#f08080","#cd5c5c","#dc143c","#b22222","#8b0000","#ff0000","#ff4500","#ff6347","#ff7f50","#ff8c00","#ffa500","#ffff00","#ffffe0","#fffacd","#fafad2","#ffefd5","#ffe4b5","#ffdab9","#eee8aa","#f0e68c","#bdb76b","#ffd700","#fff8dc","#ffebcd","#ffe4c4","#ffdead","#f5deb3","#deb887","#d2b48c","#bc8f8f","#f4a460","#daa520","#b8860b","#cd853f","#d2691e","#8b4513","#a0522d","#a52a2a","#800000","#556b2f","#808000","#6b8e23","#9acd32","#32cd32","#00ff00","#7cfc00","#7fff00","#adff2f","#00ff7f","#00fa9a","#90ee90","#98fb98","#8fbc8f","#3cb371","#2e8b57","#228b22","#008000","#006400","#66cdaa","#00ffff","#e0ffff","#afeeee","#7fffd4","#40e0d0","#48d1cc","#00ced1","#20b2aa","#5f9ea0","#008b8b","#008080","#b0c4de","#b0e0e6","#add8e6","#87ceeb","#87cefa","#00bfff","#1e90ff","#6495ed","#4682b4","#4169e1","#0000ff","#0000cd","#00008b","#000080","#191970","#e6e6fa","#d8bfd8","#dda0dd","#ee82ee","#da70d6","#ff00ff","#ba55d3","#9370db","#8a2be2","#9400d3","#9932cc","#8b008b","#800080","#4b0082","#483d8b","#663399","#6a5acd","#7b68ee","#ffffff","#fffafa","#f0fff0","#f5fffa","#f0ffff","#f0f8ff","#f8f8ff","#f5f5f5","#fff5ee","#f5f5dc","#fdf5e6","#fffaf0","#fffff0","#faebd7","#faf0e6","#fff0f5","#ffe4e1","#dcdcdc","#d3d3d3","#c0c0c0","#a9a9a9","#808080","#696969","#778899","#708090","#2f4f4f"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script>\n\n/* https://github.com/d3/d3-voronoi Copyright 2015 Mike Bostock */\n!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t(e.voronoi={})}(this,function(e){\"use strict\";function t(e){return function(){return e}}function n(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function i(e,t){return t.angle-e.angle}function r(e,t){this.l=e,this.r=t,this.a=this.b=null}function s(e,t,n){var i=new r(e,null);return i.a=t,i.b=n,D.push(i),i}function u(e,t,n){this.edge=e,this.site=t,this.angle=n}function f(e,t,n){var i=e.a,r=e.b;return new u(e,t,n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y))}function a(e,t,n,i){for(var r,u,a,l,o,c,h,y,x,v,g=B.length;g--;)if(o=B[g],o&&o.prepare())for(h=o.edges,y=h.length,c=0;y>c;)v=h[c].end(),a=v.x,l=v.y,x=h[++c%y].start(),r=x.x,u=x.y,(Math.abs(a-r)>I||Math.abs(l-u)>I)&&(h.splice(c,0,f(s(o.site,v,Math.abs(a-e)<I&&i-l>I?{x:e,y:Math.abs(r-e)<I?u:i}:Math.abs(l-i)<I&&n-a>I?{x:Math.abs(u-i)<I?r:n,y:i}:Math.abs(a-n)<I&&l-t>I?{x:n,y:Math.abs(r-n)<I?u:t}:Math.abs(l-t)<I&&a-e>I?{x:Math.abs(u-t)<I?r:e,y:t}:null),o.site,null)),++y)}function l(e,t,n,i,r){var s,u=e.a,f=e.b,a=u.x,l=u.y,o=f.x,c=f.y,h=0,y=1,x=o-a,v=c-l;if(s=t-a,x||!(s>0)){if(s/=x,0>x){if(h>s)return;y>s&&(y=s)}else if(x>0){if(s>y)return;s>h&&(h=s)}if(s=i-a,x||!(0>s)){if(s/=x,0>x){if(s>y)return;s>h&&(h=s)}else if(x>0){if(h>s)return;y>s&&(y=s)}if(s=n-l,v||!(s>0)){if(s/=v,0>v){if(h>s)return;y>s&&(y=s)}else if(v>0){if(s>y)return;s>h&&(h=s)}if(s=r-l,v||!(0>s)){if(s/=v,0>v){if(s>y)return;s>h&&(h=s)}else if(v>0){if(h>s)return;y>s&&(y=s)}return h>0&&(e.a={x:a+h*x,y:l+h*v}),1>y&&(e.b={x:a+y*x,y:l+y*v}),e}}}}}function o(e,t,n,i,r){var s=e.b;if(s)return!0;var u,f,a=e.a,l=e.l,o=e.r,c=l.x,h=l.y,y=o.x,x=o.y,v=(c+y)/2,g=(h+x)/2;if(x===h){if(t>v||v>=i)return;if(c>y){if(a){if(a.y>=r)return}else a={x:v,y:n};s={x:v,y:r}}else{if(a){if(a.y<n)return}else a={x:v,y:r};s={x:v,y:n}}}else if(u=(c-y)/(x-h),f=g-u*v,-1>u||u>1)if(c>y){if(a){if(a.y>=r)return}else a={x:(n-f)/u,y:n};s={x:(r-f)/u,y:r}}else{if(a){if(a.y<n)return}else a={x:(r-f)/u,y:r};s={x:(n-f)/u,y:n}}else if(x>h){if(a){if(a.x>=i)return}else a={x:t,y:u*t+f};s={x:i,y:u*i+f}}else{if(a){if(a.x<t)return}else a={x:i,y:u*i+f};s={x:t,y:u*t+f}}return e.a=a,e.b=s,!0}function c(e,t,n,i){for(var r,s=D.length;s--;)r=D[s],(!o(r,e,t,n,i)||!l(r,e,t,n,i)||Math.abs(r.a.x-r.b.x)<I&&Math.abs(r.a.y-r.b.y)<I)&&(r.a=r.b=null,D.splice(s,1))}function h(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function y(e){var t=e.circle;t&&(t.P||(J=t.N),F.remove(t),K.push(t),h(t),e.circle=null)}function x(){h(this),this.x=this.y=this.arc=this.site=this.cy=null}function v(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,s=n.site;if(i!==s){var u=r.x,f=r.y,a=i.x-u,l=i.y-f,o=s.x-u,c=s.y-f,h=2*(a*c-l*o);if(!(h>=-O)){var y=a*a+l*l,v=o*o+c*c,g=(c*y-l*v)/h,C=(a*v-o*y)/h,c=C+f,d=K.pop()||new x;d.arc=e,d.site=r,d.x=g+u,d.y=c+Math.sqrt(g*g+C*C),d.cy=c,e.circle=d;for(var p=null,L=F._;L;)if(d.y<L.y||d.y===L.y&&d.x<=L.x){if(!L.L){p=L.P;break}L=L.L}else{if(!L.R){p=L;break}L=L.R}F.insert(p,d),p||(J=d)}}}}function g(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function C(e,t,n,i){var s=new r(e,t);return D.push(s),n&&g(s,e,t,n),i&&g(s,t,e,i),B[e.i].edges.push(f(s,e,t)),B[t.i].edges.push(f(s,t,e)),s}function d(){h(this),this.edge=this.site=this.circle=null}function p(e){var t=Q.pop()||new d;return t.site=e,t}function L(e){y(e),G.remove(e),Q.push(e),h(e)}function b(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},s=e.P,u=e.N,f=[e];L(e);for(var a=s;a.circle&&Math.abs(n-a.circle.x)<I&&Math.abs(i-a.circle.cy)<I;)s=a.P,f.unshift(a),L(a),a=s;f.unshift(a),y(a);for(var l=u;l.circle&&Math.abs(n-l.circle.x)<I&&Math.abs(i-l.circle.cy)<I;)u=l.N,f.push(l),L(l),l=u;f.push(l),y(l);var o,c=f.length;for(o=1;c>o;++o)l=f[o],a=f[o-1],g(l.edge,a.site,l.site,r);a=f[0],l=f[c-1],l.edge=C(a.site,l.site,null,r),v(a),v(l)}function R(e){this.site=e,this.edges=[]}function M(e){return B[e.i]=new R(e)}function U(e,t){var n=e.site,i=n.x,r=n.y,s=r-t;if(!s)return i;var u=e.P;if(!u)return-(1/0);n=u.site;var f=n.x,a=n.y,l=a-t;if(!l)return f;var o=f-i,c=1/s-1/l,h=o/l;return c?(-h+Math.sqrt(h*h-2*c*(o*o/(-2*l)-a+l/2+r-s/2)))/c+i:(i+f)/2}function N(e,t){var n=e.N;if(n)return U(n,t);var i=e.site;return i.y===t?i.x:1/0}function P(e){for(var t,n,i,r,s=e.x,u=e.y,f=G._;f;)if(i=U(f,u)-s,i>I)f=f.L;else{if(r=s-N(f,u),!(r>I)){i>-I?(t=f.P,n=f):r>-I?(t=f,n=f.N):t=n=f;break}if(!f.R){t=f;break}f=f.R}M(e);var a=p(e);if(G.insert(t,a),t||n){if(t===n)return y(t),n=p(t.site),G.insert(a,n),a.edge=n.edge=C(t.site,a.site),v(t),void v(n);if(!n)return void(a.edge=C(t.site,a.site));y(t),y(n);var l=t.site,o=l.x,c=l.y,h=e.x-o,x=e.y-c,d=n.site,L=d.x-o,b=d.y-c,R=2*(h*b-x*L),P=h*h+x*x,_=L*L+b*b,m={x:(b*P-x*_)/R+o,y:(h*_-L*P)/R+c};g(n.edge,l,d,m),a.edge=C(l,e,null,m),n.edge=C(e,d,null,m),v(t),v(n)}}function _(){this._=null}function m(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function w(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function k(e){for(;e.L;)e=e.L;return e}function q(e,t){return t.y-e.y||t.x-e.x}function A(e,t){var n,i,r,s=e.sort(q).pop();for(D=[],B=new Array(e.length),G=new _,F=new _;;)if(r=J,s&&(!r||s.y<r.y||s.y===r.y&&s.x<r.x))(s.x!==n||s.y!==i)&&(P(s),n=s.x,i=s.y),s=e.pop();else{if(!r)break;b(r.arc)}if(t){var n=t[0][0],i=t[0][1],u=t[1][0],f=t[1][1];c(n,i,u,f),a(n,i,u,f)}var l={cells:B,edges:D};return G=F=D=B=null,l}function E(e){return e[1]}function j(e){return e[0]}function z(){function e(e){var t=new Array(e.length),n=l[0][0],i=l[0][1],s=l[1][0],u=l[1][1];return A(r(e),l).cells.forEach(function(r,f){var a=r.edges,l=r.site,o=t[f]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):l.x>=n&&l.x<=s&&l.y>=i&&l.y<=u?[[n,u],[s,u],[s,i],[n,i]]:[];o.point=e[f]}),t}function r(e){return e.map(function(e,t){return{x:Math.round(f(e,t)/I)*I,y:Math.round(a(e,t)/I)*I,i:t}})}var s=j,u=E,f=s,a=u,l=H;return e.links=function(e){return A(r(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},e.triangles=function(e){var t=[];return A(r(e)).cells.forEach(function(r,s){for(var u,f,a=r.site,l=r.edges.sort(i),o=-1,c=l.length,h=l[c-1].edge,y=h.l===a?h.r:h.l;++o<c;)u=h,f=y,h=l[o].edge,y=h.l===a?h.r:h.l,s<f.i&&s<y.i&&n(a,f,y)<0&&t.push([e[s],e[f.i],e[y.i]])}),t},e.x=function(n){return arguments.length?(s=n,f=\"function\"==typeof n?s:t(s),e):s},e.y=function(n){return arguments.length?(u=n,a=\"function\"==typeof n?u:t(u),e):u},e.extent=function(t){return arguments.length?(l=null==t?H:t,e):l===H?null:l},e.size=function(t){return arguments.length?e.extent(t&&[[0,0],t]):l===H?null:l&&l[1]},e}var B,D,F,G,H=[[-1e6,-1e6],[1e6,1e6]],I=1e-6;u.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}};var J,K=[],O=1e-12,Q=[];R.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(i),t.length},_.prototype={insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=k(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(w(this,n),e=n,n=e.U),n.C=!1,i.C=!0,m(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(m(this,n),e=n,n=e.U),n.C=!1,i.C=!0,w(this,i))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,s=e.L,u=e.R;if(n=s?u?k(u):s:u,r?r.L===e?r.L=n:r.R=n:this._=n,s&&u?(i=n.C,n.C=e.C,n.L=s,s.U=n,n!==u?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=u,u.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,w(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,m(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,w(this,r),e=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,m(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,w(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,m(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}},e.voronoi=z});\n\n/* https://github.com/d3/d3-timer Copyright 2015 Mike Bostock */\n\"undefined\"==typeof requestAnimationFrame&&(requestAnimationFrame=\"undefined\"!=typeof window&&(window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame)||function(e){return setTimeout(e,17)}),function(e,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?n(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],n):n(e.timer={})}(this,function(e){\"use strict\";function n(){r=m=0,c=1/0,t(u())}function t(e){if(!r){var t=e-Date.now();t>24?c>e&&(m&&clearTimeout(m),m=setTimeout(n,t),c=e):(m&&(m=clearTimeout(m),c=1/0),r=requestAnimationFrame(n))}}function i(e,n,i){i=null==i?Date.now():+i,null!=n&&(i+=+n);var o={callback:e,time:i,flush:!1,next:null};a?a.next=o:f=o,a=o,t(i)}function o(e,n,t){t=null==t?Date.now():+t,null!=n&&(t+=+n),l.callback=e,l.time=t}function u(e){e=null==e?Date.now():+e;var n=l;for(l=f;l;)e>=l.time&&(l.flush=l.callback(e-l.time,e)),l=l.next;l=n,e=1/0;for(var t,i=f;i;)i.flush?i=t?t.next=i.next:f=i.next:(i.time<e&&(e=i.time),i=(t=i).next);return a=t,e}var a,m,r,f,l,c=1/0;e.timer=i,e.timerReplace=o,e.timerFlush=u});\n\n/* https://github.com/d3/d3-color Copyright 2015 Mike Bostock */\n\"undefined\"==typeof Map?(Map=function(){this.clear()},Map.prototype={set:function(t,e){return this._[t]=e,this},get:function(t){return this._[t]},has:function(t){return t in this._},\"delete\":function(t){return t in this._&&delete this._[t]},clear:function(){this._=Object.create(null)},get size(){var t=0;for(var e in this._)++t;return t},forEach:function(t){for(var e in this._)t(this._[e],e,this)}}):function(){var t=new Map;t.set(0,0)!==t&&(t=t.set,Map.prototype.set=function(){return t.apply(this,arguments),this})}(),function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?e(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],e):e(t.color={})}(this,function(t){\"use strict\";function e(){}function s(t,e,s){this.r=Math.max(0,Math.min(255,Math.round(t))),this.g=Math.max(0,Math.min(255,Math.round(e))),this.b=Math.max(0,Math.min(255,Math.round(s)))}function n(t,e,s){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),isNaN(s)&&(s=0),\"#\"+(16>t?\"0\"+t.toString(16):t.toString(16))+(16>e?\"0\"+e.toString(16):e.toString(16))+(16>s?\"0\"+s.toString(16):s.toString(16))}function r(t,n,r){return 1===arguments.length&&(t instanceof e||(t=l(t)),t?(t=t.rgb(),r=t.b,n=t.g,t=t.r):t=n=r=NaN),new s(t,n,r)}function i(t){return r(t>>16&255,t>>8&255,255&t)}function a(t,e,s){this.h=+t,this.s=Math.max(0,Math.min(1,+e)),this.l=Math.max(0,Math.min(1,+s))}function o(t,e,s){return 255*(60>t?e+(s-e)*t/60:180>t?s:240>t?e+(s-e)*(240-t)/60:e)}function h(t,s,n){if(1===arguments.length)if(t instanceof a)n=t.l,s=t.s,t=t.h;else if(t instanceof e||(t=l(t)),t){if(t instanceof a)return t;t=t.rgb();var r=t.r/255,i=t.g/255,o=t.b/255,h=Math.min(r,i,o),u=Math.max(r,i,o),c=u-h;n=(u+h)/2,c?(s=.5>n?c/(u+h):c/(2-u-h),t=r===u?(i-o)/c+6*(o>i):i===u?(o-r)/c+2:(r-i)/c+4,t*=60):(t=NaN,s=n>0&&1>n?0:t)}else t=s=n=NaN;return new a(t,s,n)}function l(t){var e;return t=(t+\"\").trim().toLowerCase(),(e=R.exec(t))?(e=parseInt(e[1],16),r(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e)):(e=E.exec(t))?i(parseInt(e[1],16)):(e=z.exec(t))?r(e[1],e[2],e[3]):(e=P.exec(t))?r(2.55*e[1],2.55*e[2],2.55*e[3]):(e=O.exec(t))?h(e[1],.01*e[2],.01*e[3]):L.has(t)?i(L.get(t)):null}function u(t,e,s){this.l=+t,this.a=+e,this.b=+s}function c(t){return 255*(.0031308>=t?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function g(t){return t>F?t*t*t:G*(t-D)}function f(t){return t>T?Math.pow(t,1/3):t/G+D}function d(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function p(t,e,s){this.h=+t,this.c=+e,this.l=+s}function b(t,e,n){if(1===arguments.length)if(t instanceof u)n=t.b,e=t.a,t=t.l;else if(t instanceof p){var i=t.h*U;n=Math.sin(i)*t.c,e=Math.cos(i)*t.c,t=t.l}else{t instanceof s||(t=r(t));var a=d(t.r),o=d(t.g),n=d(t.b),h=f((.4124564*a+.3575761*o+.1804375*n)/K),l=f((.2126729*a+.7151522*o+.072175*n)/Q),c=f((.0193339*a+.119192*o+.9503041*n)/J);n=200*(l-c),e=500*(h-l),t=116*l-16}return new u(t,e,n)}function N(t,e,s){return 1===arguments.length&&(t instanceof p?(s=t.l,e=t.c,t=t.h):(t instanceof u||(t=b(t)),s=t.l,e=Math.sqrt(t.a*t.a+t.b*t.b),t=Math.atan2(t.b,t.a)*W,0>t&&(t+=360))),new p(t,e,s)}function m(t,e,s){this.h=+t,this.s=+e,this.l=+s}function w(t,e,n){if(1===arguments.length)if(t instanceof m)n=t.l,e=t.s,t=t.h;else{t instanceof s||(t=r(t));var i=t.r/255,a=t.g/255,o=t.b/255;n=(at*o+it*i-rt*a)/(at+it-rt);var h=o-n,l=(Y*(a-n)-tt*h)/Z,u=Math.pow(n,nt);e=Math.sqrt(l*l+h*h)/(Y*u*(1-u)),t=e?Math.atan2(l,h)*W-120:NaN,0>t&&(t+=360)}return new m(t,e,n)}function y(t,e){t=w(t),e=w(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function v(t,e){var s=(t-e)%360;return s+(s>180?-360:-180>s?360:0)}function M(t,e){t=w(t),e=w(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function k(t,e){t=N(t),e=N(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.c)?e.c:t.c,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.c)?0:e.c-n,o=e.l-r;return function(e){return t.h=s+i*e,t.c=n+a*e,t.l=r+o*e,t+\"\"}}function x(t,e){t=N(t),e=N(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.c)?e.c:t.c,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.c)?0:e.c-n,o=e.l-r;return function(e){return t.h=s+i*e,t.c=n+a*e,t.l=r+o*e,t+\"\"}}function q(t,e){t=b(t),e=b(e);var s=t.l,n=t.a,r=t.b,i=e.l-s,a=e.a-n,o=e.b-r;return function(e){return t.l=s+i*e,t.a=n+a*e,t.b=r+o*e,t+\"\"}}function _(t,e){t=h(t),e=h(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function S(t,e){t=h(t),e=h(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function j(t,e){t=r(t),e=r(e);var s=t.r,i=t.g,a=t.b,o=e.r-s,h=e.g-i,l=e.b-a;return function(t){return n(Math.round(s+o*t),Math.round(i+h*t),Math.round(a+l*t))}}e.prototype={toString:function(){return this.rgb()+\"\"}};var L=(new Map).set(\"aliceblue\",15792383).set(\"antiquewhite\",16444375).set(\"aqua\",65535).set(\"aquamarine\",8388564).set(\"azure\",15794175).set(\"beige\",16119260).set(\"bisque\",16770244).set(\"black\",0).set(\"blanchedalmond\",16772045).set(\"blue\",255).set(\"blueviolet\",9055202).set(\"brown\",10824234).set(\"burlywood\",14596231).set(\"cadetblue\",6266528).set(\"chartreuse\",8388352).set(\"chocolate\",13789470).set(\"coral\",16744272).set(\"cornflowerblue\",6591981).set(\"cornsilk\",16775388).set(\"crimson\",14423100).set(\"cyan\",65535).set(\"darkblue\",139).set(\"darkcyan\",35723).set(\"darkgoldenrod\",12092939).set(\"darkgray\",11119017).set(\"darkgreen\",25600).set(\"darkgrey\",11119017).set(\"darkkhaki\",12433259).set(\"darkmagenta\",9109643).set(\"darkolivegreen\",5597999).set(\"darkorange\",16747520).set(\"darkorchid\",10040012).set(\"darkred\",9109504).set(\"darksalmon\",15308410).set(\"darkseagreen\",9419919).set(\"darkslateblue\",4734347).set(\"darkslategray\",3100495).set(\"darkslategrey\",3100495).set(\"darkturquoise\",52945).set(\"darkviolet\",9699539).set(\"deeppink\",16716947).set(\"deepskyblue\",49151).set(\"dimgray\",6908265).set(\"dimgrey\",6908265).set(\"dodgerblue\",2003199).set(\"firebrick\",11674146).set(\"floralwhite\",16775920).set(\"forestgreen\",2263842).set(\"fuchsia\",16711935).set(\"gainsboro\",14474460).set(\"ghostwhite\",16316671).set(\"gold\",16766720).set(\"goldenrod\",14329120).set(\"gray\",8421504).set(\"green\",32768).set(\"greenyellow\",11403055).set(\"grey\",8421504).set(\"honeydew\",15794160).set(\"hotpink\",16738740).set(\"indianred\",13458524).set(\"indigo\",4915330).set(\"ivory\",16777200).set(\"khaki\",15787660).set(\"lavender\",15132410).set(\"lavenderblush\",16773365).set(\"lawngreen\",8190976).set(\"lemonchiffon\",16775885).set(\"lightblue\",11393254).set(\"lightcoral\",15761536).set(\"lightcyan\",14745599).set(\"lightgoldenrodyellow\",16448210).set(\"lightgray\",13882323).set(\"lightgreen\",9498256).set(\"lightgrey\",13882323).set(\"lightpink\",16758465).set(\"lightsalmon\",16752762).set(\"lightseagreen\",2142890).set(\"lightskyblue\",8900346).set(\"lightslategray\",7833753).set(\"lightslategrey\",7833753).set(\"lightsteelblue\",11584734).set(\"lightyellow\",16777184).set(\"lime\",65280).set(\"limegreen\",3329330).set(\"linen\",16445670).set(\"magenta\",16711935).set(\"maroon\",8388608).set(\"mediumaquamarine\",6737322).set(\"mediumblue\",205).set(\"mediumorchid\",12211667).set(\"mediumpurple\",9662683).set(\"mediumseagreen\",3978097).set(\"mediumslateblue\",8087790).set(\"mediumspringgreen\",64154).set(\"mediumturquoise\",4772300).set(\"mediumvioletred\",13047173).set(\"midnightblue\",1644912).set(\"mintcream\",16121850).set(\"mistyrose\",16770273).set(\"moccasin\",16770229).set(\"navajowhite\",16768685).set(\"navy\",128).set(\"oldlace\",16643558).set(\"olive\",8421376).set(\"olivedrab\",7048739).set(\"orange\",16753920).set(\"orangered\",16729344).set(\"orchid\",14315734).set(\"palegoldenrod\",15657130).set(\"palegreen\",10025880).set(\"paleturquoise\",11529966).set(\"palevioletred\",14381203).set(\"papayawhip\",16773077).set(\"peachpuff\",16767673).set(\"peru\",13468991).set(\"pink\",16761035).set(\"plum\",14524637).set(\"powderblue\",11591910).set(\"purple\",8388736).set(\"rebeccapurple\",6697881).set(\"red\",16711680).set(\"rosybrown\",12357519).set(\"royalblue\",4286945).set(\"saddlebrown\",9127187).set(\"salmon\",16416882).set(\"sandybrown\",16032864).set(\"seagreen\",3050327).set(\"seashell\",16774638).set(\"sienna\",10506797).set(\"silver\",12632256).set(\"skyblue\",8900331).set(\"slateblue\",6970061).set(\"slategray\",7372944).set(\"slategrey\",7372944).set(\"snow\",16775930).set(\"springgreen\",65407).set(\"steelblue\",4620980).set(\"tan\",13808780).set(\"teal\",32896).set(\"thistle\",14204888).set(\"tomato\",16737095).set(\"turquoise\",4251856).set(\"violet\",15631086).set(\"wheat\",16113331).set(\"white\",16777215).set(\"whitesmoke\",16119285).set(\"yellow\",16776960).set(\"yellowgreen\",10145074),$=s.prototype=new e,H=.7;$.darker=function(t){return t=null==t?H:Math.pow(H,t),new s(this.r*t,this.g*t,this.b*t)};var I=1/H;$.brighter=function(t){return t=null==t?I:Math.pow(I,t),new s(this.r*t,this.g*t,this.b*t)},$.rgb=function(){return this},$.toString=function(){return n(this.r,this.g,this.b)};var C=a.prototype=new e;C.brighter=function(t){return t=null==t?I:Math.pow(I,t),new a(this.h,this.s,this.l*t)},C.darker=function(t){return t=null==t?H:Math.pow(H,t),new a(this.h,this.s,this.l*t)},C.rgb=function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=.5>=n?n*(1+e):n+e-n*e,i=2*n-r;return new s(o(t>=240?t-240:t+120,i,r),o(t,i,r),o(120>t?t+240:t-120,i,r))};var O=/^hsl\\(\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*\\)$/,P=/^rgb\\(\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*\\)$/,z=/^rgb\\(\\s*([-+]?\\d+)\\s*,\\s*([-+]?\\d+)\\s*,\\s*([-+]?\\d+)\\s*\\)$/,E=/^#([0-9a-f]{6})$/,R=/^#([0-9a-f]{3})$/;l.prototype=e.prototype,r.prototype=s.prototype,h.prototype=a.prototype;var A=u.prototype=new e,B=18;A.brighter=function(t){return new u(this.l+B*(null==t?1:t),this.a,this.b)},A.darker=function(t){return new u(this.l-B*(null==t?1:t),this.a,this.b)};var D=4/29,F=6/29,G=3*F*F,J=1.08883,K=.95047,Q=1;A.rgb=function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=Q*g(t),e=K*g(e),n=J*g(n),new s(c(3.2404542*e-1.5371385*t-.4985314*n),c(-.969266*e+1.8760108*t+.041556*n),c(.0556434*e-.2040259*t+1.0572252*n))};var T=F*F*F,U=Math.PI/180,V=p.prototype=new e;V.brighter=function(t){return new p(this.h,this.c,this.l+B*(null==t?1:t))},V.darker=function(t){return new p(this.h,this.c,this.l-B*(null==t?1:t))},V.rgb=function(){return b(this).rgb()},b.prototype=u.prototype;var W=180/Math.PI;N.prototype=p.prototype;var X=m.prototype=new e;X.brighter=function(t){return t=null==t?I:Math.pow(I,t),new m(this.h,this.s,this.l*t)},X.darker=function(t){return t=null==t?H:Math.pow(H,t),new m(this.h,this.s,this.l*t)};var Y=1.97294,Z=-.90649,tt=-.29227,et=1.78277,st=-.14861,nt=1,rt=Y*et,it=Y*Z,at=et*tt-Z*st;X.rgb=function(){var t=isNaN(this.h)?0:(this.h+120)*U,e=Math.pow(this.l,nt),n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new s(255*(e+n*(st*r+et*i)),255*(e+n*(tt*r+Z*i)),255*(e+n*Y*r))},w.prototype=m.prototype,t.color=l,t.rgb=r,t.hsl=h,t.lab=b,t.hcl=N,t.cubehelix=w,t.interpolateRgb=j,t.interpolateHsl=S,t.interpolateHslLong=_,t.interpolateLab=q,t.interpolateHcl=x,t.interpolateHclLong=k,t.interpolateCubehelix=M,t.interpolateCubehelixLong=y});\n\nvar canvas = document.querySelector(\"canvas\"),\n    width = canvas.width,\n    height = canvas.height,\n    context = canvas.getContext(\"2d\"),\n    voro = voronoi.voronoi().extent([[1, 1], [width - 1, height - 1]]);\n\nvar n = 200,\n    particles = new Array(n),\n    fill = color.interpolateCubehelix(color.cubehelix(80, 1.50, 0.8), color.cubehelix(-100, 0.75, 0.35)),\n    radius = 10;\n\nfor (var i = 0; i < n; ++i) particles[i] = {0: Math.random() * width, 1: Math.random() * height, vx: 0, vy: 0};\nfor (var i = 0; i <= width; i += 80) particles.push([i, 0], [i, height]);\nfor (var i = 0; i <= height; i += 80) particles.push([0, i], [width, i]);\n\ntimer.timer(function(elapsed) {\n  for (var i = 0; i < n; ++i) {\n    var p = particles[i];\n    p[0] += p.vx; if (p[0] < 0) p[0] += width; else if (p[0] > width) p[0] -= width;\n    p[1] += p.vy; if (p[1] < 0) p[1] += height; else if (p[1] > height) p[1] -= height;\n    p.vx += 0.1 * (Math.random() - .5) - 0.01 * p.vx;\n    p.vy += 0.1 * (Math.random() - .5) - 0.01 * p.vy;\n  }\n\n  context.clearRect(0, 0, width, height);\n\n  var triangles = voro.triangles(particles),\n      links = voro.links(particles);\n\n  triangles.forEach(function(t) {\n    context.beginPath();\n    var r = drawRoundedTriangle(t[0][0], t[0][1], t[1][0], t[1][1], t[2][0], t[2][1], radius);\n    context.fillStyle = fill(Math.sqrt(r / 50));\n    context.fill();\n  });\n\n  context.beginPath();\n  triangles.forEach(function(t) {\n    drawRoundedTriangle(t[0][0], t[0][1], t[1][0], t[1][1], t[2][0], t[2][1], radius);\n  });\n  context.lineWidth = 5;\n  context.strokeStyle = \"#ddd\";\n  context.stroke();\n\n  context.beginPath();\n  links.forEach(function(l) {\n    drawLink(l.source[0], l.source[1], l.target[0], l.target[1]);\n  });\n  context.lineWidth = 1;\n  context.strokeStyle = \"#aaa\";\n  context.stroke();\n\n  context.beginPath();\n  particles.forEach(function(p) { drawParticle(p[0], p[1]); });\n  context.fillStyle = \"#000\";\n  context.fill();\n});\n\nfunction drawParticle(x, y) {\n  context.moveTo(x + 2, y);\n  context.arc(x, y, 2, 0, 2 * Math.PI);\n}\n\nfunction drawTriangle(x0, y0, x1, y1, x2, y2) {\n  context.moveTo(x0, y0);\n  context.lineTo(x1, y1);\n  context.lineTo(x2, y2);\n  context.closePath();\n}\n\nfunction drawLink(x0, y0, x1, y1) {\n  context.moveTo(x0, y0);\n  context.lineTo(x1, y1);\n}\n\nfunction drawRoundedTriangle(x0, y0, x1, y1, x2, y2, r) {\n  var circle = inscribeTriangle(x0, y0, x1, y1, x2, y2);\n  if (circle.radius <= r) {\n    context.moveTo(circle[0] + circle.radius, circle[1]);\n    context.arc(circle[0], circle[1], circle.radius, 0, 2 * Math.PI);\n  } else {\n    var p0 = closestPoint(circle[0], circle[1], x0, y0, x1, y1),\n        p1 = closestPoint(circle[0], circle[1], x1, y1, x2, y2),\n        p2 = closestPoint(circle[0], circle[1], x2, y2, x0, y0);\n    context.moveTo(p0[0], p0[1]);\n    context.arcTo(x1, y1, p1[0], p1[1], r);\n    context.arcTo(x2, y2, p2[0], p2[1], r);\n    context.arcTo(x0, y0, p0[0], p0[1], r);\n    context.closePath();\n  }\n  return circle.radius;\n}\n\nfunction closestPoint(x2, y2, x0, y0, x1, y1) {\n  var x10 = x1 - x0, y10 = y1 - y0,\n      x20 = x2 - x0, y20 = y2 - y0,\n      t = (x20 * x10 + y20 * y10) / (x10 * x10 + y10 * y10);\n  return [x0 + t * x10, y0 + t * y10];\n}\n\nfunction inscribeTriangle(x0, y0, x1, y1, x2, y2) {\n  var x01 = x0 - x1, y01 = y0 - y1,\n      x02 = x0 - x2, y02 = y0 - y2,\n      x12 = x1 - x2, y12 = y1 - y2,\n      l01 = Math.sqrt(x01 * x01 + y01 * y01),\n      l02 = Math.sqrt(x02 * x02 + y02 * y02),\n      l12 = Math.sqrt(x12 * x12 + y12 * y12),\n      k0 = l01 / (l01 + l02),\n      k1 = l12 / (l12 + l01),\n      center = segmentIntersection(x0, y0, x1 - k0 * x12, y1 - k0 * y12, x1, y1, x2 + k1 * x02, y2 + k1 * y02);\n  center.radius = Math.sqrt((l02 + l12 - l01) * (l12 + l01 - l02) * (l01 + l02 - l12) / (l01 + l02 + l12)) / 2;\n  return center;\n}\n\nfunction segmentIntersection(x0, y0, x1, y1, x2, y2, x3, y3) {\n  var x02 = x0 - x2, y02 = y0 - y2,\n      x10 = x1 - x0, y10 = y1 - y0,\n      x32 = x3 - x2, y32 = y3 - y2,\n      t = (x32 * y02 - y32 * x02) / (y32 * x10 - x32 * y10);\n  return [x0 + t * x10, y0 + t * y10];\n}\n\n</script>\n","filenames":[".block","index.html","thumbnail.png"],"thumb":"f9494c63320081f4b766226420f7322a7eef5f32"},"sort":[1436402960000]},{"_index":"blockbuilder","_type":"blocks","_id":"4a21fbfe0d5cb6690ed4","_score":null,"_source":{"userId":"mbostock","description":"Delaunay Circles II","created_at":"2015-07-08T19:16:22Z","updated_at":"2016-02-09T01:49:40Z","api":[],"colors":["#aaaaaa","#eeeeee","#000000","#d2b48c"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script>\n\n/* https://github.com/d3/d3-voronoi Copyright 2015 Mike Bostock */\n!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t(e.voronoi={})}(this,function(e){\"use strict\";function t(e){return function(){return e}}function n(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function i(e,t){return t.angle-e.angle}function r(e,t){this.l=e,this.r=t,this.a=this.b=null}function s(e,t,n){var i=new r(e,null);return i.a=t,i.b=n,D.push(i),i}function u(e,t,n){this.edge=e,this.site=t,this.angle=n}function f(e,t,n){var i=e.a,r=e.b;return new u(e,t,n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y))}function a(e,t,n,i){for(var r,u,a,l,o,c,h,y,x,v,g=B.length;g--;)if(o=B[g],o&&o.prepare())for(h=o.edges,y=h.length,c=0;y>c;)v=h[c].end(),a=v.x,l=v.y,x=h[++c%y].start(),r=x.x,u=x.y,(Math.abs(a-r)>I||Math.abs(l-u)>I)&&(h.splice(c,0,f(s(o.site,v,Math.abs(a-e)<I&&i-l>I?{x:e,y:Math.abs(r-e)<I?u:i}:Math.abs(l-i)<I&&n-a>I?{x:Math.abs(u-i)<I?r:n,y:i}:Math.abs(a-n)<I&&l-t>I?{x:n,y:Math.abs(r-n)<I?u:t}:Math.abs(l-t)<I&&a-e>I?{x:Math.abs(u-t)<I?r:e,y:t}:null),o.site,null)),++y)}function l(e,t,n,i,r){var s,u=e.a,f=e.b,a=u.x,l=u.y,o=f.x,c=f.y,h=0,y=1,x=o-a,v=c-l;if(s=t-a,x||!(s>0)){if(s/=x,0>x){if(h>s)return;y>s&&(y=s)}else if(x>0){if(s>y)return;s>h&&(h=s)}if(s=i-a,x||!(0>s)){if(s/=x,0>x){if(s>y)return;s>h&&(h=s)}else if(x>0){if(h>s)return;y>s&&(y=s)}if(s=n-l,v||!(s>0)){if(s/=v,0>v){if(h>s)return;y>s&&(y=s)}else if(v>0){if(s>y)return;s>h&&(h=s)}if(s=r-l,v||!(0>s)){if(s/=v,0>v){if(s>y)return;s>h&&(h=s)}else if(v>0){if(h>s)return;y>s&&(y=s)}return h>0&&(e.a={x:a+h*x,y:l+h*v}),1>y&&(e.b={x:a+y*x,y:l+y*v}),e}}}}}function o(e,t,n,i,r){var s=e.b;if(s)return!0;var u,f,a=e.a,l=e.l,o=e.r,c=l.x,h=l.y,y=o.x,x=o.y,v=(c+y)/2,g=(h+x)/2;if(x===h){if(t>v||v>=i)return;if(c>y){if(a){if(a.y>=r)return}else a={x:v,y:n};s={x:v,y:r}}else{if(a){if(a.y<n)return}else a={x:v,y:r};s={x:v,y:n}}}else if(u=(c-y)/(x-h),f=g-u*v,-1>u||u>1)if(c>y){if(a){if(a.y>=r)return}else a={x:(n-f)/u,y:n};s={x:(r-f)/u,y:r}}else{if(a){if(a.y<n)return}else a={x:(r-f)/u,y:r};s={x:(n-f)/u,y:n}}else if(x>h){if(a){if(a.x>=i)return}else a={x:t,y:u*t+f};s={x:i,y:u*i+f}}else{if(a){if(a.x<t)return}else a={x:i,y:u*i+f};s={x:t,y:u*t+f}}return e.a=a,e.b=s,!0}function c(e,t,n,i){for(var r,s=D.length;s--;)r=D[s],(!o(r,e,t,n,i)||!l(r,e,t,n,i)||Math.abs(r.a.x-r.b.x)<I&&Math.abs(r.a.y-r.b.y)<I)&&(r.a=r.b=null,D.splice(s,1))}function h(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function y(e){var t=e.circle;t&&(t.P||(J=t.N),F.remove(t),K.push(t),h(t),e.circle=null)}function x(){h(this),this.x=this.y=this.arc=this.site=this.cy=null}function v(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,s=n.site;if(i!==s){var u=r.x,f=r.y,a=i.x-u,l=i.y-f,o=s.x-u,c=s.y-f,h=2*(a*c-l*o);if(!(h>=-O)){var y=a*a+l*l,v=o*o+c*c,g=(c*y-l*v)/h,C=(a*v-o*y)/h,c=C+f,d=K.pop()||new x;d.arc=e,d.site=r,d.x=g+u,d.y=c+Math.sqrt(g*g+C*C),d.cy=c,e.circle=d;for(var p=null,L=F._;L;)if(d.y<L.y||d.y===L.y&&d.x<=L.x){if(!L.L){p=L.P;break}L=L.L}else{if(!L.R){p=L;break}L=L.R}F.insert(p,d),p||(J=d)}}}}function g(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function C(e,t,n,i){var s=new r(e,t);return D.push(s),n&&g(s,e,t,n),i&&g(s,t,e,i),B[e.i].edges.push(f(s,e,t)),B[t.i].edges.push(f(s,t,e)),s}function d(){h(this),this.edge=this.site=this.circle=null}function p(e){var t=Q.pop()||new d;return t.site=e,t}function L(e){y(e),G.remove(e),Q.push(e),h(e)}function b(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},s=e.P,u=e.N,f=[e];L(e);for(var a=s;a.circle&&Math.abs(n-a.circle.x)<I&&Math.abs(i-a.circle.cy)<I;)s=a.P,f.unshift(a),L(a),a=s;f.unshift(a),y(a);for(var l=u;l.circle&&Math.abs(n-l.circle.x)<I&&Math.abs(i-l.circle.cy)<I;)u=l.N,f.push(l),L(l),l=u;f.push(l),y(l);var o,c=f.length;for(o=1;c>o;++o)l=f[o],a=f[o-1],g(l.edge,a.site,l.site,r);a=f[0],l=f[c-1],l.edge=C(a.site,l.site,null,r),v(a),v(l)}function R(e){this.site=e,this.edges=[]}function M(e){return B[e.i]=new R(e)}function U(e,t){var n=e.site,i=n.x,r=n.y,s=r-t;if(!s)return i;var u=e.P;if(!u)return-(1/0);n=u.site;var f=n.x,a=n.y,l=a-t;if(!l)return f;var o=f-i,c=1/s-1/l,h=o/l;return c?(-h+Math.sqrt(h*h-2*c*(o*o/(-2*l)-a+l/2+r-s/2)))/c+i:(i+f)/2}function N(e,t){var n=e.N;if(n)return U(n,t);var i=e.site;return i.y===t?i.x:1/0}function P(e){for(var t,n,i,r,s=e.x,u=e.y,f=G._;f;)if(i=U(f,u)-s,i>I)f=f.L;else{if(r=s-N(f,u),!(r>I)){i>-I?(t=f.P,n=f):r>-I?(t=f,n=f.N):t=n=f;break}if(!f.R){t=f;break}f=f.R}M(e);var a=p(e);if(G.insert(t,a),t||n){if(t===n)return y(t),n=p(t.site),G.insert(a,n),a.edge=n.edge=C(t.site,a.site),v(t),void v(n);if(!n)return void(a.edge=C(t.site,a.site));y(t),y(n);var l=t.site,o=l.x,c=l.y,h=e.x-o,x=e.y-c,d=n.site,L=d.x-o,b=d.y-c,R=2*(h*b-x*L),P=h*h+x*x,_=L*L+b*b,m={x:(b*P-x*_)/R+o,y:(h*_-L*P)/R+c};g(n.edge,l,d,m),a.edge=C(l,e,null,m),n.edge=C(e,d,null,m),v(t),v(n)}}function _(){this._=null}function m(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function w(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function k(e){for(;e.L;)e=e.L;return e}function q(e,t){return t.y-e.y||t.x-e.x}function A(e,t){var n,i,r,s=e.sort(q).pop();for(D=[],B=new Array(e.length),G=new _,F=new _;;)if(r=J,s&&(!r||s.y<r.y||s.y===r.y&&s.x<r.x))(s.x!==n||s.y!==i)&&(P(s),n=s.x,i=s.y),s=e.pop();else{if(!r)break;b(r.arc)}if(t){var n=t[0][0],i=t[0][1],u=t[1][0],f=t[1][1];c(n,i,u,f),a(n,i,u,f)}var l={cells:B,edges:D};return G=F=D=B=null,l}function E(e){return e[1]}function j(e){return e[0]}function z(){function e(e){var t=new Array(e.length),n=l[0][0],i=l[0][1],s=l[1][0],u=l[1][1];return A(r(e),l).cells.forEach(function(r,f){var a=r.edges,l=r.site,o=t[f]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):l.x>=n&&l.x<=s&&l.y>=i&&l.y<=u?[[n,u],[s,u],[s,i],[n,i]]:[];o.point=e[f]}),t}function r(e){return e.map(function(e,t){return{x:Math.round(f(e,t)/I)*I,y:Math.round(a(e,t)/I)*I,i:t}})}var s=j,u=E,f=s,a=u,l=H;return e.links=function(e){return A(r(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},e.triangles=function(e){var t=[];return A(r(e)).cells.forEach(function(r,s){for(var u,f,a=r.site,l=r.edges.sort(i),o=-1,c=l.length,h=l[c-1].edge,y=h.l===a?h.r:h.l;++o<c;)u=h,f=y,h=l[o].edge,y=h.l===a?h.r:h.l,s<f.i&&s<y.i&&n(a,f,y)<0&&t.push([e[s],e[f.i],e[y.i]])}),t},e.x=function(n){return arguments.length?(s=n,f=\"function\"==typeof n?s:t(s),e):s},e.y=function(n){return arguments.length?(u=n,a=\"function\"==typeof n?u:t(u),e):u},e.extent=function(t){return arguments.length?(l=null==t?H:t,e):l===H?null:l},e.size=function(t){return arguments.length?e.extent(t&&[[0,0],t]):l===H?null:l&&l[1]},e}var B,D,F,G,H=[[-1e6,-1e6],[1e6,1e6]],I=1e-6;u.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}};var J,K=[],O=1e-12,Q=[];R.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(i),t.length},_.prototype={insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=k(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(w(this,n),e=n,n=e.U),n.C=!1,i.C=!0,m(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(m(this,n),e=n,n=e.U),n.C=!1,i.C=!0,w(this,i))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,s=e.L,u=e.R;if(n=s?u?k(u):s:u,r?r.L===e?r.L=n:r.R=n:this._=n,s&&u?(i=n.C,n.C=e.C,n.L=s,s.U=n,n!==u?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=u,u.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,w(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,m(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,w(this,r),e=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,m(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,w(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,m(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}},e.voronoi=z});\n\n/* https://github.com/d3/d3-timer Copyright 2015 Mike Bostock */\n\"undefined\"==typeof requestAnimationFrame&&(requestAnimationFrame=\"undefined\"!=typeof window&&(window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame)||function(e){return setTimeout(e,17)}),function(e,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?n(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],n):n(e.timer={})}(this,function(e){\"use strict\";function n(){r=m=0,c=1/0,t(u())}function t(e){if(!r){var t=e-Date.now();t>24?c>e&&(m&&clearTimeout(m),m=setTimeout(n,t),c=e):(m&&(m=clearTimeout(m),c=1/0),r=requestAnimationFrame(n))}}function i(e,n,i){i=null==i?Date.now():+i,null!=n&&(i+=+n);var o={callback:e,time:i,flush:!1,next:null};a?a.next=o:f=o,a=o,t(i)}function o(e,n,t){t=null==t?Date.now():+t,null!=n&&(t+=+n),l.callback=e,l.time=t}function u(e){e=null==e?Date.now():+e;var n=l;for(l=f;l;)e>=l.time&&(l.flush=l.callback(e-l.time,e)),l=l.next;l=n,e=1/0;for(var t,i=f;i;)i.flush?i=t?t.next=i.next:f=i.next:(i.time<e&&(e=i.time),i=(t=i).next);return a=t,e}var a,m,r,f,l,c=1/0;e.timer=i,e.timerReplace=o,e.timerFlush=u});\n\nvar canvas = document.querySelector(\"canvas\"),\n    width = canvas.width,\n    height = canvas.height,\n    context = canvas.getContext(\"2d\"),\n    voro = voronoi.voronoi().extent([[1, 1], [width - 1, height - 1]]);\n\nvar n = 200,\n    particles = new Array(n),\n    radius = 10;\n\nfor (var i = 0; i < n; ++i) particles[i] = {0: Math.random() * width, 1: Math.random() * height, vx: 0, vy: 0};\nfor (var i = 0; i <= width; i += 80) particles.push([i, 0], [i, height]);\nfor (var i = 0; i <= height; i += 80) particles.push([0, i], [width, i]);\n\ntimer.timer(function(elapsed) {\n  for (var i = 0; i < n; ++i) {\n    var p = particles[i];\n    p[0] += p.vx; if (p[0] < 0) p[0] += width; else if (p[0] > width) p[0] -= width;\n    p[1] += p.vy; if (p[1] < 0) p[1] += height; else if (p[1] > height) p[1] -= height;\n    p.vx += 0.1 * (Math.random() - .5) - 0.01 * p.vx;\n    p.vy += 0.1 * (Math.random() - .5) - 0.01 * p.vy;\n  }\n\n  var triangles = voro.triangles(particles);\n  context.clearRect(0, 0, width, height);\n\n  context.beginPath();\n  triangles.forEach(function(t) { drawTriangle(t[0][0], t[0][1], t[1][0], t[1][1], t[2][0], t[2][1]); });\n  context.strokeStyle = \"#aaa\";\n  context.stroke();\n\n  context.beginPath();\n  triangles.forEach(function(t) { drawRoundedTriangle(t[0][0], t[0][1], t[1][0], t[1][1], t[2][0], t[2][1], radius); });\n  context.fillStyle = \"#eee\";\n  context.fill();\n  context.strokeStyle = \"#000\";\n  context.stroke();\n\n  context.beginPath();\n  particles.forEach(function(p) { drawParticle(p[0], p[1]); });\n  context.fillStyle = \"#000\";\n  context.fill();\n});\n\nfunction drawParticle(x, y) {\n  context.moveTo(x + 2, y);\n  context.arc(x, y, 2, 0, 2 * Math.PI);\n}\n\nfunction drawTriangle(x0, y0, x1, y1, x2, y2) {\n  context.moveTo(x0, y0);\n  context.lineTo(x1, y1);\n  context.lineTo(x2, y2);\n  context.closePath();\n}\n\nfunction drawRoundedTriangle(x0, y0, x1, y1, x2, y2, r) {\n  var circle = inscribeTriangle(x0, y0, x1, y1, x2, y2);\n  if (circle.radius <= r) {\n    context.moveTo(circle[0] + circle.radius, circle[1]);\n    context.arc(circle[0], circle[1], circle.radius, 0, 2 * Math.PI);\n  } else {\n    var p0 = closestPoint(circle[0], circle[1], x0, y0, x1, y1),\n        p1 = closestPoint(circle[0], circle[1], x1, y1, x2, y2),\n        p2 = closestPoint(circle[0], circle[1], x2, y2, x0, y0);\n    context.moveTo(p0[0], p0[1]);\n    context.arcTo(x1, y1, p1[0], p1[1], r);\n    context.arcTo(x2, y2, p2[0], p2[1], r);\n    context.arcTo(x0, y0, p0[0], p0[1], r);\n    context.closePath();\n  }\n}\n\nfunction closestPoint(x2, y2, x0, y0, x1, y1) {\n  var x10 = x1 - x0, y10 = y1 - y0,\n      x20 = x2 - x0, y20 = y2 - y0,\n      t = (x20 * x10 + y20 * y10) / (x10 * x10 + y10 * y10);\n  return [x0 + t * x10, y0 + t * y10];\n}\n\nfunction inscribeTriangle(x0, y0, x1, y1, x2, y2) {\n  var x01 = x0 - x1, y01 = y0 - y1,\n      x02 = x0 - x2, y02 = y0 - y2,\n      x12 = x1 - x2, y12 = y1 - y2,\n      l01 = Math.sqrt(x01 * x01 + y01 * y01),\n      l02 = Math.sqrt(x02 * x02 + y02 * y02),\n      l12 = Math.sqrt(x12 * x12 + y12 * y12),\n      k0 = l01 / (l01 + l02),\n      k1 = l12 / (l12 + l01),\n      center = segmentIntersection(x0, y0, x1 - k0 * x12, y1 - k0 * y12, x1, y1, x2 + k1 * x02, y2 + k1 * y02);\n  center.radius = Math.sqrt((l02 + l12 - l01) * (l12 + l01 - l02) * (l01 + l02 - l12) / (l01 + l02 + l12)) / 2;\n  return center;\n}\n\nfunction segmentIntersection(x0, y0, x1, y1, x2, y2, x3, y3) {\n  var x02 = x0 - x2, y02 = y0 - y2,\n      x10 = x1 - x0, y10 = y1 - y0,\n      x32 = x3 - x2, y32 = y3 - y2,\n      t = (x32 * y02 - y32 * x02) / (y32 * x10 - x32 * y10);\n  return [x0 + t * x10, y0 + t * y10];\n}\n\n</script>\n","filenames":[".block","index.html","thumbnail.png"],"thumb":"37e9bc97ebbe4cf3aa5b07295d2e740f932ed46b"},"sort":[1436382982000]},{"_index":"blockbuilder","_type":"blocks","_id":"e2ee1d2613a41ef85d6a","_score":null,"_source":{"userId":"mbostock","description":"Delaunay Circles","created_at":"2015-07-08T19:02:59Z","updated_at":"2016-02-09T01:49:42Z","api":[],"colors":["#cccccc","#eeeeee","#000000","#d2b48c"],"readme":"A Delaunay mesh of some randomly-walking points with inscribed circles in each triangle. There’s no real point to this, other than me learning a bit about geometry.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script>\n\n/* https://github.com/d3/d3-voronoi Copyright 2015 Mike Bostock */\n!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t(e.voronoi={})}(this,function(e){\"use strict\";function t(e){return function(){return e}}function n(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function i(e,t){return t.angle-e.angle}function r(e,t){this.l=e,this.r=t,this.a=this.b=null}function s(e,t,n){var i=new r(e,null);return i.a=t,i.b=n,D.push(i),i}function u(e,t,n){this.edge=e,this.site=t,this.angle=n}function f(e,t,n){var i=e.a,r=e.b;return new u(e,t,n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y))}function a(e,t,n,i){for(var r,u,a,l,o,c,h,y,x,v,g=B.length;g--;)if(o=B[g],o&&o.prepare())for(h=o.edges,y=h.length,c=0;y>c;)v=h[c].end(),a=v.x,l=v.y,x=h[++c%y].start(),r=x.x,u=x.y,(Math.abs(a-r)>I||Math.abs(l-u)>I)&&(h.splice(c,0,f(s(o.site,v,Math.abs(a-e)<I&&i-l>I?{x:e,y:Math.abs(r-e)<I?u:i}:Math.abs(l-i)<I&&n-a>I?{x:Math.abs(u-i)<I?r:n,y:i}:Math.abs(a-n)<I&&l-t>I?{x:n,y:Math.abs(r-n)<I?u:t}:Math.abs(l-t)<I&&a-e>I?{x:Math.abs(u-t)<I?r:e,y:t}:null),o.site,null)),++y)}function l(e,t,n,i,r){var s,u=e.a,f=e.b,a=u.x,l=u.y,o=f.x,c=f.y,h=0,y=1,x=o-a,v=c-l;if(s=t-a,x||!(s>0)){if(s/=x,0>x){if(h>s)return;y>s&&(y=s)}else if(x>0){if(s>y)return;s>h&&(h=s)}if(s=i-a,x||!(0>s)){if(s/=x,0>x){if(s>y)return;s>h&&(h=s)}else if(x>0){if(h>s)return;y>s&&(y=s)}if(s=n-l,v||!(s>0)){if(s/=v,0>v){if(h>s)return;y>s&&(y=s)}else if(v>0){if(s>y)return;s>h&&(h=s)}if(s=r-l,v||!(0>s)){if(s/=v,0>v){if(s>y)return;s>h&&(h=s)}else if(v>0){if(h>s)return;y>s&&(y=s)}return h>0&&(e.a={x:a+h*x,y:l+h*v}),1>y&&(e.b={x:a+y*x,y:l+y*v}),e}}}}}function o(e,t,n,i,r){var s=e.b;if(s)return!0;var u,f,a=e.a,l=e.l,o=e.r,c=l.x,h=l.y,y=o.x,x=o.y,v=(c+y)/2,g=(h+x)/2;if(x===h){if(t>v||v>=i)return;if(c>y){if(a){if(a.y>=r)return}else a={x:v,y:n};s={x:v,y:r}}else{if(a){if(a.y<n)return}else a={x:v,y:r};s={x:v,y:n}}}else if(u=(c-y)/(x-h),f=g-u*v,-1>u||u>1)if(c>y){if(a){if(a.y>=r)return}else a={x:(n-f)/u,y:n};s={x:(r-f)/u,y:r}}else{if(a){if(a.y<n)return}else a={x:(r-f)/u,y:r};s={x:(n-f)/u,y:n}}else if(x>h){if(a){if(a.x>=i)return}else a={x:t,y:u*t+f};s={x:i,y:u*i+f}}else{if(a){if(a.x<t)return}else a={x:i,y:u*i+f};s={x:t,y:u*t+f}}return e.a=a,e.b=s,!0}function c(e,t,n,i){for(var r,s=D.length;s--;)r=D[s],(!o(r,e,t,n,i)||!l(r,e,t,n,i)||Math.abs(r.a.x-r.b.x)<I&&Math.abs(r.a.y-r.b.y)<I)&&(r.a=r.b=null,D.splice(s,1))}function h(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function y(e){var t=e.circle;t&&(t.P||(J=t.N),F.remove(t),K.push(t),h(t),e.circle=null)}function x(){h(this),this.x=this.y=this.arc=this.site=this.cy=null}function v(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,s=n.site;if(i!==s){var u=r.x,f=r.y,a=i.x-u,l=i.y-f,o=s.x-u,c=s.y-f,h=2*(a*c-l*o);if(!(h>=-O)){var y=a*a+l*l,v=o*o+c*c,g=(c*y-l*v)/h,C=(a*v-o*y)/h,c=C+f,d=K.pop()||new x;d.arc=e,d.site=r,d.x=g+u,d.y=c+Math.sqrt(g*g+C*C),d.cy=c,e.circle=d;for(var p=null,L=F._;L;)if(d.y<L.y||d.y===L.y&&d.x<=L.x){if(!L.L){p=L.P;break}L=L.L}else{if(!L.R){p=L;break}L=L.R}F.insert(p,d),p||(J=d)}}}}function g(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function C(e,t,n,i){var s=new r(e,t);return D.push(s),n&&g(s,e,t,n),i&&g(s,t,e,i),B[e.i].edges.push(f(s,e,t)),B[t.i].edges.push(f(s,t,e)),s}function d(){h(this),this.edge=this.site=this.circle=null}function p(e){var t=Q.pop()||new d;return t.site=e,t}function L(e){y(e),G.remove(e),Q.push(e),h(e)}function b(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},s=e.P,u=e.N,f=[e];L(e);for(var a=s;a.circle&&Math.abs(n-a.circle.x)<I&&Math.abs(i-a.circle.cy)<I;)s=a.P,f.unshift(a),L(a),a=s;f.unshift(a),y(a);for(var l=u;l.circle&&Math.abs(n-l.circle.x)<I&&Math.abs(i-l.circle.cy)<I;)u=l.N,f.push(l),L(l),l=u;f.push(l),y(l);var o,c=f.length;for(o=1;c>o;++o)l=f[o],a=f[o-1],g(l.edge,a.site,l.site,r);a=f[0],l=f[c-1],l.edge=C(a.site,l.site,null,r),v(a),v(l)}function R(e){this.site=e,this.edges=[]}function M(e){return B[e.i]=new R(e)}function U(e,t){var n=e.site,i=n.x,r=n.y,s=r-t;if(!s)return i;var u=e.P;if(!u)return-(1/0);n=u.site;var f=n.x,a=n.y,l=a-t;if(!l)return f;var o=f-i,c=1/s-1/l,h=o/l;return c?(-h+Math.sqrt(h*h-2*c*(o*o/(-2*l)-a+l/2+r-s/2)))/c+i:(i+f)/2}function N(e,t){var n=e.N;if(n)return U(n,t);var i=e.site;return i.y===t?i.x:1/0}function P(e){for(var t,n,i,r,s=e.x,u=e.y,f=G._;f;)if(i=U(f,u)-s,i>I)f=f.L;else{if(r=s-N(f,u),!(r>I)){i>-I?(t=f.P,n=f):r>-I?(t=f,n=f.N):t=n=f;break}if(!f.R){t=f;break}f=f.R}M(e);var a=p(e);if(G.insert(t,a),t||n){if(t===n)return y(t),n=p(t.site),G.insert(a,n),a.edge=n.edge=C(t.site,a.site),v(t),void v(n);if(!n)return void(a.edge=C(t.site,a.site));y(t),y(n);var l=t.site,o=l.x,c=l.y,h=e.x-o,x=e.y-c,d=n.site,L=d.x-o,b=d.y-c,R=2*(h*b-x*L),P=h*h+x*x,_=L*L+b*b,m={x:(b*P-x*_)/R+o,y:(h*_-L*P)/R+c};g(n.edge,l,d,m),a.edge=C(l,e,null,m),n.edge=C(e,d,null,m),v(t),v(n)}}function _(){this._=null}function m(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function w(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function k(e){for(;e.L;)e=e.L;return e}function q(e,t){return t.y-e.y||t.x-e.x}function A(e,t){var n,i,r,s=e.sort(q).pop();for(D=[],B=new Array(e.length),G=new _,F=new _;;)if(r=J,s&&(!r||s.y<r.y||s.y===r.y&&s.x<r.x))(s.x!==n||s.y!==i)&&(P(s),n=s.x,i=s.y),s=e.pop();else{if(!r)break;b(r.arc)}if(t){var n=t[0][0],i=t[0][1],u=t[1][0],f=t[1][1];c(n,i,u,f),a(n,i,u,f)}var l={cells:B,edges:D};return G=F=D=B=null,l}function E(e){return e[1]}function j(e){return e[0]}function z(){function e(e){var t=new Array(e.length),n=l[0][0],i=l[0][1],s=l[1][0],u=l[1][1];return A(r(e),l).cells.forEach(function(r,f){var a=r.edges,l=r.site,o=t[f]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):l.x>=n&&l.x<=s&&l.y>=i&&l.y<=u?[[n,u],[s,u],[s,i],[n,i]]:[];o.point=e[f]}),t}function r(e){return e.map(function(e,t){return{x:Math.round(f(e,t)/I)*I,y:Math.round(a(e,t)/I)*I,i:t}})}var s=j,u=E,f=s,a=u,l=H;return e.links=function(e){return A(r(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},e.triangles=function(e){var t=[];return A(r(e)).cells.forEach(function(r,s){for(var u,f,a=r.site,l=r.edges.sort(i),o=-1,c=l.length,h=l[c-1].edge,y=h.l===a?h.r:h.l;++o<c;)u=h,f=y,h=l[o].edge,y=h.l===a?h.r:h.l,s<f.i&&s<y.i&&n(a,f,y)<0&&t.push([e[s],e[f.i],e[y.i]])}),t},e.x=function(n){return arguments.length?(s=n,f=\"function\"==typeof n?s:t(s),e):s},e.y=function(n){return arguments.length?(u=n,a=\"function\"==typeof n?u:t(u),e):u},e.extent=function(t){return arguments.length?(l=null==t?H:t,e):l===H?null:l},e.size=function(t){return arguments.length?e.extent(t&&[[0,0],t]):l===H?null:l&&l[1]},e}var B,D,F,G,H=[[-1e6,-1e6],[1e6,1e6]],I=1e-6;u.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}};var J,K=[],O=1e-12,Q=[];R.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(i),t.length},_.prototype={insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=k(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(w(this,n),e=n,n=e.U),n.C=!1,i.C=!0,m(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(m(this,n),e=n,n=e.U),n.C=!1,i.C=!0,w(this,i))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,s=e.L,u=e.R;if(n=s?u?k(u):s:u,r?r.L===e?r.L=n:r.R=n:this._=n,s&&u?(i=n.C,n.C=e.C,n.L=s,s.U=n,n!==u?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=u,u.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,w(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,m(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,w(this,r),e=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,m(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,w(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,m(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}},e.voronoi=z});\n\n/* https://github.com/d3/d3-timer Copyright 2015 Mike Bostock */\n\"undefined\"==typeof requestAnimationFrame&&(requestAnimationFrame=\"undefined\"!=typeof window&&(window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame)||function(e){return setTimeout(e,17)}),function(e,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?n(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],n):n(e.timer={})}(this,function(e){\"use strict\";function n(){r=m=0,c=1/0,t(u())}function t(e){if(!r){var t=e-Date.now();t>24?c>e&&(m&&clearTimeout(m),m=setTimeout(n,t),c=e):(m&&(m=clearTimeout(m),c=1/0),r=requestAnimationFrame(n))}}function i(e,n,i){i=null==i?Date.now():+i,null!=n&&(i+=+n);var o={callback:e,time:i,flush:!1,next:null};a?a.next=o:f=o,a=o,t(i)}function o(e,n,t){t=null==t?Date.now():+t,null!=n&&(t+=+n),l.callback=e,l.time=t}function u(e){e=null==e?Date.now():+e;var n=l;for(l=f;l;)e>=l.time&&(l.flush=l.callback(e-l.time,e)),l=l.next;l=n,e=1/0;for(var t,i=f;i;)i.flush?i=t?t.next=i.next:f=i.next:(i.time<e&&(e=i.time),i=(t=i).next);return a=t,e}var a,m,r,f,l,c=1/0;e.timer=i,e.timerReplace=o,e.timerFlush=u});\n\nvar canvas = document.querySelector(\"canvas\"),\n    width = canvas.width,\n    height = canvas.height,\n    context = canvas.getContext(\"2d\"),\n    voro = voronoi.voronoi().extent([[1, 1], [width - 1, height - 1]]);\n\nvar n = 200,\n    particles = new Array(n);\n\nfor (var i = 0; i < n; ++i) particles[i] = {0: Math.random() * width, 1: Math.random() * height, vx: 0, vy: 0};\nfor (var i = 0; i <= width; i += 80) particles.push([i, 0], [i, height]);\nfor (var i = 0; i <= height; i += 80) particles.push([0, i], [width, i]);\n\ntimer.timer(function(elapsed) {\n  for (var i = 0; i < n; ++i) {\n    var p = particles[i];\n    p[0] += p.vx; if (p[0] < 0) p[0] += width; else if (p[0] > width) p[0] -= width;\n    p[1] += p.vy; if (p[1] < 0) p[1] += height; else if (p[1] > height) p[1] -= height;\n    p.vx += 0.1 * (Math.random() - .5) - 0.01 * p.vx;\n    p.vy += 0.1 * (Math.random() - .5) - 0.01 * p.vy;\n  }\n\n  var triangles = voro.triangles(particles);\n  context.clearRect(0, 0, width, height);\n\n  context.beginPath();\n  triangles.forEach(function(t) { drawTriangle(t[0][0], t[0][1], t[1][0], t[1][1], t[2][0], t[2][1]); });\n  context.strokeStyle = \"#ccc\";\n  context.stroke();\n\n  context.beginPath();\n  triangles.forEach(function(t) { drawInscribedCircle(t[0][0], t[0][1], t[1][0], t[1][1], t[2][0], t[2][1]); });\n  context.fillStyle = \"#eee\";\n  context.fill();\n  context.strokeStyle = \"#000\";\n  context.stroke();\n\n  context.beginPath();\n  particles.forEach(function(p) { drawParticle(p[0], p[1]); });\n  context.fillStyle = \"#000\";\n  context.fill();\n});\n\nfunction drawParticle(x, y) {\n  context.moveTo(x + 2, y);\n  context.arc(x, y, 2, 0, 2 * Math.PI);\n}\n\nfunction drawTriangle(x0, y0, x1, y1, x2, y2) {\n  context.moveTo(x0, y0);\n  context.lineTo(x1, y1);\n  context.lineTo(x2, y2);\n  context.closePath();\n}\n\nfunction drawInscribedCircle(x0, y0, x1, y1, x2, y2) {\n  var circle = inscribeTriangle(x0, y0, x1, y1, x2, y2);\n  context.moveTo(circle[0] + circle.radius, circle[1]);\n  context.arc(circle[0], circle[1], circle.radius, 0, 2 * Math.PI);\n}\n\nfunction inscribeTriangle(x0, y0, x1, y1, x2, y2) {\n  var x01 = x0 - x1, y01 = y0 - y1,\n      x02 = x0 - x2, y02 = y0 - y2,\n      x12 = x1 - x2, y12 = y1 - y2,\n      l01 = Math.sqrt(x01 * x01 + y01 * y01),\n      l02 = Math.sqrt(x02 * x02 + y02 * y02),\n      l12 = Math.sqrt(x12 * x12 + y12 * y12),\n      k0 = l01 / (l01 + l02),\n      k1 = l12 / (l12 + l01),\n      center = segmentIntersection(x0, y0, x1 - k0 * x12, y1 - k0 * y12, x1, y1, x2 + k1 * x02, y2 + k1 * y02);\n  center.radius = Math.sqrt((l02 + l12 - l01) * (l12 + l01 - l02) * (l01 + l02 - l12) / (l01 + l02 + l12)) / 2;\n  return center;\n}\n\nfunction segmentIntersection(x0, y0, x1, y1, x2, y2, x3, y3) {\n  var x02 = x0 - x2, y02 = y0 - y2,\n      x10 = x1 - x0, y10 = y1 - y0,\n      x32 = x3 - x2, y32 = y3 - y2,\n      t = (x32 * y02 - y32 * x02) / (y32 * x10 - x32 * y10);\n  return [x0 + t * x10, y0 + t * y10];\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"c3c4e5d29b39309d2e6358ee745f87230fb51043"},"sort":[1436382179000]},{"_index":"blockbuilder","_type":"blocks","_id":"76456029b13c68accf6e","_score":null,"_source":{"userId":"mbostock","description":"Voroblobinoids","created_at":"2015-07-08T00:51:16Z","updated_at":"2016-03-31T01:01:10Z","api":[],"colors":["#dddddd","#ffffff","#aaaaaa","#000000","#ff0000","#d2b48c"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<canvas width=\"960\" height=\"500\"></canvas>\n<script src=\"//d3js.org/d3-voronoi.v0.3.min.js\"></script>\n<script src=\"//d3js.org/d3-timer.v0.1.min.js\"></script>\n<script>\n\nvar canvas = document.querySelector(\"canvas\"),\n    width = canvas.width,\n    height = canvas.height,\n    context = canvas.getContext(\"2d\"),\n    voronoi = d3_voronoi.voronoi().extent([[0.5, 0.5], [width - 0.5, height - 0.5]]);\n\nvar n = 100,\n    particles = new Array(n),\n    radius = 12;\n\nfor (var i = 0; i < n; ++i) particles[i] = {0: Math.random() * width, 1: Math.random() * height, vx: 0, vy: 0};\n\nd3_timer.timer(function(elapsed) {\n  for (var i = 0; i < n; ++i) {\n    var p = particles[i];\n    p[0] += p.vx; if (p[0] < 0) p[0] = p.vx *= -1; else if (p[0] > width) p[0] = width + (p.vx *= -1);\n    p[1] += p.vy; if (p[1] < 0) p[1] = p.vy *= -1; else if (p[1] > height) p[1] = height + (p.vy *= -1);\n    p.vx += 0.1 * (Math.random() - .5) - 0.01 * p.vx;\n    p.vy += 0.1 * (Math.random() - .5) - 0.01 * p.vy;\n  }\n\n  var cells = voronoi.polygons(particles);\n  context.clearRect(0, 0, width, height);\n\n  context.beginPath();\n  cells.forEach(function(cell) { drawRoundedPolygon(cell, radius); });\n  context.fillStyle = \"#ddd\";\n  context.fill();\n  context.lineWidth = 5;\n  context.strokeStyle = \"#fff\";\n  context.stroke();\n\n  context.beginPath();\n  cells.forEach(function(cell) { drawPolygon(cell); });\n  context.lineWidth = 1;\n  context.strokeStyle = \"#aaa\";\n  context.stroke();\n\n  context.beginPath();\n  particles.forEach(function(particle) { drawPoint(particle); });\n  context.fillStyle = \"#000\";\n  context.fill();\n});\n\nfunction drawPoint(point) {\n  context.moveTo(point[0] + 1.5, point[1]);\n  context.arc(point[0], point[1], 1.5, 0, 2 * Math.PI);\n}\n\nfunction drawPolygon(points) {\n  context.moveTo(points[0][0], points[0][1]);\n  for (var i = 1, n = points.length; i < n; ++i) context.lineTo(points[i][0], points[i][1]);\n  context.closePath();\n}\n\nfunction drawRoundedPolygon(points, r) {\n  var i,\n      n = points.length,\n      p0,\n      p1,\n      p2,\n      p3,\n      n1 = 0,\n      t012,\n      t123,\n      x21, y21,\n      x4, y4,\n      x5, y5,\n      moved,\n      circle = polygonIncircle(points);\n\n  // Build a linked list from the array of vertices so we can splice.\n  for (i = 0, p1 = points[n - 2], p2 = points[n - 1]; i < n; ++i) {\n    p0 = p1, p1 = p2, p2 = points[i];\n    p1.previous = p0;\n    p1.next = p2;\n  }\n\n  // The rounding radius can’t be bigger than the polygon’s incircle.\n  // The fudge factor of 1px lets the rounded polygon get squished a bit.\n  // TODO Abort the search for the incircle if one is found larger than r.\n  r = Math.min(r, circle.radius - 1);\n  if (r <= 0) return;\n\n  // TODO do we need to make all these extra passes?\n  for (i = 0, p3 = p2.next; n1 <= n; ++n1) {\n    p0 = p1, p1 = p2, p2 = p3, p3 = p3.next;\n    t012 = cornerTangent(p0[0], p0[1], p1[0], p1[1], p2[0], p2[1], r);\n    t123 = 1 - cornerTangent(p3[0], p3[1], p2[0], p2[1], p1[0], p1[1], r);\n\n    // If the following corner’s tangent is before this corner’s tangent,\n    // replace p1 and p2 with the intersection of the lines 01 and 23.\n    if (t012 >= t123) {\n      p2 = p0.next = p3.previous = lineLineIntersection(p0[0], p0[1], p1[0], p1[1], p2[0], p2[1], p3[0], p3[1]);\n      p2.previous = p0;\n      p2.next = p3;\n      p3 = p2;\n      p2 = p3.previous;\n      p1 = p2.previous;\n      p0 = p1.previous;\n      n1 = 0;\n      if (--n < 3) break;\n    }\n  }\n\n  // If we removed too many points, just draw the previously computed incircle.\n  if (n < 3) {\n    context.moveTo(circle[0] + circle.radius, circle[1]);\n    context.arc(circle[0], circle[1], circle.radius, 0, 2 * Math.PI);\n    return;\n  }\n\n  // Draw the rounded polygon, compting the corner tangents.\n  for (i = 0; i <= n; ++i) {\n    p0 = p1, p1 = p2, p2 = p3, p3 = p3.next;\n    t012 = cornerTangent(p0[0], p0[1], p1[0], p1[1], p2[0], p2[1], r);\n    t123 = 1 - cornerTangent(p3[0], p3[1], p2[0], p2[1], p1[0], p1[1], r);\n    x21 = p2[0] - p1[0], y21 = p2[1] - p1[1];\n    x4 = p1[0] + t012 * x21, y4 = p1[1] + t012 * y21;\n    x5 = p1[0] + t123 * x21, y5 = p1[1] + t123 * y21;\n    if (moved) context.arcTo(p1[0], p1[1], x4, y4, r);\n    else moved = true, context.moveTo(x4, y4);\n    context.lineTo(x5, y5);\n  }\n}\n\n// Given a circle of radius r that is tangent to the line segments 01 and 12,\n// returns the parameter t of the tangent along the line segment 12.\nfunction cornerTangent(x0, y0, x1, y1, x2, y2, r) {\n  var theta = innerAngle(x0, y0, x1, y1, x2, y2),\n      x21 = x2 - x1, y21 = y2 - y1,\n      l21 = Math.sqrt(x21 * x21 + y21 * y21),\n      l14 = r / Math.tan(theta / 2);\n  return l14 / l21;\n}\n\n// A horrible brute-force algorithm for determining the largest circle that can\n// fit inside a convex polygon. For each distinct set of three sides of the\n// polygon, compute the tangent circle. Then reduce the circle’s radius against\n// the remaining sides of the polygon.\nfunction polygonIncircle(points) {\n  var circle = {radius: 0};\n\n  for (var i = 0, n = points.length; i < n; ++i) {\n    var pi0 = points[i],\n        pi1 = points[(i + 1) % n];\n    for (var j = i + 1; j < n; ++j) {\n      var pj0 = points[j],\n          pj1 = points[(j + 1) % n],\n          pij = j === i + 1 ? pj0 : lineLineIntersection(pi0[0], pi0[1], pi1[0], pi1[1], pj0[0], pj0[1], pj1[0], pj1[1]);\n      search: for (var k = j + 1; k < n; ++k) {\n        var pk0 = points[k],\n            pk1 = points[(k + 1) % n],\n            pik = lineLineIntersection(pi0[0], pi0[1], pi1[0], pi1[1], pk0[0], pk0[1], pk1[0], pk1[1]),\n            pjk = k === j + 1 ? pk0 : lineLineIntersection(pj0[0], pj0[1], pj1[0], pj1[1], pk0[0], pk0[1], pk1[0], pk1[1]),\n            candidate = triangleIncircle(pij[0], pij[1], pik[0], pik[1], pjk[0], pjk[1]),\n            radius = candidate.radius;\n\n        for (var l = 0; l < n; ++l) {\n          var pl0 = points[l],\n              pl1 = points[(l + 1) % n],\n              r = pointLineDistance(candidate[0], candidate[1], pl0[0], pl0[1], pl1[0], pl1[1]);\n          if (r < circle.radius) continue search;\n          if (r < radius) radius = r;\n        }\n\n        circle = candidate;\n        circle.radius = radius;\n      }\n    }\n  }\n\n  return circle;\n}\n\n// Returns the angle between segments 01 and 12.\nfunction innerAngle(x0, y0, x1, y1, x2, y2) {\n  var x01 = x0 - x1, y01 = y0 - y1,\n      x12 = x1 - x2, y12 = y1 - y2,\n      x02 = x0 - x2, y02 = y0 - y2,\n      l01_2 = x01 * x01 + y01 * y01,\n      l12_2 = x12 * x12 + y12 * y12,\n      l02_2 = x02 * x02 + y02 * y02;\n  return Math.acos((l12_2 + l01_2 - l02_2) / (2 * Math.sqrt(l12_2 * l01_2)));\n}\n\n// Returns the intersection of the infinite lines 01 and 23.\nfunction lineLineIntersection(x0, y0, x1, y1, x2, y2, x3, y3) {\n  var x02 = x0 - x2, y02 = y0 - y2,\n      x10 = x1 - x0, y10 = y1 - y0,\n      x32 = x3 - x2, y32 = y3 - y2,\n      t = (x32 * y02 - y32 * x02) / (y32 * x10 - x32 * y10);\n  return [x0 + t * x10, y0 + t * y10];\n}\n\n// Returns the signed distance from point 0 to the infinite line 12.\nfunction pointLineDistance(x0, y0, x1, y1, x2, y2) {\n  var x21 = x2 - x1, y21 = y2 - y1;\n  return (y21 * x0 - x21 * y0 + x2 * y1 - y2 * x1) / Math.sqrt(y21 * y21 + x21 * x21);\n}\n\n// Returns the largest circle inside the triangle 012.\nfunction triangleIncircle(x0, y0, x1, y1, x2, y2) {\n  var x01 = x0 - x1, y01 = y0 - y1,\n      x02 = x0 - x2, y02 = y0 - y2,\n      x12 = x1 - x2, y12 = y1 - y2,\n      l01 = Math.sqrt(x01 * x01 + y01 * y01),\n      l02 = Math.sqrt(x02 * x02 + y02 * y02),\n      l12 = Math.sqrt(x12 * x12 + y12 * y12),\n      k0 = l01 / (l01 + l02),\n      k1 = l12 / (l12 + l01),\n      center = lineLineIntersection(x0, y0, x1 - k0 * x12, y1 - k0 * y12, x1, y1, x2 + k1 * x02, y2 + k1 * y02);\n  center.radius = Math.sqrt((l02 + l12 - l01) * (l12 + l01 - l02) * (l01 + l02 - l12) / (l01 + l02 + l12)) / 2;\n  return center;\n}\n\n</script>\n","filenames":[".block","index.html","thumbnail.png"],"thumb":"500db0bda9f3bbb624ed436d0a9768fd7eca36e9"},"sort":[1436316676000]},{"_index":"blockbuilder","_type":"blocks","_id":"461a271f3fb3fb24a84f","_score":null,"_source":{"userId":"mbostock","description":"Monocomb","created_at":"2015-07-04T03:32:39Z","updated_at":"2016-02-09T01:49:48Z","api":[],"colors":["#000000","#ffffff","#ffc0cb","#ffb6c1","#ff69b4","#ff1493","#db7093","#c71585","#ffa07a","#fa8072","#e9967a","#f08080","#cd5c5c","#dc143c","#b22222","#8b0000","#ff0000","#ff4500","#ff6347","#ff7f50","#ff8c00","#ffa500","#ffff00","#ffffe0","#fffacd","#fafad2","#ffefd5","#ffe4b5","#ffdab9","#eee8aa","#f0e68c","#bdb76b","#ffd700","#fff8dc","#ffebcd","#ffe4c4","#ffdead","#f5deb3","#deb887","#d2b48c","#bc8f8f","#f4a460","#daa520","#b8860b","#cd853f","#d2691e","#8b4513","#a0522d","#a52a2a","#800000","#556b2f","#808000","#6b8e23","#9acd32","#32cd32","#00ff00","#7cfc00","#7fff00","#adff2f","#00ff7f","#00fa9a","#90ee90","#98fb98","#8fbc8f","#3cb371","#2e8b57","#228b22","#008000","#006400","#66cdaa","#00ffff","#e0ffff","#afeeee","#7fffd4","#40e0d0","#48d1cc","#00ced1","#20b2aa","#5f9ea0","#008b8b","#008080","#b0c4de","#b0e0e6","#add8e6","#87ceeb","#87cefa","#00bfff","#1e90ff","#6495ed","#4682b4","#4169e1","#0000ff","#0000cd","#00008b","#000080","#191970","#e6e6fa","#d8bfd8","#dda0dd","#ee82ee","#da70d6","#ff00ff","#ba55d3","#9370db","#8a2be2","#9400d3","#9932cc","#8b008b","#800080","#4b0082","#483d8b","#663399","#6a5acd","#7b68ee","#fffafa","#f0fff0","#f5fffa","#f0ffff","#f0f8ff","#f8f8ff","#f5f5f5","#fff5ee","#f5f5dc","#fdf5e6","#fffaf0","#fffff0","#faebd7","#faf0e6","#fff0f5","#ffe4e1","#dcdcdc","#d3d3d3","#c0c0c0","#a9a9a9","#808080","#696969","#778899","#708090","#2f4f4f"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  margin: 0;\n  background: #000;\n}\n\n</style>\n<body>\n<script>\n\n/* https://github.com/d3/d3-timer Copyright 2015 Mike Bostock */\n\"undefined\"==typeof requestAnimationFrame&&(requestAnimationFrame=\"undefined\"!=typeof window&&(window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame)||function(e){return setTimeout(e,17)}),function(e,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?n(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],n):n(e.timer={})}(this,function(e){\"use strict\";function n(){r=m=0,c=1/0,t(u())}function t(e){if(!r){var t=e-Date.now();t>24?c>e&&(m&&clearTimeout(m),m=setTimeout(n,t),c=e):(m&&(m=clearTimeout(m),c=1/0),r=requestAnimationFrame(n))}}function i(e,n,i){i=null==i?Date.now():+i,null!=n&&(i+=+n);var o={callback:e,time:i,flush:!1,next:null};a?a.next=o:f=o,a=o,t(i)}function o(e,n,t){t=null==t?Date.now():+t,null!=n&&(t+=+n),l.callback=e,l.time=t}function u(e){e=null==e?Date.now():+e;var n=l;for(l=f;l;)e>=l.time&&(l.flush=l.callback(e-l.time,e)),l=l.next;l=n,e=1/0;for(var t,i=f;i;)i.flush?i=t?t.next=i.next:f=i.next:(i.time<e&&(e=i.time),i=(t=i).next);return a=t,e}var a,m,r,f,l,c=1/0;e.timer=i,e.timerReplace=o,e.timerFlush=u});\n\n/* https://github.com/d3/d3-color Copyright 2015 Mike Bostock */\n\"undefined\"==typeof Map?(Map=function(){this.clear()},Map.prototype={set:function(t,e){return this._[t]=e,this},get:function(t){return this._[t]},has:function(t){return t in this._},\"delete\":function(t){return t in this._&&delete this._[t]},clear:function(){this._=Object.create(null)},get size(){var t=0;for(var e in this._)++t;return t},forEach:function(t){for(var e in this._)t(this._[e],e,this)}}):function(){var t=new Map;t.set(0,0)!==t&&(t=t.set,Map.prototype.set=function(){return t.apply(this,arguments),this})}(),function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?e(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],e):e(t.color={})}(this,function(t){\"use strict\";function e(){}function s(t,e,s){this.r=Math.max(0,Math.min(255,Math.round(t))),this.g=Math.max(0,Math.min(255,Math.round(e))),this.b=Math.max(0,Math.min(255,Math.round(s)))}function n(t,e,s){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),isNaN(s)&&(s=0),\"#\"+(16>t?\"0\"+t.toString(16):t.toString(16))+(16>e?\"0\"+e.toString(16):e.toString(16))+(16>s?\"0\"+s.toString(16):s.toString(16))}function r(t,n,r){return 1===arguments.length&&(t instanceof e||(t=l(t)),t?(t=t.rgb(),r=t.b,n=t.g,t=t.r):t=n=r=NaN),new s(t,n,r)}function i(t){return r(t>>16&255,t>>8&255,255&t)}function a(t,e,s){this.h=+t,this.s=Math.max(0,Math.min(1,+e)),this.l=Math.max(0,Math.min(1,+s))}function o(t,e,s){return 255*(60>t?e+(s-e)*t/60:180>t?s:240>t?e+(s-e)*(240-t)/60:e)}function h(t,s,n){if(1===arguments.length)if(t instanceof a)n=t.l,s=t.s,t=t.h;else if(t instanceof e||(t=l(t)),t){if(t instanceof a)return t;t=t.rgb();var r=t.r/255,i=t.g/255,o=t.b/255,h=Math.min(r,i,o),u=Math.max(r,i,o),c=u-h;n=(u+h)/2,c?(s=.5>n?c/(u+h):c/(2-u-h),t=r===u?(i-o)/c+6*(o>i):i===u?(o-r)/c+2:(r-i)/c+4,t*=60):(t=NaN,s=n>0&&1>n?0:t)}else t=s=n=NaN;return new a(t,s,n)}function l(t){var e;return t=(t+\"\").trim().toLowerCase(),(e=R.exec(t))?(e=parseInt(e[1],16),r(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e)):(e=E.exec(t))?i(parseInt(e[1],16)):(e=z.exec(t))?r(e[1],e[2],e[3]):(e=P.exec(t))?r(2.55*e[1],2.55*e[2],2.55*e[3]):(e=O.exec(t))?h(e[1],.01*e[2],.01*e[3]):L.has(t)?i(L.get(t)):null}function u(t,e,s){this.l=+t,this.a=+e,this.b=+s}function c(t){return 255*(.0031308>=t?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function g(t){return t>F?t*t*t:G*(t-D)}function f(t){return t>T?Math.pow(t,1/3):t/G+D}function d(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function p(t,e,s){this.h=+t,this.c=+e,this.l=+s}function b(t,e,n){if(1===arguments.length)if(t instanceof u)n=t.b,e=t.a,t=t.l;else if(t instanceof p){var i=t.h*U;n=Math.sin(i)*t.c,e=Math.cos(i)*t.c,t=t.l}else{t instanceof s||(t=r(t));var a=d(t.r),o=d(t.g),n=d(t.b),h=f((.4124564*a+.3575761*o+.1804375*n)/K),l=f((.2126729*a+.7151522*o+.072175*n)/Q),c=f((.0193339*a+.119192*o+.9503041*n)/J);n=200*(l-c),e=500*(h-l),t=116*l-16}return new u(t,e,n)}function N(t,e,s){return 1===arguments.length&&(t instanceof p?(s=t.l,e=t.c,t=t.h):(t instanceof u||(t=b(t)),s=t.l,e=Math.sqrt(t.a*t.a+t.b*t.b),t=Math.atan2(t.b,t.a)*W,0>t&&(t+=360))),new p(t,e,s)}function m(t,e,s){this.h=+t,this.s=+e,this.l=+s}function w(t,e,n){if(1===arguments.length)if(t instanceof m)n=t.l,e=t.s,t=t.h;else{t instanceof s||(t=r(t));var i=t.r/255,a=t.g/255,o=t.b/255;n=(at*o+it*i-rt*a)/(at+it-rt);var h=o-n,l=(Y*(a-n)-tt*h)/Z,u=Math.pow(n,nt);e=Math.sqrt(l*l+h*h)/(Y*u*(1-u)),t=e?Math.atan2(l,h)*W-120:NaN,0>t&&(t+=360)}return new m(t,e,n)}function y(t,e){t=w(t),e=w(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function v(t,e){var s=(t-e)%360;return s+(s>180?-360:-180>s?360:0)}function M(t,e){t=w(t),e=w(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function k(t,e){t=N(t),e=N(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.c)?e.c:t.c,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.c)?0:e.c-n,o=e.l-r;return function(e){return t.h=s+i*e,t.c=n+a*e,t.l=r+o*e,t+\"\"}}function x(t,e){t=N(t),e=N(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.c)?e.c:t.c,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.c)?0:e.c-n,o=e.l-r;return function(e){return t.h=s+i*e,t.c=n+a*e,t.l=r+o*e,t+\"\"}}function q(t,e){t=b(t),e=b(e);var s=t.l,n=t.a,r=t.b,i=e.l-s,a=e.a-n,o=e.b-r;return function(e){return t.l=s+i*e,t.a=n+a*e,t.b=r+o*e,t+\"\"}}function _(t,e){t=h(t),e=h(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function S(t,e){t=h(t),e=h(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function j(t,e){t=r(t),e=r(e);var s=t.r,i=t.g,a=t.b,o=e.r-s,h=e.g-i,l=e.b-a;return function(t){return n(Math.round(s+o*t),Math.round(i+h*t),Math.round(a+l*t))}}e.prototype={toString:function(){return this.rgb()+\"\"}};var L=(new Map).set(\"aliceblue\",15792383).set(\"antiquewhite\",16444375).set(\"aqua\",65535).set(\"aquamarine\",8388564).set(\"azure\",15794175).set(\"beige\",16119260).set(\"bisque\",16770244).set(\"black\",0).set(\"blanchedalmond\",16772045).set(\"blue\",255).set(\"blueviolet\",9055202).set(\"brown\",10824234).set(\"burlywood\",14596231).set(\"cadetblue\",6266528).set(\"chartreuse\",8388352).set(\"chocolate\",13789470).set(\"coral\",16744272).set(\"cornflowerblue\",6591981).set(\"cornsilk\",16775388).set(\"crimson\",14423100).set(\"cyan\",65535).set(\"darkblue\",139).set(\"darkcyan\",35723).set(\"darkgoldenrod\",12092939).set(\"darkgray\",11119017).set(\"darkgreen\",25600).set(\"darkgrey\",11119017).set(\"darkkhaki\",12433259).set(\"darkmagenta\",9109643).set(\"darkolivegreen\",5597999).set(\"darkorange\",16747520).set(\"darkorchid\",10040012).set(\"darkred\",9109504).set(\"darksalmon\",15308410).set(\"darkseagreen\",9419919).set(\"darkslateblue\",4734347).set(\"darkslategray\",3100495).set(\"darkslategrey\",3100495).set(\"darkturquoise\",52945).set(\"darkviolet\",9699539).set(\"deeppink\",16716947).set(\"deepskyblue\",49151).set(\"dimgray\",6908265).set(\"dimgrey\",6908265).set(\"dodgerblue\",2003199).set(\"firebrick\",11674146).set(\"floralwhite\",16775920).set(\"forestgreen\",2263842).set(\"fuchsia\",16711935).set(\"gainsboro\",14474460).set(\"ghostwhite\",16316671).set(\"gold\",16766720).set(\"goldenrod\",14329120).set(\"gray\",8421504).set(\"green\",32768).set(\"greenyellow\",11403055).set(\"grey\",8421504).set(\"honeydew\",15794160).set(\"hotpink\",16738740).set(\"indianred\",13458524).set(\"indigo\",4915330).set(\"ivory\",16777200).set(\"khaki\",15787660).set(\"lavender\",15132410).set(\"lavenderblush\",16773365).set(\"lawngreen\",8190976).set(\"lemonchiffon\",16775885).set(\"lightblue\",11393254).set(\"lightcoral\",15761536).set(\"lightcyan\",14745599).set(\"lightgoldenrodyellow\",16448210).set(\"lightgray\",13882323).set(\"lightgreen\",9498256).set(\"lightgrey\",13882323).set(\"lightpink\",16758465).set(\"lightsalmon\",16752762).set(\"lightseagreen\",2142890).set(\"lightskyblue\",8900346).set(\"lightslategray\",7833753).set(\"lightslategrey\",7833753).set(\"lightsteelblue\",11584734).set(\"lightyellow\",16777184).set(\"lime\",65280).set(\"limegreen\",3329330).set(\"linen\",16445670).set(\"magenta\",16711935).set(\"maroon\",8388608).set(\"mediumaquamarine\",6737322).set(\"mediumblue\",205).set(\"mediumorchid\",12211667).set(\"mediumpurple\",9662683).set(\"mediumseagreen\",3978097).set(\"mediumslateblue\",8087790).set(\"mediumspringgreen\",64154).set(\"mediumturquoise\",4772300).set(\"mediumvioletred\",13047173).set(\"midnightblue\",1644912).set(\"mintcream\",16121850).set(\"mistyrose\",16770273).set(\"moccasin\",16770229).set(\"navajowhite\",16768685).set(\"navy\",128).set(\"oldlace\",16643558).set(\"olive\",8421376).set(\"olivedrab\",7048739).set(\"orange\",16753920).set(\"orangered\",16729344).set(\"orchid\",14315734).set(\"palegoldenrod\",15657130).set(\"palegreen\",10025880).set(\"paleturquoise\",11529966).set(\"palevioletred\",14381203).set(\"papayawhip\",16773077).set(\"peachpuff\",16767673).set(\"peru\",13468991).set(\"pink\",16761035).set(\"plum\",14524637).set(\"powderblue\",11591910).set(\"purple\",8388736).set(\"rebeccapurple\",6697881).set(\"red\",16711680).set(\"rosybrown\",12357519).set(\"royalblue\",4286945).set(\"saddlebrown\",9127187).set(\"salmon\",16416882).set(\"sandybrown\",16032864).set(\"seagreen\",3050327).set(\"seashell\",16774638).set(\"sienna\",10506797).set(\"silver\",12632256).set(\"skyblue\",8900331).set(\"slateblue\",6970061).set(\"slategray\",7372944).set(\"slategrey\",7372944).set(\"snow\",16775930).set(\"springgreen\",65407).set(\"steelblue\",4620980).set(\"tan\",13808780).set(\"teal\",32896).set(\"thistle\",14204888).set(\"tomato\",16737095).set(\"turquoise\",4251856).set(\"violet\",15631086).set(\"wheat\",16113331).set(\"white\",16777215).set(\"whitesmoke\",16119285).set(\"yellow\",16776960).set(\"yellowgreen\",10145074),$=s.prototype=new e,H=.7;$.darker=function(t){return t=null==t?H:Math.pow(H,t),new s(this.r*t,this.g*t,this.b*t)};var I=1/H;$.brighter=function(t){return t=null==t?I:Math.pow(I,t),new s(this.r*t,this.g*t,this.b*t)},$.rgb=function(){return this},$.toString=function(){return n(this.r,this.g,this.b)};var C=a.prototype=new e;C.brighter=function(t){return t=null==t?I:Math.pow(I,t),new a(this.h,this.s,this.l*t)},C.darker=function(t){return t=null==t?H:Math.pow(H,t),new a(this.h,this.s,this.l*t)},C.rgb=function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=.5>=n?n*(1+e):n+e-n*e,i=2*n-r;return new s(o(t>=240?t-240:t+120,i,r),o(t,i,r),o(120>t?t+240:t-120,i,r))};var O=/^hsl\\(\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*\\)$/,P=/^rgb\\(\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*\\)$/,z=/^rgb\\(\\s*([-+]?\\d+)\\s*,\\s*([-+]?\\d+)\\s*,\\s*([-+]?\\d+)\\s*\\)$/,E=/^#([0-9a-f]{6})$/,R=/^#([0-9a-f]{3})$/;l.prototype=e.prototype,r.prototype=s.prototype,h.prototype=a.prototype;var A=u.prototype=new e,B=18;A.brighter=function(t){return new u(this.l+B*(null==t?1:t),this.a,this.b)},A.darker=function(t){return new u(this.l-B*(null==t?1:t),this.a,this.b)};var D=4/29,F=6/29,G=3*F*F,J=1.08883,K=.95047,Q=1;A.rgb=function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=Q*g(t),e=K*g(e),n=J*g(n),new s(c(3.2404542*e-1.5371385*t-.4985314*n),c(-.969266*e+1.8760108*t+.041556*n),c(.0556434*e-.2040259*t+1.0572252*n))};var T=F*F*F,U=Math.PI/180,V=p.prototype=new e;V.brighter=function(t){return new p(this.h,this.c,this.l+B*(null==t?1:t))},V.darker=function(t){return new p(this.h,this.c,this.l-B*(null==t?1:t))},V.rgb=function(){return b(this).rgb()},b.prototype=u.prototype;var W=180/Math.PI;N.prototype=p.prototype;var X=m.prototype=new e;X.brighter=function(t){return t=null==t?I:Math.pow(I,t),new m(this.h,this.s,this.l*t)},X.darker=function(t){return t=null==t?H:Math.pow(H,t),new m(this.h,this.s,this.l*t)};var Y=1.97294,Z=-.90649,tt=-.29227,et=1.78277,st=-.14861,nt=1,rt=Y*et,it=Y*Z,at=et*tt-Z*st;X.rgb=function(){var t=isNaN(this.h)?0:(this.h+120)*U,e=Math.pow(this.l,nt),n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new s(255*(e+n*(st*r+et*i)),255*(e+n*(tt*r+Z*i)),255*(e+n*Y*r))},w.prototype=m.prototype,t.color=l,t.rgb=r,t.hsl=h,t.lab=b,t.hcl=N,t.cubehelix=w,t.interpolateRgb=j,t.interpolateHsl=S,t.interpolateHslLong=_,t.interpolateLab=q,t.interpolateHcl=x,t.interpolateHclLong=k,t.interpolateCubehelix=M,t.interpolateCubehelixLong=y});\n\n/* https://github.com/d3/d3-voronoi Copyright 2015 Mike Bostock */\n!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t(e.voronoi={})}(this,function(e){\"use strict\";function t(e){return function(){return e}}function n(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function i(e,t){return t.angle-e.angle}function r(e,t){this.l=e,this.r=t,this.a=this.b=null}function s(e,t,n){var i=new r(e,null);return i.a=t,i.b=n,D.push(i),i}function u(e,t,n){this.edge=e,this.site=t,this.angle=n}function f(e,t,n){var i=e.a,r=e.b;return new u(e,t,n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y))}function a(e,t,n,i){for(var r,u,a,l,o,c,h,y,x,v,g=B.length;g--;)if(o=B[g],o&&o.prepare())for(h=o.edges,y=h.length,c=0;y>c;)v=h[c].end(),a=v.x,l=v.y,x=h[++c%y].start(),r=x.x,u=x.y,(Math.abs(a-r)>I||Math.abs(l-u)>I)&&(h.splice(c,0,f(s(o.site,v,Math.abs(a-e)<I&&i-l>I?{x:e,y:Math.abs(r-e)<I?u:i}:Math.abs(l-i)<I&&n-a>I?{x:Math.abs(u-i)<I?r:n,y:i}:Math.abs(a-n)<I&&l-t>I?{x:n,y:Math.abs(r-n)<I?u:t}:Math.abs(l-t)<I&&a-e>I?{x:Math.abs(u-t)<I?r:e,y:t}:null),o.site,null)),++y)}function l(e,t,n,i,r){var s,u=e.a,f=e.b,a=u.x,l=u.y,o=f.x,c=f.y,h=0,y=1,x=o-a,v=c-l;if(s=t-a,x||!(s>0)){if(s/=x,0>x){if(h>s)return;y>s&&(y=s)}else if(x>0){if(s>y)return;s>h&&(h=s)}if(s=i-a,x||!(0>s)){if(s/=x,0>x){if(s>y)return;s>h&&(h=s)}else if(x>0){if(h>s)return;y>s&&(y=s)}if(s=n-l,v||!(s>0)){if(s/=v,0>v){if(h>s)return;y>s&&(y=s)}else if(v>0){if(s>y)return;s>h&&(h=s)}if(s=r-l,v||!(0>s)){if(s/=v,0>v){if(s>y)return;s>h&&(h=s)}else if(v>0){if(h>s)return;y>s&&(y=s)}return h>0&&(e.a={x:a+h*x,y:l+h*v}),1>y&&(e.b={x:a+y*x,y:l+y*v}),e}}}}}function o(e,t,n,i,r){var s=e.b;if(s)return!0;var u,f,a=e.a,l=e.l,o=e.r,c=l.x,h=l.y,y=o.x,x=o.y,v=(c+y)/2,g=(h+x)/2;if(x===h){if(t>v||v>=i)return;if(c>y){if(a){if(a.y>=r)return}else a={x:v,y:n};s={x:v,y:r}}else{if(a){if(a.y<n)return}else a={x:v,y:r};s={x:v,y:n}}}else if(u=(c-y)/(x-h),f=g-u*v,-1>u||u>1)if(c>y){if(a){if(a.y>=r)return}else a={x:(n-f)/u,y:n};s={x:(r-f)/u,y:r}}else{if(a){if(a.y<n)return}else a={x:(r-f)/u,y:r};s={x:(n-f)/u,y:n}}else if(x>h){if(a){if(a.x>=i)return}else a={x:t,y:u*t+f};s={x:i,y:u*i+f}}else{if(a){if(a.x<t)return}else a={x:i,y:u*i+f};s={x:t,y:u*t+f}}return e.a=a,e.b=s,!0}function c(e,t,n,i){for(var r,s=D.length;s--;)r=D[s],(!o(r,e,t,n,i)||!l(r,e,t,n,i)||Math.abs(r.a.x-r.b.x)<I&&Math.abs(r.a.y-r.b.y)<I)&&(r.a=r.b=null,D.splice(s,1))}function h(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function y(e){var t=e.circle;t&&(t.P||(J=t.N),F.remove(t),K.push(t),h(t),e.circle=null)}function x(){h(this),this.x=this.y=this.arc=this.site=this.cy=null}function v(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,s=n.site;if(i!==s){var u=r.x,f=r.y,a=i.x-u,l=i.y-f,o=s.x-u,c=s.y-f,h=2*(a*c-l*o);if(!(h>=-O)){var y=a*a+l*l,v=o*o+c*c,g=(c*y-l*v)/h,C=(a*v-o*y)/h,c=C+f,d=K.pop()||new x;d.arc=e,d.site=r,d.x=g+u,d.y=c+Math.sqrt(g*g+C*C),d.cy=c,e.circle=d;for(var p=null,L=F._;L;)if(d.y<L.y||d.y===L.y&&d.x<=L.x){if(!L.L){p=L.P;break}L=L.L}else{if(!L.R){p=L;break}L=L.R}F.insert(p,d),p||(J=d)}}}}function g(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function C(e,t,n,i){var s=new r(e,t);return D.push(s),n&&g(s,e,t,n),i&&g(s,t,e,i),B[e.i].edges.push(f(s,e,t)),B[t.i].edges.push(f(s,t,e)),s}function d(){h(this),this.edge=this.site=this.circle=null}function p(e){var t=Q.pop()||new d;return t.site=e,t}function L(e){y(e),G.remove(e),Q.push(e),h(e)}function b(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},s=e.P,u=e.N,f=[e];L(e);for(var a=s;a.circle&&Math.abs(n-a.circle.x)<I&&Math.abs(i-a.circle.cy)<I;)s=a.P,f.unshift(a),L(a),a=s;f.unshift(a),y(a);for(var l=u;l.circle&&Math.abs(n-l.circle.x)<I&&Math.abs(i-l.circle.cy)<I;)u=l.N,f.push(l),L(l),l=u;f.push(l),y(l);var o,c=f.length;for(o=1;c>o;++o)l=f[o],a=f[o-1],g(l.edge,a.site,l.site,r);a=f[0],l=f[c-1],l.edge=C(a.site,l.site,null,r),v(a),v(l)}function R(e){this.site=e,this.edges=[]}function M(e){return B[e.i]=new R(e)}function U(e,t){var n=e.site,i=n.x,r=n.y,s=r-t;if(!s)return i;var u=e.P;if(!u)return-(1/0);n=u.site;var f=n.x,a=n.y,l=a-t;if(!l)return f;var o=f-i,c=1/s-1/l,h=o/l;return c?(-h+Math.sqrt(h*h-2*c*(o*o/(-2*l)-a+l/2+r-s/2)))/c+i:(i+f)/2}function N(e,t){var n=e.N;if(n)return U(n,t);var i=e.site;return i.y===t?i.x:1/0}function P(e){for(var t,n,i,r,s=e.x,u=e.y,f=G._;f;)if(i=U(f,u)-s,i>I)f=f.L;else{if(r=s-N(f,u),!(r>I)){i>-I?(t=f.P,n=f):r>-I?(t=f,n=f.N):t=n=f;break}if(!f.R){t=f;break}f=f.R}M(e);var a=p(e);if(G.insert(t,a),t||n){if(t===n)return y(t),n=p(t.site),G.insert(a,n),a.edge=n.edge=C(t.site,a.site),v(t),void v(n);if(!n)return void(a.edge=C(t.site,a.site));y(t),y(n);var l=t.site,o=l.x,c=l.y,h=e.x-o,x=e.y-c,d=n.site,L=d.x-o,b=d.y-c,R=2*(h*b-x*L),P=h*h+x*x,_=L*L+b*b,m={x:(b*P-x*_)/R+o,y:(h*_-L*P)/R+c};g(n.edge,l,d,m),a.edge=C(l,e,null,m),n.edge=C(e,d,null,m),v(t),v(n)}}function _(){this._=null}function m(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function w(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function k(e){for(;e.L;)e=e.L;return e}function q(e,t){return t.y-e.y||t.x-e.x}function A(e,t){var n,i,r,s=e.sort(q).pop();for(D=[],B=new Array(e.length),G=new _,F=new _;;)if(r=J,s&&(!r||s.y<r.y||s.y===r.y&&s.x<r.x))(s.x!==n||s.y!==i)&&(P(s),n=s.x,i=s.y),s=e.pop();else{if(!r)break;b(r.arc)}if(t){var n=t[0][0],i=t[0][1],u=t[1][0],f=t[1][1];c(n,i,u,f),a(n,i,u,f)}var l={cells:B,edges:D};return G=F=D=B=null,l}function E(e){return e[1]}function j(e){return e[0]}function z(){function e(e){var t=new Array(e.length),n=l[0][0],i=l[0][1],s=l[1][0],u=l[1][1];return A(r(e),l).cells.forEach(function(r,f){var a=r.edges,l=r.site,o=t[f]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):l.x>=n&&l.x<=s&&l.y>=i&&l.y<=u?[[n,u],[s,u],[s,i],[n,i]]:[];o.point=e[f]}),t}function r(e){return e.map(function(e,t){return{x:Math.round(f(e,t)/I)*I,y:Math.round(a(e,t)/I)*I,i:t}})}var s=j,u=E,f=s,a=u,l=H;return e.links=function(e){return A(r(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},e.triangles=function(e){var t=[];return A(r(e)).cells.forEach(function(r,s){for(var u,f,a=r.site,l=r.edges.sort(i),o=-1,c=l.length,h=l[c-1].edge,y=h.l===a?h.r:h.l;++o<c;)u=h,f=y,h=l[o].edge,y=h.l===a?h.r:h.l,s<f.i&&s<y.i&&n(a,f,y)<0&&t.push([e[s],e[f.i],e[y.i]])}),t},e.x=function(n){return arguments.length?(s=n,f=\"function\"==typeof n?s:t(s),e):s},e.y=function(n){return arguments.length?(u=n,a=\"function\"==typeof n?u:t(u),e):u},e.extent=function(t){return arguments.length?(l=null==t?H:t,e):l===H?null:l},e.size=function(t){return arguments.length?e.extent(t&&[[0,0],t]):l===H?null:l&&l[1]},e}var B,D,F,G,H=[[-1e6,-1e6],[1e6,1e6]],I=1e-6;u.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}};var J,K=[],O=1e-12,Q=[];R.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(i),t.length},_.prototype={insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=k(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(w(this,n),e=n,n=e.U),n.C=!1,i.C=!0,m(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(m(this,n),e=n,n=e.U),n.C=!1,i.C=!0,w(this,i))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,s=e.L,u=e.R;if(n=s?u?k(u):s:u,r?r.L===e?r.L=n:r.R=n:this._=n,s&&u?(i=n.C,n.C=e.C,n.L=s,s.U=n,n!==u?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=u,u.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,w(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,m(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,w(this,r),e=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,m(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,w(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,m(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}},e.voronoi=z});\n\nvar canvas = document.body.appendChild(document.createElement(\"canvas\")),\n    width,\n    height,\n    context;\n\nvar n = 400,\n    particles = new Array(n),\n    voro = voronoi.voronoi();\n\ninit();\n\ntimer.timer(function(elapsed) {\n  for (var i = 0; i < n; ++i) {\n    var p = particles[i];\n    p[0] += p.vx; if (p[0] < 0) p[0] += width; else if (p[0] > width) p[0] -= width;\n    p[1] += p.vy; if (p[1] < 0) p[1] += height; else if (p[1] > height) p[1] -= height;\n    p.vx += 0.2 * (Math.random() - .5) - 0.01 * p.vx;\n    p.vy += 0.2 * (Math.random() - .5) - 0.01 * p.vy;\n  }\n\n  var cells = voro(particles);\n\n  context.beginPath();\n  cells.forEach(drawCell);\n  context.globalAlpha = 0.2;\n  context.lineWidth = 4;\n  context.strokeStyle = \"#000\";\n  context.stroke();\n\n  context.beginPath();\n  cells.forEach(drawCell);\n  context.globalAlpha = 1;\n  context.strokeStyle = \"#fff\";\n  context.lineWidth = 1;\n  context.stroke();\n});\n\nfunction init() {\n  width = canvas.width = window.innerWidth;\n  height = canvas.height = window.innerHeight;\n  context = canvas.getContext(\"2d\");\n  for (var i = 0; i < n; ++i) {\n    particles[i] = {\n      0: Math.random() * width,\n      1: Math.random() * height,\n      vx: 0,\n      vy: 0\n    };\n  }\n}\n\nfunction drawCell(cell) {\n  context.moveTo(cell[0][0], cell[0][1]);\n  for (var i = 1, n = cell.length; i < n; ++i) context.lineTo(cell[i][0], cell[i][1]);\n  context.closePath();\n}\n\nwindow.addEventListener(\"resize\", init);\n\n</script>\n","filenames":[".block","index.html","thumbnail.png"],"thumb":"8cf11ae5647413cc49122c02511187728535fc96"},"sort":[1435980759000]},{"_index":"blockbuilder","_type":"blocks","_id":"615dfa9bf9b55878f7f6","_score":null,"_source":{"userId":"mbostock","description":"Colorcomb","created_at":"2015-07-03T15:47:05Z","updated_at":"2016-02-09T01:49:51Z","api":[],"colors":["#000000","#ffc0cb","#ffb6c1","#ff69b4","#ff1493","#db7093","#c71585","#ffa07a","#fa8072","#e9967a","#f08080","#cd5c5c","#dc143c","#b22222","#8b0000","#ff0000","#ff4500","#ff6347","#ff7f50","#ff8c00","#ffa500","#ffff00","#ffffe0","#fffacd","#fafad2","#ffefd5","#ffe4b5","#ffdab9","#eee8aa","#f0e68c","#bdb76b","#ffd700","#fff8dc","#ffebcd","#ffe4c4","#ffdead","#f5deb3","#deb887","#d2b48c","#bc8f8f","#f4a460","#daa520","#b8860b","#cd853f","#d2691e","#8b4513","#a0522d","#a52a2a","#800000","#556b2f","#808000","#6b8e23","#9acd32","#32cd32","#00ff00","#7cfc00","#7fff00","#adff2f","#00ff7f","#00fa9a","#90ee90","#98fb98","#8fbc8f","#3cb371","#2e8b57","#228b22","#008000","#006400","#66cdaa","#00ffff","#e0ffff","#afeeee","#7fffd4","#40e0d0","#48d1cc","#00ced1","#20b2aa","#5f9ea0","#008b8b","#008080","#b0c4de","#b0e0e6","#add8e6","#87ceeb","#87cefa","#00bfff","#1e90ff","#6495ed","#4682b4","#4169e1","#0000ff","#0000cd","#00008b","#000080","#191970","#e6e6fa","#d8bfd8","#dda0dd","#ee82ee","#da70d6","#ff00ff","#ba55d3","#9370db","#8a2be2","#9400d3","#9932cc","#8b008b","#800080","#4b0082","#483d8b","#663399","#6a5acd","#7b68ee","#ffffff","#fffafa","#f0fff0","#f5fffa","#f0ffff","#f0f8ff","#f8f8ff","#f5f5f5","#fff5ee","#f5f5dc","#fdf5e6","#fffaf0","#fffff0","#faebd7","#faf0e6","#fff0f5","#ffe4e1","#dcdcdc","#d3d3d3","#c0c0c0","#a9a9a9","#808080","#696969","#778899","#708090","#2f4f4f"],"readme":"","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n\nbody {\n  margin: 0;\n}\n\n</style>\n<body>\n<script>\n\n/* https://github.com/d3/d3-timer Copyright 2015 Mike Bostock */\n\"undefined\"==typeof requestAnimationFrame&&(requestAnimationFrame=\"undefined\"!=typeof window&&(window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame)||function(e){return setTimeout(e,17)}),function(e,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?n(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],n):n(e.timer={})}(this,function(e){\"use strict\";function n(){r=m=0,c=1/0,t(u())}function t(e){if(!r){var t=e-Date.now();t>24?c>e&&(m&&clearTimeout(m),m=setTimeout(n,t),c=e):(m&&(m=clearTimeout(m),c=1/0),r=requestAnimationFrame(n))}}function i(e,n,i){i=null==i?Date.now():+i,null!=n&&(i+=+n);var o={callback:e,time:i,flush:!1,next:null};a?a.next=o:f=o,a=o,t(i)}function o(e,n,t){t=null==t?Date.now():+t,null!=n&&(t+=+n),l.callback=e,l.time=t}function u(e){e=null==e?Date.now():+e;var n=l;for(l=f;l;)e>=l.time&&(l.flush=l.callback(e-l.time,e)),l=l.next;l=n,e=1/0;for(var t,i=f;i;)i.flush?i=t?t.next=i.next:f=i.next:(i.time<e&&(e=i.time),i=(t=i).next);return a=t,e}var a,m,r,f,l,c=1/0;e.timer=i,e.timerReplace=o,e.timerFlush=u});\n\n/* https://github.com/d3/d3-color Copyright 2015 Mike Bostock */\n\"undefined\"==typeof Map?(Map=function(){this.clear()},Map.prototype={set:function(t,e){return this._[t]=e,this},get:function(t){return this._[t]},has:function(t){return t in this._},\"delete\":function(t){return t in this._&&delete this._[t]},clear:function(){this._=Object.create(null)},get size(){var t=0;for(var e in this._)++t;return t},forEach:function(t){for(var e in this._)t(this._[e],e,this)}}):function(){var t=new Map;t.set(0,0)!==t&&(t=t.set,Map.prototype.set=function(){return t.apply(this,arguments),this})}(),function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?e(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],e):e(t.color={})}(this,function(t){\"use strict\";function e(){}function s(t,e,s){this.r=Math.max(0,Math.min(255,Math.round(t))),this.g=Math.max(0,Math.min(255,Math.round(e))),this.b=Math.max(0,Math.min(255,Math.round(s)))}function n(t,e,s){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),isNaN(s)&&(s=0),\"#\"+(16>t?\"0\"+t.toString(16):t.toString(16))+(16>e?\"0\"+e.toString(16):e.toString(16))+(16>s?\"0\"+s.toString(16):s.toString(16))}function r(t,n,r){return 1===arguments.length&&(t instanceof e||(t=l(t)),t?(t=t.rgb(),r=t.b,n=t.g,t=t.r):t=n=r=NaN),new s(t,n,r)}function i(t){return r(t>>16&255,t>>8&255,255&t)}function a(t,e,s){this.h=+t,this.s=Math.max(0,Math.min(1,+e)),this.l=Math.max(0,Math.min(1,+s))}function o(t,e,s){return 255*(60>t?e+(s-e)*t/60:180>t?s:240>t?e+(s-e)*(240-t)/60:e)}function h(t,s,n){if(1===arguments.length)if(t instanceof a)n=t.l,s=t.s,t=t.h;else if(t instanceof e||(t=l(t)),t){if(t instanceof a)return t;t=t.rgb();var r=t.r/255,i=t.g/255,o=t.b/255,h=Math.min(r,i,o),u=Math.max(r,i,o),c=u-h;n=(u+h)/2,c?(s=.5>n?c/(u+h):c/(2-u-h),t=r===u?(i-o)/c+6*(o>i):i===u?(o-r)/c+2:(r-i)/c+4,t*=60):(t=NaN,s=n>0&&1>n?0:t)}else t=s=n=NaN;return new a(t,s,n)}function l(t){var e;return t=(t+\"\").trim().toLowerCase(),(e=R.exec(t))?(e=parseInt(e[1],16),r(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e)):(e=E.exec(t))?i(parseInt(e[1],16)):(e=z.exec(t))?r(e[1],e[2],e[3]):(e=P.exec(t))?r(2.55*e[1],2.55*e[2],2.55*e[3]):(e=O.exec(t))?h(e[1],.01*e[2],.01*e[3]):L.has(t)?i(L.get(t)):null}function u(t,e,s){this.l=+t,this.a=+e,this.b=+s}function c(t){return 255*(.0031308>=t?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function g(t){return t>F?t*t*t:G*(t-D)}function f(t){return t>T?Math.pow(t,1/3):t/G+D}function d(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function p(t,e,s){this.h=+t,this.c=+e,this.l=+s}function b(t,e,n){if(1===arguments.length)if(t instanceof u)n=t.b,e=t.a,t=t.l;else if(t instanceof p){var i=t.h*U;n=Math.sin(i)*t.c,e=Math.cos(i)*t.c,t=t.l}else{t instanceof s||(t=r(t));var a=d(t.r),o=d(t.g),n=d(t.b),h=f((.4124564*a+.3575761*o+.1804375*n)/K),l=f((.2126729*a+.7151522*o+.072175*n)/Q),c=f((.0193339*a+.119192*o+.9503041*n)/J);n=200*(l-c),e=500*(h-l),t=116*l-16}return new u(t,e,n)}function N(t,e,s){return 1===arguments.length&&(t instanceof p?(s=t.l,e=t.c,t=t.h):(t instanceof u||(t=b(t)),s=t.l,e=Math.sqrt(t.a*t.a+t.b*t.b),t=Math.atan2(t.b,t.a)*W,0>t&&(t+=360))),new p(t,e,s)}function m(t,e,s){this.h=+t,this.s=+e,this.l=+s}function w(t,e,n){if(1===arguments.length)if(t instanceof m)n=t.l,e=t.s,t=t.h;else{t instanceof s||(t=r(t));var i=t.r/255,a=t.g/255,o=t.b/255;n=(at*o+it*i-rt*a)/(at+it-rt);var h=o-n,l=(Y*(a-n)-tt*h)/Z,u=Math.pow(n,nt);e=Math.sqrt(l*l+h*h)/(Y*u*(1-u)),t=e?Math.atan2(l,h)*W-120:NaN,0>t&&(t+=360)}return new m(t,e,n)}function y(t,e){t=w(t),e=w(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function v(t,e){var s=(t-e)%360;return s+(s>180?-360:-180>s?360:0)}function M(t,e){t=w(t),e=w(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function k(t,e){t=N(t),e=N(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.c)?e.c:t.c,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.c)?0:e.c-n,o=e.l-r;return function(e){return t.h=s+i*e,t.c=n+a*e,t.l=r+o*e,t+\"\"}}function x(t,e){t=N(t),e=N(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.c)?e.c:t.c,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.c)?0:e.c-n,o=e.l-r;return function(e){return t.h=s+i*e,t.c=n+a*e,t.l=r+o*e,t+\"\"}}function q(t,e){t=b(t),e=b(e);var s=t.l,n=t.a,r=t.b,i=e.l-s,a=e.a-n,o=e.b-r;return function(e){return t.l=s+i*e,t.a=n+a*e,t.b=r+o*e,t+\"\"}}function _(t,e){t=h(t),e=h(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:e.h-s,a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function S(t,e){t=h(t),e=h(e);var s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?0:v(e.h,s),a=isNaN(e.s)?0:e.s-n,o=e.l-r;return function(e){return t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+\"\"}}function j(t,e){t=r(t),e=r(e);var s=t.r,i=t.g,a=t.b,o=e.r-s,h=e.g-i,l=e.b-a;return function(t){return n(Math.round(s+o*t),Math.round(i+h*t),Math.round(a+l*t))}}e.prototype={toString:function(){return this.rgb()+\"\"}};var L=(new Map).set(\"aliceblue\",15792383).set(\"antiquewhite\",16444375).set(\"aqua\",65535).set(\"aquamarine\",8388564).set(\"azure\",15794175).set(\"beige\",16119260).set(\"bisque\",16770244).set(\"black\",0).set(\"blanchedalmond\",16772045).set(\"blue\",255).set(\"blueviolet\",9055202).set(\"brown\",10824234).set(\"burlywood\",14596231).set(\"cadetblue\",6266528).set(\"chartreuse\",8388352).set(\"chocolate\",13789470).set(\"coral\",16744272).set(\"cornflowerblue\",6591981).set(\"cornsilk\",16775388).set(\"crimson\",14423100).set(\"cyan\",65535).set(\"darkblue\",139).set(\"darkcyan\",35723).set(\"darkgoldenrod\",12092939).set(\"darkgray\",11119017).set(\"darkgreen\",25600).set(\"darkgrey\",11119017).set(\"darkkhaki\",12433259).set(\"darkmagenta\",9109643).set(\"darkolivegreen\",5597999).set(\"darkorange\",16747520).set(\"darkorchid\",10040012).set(\"darkred\",9109504).set(\"darksalmon\",15308410).set(\"darkseagreen\",9419919).set(\"darkslateblue\",4734347).set(\"darkslategray\",3100495).set(\"darkslategrey\",3100495).set(\"darkturquoise\",52945).set(\"darkviolet\",9699539).set(\"deeppink\",16716947).set(\"deepskyblue\",49151).set(\"dimgray\",6908265).set(\"dimgrey\",6908265).set(\"dodgerblue\",2003199).set(\"firebrick\",11674146).set(\"floralwhite\",16775920).set(\"forestgreen\",2263842).set(\"fuchsia\",16711935).set(\"gainsboro\",14474460).set(\"ghostwhite\",16316671).set(\"gold\",16766720).set(\"goldenrod\",14329120).set(\"gray\",8421504).set(\"green\",32768).set(\"greenyellow\",11403055).set(\"grey\",8421504).set(\"honeydew\",15794160).set(\"hotpink\",16738740).set(\"indianred\",13458524).set(\"indigo\",4915330).set(\"ivory\",16777200).set(\"khaki\",15787660).set(\"lavender\",15132410).set(\"lavenderblush\",16773365).set(\"lawngreen\",8190976).set(\"lemonchiffon\",16775885).set(\"lightblue\",11393254).set(\"lightcoral\",15761536).set(\"lightcyan\",14745599).set(\"lightgoldenrodyellow\",16448210).set(\"lightgray\",13882323).set(\"lightgreen\",9498256).set(\"lightgrey\",13882323).set(\"lightpink\",16758465).set(\"lightsalmon\",16752762).set(\"lightseagreen\",2142890).set(\"lightskyblue\",8900346).set(\"lightslategray\",7833753).set(\"lightslategrey\",7833753).set(\"lightsteelblue\",11584734).set(\"lightyellow\",16777184).set(\"lime\",65280).set(\"limegreen\",3329330).set(\"linen\",16445670).set(\"magenta\",16711935).set(\"maroon\",8388608).set(\"mediumaquamarine\",6737322).set(\"mediumblue\",205).set(\"mediumorchid\",12211667).set(\"mediumpurple\",9662683).set(\"mediumseagreen\",3978097).set(\"mediumslateblue\",8087790).set(\"mediumspringgreen\",64154).set(\"mediumturquoise\",4772300).set(\"mediumvioletred\",13047173).set(\"midnightblue\",1644912).set(\"mintcream\",16121850).set(\"mistyrose\",16770273).set(\"moccasin\",16770229).set(\"navajowhite\",16768685).set(\"navy\",128).set(\"oldlace\",16643558).set(\"olive\",8421376).set(\"olivedrab\",7048739).set(\"orange\",16753920).set(\"orangered\",16729344).set(\"orchid\",14315734).set(\"palegoldenrod\",15657130).set(\"palegreen\",10025880).set(\"paleturquoise\",11529966).set(\"palevioletred\",14381203).set(\"papayawhip\",16773077).set(\"peachpuff\",16767673).set(\"peru\",13468991).set(\"pink\",16761035).set(\"plum\",14524637).set(\"powderblue\",11591910).set(\"purple\",8388736).set(\"rebeccapurple\",6697881).set(\"red\",16711680).set(\"rosybrown\",12357519).set(\"royalblue\",4286945).set(\"saddlebrown\",9127187).set(\"salmon\",16416882).set(\"sandybrown\",16032864).set(\"seagreen\",3050327).set(\"seashell\",16774638).set(\"sienna\",10506797).set(\"silver\",12632256).set(\"skyblue\",8900331).set(\"slateblue\",6970061).set(\"slategray\",7372944).set(\"slategrey\",7372944).set(\"snow\",16775930).set(\"springgreen\",65407).set(\"steelblue\",4620980).set(\"tan\",13808780).set(\"teal\",32896).set(\"thistle\",14204888).set(\"tomato\",16737095).set(\"turquoise\",4251856).set(\"violet\",15631086).set(\"wheat\",16113331).set(\"white\",16777215).set(\"whitesmoke\",16119285).set(\"yellow\",16776960).set(\"yellowgreen\",10145074),$=s.prototype=new e,H=.7;$.darker=function(t){return t=null==t?H:Math.pow(H,t),new s(this.r*t,this.g*t,this.b*t)};var I=1/H;$.brighter=function(t){return t=null==t?I:Math.pow(I,t),new s(this.r*t,this.g*t,this.b*t)},$.rgb=function(){return this},$.toString=function(){return n(this.r,this.g,this.b)};var C=a.prototype=new e;C.brighter=function(t){return t=null==t?I:Math.pow(I,t),new a(this.h,this.s,this.l*t)},C.darker=function(t){return t=null==t?H:Math.pow(H,t),new a(this.h,this.s,this.l*t)},C.rgb=function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=.5>=n?n*(1+e):n+e-n*e,i=2*n-r;return new s(o(t>=240?t-240:t+120,i,r),o(t,i,r),o(120>t?t+240:t-120,i,r))};var O=/^hsl\\(\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*\\)$/,P=/^rgb\\(\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)%\\s*\\)$/,z=/^rgb\\(\\s*([-+]?\\d+)\\s*,\\s*([-+]?\\d+)\\s*,\\s*([-+]?\\d+)\\s*\\)$/,E=/^#([0-9a-f]{6})$/,R=/^#([0-9a-f]{3})$/;l.prototype=e.prototype,r.prototype=s.prototype,h.prototype=a.prototype;var A=u.prototype=new e,B=18;A.brighter=function(t){return new u(this.l+B*(null==t?1:t),this.a,this.b)},A.darker=function(t){return new u(this.l-B*(null==t?1:t),this.a,this.b)};var D=4/29,F=6/29,G=3*F*F,J=1.08883,K=.95047,Q=1;A.rgb=function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=Q*g(t),e=K*g(e),n=J*g(n),new s(c(3.2404542*e-1.5371385*t-.4985314*n),c(-.969266*e+1.8760108*t+.041556*n),c(.0556434*e-.2040259*t+1.0572252*n))};var T=F*F*F,U=Math.PI/180,V=p.prototype=new e;V.brighter=function(t){return new p(this.h,this.c,this.l+B*(null==t?1:t))},V.darker=function(t){return new p(this.h,this.c,this.l-B*(null==t?1:t))},V.rgb=function(){return b(this).rgb()},b.prototype=u.prototype;var W=180/Math.PI;N.prototype=p.prototype;var X=m.prototype=new e;X.brighter=function(t){return t=null==t?I:Math.pow(I,t),new m(this.h,this.s,this.l*t)},X.darker=function(t){return t=null==t?H:Math.pow(H,t),new m(this.h,this.s,this.l*t)};var Y=1.97294,Z=-.90649,tt=-.29227,et=1.78277,st=-.14861,nt=1,rt=Y*et,it=Y*Z,at=et*tt-Z*st;X.rgb=function(){var t=isNaN(this.h)?0:(this.h+120)*U,e=Math.pow(this.l,nt),n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new s(255*(e+n*(st*r+et*i)),255*(e+n*(tt*r+Z*i)),255*(e+n*Y*r))},w.prototype=m.prototype,t.color=l,t.rgb=r,t.hsl=h,t.lab=b,t.hcl=N,t.cubehelix=w,t.interpolateRgb=j,t.interpolateHsl=S,t.interpolateHslLong=_,t.interpolateLab=q,t.interpolateHcl=x,t.interpolateHclLong=k,t.interpolateCubehelix=M,t.interpolateCubehelixLong=y});\n\n/* https://github.com/d3/d3-voronoi Copyright 2015 Mike Bostock */\n!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t(e.voronoi={})}(this,function(e){\"use strict\";function t(e){return function(){return e}}function n(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function i(e,t){return t.angle-e.angle}function r(e,t){this.l=e,this.r=t,this.a=this.b=null}function s(e,t,n){var i=new r(e,null);return i.a=t,i.b=n,D.push(i),i}function u(e,t,n){this.edge=e,this.site=t,this.angle=n}function f(e,t,n){var i=e.a,r=e.b;return new u(e,t,n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y))}function a(e,t,n,i){for(var r,u,a,l,o,c,h,y,x,v,g=B.length;g--;)if(o=B[g],o&&o.prepare())for(h=o.edges,y=h.length,c=0;y>c;)v=h[c].end(),a=v.x,l=v.y,x=h[++c%y].start(),r=x.x,u=x.y,(Math.abs(a-r)>I||Math.abs(l-u)>I)&&(h.splice(c,0,f(s(o.site,v,Math.abs(a-e)<I&&i-l>I?{x:e,y:Math.abs(r-e)<I?u:i}:Math.abs(l-i)<I&&n-a>I?{x:Math.abs(u-i)<I?r:n,y:i}:Math.abs(a-n)<I&&l-t>I?{x:n,y:Math.abs(r-n)<I?u:t}:Math.abs(l-t)<I&&a-e>I?{x:Math.abs(u-t)<I?r:e,y:t}:null),o.site,null)),++y)}function l(e,t,n,i,r){var s,u=e.a,f=e.b,a=u.x,l=u.y,o=f.x,c=f.y,h=0,y=1,x=o-a,v=c-l;if(s=t-a,x||!(s>0)){if(s/=x,0>x){if(h>s)return;y>s&&(y=s)}else if(x>0){if(s>y)return;s>h&&(h=s)}if(s=i-a,x||!(0>s)){if(s/=x,0>x){if(s>y)return;s>h&&(h=s)}else if(x>0){if(h>s)return;y>s&&(y=s)}if(s=n-l,v||!(s>0)){if(s/=v,0>v){if(h>s)return;y>s&&(y=s)}else if(v>0){if(s>y)return;s>h&&(h=s)}if(s=r-l,v||!(0>s)){if(s/=v,0>v){if(s>y)return;s>h&&(h=s)}else if(v>0){if(h>s)return;y>s&&(y=s)}return h>0&&(e.a={x:a+h*x,y:l+h*v}),1>y&&(e.b={x:a+y*x,y:l+y*v}),e}}}}}function o(e,t,n,i,r){var s=e.b;if(s)return!0;var u,f,a=e.a,l=e.l,o=e.r,c=l.x,h=l.y,y=o.x,x=o.y,v=(c+y)/2,g=(h+x)/2;if(x===h){if(t>v||v>=i)return;if(c>y){if(a){if(a.y>=r)return}else a={x:v,y:n};s={x:v,y:r}}else{if(a){if(a.y<n)return}else a={x:v,y:r};s={x:v,y:n}}}else if(u=(c-y)/(x-h),f=g-u*v,-1>u||u>1)if(c>y){if(a){if(a.y>=r)return}else a={x:(n-f)/u,y:n};s={x:(r-f)/u,y:r}}else{if(a){if(a.y<n)return}else a={x:(r-f)/u,y:r};s={x:(n-f)/u,y:n}}else if(x>h){if(a){if(a.x>=i)return}else a={x:t,y:u*t+f};s={x:i,y:u*i+f}}else{if(a){if(a.x<t)return}else a={x:i,y:u*i+f};s={x:t,y:u*t+f}}return e.a=a,e.b=s,!0}function c(e,t,n,i){for(var r,s=D.length;s--;)r=D[s],(!o(r,e,t,n,i)||!l(r,e,t,n,i)||Math.abs(r.a.x-r.b.x)<I&&Math.abs(r.a.y-r.b.y)<I)&&(r.a=r.b=null,D.splice(s,1))}function h(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function y(e){var t=e.circle;t&&(t.P||(J=t.N),F.remove(t),K.push(t),h(t),e.circle=null)}function x(){h(this),this.x=this.y=this.arc=this.site=this.cy=null}function v(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,s=n.site;if(i!==s){var u=r.x,f=r.y,a=i.x-u,l=i.y-f,o=s.x-u,c=s.y-f,h=2*(a*c-l*o);if(!(h>=-O)){var y=a*a+l*l,v=o*o+c*c,g=(c*y-l*v)/h,C=(a*v-o*y)/h,c=C+f,d=K.pop()||new x;d.arc=e,d.site=r,d.x=g+u,d.y=c+Math.sqrt(g*g+C*C),d.cy=c,e.circle=d;for(var p=null,L=F._;L;)if(d.y<L.y||d.y===L.y&&d.x<=L.x){if(!L.L){p=L.P;break}L=L.L}else{if(!L.R){p=L;break}L=L.R}F.insert(p,d),p||(J=d)}}}}function g(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function C(e,t,n,i){var s=new r(e,t);return D.push(s),n&&g(s,e,t,n),i&&g(s,t,e,i),B[e.i].edges.push(f(s,e,t)),B[t.i].edges.push(f(s,t,e)),s}function d(){h(this),this.edge=this.site=this.circle=null}function p(e){var t=Q.pop()||new d;return t.site=e,t}function L(e){y(e),G.remove(e),Q.push(e),h(e)}function b(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},s=e.P,u=e.N,f=[e];L(e);for(var a=s;a.circle&&Math.abs(n-a.circle.x)<I&&Math.abs(i-a.circle.cy)<I;)s=a.P,f.unshift(a),L(a),a=s;f.unshift(a),y(a);for(var l=u;l.circle&&Math.abs(n-l.circle.x)<I&&Math.abs(i-l.circle.cy)<I;)u=l.N,f.push(l),L(l),l=u;f.push(l),y(l);var o,c=f.length;for(o=1;c>o;++o)l=f[o],a=f[o-1],g(l.edge,a.site,l.site,r);a=f[0],l=f[c-1],l.edge=C(a.site,l.site,null,r),v(a),v(l)}function R(e){this.site=e,this.edges=[]}function M(e){return B[e.i]=new R(e)}function U(e,t){var n=e.site,i=n.x,r=n.y,s=r-t;if(!s)return i;var u=e.P;if(!u)return-(1/0);n=u.site;var f=n.x,a=n.y,l=a-t;if(!l)return f;var o=f-i,c=1/s-1/l,h=o/l;return c?(-h+Math.sqrt(h*h-2*c*(o*o/(-2*l)-a+l/2+r-s/2)))/c+i:(i+f)/2}function N(e,t){var n=e.N;if(n)return U(n,t);var i=e.site;return i.y===t?i.x:1/0}function P(e){for(var t,n,i,r,s=e.x,u=e.y,f=G._;f;)if(i=U(f,u)-s,i>I)f=f.L;else{if(r=s-N(f,u),!(r>I)){i>-I?(t=f.P,n=f):r>-I?(t=f,n=f.N):t=n=f;break}if(!f.R){t=f;break}f=f.R}M(e);var a=p(e);if(G.insert(t,a),t||n){if(t===n)return y(t),n=p(t.site),G.insert(a,n),a.edge=n.edge=C(t.site,a.site),v(t),void v(n);if(!n)return void(a.edge=C(t.site,a.site));y(t),y(n);var l=t.site,o=l.x,c=l.y,h=e.x-o,x=e.y-c,d=n.site,L=d.x-o,b=d.y-c,R=2*(h*b-x*L),P=h*h+x*x,_=L*L+b*b,m={x:(b*P-x*_)/R+o,y:(h*_-L*P)/R+c};g(n.edge,l,d,m),a.edge=C(l,e,null,m),n.edge=C(e,d,null,m),v(t),v(n)}}function _(){this._=null}function m(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function w(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function k(e){for(;e.L;)e=e.L;return e}function q(e,t){return t.y-e.y||t.x-e.x}function A(e,t){var n,i,r,s=e.sort(q).pop();for(D=[],B=new Array(e.length),G=new _,F=new _;;)if(r=J,s&&(!r||s.y<r.y||s.y===r.y&&s.x<r.x))(s.x!==n||s.y!==i)&&(P(s),n=s.x,i=s.y),s=e.pop();else{if(!r)break;b(r.arc)}if(t){var n=t[0][0],i=t[0][1],u=t[1][0],f=t[1][1];c(n,i,u,f),a(n,i,u,f)}var l={cells:B,edges:D};return G=F=D=B=null,l}function E(e){return e[1]}function j(e){return e[0]}function z(){function e(e){var t=new Array(e.length),n=l[0][0],i=l[0][1],s=l[1][0],u=l[1][1];return A(r(e),l).cells.forEach(function(r,f){var a=r.edges,l=r.site,o=t[f]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):l.x>=n&&l.x<=s&&l.y>=i&&l.y<=u?[[n,u],[s,u],[s,i],[n,i]]:[];o.point=e[f]}),t}function r(e){return e.map(function(e,t){return{x:Math.round(f(e,t)/I)*I,y:Math.round(a(e,t)/I)*I,i:t}})}var s=j,u=E,f=s,a=u,l=H;return e.links=function(e){return A(r(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},e.triangles=function(e){var t=[];return A(r(e)).cells.forEach(function(r,s){for(var u,f,a=r.site,l=r.edges.sort(i),o=-1,c=l.length,h=l[c-1].edge,y=h.l===a?h.r:h.l;++o<c;)u=h,f=y,h=l[o].edge,y=h.l===a?h.r:h.l,s<f.i&&s<y.i&&n(a,f,y)<0&&t.push([e[s],e[f.i],e[y.i]])}),t},e.x=function(n){return arguments.length?(s=n,f=\"function\"==typeof n?s:t(s),e):s},e.y=function(n){return arguments.length?(u=n,a=\"function\"==typeof n?u:t(u),e):u},e.extent=function(t){return arguments.length?(l=null==t?H:t,e):l===H?null:l},e.size=function(t){return arguments.length?e.extent(t&&[[0,0],t]):l===H?null:l&&l[1]},e}var B,D,F,G,H=[[-1e6,-1e6],[1e6,1e6]],I=1e-6;u.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}};var J,K=[],O=1e-12,Q=[];R.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(i),t.length},_.prototype={insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=k(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(w(this,n),e=n,n=e.U),n.C=!1,i.C=!0,m(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(m(this,n),e=n,n=e.U),n.C=!1,i.C=!0,w(this,i))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,s=e.L,u=e.R;if(n=s?u?k(u):s:u,r?r.L===e?r.L=n:r.R=n:this._=n,s&&u?(i=n.C,n.C=e.C,n.L=s,s.U=n,n!==u?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=u,u.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,w(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,m(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,w(this,r),e=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,m(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,w(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,m(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}},e.voronoi=z});\n\nvar canvas = document.body.appendChild(document.createElement(\"canvas\")),\n    width,\n    height,\n    context;\n\nvar n = 400,\n    particles = new Array(n),\n    voro = voronoi.voronoi();\n\ninit();\n\ntimer.timer(function(elapsed) {\n  for (var i = 0; i < n; ++i) {\n    var p = particles[i];\n    p[0] += p.vx; if (p[0] < 0) p[0] += width; else if (p[0] > width) p[0] -= width;\n    p[1] += p.vy; if (p[1] < 0) p[1] += height; else if (p[1] > height) p[1] -= height;\n    p.vx += 0.2 * (Math.random() - .5) - 0.01 * p.vx;\n    p.vy += 0.2 * (Math.random() - .5) - 0.01 * p.vy;\n  }\n\n  var cells = voro(particles);\n\n  context.beginPath();\n  cells.forEach(drawCell);\n  context.globalAlpha = 0.2;\n  context.strokeStyle = \"#000\";\n  context.lineWidth = 3;\n  context.stroke();\n\n  context.globalAlpha = 1.0;\n  context.lineWidth = 1;\n  cells.forEach(function(cell) {\n    context.beginPath();\n    drawCell(cell);\n    var c = color.hcl(color.lab(90, (cell.point[0] - width / 2) / width * 120, (cell.point[1] - height / 2) / width * 120));\n    c.h += elapsed * 0.1;\n    context.strokeStyle = c + \"\";\n    context.stroke();\n  });\n});\n\nfunction init() {\n  width = canvas.width = window.innerWidth;\n  height = canvas.height = window.innerHeight;\n  context = canvas.getContext(\"2d\");\n  for (var i = 0; i < n; ++i) {\n    particles[i] = {\n      0: Math.random() * width,\n      1: Math.random() * height,\n      vx: 0,\n      vy: 0\n    };\n  }\n}\n\nfunction drawCell(cell) {\n  context.moveTo(cell[0][0], cell[0][1]);\n  for (var i = 1, n = cell.length; i < n; ++i) context.lineTo(cell[i][0], cell[i][1]);\n  context.closePath();\n}\n\nwindow.addEventListener(\"resize\", init);\n\n</script>\n","filenames":[".block","index.html","thumbnail.png"],"thumb":"ce3e2c5ed1ea290118fe404f89a2fff1bf9a3a40"},"sort":[1435938425000]},{"_index":"blockbuilder","_type":"blocks","_id":"76342abc327062128604","_score":null,"_source":{"userId":"mbostock","description":"Color Mesh II","created_at":"2015-07-03T15:10:49Z","updated_at":"2015-10-31T02:02:57Z","api":["d3.geom.voronoi","d3.select","d3.lab"],"colors":[],"readme":"This version uses a Delaunay triangluation; compare to a [Voronoi diagram](/mbostock/99049112373e12709381).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 500,\n    radius = 30;\n\nvar sampler = poissonDiscSampler(width + radius * 2, height + radius * 2, radius),\n    samples = [],\n    sample;\n\nwhile (sample = sampler()) samples.push([sample[0] - radius, sample[1] - radius]);\n\nvar voronoi = d3.geom.voronoi()\n    .clipExtent([[-1, -1], [width + 1, height + 1]]);\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height);\n\nsvg.selectAll(\"path\")\n    .data(voronoi.triangles(samples).map(d3.geom.polygon))\n  .enter().append(\"path\")\n    .attr(\"d\", function(d) { return \"M\" + d.join(\"L\") + \"Z\"; })\n    .style(\"fill\", function(d) { return color(d.centroid()); })\n    .style(\"stroke\", function(d) { return color(d.centroid()); });\n\nfunction color(d) {\n  var dx = d[0] - width / 2,\n      dy = d[1] - height / 2;\n  return d3.lab(100 - (dx * dx + dy * dy) / 5000, dx / 10, dy / 10);\n}\n\n// Based on https://www.jasondavies.com/poisson-disc/\nfunction poissonDiscSampler(width, height, radius) {\n  var k = 30, // maximum number of samples before rejection\n      radius2 = radius * radius,\n      R = 3 * radius2,\n      cellSize = radius * Math.SQRT1_2,\n      gridWidth = Math.ceil(width / cellSize),\n      gridHeight = Math.ceil(height / cellSize),\n      grid = new Array(gridWidth * gridHeight),\n      queue = [],\n      queueSize = 0,\n      sampleSize = 0;\n\n  return function() {\n    if (!sampleSize) return sample(Math.random() * width, Math.random() * height);\n\n    // Pick a random existing sample and remove it from the queue.\n    while (queueSize) {\n      var i = Math.random() * queueSize | 0,\n          s = queue[i];\n\n      // Make a new candidate between [radius, 2 * radius] from the existing sample.\n      for (var j = 0; j < k; ++j) {\n        var a = 2 * Math.PI * Math.random(),\n            r = Math.sqrt(Math.random() * R + radius2),\n            x = s[0] + r * Math.cos(a),\n            y = s[1] + r * Math.sin(a);\n\n        // Reject candidates that are outside the allowed extent,\n        // or closer than 2 * radius to any existing sample.\n        if (0 <= x && x < width && 0 <= y && y < height && far(x, y)) return sample(x, y);\n      }\n\n      queue[i] = queue[--queueSize];\n      queue.length = queueSize;\n    }\n  };\n\n  function far(x, y) {\n    var i = x / cellSize | 0,\n        j = y / cellSize | 0,\n        i0 = Math.max(i - 2, 0),\n        j0 = Math.max(j - 2, 0),\n        i1 = Math.min(i + 3, gridWidth),\n        j1 = Math.min(j + 3, gridHeight);\n\n    for (j = j0; j < j1; ++j) {\n      var o = j * gridWidth;\n      for (i = i0; i < i1; ++i) {\n        if (s = grid[o + i]) {\n          var s,\n              dx = s[0] - x,\n              dy = s[1] - y;\n          if (dx * dx + dy * dy < radius2) return false;\n        }\n      }\n    }\n\n    return true;\n  }\n\n  function sample(x, y) {\n    var s = [x, y];\n    queue.push(s);\n    grid[gridWidth * (y / cellSize | 0) + (x / cellSize | 0)] = s;\n    ++sampleSize;\n    ++queueSize;\n    return s;\n  }\n}\n\n</script>\n","filenames":["README.md","index.html","thumbnail.png"],"thumb":"4011bbbe6fdd899cdbc2ef13667817da1530b7f4"},"sort":[1435936249000]},{"_index":"blockbuilder","_type":"blocks","_id":"99049112373e12709381","_score":null,"_source":{"userId":"mbostock","description":"Color Mesh","created_at":"2015-07-03T15:07:36Z","updated_at":"2016-02-09T01:49:54Z","api":["d3.geom.voronoi","d3.select","d3.lab"],"colors":[],"readme":"This version uses a Voronoi diagram; compare to a [Delaunay triangluation](/mbostock/76342abc327062128604).\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 500;\n\nvar sampler = poissonDiscSampler(width, height, 30),\n    samples = [],\n    sample;\n\nwhile (sample = sampler()) samples.push(sample);\n\nvar voronoi = d3.geom.voronoi()\n    .clipExtent([[-1, -1], [width + 1, height + 1]]);\n\nvar svg = d3.select(\"body\").append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height);\n\nsvg.selectAll(\"path\")\n    .data(voronoi(samples))\n  .enter().append(\"path\")\n    .attr(\"d\", function(d) { return \"M\" + d.join(\"L\") + \"Z\"; })\n    .style(\"fill\", function(d) { return color(d.point); })\n    .style(\"stroke\", function(d) { return color(d.point); });\n\nfunction color(d) {\n  var dx = d[0] - width / 2,\n      dy = d[1] - height / 2;\n  return d3.lab(100 - (dx * dx + dy * dy) / 5000, dx / 10, dy / 10);\n}\n\n// Based on https://www.jasondavies.com/poisson-disc/\nfunction poissonDiscSampler(width, height, radius) {\n  var k = 30, // maximum number of samples before rejection\n      radius2 = radius * radius,\n      R = 3 * radius2,\n      cellSize = radius * Math.SQRT1_2,\n      gridWidth = Math.ceil(width / cellSize),\n      gridHeight = Math.ceil(height / cellSize),\n      grid = new Array(gridWidth * gridHeight),\n      queue = [],\n      queueSize = 0,\n      sampleSize = 0;\n\n  return function() {\n    if (!sampleSize) return sample(Math.random() * width, Math.random() * height);\n\n    // Pick a random existing sample and remove it from the queue.\n    while (queueSize) {\n      var i = Math.random() * queueSize | 0,\n          s = queue[i];\n\n      // Make a new candidate between [radius, 2 * radius] from the existing sample.\n      for (var j = 0; j < k; ++j) {\n        var a = 2 * Math.PI * Math.random(),\n            r = Math.sqrt(Math.random() * R + radius2),\n            x = s[0] + r * Math.cos(a),\n            y = s[1] + r * Math.sin(a);\n\n        // Reject candidates that are outside the allowed extent,\n        // or closer than 2 * radius to any existing sample.\n        if (0 <= x && x < width && 0 <= y && y < height && far(x, y)) return sample(x, y);\n      }\n\n      queue[i] = queue[--queueSize];\n      queue.length = queueSize;\n    }\n  };\n\n  function far(x, y) {\n    var i = x / cellSize | 0,\n        j = y / cellSize | 0,\n        i0 = Math.max(i - 2, 0),\n        j0 = Math.max(j - 2, 0),\n        i1 = Math.min(i + 3, gridWidth),\n        j1 = Math.min(j + 3, gridHeight);\n\n    for (j = j0; j < j1; ++j) {\n      var o = j * gridWidth;\n      for (i = i0; i < i1; ++i) {\n        if (s = grid[o + i]) {\n          var s,\n              dx = s[0] - x,\n              dy = s[1] - y;\n          if (dx * dx + dy * dy < radius2) return false;\n        }\n      }\n    }\n\n    return true;\n  }\n\n  function sample(x, y) {\n    var s = [x, y];\n    queue.push(s);\n    grid[gridWidth * (y / cellSize | 0) + (x / cellSize | 0)] = s;\n    ++sampleSize;\n    ++queueSize;\n    return s;\n  }\n}\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"8ed665f1a670eee0dd311bff1d27725ae9993b12"},"sort":[1435936056000]},{"_index":"blockbuilder","_type":"blocks","_id":"ba63c55dd2dbc3ab0127","_score":null,"_source":{"userId":"mbostock","description":"This Is a Globe","created_at":"2015-07-03T05:23:22Z","updated_at":"2016-02-09T01:49:57Z","api":["d3.geo.orthographic","d3.select","d3.geo.path","d3.json","d3.timer"],"colors":[],"readme":"[This is not a globe.](/mbostock/2fb85b77236c24be5a6f) This is a globe.\n","code":"<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<body>\n<script src=\"//d3js.org/d3.v3.min.js\"></script>\n<script src=\"//d3js.org/topojson.v1.min.js\"></script>\n<script>\n\nvar width = 960,\n    height = 600;\n\nvar radius = height / 2 - 5,\n    scale = radius,\n    velocity = .02;\n\nvar projection = d3.geo.orthographic()\n    .translate([width / 2, height / 2])\n    .scale(scale)\n    .clipAngle(90);\n\nvar canvas = d3.select(\"body\").append(\"canvas\")\n    .attr(\"width\", width)\n    .attr(\"height\", height);\n\nvar context = canvas.node().getContext(\"2d\");\n\nvar path = d3.geo.path()\n    .projection(projection)\n    .context(context);\n\nd3.json(\"/mbostock/raw/4090846/world-110m.json\", function(error, world) {\n  if (error) throw error;\n\n  var land = topojson.feature(world, world.objects.land);\n\n  d3.timer(function(elapsed) {\n    context.clearRect(0, 0, width, height);\n\n    projection.rotate([velocity * elapsed, 0]);\n    context.beginPath();\n    path(land);\n    context.fill();\n\n    context.beginPath();\n    context.arc(width / 2, height / 2, radius, 0, 2 * Math.PI, true);\n    context.lineWidth = 2.5;\n    context.stroke();\n  });\n});\n\nd3.select(self.frameElement).style(\"height\", height + \"px\");\n\n</script>\n","filenames":[".block","README.md","index.html","thumbnail.png"],"thumb":"10faa2114cd7e238b68ccd636beca9ccc4b27b56"},"sort":[1435901002000]}]}}